root@828b5a21edb1:/workspace/CDTree# sh train_init.sh
Files already downloaded and verified
Files already downloaded and verified
============== Performance on task 0 =================
/workspace/CDTree/utils/models.py:1070: UserWarning: Implicit dimension choice for log_softmax has been deprecated. Change the call to include dim=X as an argument.
  return F.log_softmax(out)
/opt/conda/lib/python3.7/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Test set: Average loss: 1.2063, Top-1 Accuracy: 5020/6000 (83.6667%)
Took 4.084086179733276 seconds.
Test set: Average loss: 1.2063, Top-5 Accuracy: 5983.0/6000 (99.7167%)
Took 4.084086179733276 seconds.

----- Top1 acc: [83.66666412353516]
----- Top5 acc: [99.71666717529297]
============== Continual learning on task 1 =================

[before adaption and growth]
Test set: Average loss: 2.0534, Top-1 Accuracy: 4276/6000 (71.2667%)
Took 5.256698369979858 seconds.
Test set: Average loss: 2.0534, Top-5 Accuracy: 5934.0/6000 (98.9000%)
Took 5.256698369979858 seconds.
old_data shape: torch.Size([25000, 3072])
new_data_1 shape: torch.Size([25000, 3072])
MMD loss:tensor(0.3035, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[2]
tensor([1.], device='cuda:0')
[2]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 2.0534, Top-1 Accuracy: 4276/6000 (71.2667%)
Took 18.3420352935791 seconds.
Test set: Average loss: 2.0534, Top-5 Accuracy: 5934.0/6000 (98.9000%)
Took 18.3420352935791 seconds.
False
False
False

Perform global training

----- Layer 1, Node 1, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.390177
Train set: Average loss: 0.5554
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8371, Accuracy: 8262/12000 (69%)
Took 34.755727767944336 seconds.
Test set: Average loss: 1.9357, Top-1 Accuracy: 3917/6000 (65.2833%)
Took 35.803953647613525 seconds.
Test set: Average loss: 1.9357, Top-5 Accuracy: 5866.0/6000 (97.7667%)
Took 35.803953647613525 seconds.

----- Layer 1, Node 1, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.283027
Train set: Average loss: 0.3313
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7758, Accuracy: 8379/12000 (70%)
Took 52.180131912231445 seconds.
Test set: Average loss: 1.9507, Top-1 Accuracy: 3953/6000 (65.8833%)
Took 53.22552561759949 seconds.
Test set: Average loss: 1.9507, Top-5 Accuracy: 5923.0/6000 (98.7167%)
Took 53.22552561759949 seconds.

----- Layer 1, Node 1, Epoch 3/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.239082
Train set: Average loss: 0.2597
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.6393, Accuracy: 8649/12000 (72%)
Took 69.58808493614197 seconds.
Test set: Average loss: 1.7227, Top-1 Accuracy: 4147/6000 (69.1167%)
Took 70.6375458240509 seconds.
Test set: Average loss: 1.7227, Top-5 Accuracy: 5959.0/6000 (99.3167%)
Took 70.6375458240509 seconds.

----- Layer 1, Node 1, Epoch 4/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.215665
Train set: Average loss: 0.2284
Valid set: Average loss: 2.2375, Accuracy: 8326/12000 (69%)
Took 86.9863612651825 seconds.
Test set: Average loss: 2.3097, Top-1 Accuracy: 4027/6000 (67.1167%)
Took 88.05390954017639 seconds.
Test set: Average loss: 2.3097, Top-5 Accuracy: 5913.0/6000 (98.5500%)
Took 88.05390954017639 seconds.

----- Layer 1, Node 1, Epoch 5/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.180765
Train set: Average loss: 0.2033
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8963, Accuracy: 8662/12000 (72%)
Took 104.39217352867126 seconds.
Test set: Average loss: 1.9639, Top-1 Accuracy: 4181/6000 (69.6833%)
Took 105.44796514511108 seconds.
Test set: Average loss: 1.9639, Top-5 Accuracy: 5947.0/6000 (99.1167%)
Took 105.44796514511108 seconds.

----- Layer 1, Node 1, Epoch 6/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.151233
Train set: Average loss: 0.1760
Valid set: Average loss: 2.5215, Accuracy: 8132/12000 (68%)
Took 121.47890019416809 seconds.
Test set: Average loss: 2.6265, Top-1 Accuracy: 3921/6000 (65.3500%)
Took 122.5253963470459 seconds.
Test set: Average loss: 2.6265, Top-5 Accuracy: 5946.0/6000 (99.1000%)
Took 122.5253963470459 seconds.

----- Layer 1, Node 1, Epoch 7/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.128669
Train set: Average loss: 0.1643
Valid set: Average loss: 2.0159, Accuracy: 8570/12000 (71%)
Took 138.93667316436768 seconds.
Test set: Average loss: 2.0478, Top-1 Accuracy: 4189/6000 (69.8167%)
Took 139.98158025741577 seconds.
Test set: Average loss: 2.0478, Top-5 Accuracy: 5946.0/6000 (99.1000%)
Took 139.98158025741577 seconds.

----- Layer 1, Node 1, Epoch 8/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.121860
Train set: Average loss: 0.1429
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.6977, Accuracy: 8950/12000 (75%)
Took 155.7969880104065 seconds.
Test set: Average loss: 1.6491, Top-1 Accuracy: 4418/6000 (73.6333%)
Took 156.8012638092041 seconds.
Test set: Average loss: 1.6491, Top-5 Accuracy: 5956.0/6000 (99.2667%)
Took 156.8012638092041 seconds.

----- Layer 1, Node 1, Epoch 9/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.104334
Train set: Average loss: 0.1235
Valid set: Average loss: 1.8254, Accuracy: 8947/12000 (75%)
Took 172.34451460838318 seconds.
Test set: Average loss: 1.8220, Top-1 Accuracy: 4413/6000 (73.5500%)
Took 173.3398985862732 seconds.
Test set: Average loss: 1.8220, Top-5 Accuracy: 5949.0/6000 (99.1500%)
Took 173.3398985862732 seconds.

----- Layer 1, Node 1, Epoch 10/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.106805
Train set: Average loss: 0.1186
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7758, Accuracy: 8995/12000 (75%)
Took 188.89631748199463 seconds.
Test set: Average loss: 1.6410, Top-1 Accuracy: 4470/6000 (74.5000%)
Took 189.88940978050232 seconds.
Test set: Average loss: 1.6410, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 189.88940978050232 seconds.

----- Layer 1, Node 1, Epoch 11/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.107058
Train set: Average loss: 0.1138
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.6805, Accuracy: 9010/12000 (75%)
Took 205.62030339241028 seconds.
Test set: Average loss: 1.8779, Top-1 Accuracy: 4362/6000 (72.7000%)
Took 206.66731071472168 seconds.
Test set: Average loss: 1.8779, Top-5 Accuracy: 5926.0/6000 (98.7667%)
Took 206.66731071472168 seconds.

----- Layer 1, Node 1, Epoch 12/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.100269
Train set: Average loss: 0.1021
Valid set: Average loss: 1.7238, Accuracy: 8940/12000 (74%)
Took 223.02427911758423 seconds.
Test set: Average loss: 1.8013, Top-1 Accuracy: 4366/6000 (72.7667%)
Took 224.0700900554657 seconds.
Test set: Average loss: 1.8013, Top-5 Accuracy: 5934.0/6000 (98.9000%)
Took 224.0700900554657 seconds.

----- Layer 1, Node 1, Epoch 13/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.085988
Train set: Average loss: 0.0934
Valid set: Average loss: 2.2619, Accuracy: 8738/12000 (73%)
Took 240.15197610855103 seconds.
Test set: Average loss: 2.4902, Top-1 Accuracy: 4208/6000 (70.1333%)
Took 241.1530487537384 seconds.
Test set: Average loss: 2.4902, Top-5 Accuracy: 5899.0/6000 (98.3167%)
Took 241.1530487537384 seconds.

----- Layer 1, Node 1, Epoch 14/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.073834
Train set: Average loss: 0.0894
Valid set: Average loss: 2.2175, Accuracy: 8721/12000 (73%)
Took 256.66132855415344 seconds.
Test set: Average loss: 2.2381, Top-1 Accuracy: 4297/6000 (71.6167%)
Took 257.66990423202515 seconds.
Test set: Average loss: 2.2381, Top-5 Accuracy: 5927.0/6000 (98.7833%)
Took 257.66990423202515 seconds.

----- Layer 1, Node 1, Epoch 15/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.099964
Train set: Average loss: 0.0827
Valid set: Average loss: 1.9460, Accuracy: 9003/12000 (75%)
Took 273.73720717430115 seconds.
Test set: Average loss: 2.0189, Top-1 Accuracy: 4383/6000 (73.0500%)
Took 274.7682240009308 seconds.
Test set: Average loss: 2.0189, Top-5 Accuracy: 5938.0/6000 (98.9667%)
Took 274.7682240009308 seconds.

----- Layer 1, Node 1, Epoch 16/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.109382
Train set: Average loss: 0.0933
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8761, Accuracy: 9182/12000 (77%)
Took 290.9118072986603 seconds.
Test set: Average loss: 1.8989, Top-1 Accuracy: 4489/6000 (74.8167%)
Took 291.94243001937866 seconds.
Test set: Average loss: 1.8989, Top-5 Accuracy: 5962.0/6000 (99.3667%)
Took 291.94243001937866 seconds.

----- Layer 1, Node 1, Epoch 17/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.063526
Train set: Average loss: 0.0797
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7311, Accuracy: 9203/12000 (77%)
Took 308.0737717151642 seconds.
Test set: Average loss: 1.8592, Top-1 Accuracy: 4410/6000 (73.5000%)
Took 309.1173725128174 seconds.
Test set: Average loss: 1.8592, Top-5 Accuracy: 5965.0/6000 (99.4167%)
Took 309.1173725128174 seconds.

----- Layer 1, Node 1, Epoch 18/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.054749
Train set: Average loss: 0.0710
Valid set: Average loss: 1.7265, Accuracy: 9115/12000 (76%)
Took 325.2650737762451 seconds.
Test set: Average loss: 1.6670, Top-1 Accuracy: 4501/6000 (75.0167%)
Took 326.296911239624 seconds.
Test set: Average loss: 1.6670, Top-5 Accuracy: 5950.0/6000 (99.1667%)
Took 326.296911239624 seconds.

----- Layer 1, Node 1, Epoch 19/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.071260
Train set: Average loss: 0.0591
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7423, Accuracy: 9261/12000 (77%)
Took 342.4513931274414 seconds.
Test set: Average loss: 1.4791, Top-1 Accuracy: 4681/6000 (78.0167%)
Took 343.48430848121643 seconds.
Test set: Average loss: 1.4791, Top-5 Accuracy: 5953.0/6000 (99.2167%)
Took 343.48430848121643 seconds.

----- Layer 1, Node 1, Epoch 20/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.044477
Train set: Average loss: 0.0479
Valid set: Average loss: 2.0399, Accuracy: 9070/12000 (76%)
Took 359.6078543663025 seconds.
Test set: Average loss: 2.0208, Top-1 Accuracy: 4459/6000 (74.3167%)
Took 360.6376543045044 seconds.
Test set: Average loss: 2.0208, Top-5 Accuracy: 5933.0/6000 (98.8833%)
Took 360.6376543045044 seconds.

----- Layer 1, Node 1, Epoch 21/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.053721
Train set: Average loss: 0.0579
Valid set: Average loss: 1.8588, Accuracy: 9153/12000 (76%)
Took 376.7736999988556 seconds.
Test set: Average loss: 1.5639, Top-1 Accuracy: 4682/6000 (78.0333%)
Took 377.8047425746918 seconds.
Test set: Average loss: 1.5639, Top-5 Accuracy: 5938.0/6000 (98.9667%)
Took 377.8047425746918 seconds.

----- Layer 1, Node 1, Epoch 22/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.047691
Train set: Average loss: 0.0494
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.5840, Accuracy: 9532/12000 (79%)
Took 393.9300549030304 seconds.
Test set: Average loss: 1.4777, Top-1 Accuracy: 4776/6000 (79.6000%)
Took 394.96497344970703 seconds.
Test set: Average loss: 1.4777, Top-5 Accuracy: 5914.0/6000 (98.5667%)
Took 394.96497344970703 seconds.

----- Layer 1, Node 1, Epoch 23/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.063976
Train set: Average loss: 0.0532
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.3000, Accuracy: 9724/12000 (81%)
Took 411.087904214859 seconds.
Test set: Average loss: 1.1785, Top-1 Accuracy: 4882/6000 (81.3667%)
Took 412.12708616256714 seconds.
Test set: Average loss: 1.1785, Top-5 Accuracy: 5942.0/6000 (99.0333%)
Took 412.12708616256714 seconds.

----- Layer 1, Node 1, Epoch 24/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.062911
Train set: Average loss: 0.0545
Valid set: Average loss: 1.8453, Accuracy: 9327/12000 (78%)
Took 428.2085602283478 seconds.
Test set: Average loss: 2.0836, Top-1 Accuracy: 4508/6000 (75.1333%)
Took 429.2593994140625 seconds.
Test set: Average loss: 2.0836, Top-5 Accuracy: 5941.0/6000 (99.0167%)
Took 429.2593994140625 seconds.

----- Layer 1, Node 1, Epoch 25/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.046596
Train set: Average loss: 0.0528
Valid set: Average loss: 2.2044, Accuracy: 8723/12000 (73%)
Took 445.37780690193176 seconds.
Test set: Average loss: 2.0883, Top-1 Accuracy: 4368/6000 (72.8000%)
Took 446.4104585647583 seconds.
Test set: Average loss: 2.0883, Top-5 Accuracy: 5899.0/6000 (98.3167%)
Took 446.4104585647583 seconds.

----- Layer 1, Node 1, Epoch 26/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.006879
Train set: Average loss: 0.0247
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.3967, Accuracy: 9761/12000 (81%)
Took 462.8592040538788 seconds.
Test set: Average loss: 1.1762, Top-1 Accuracy: 4967/6000 (82.7833%)
Took 463.90917897224426 seconds.
Test set: Average loss: 1.1762, Top-5 Accuracy: 5964.0/6000 (99.4000%)
Took 463.90917897224426 seconds.

----- Layer 1, Node 1, Epoch 27/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.002317
Train set: Average loss: 0.0061
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.4122, Accuracy: 9818/12000 (82%)
Took 480.29600620269775 seconds.
Test set: Average loss: 1.2645, Top-1 Accuracy: 4947/6000 (82.4500%)
Took 481.3439612388611 seconds.
Test set: Average loss: 1.2645, Top-5 Accuracy: 5967.0/6000 (99.4500%)
Took 481.3439612388611 seconds.

----- Layer 1, Node 1, Epoch 28/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.001052
Train set: Average loss: 0.0031
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.4828, Accuracy: 9828/12000 (82%)
Took 497.7333104610443 seconds.
Test set: Average loss: 1.3341, Top-1 Accuracy: 4952/6000 (82.5333%)
Took 498.77929615974426 seconds.
Test set: Average loss: 1.3341, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 498.77929615974426 seconds.

----- Layer 1, Node 1, Epoch 29/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.000739
Train set: Average loss: 0.0023
Valid set: Average loss: 1.5802, Accuracy: 9783/12000 (82%)
Took 515.1326615810394 seconds.
Test set: Average loss: 1.4430, Top-1 Accuracy: 4916/6000 (81.9333%)
Took 516.1818895339966 seconds.
Test set: Average loss: 1.4430, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 516.1818895339966 seconds.

----- Layer 1, Node 1, Epoch 30/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.000539
Train set: Average loss: 0.0022
Valid set: Average loss: 1.6040, Accuracy: 9798/12000 (82%)
Took 532.548957824707 seconds.
Test set: Average loss: 1.4733, Top-1 Accuracy: 4917/6000 (81.9500%)
Took 533.5965924263 seconds.
Test set: Average loss: 1.4733, Top-5 Accuracy: 5958.0/6000 (99.3000%)
Took 533.5965924263 seconds.
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.3341, Top-1 Accuracy: 4952/6000 (82.5333%)
Took 534.667563199997 seconds.
Test set: Average loss: 1.3341, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 534.667563199997 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 1.1845, Top-1 Accuracy: 4994/6000 (83.2333%)
Took 535.566061258316 seconds.
Test set: Average loss: 1.1845, Top-5 Accuracy: 5940.0/6000 (99.0000%)
Took 535.566061258316 seconds.
Test set: Average loss: 1.3341, Top-1 Accuracy: 4952/6000 (82.5333%)
Took 536.613908290863 seconds.
Test set: Average loss: 1.3341, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 536.613908290863 seconds.

Average Top-1 accuracy: tensor(82.8833)

----- Top1 acc: [83.66666412353516, 82.88333129882812]
----- Top5 acc: [99.71666717529297, 99.16667175292969]
============== Continual learning on task 2 =================

[before adaption and growth]
Test set: Average loss: 5.1534, Top-1 Accuracy: 1783/6000 (29.7167%)
Took 538.2027266025543 seconds.
Test set: Average loss: 5.1534, Top-5 Accuracy: 5249.0/6000 (87.4833%)
Took 538.2027266025543 seconds.
old_data shape: torch.Size([20000, 3072])
new_data_1 shape: torch.Size([20000, 3072])
MMD loss:tensor(1.3463, device='cuda:0')

 ------------ start adaptation .............
--------- Task 2, DA Epoch 1/15 ---------
              [17920/30000 (0%)]      Loss: 8.454102
Train set: Average loss: 5.0501
Test set: Average loss: 5.8325, Top-1 Accuracy: 1984/6000 (33.0667%)
Took 561.0282552242279 seconds.
Test set: Average loss: 5.8325, Top-5 Accuracy: 5428.0/6000 (90.4667%)
Took 561.0282552242279 seconds.
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json
--------- Task 2, DA Epoch 2/15 ---------
              [17920/30000 (0%)]      Loss: 8.344267
Train set: Average loss: 4.9522
Test set: Average loss: 5.8103, Top-1 Accuracy: 1991/6000 (33.1833%)
Took 573.4018361568451 seconds.
Test set: Average loss: 5.8103, Top-5 Accuracy: 5415.0/6000 (90.2500%)
Took 573.4018361568451 seconds.
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json
--------- Task 2, DA Epoch 3/15 ---------
              [17920/30000 (0%)]      Loss: 8.252104
Train set: Average loss: 4.8664
Test set: Average loss: 5.8657, Top-1 Accuracy: 1967/6000 (32.7833%)
Took 585.6900448799133 seconds.
Test set: Average loss: 5.8657, Top-5 Accuracy: 5388.0/6000 (89.8000%)
Took 585.6900448799133 seconds.
--------- Task 2, DA Epoch 4/15 ---------
              [17920/30000 (0%)]      Loss: 8.164123
Train set: Average loss: 4.7869
Test set: Average loss: 6.0006, Top-1 Accuracy: 1954/6000 (32.5667%)
Took 597.9062833786011 seconds.
Test set: Average loss: 6.0006, Top-5 Accuracy: 5364.0/6000 (89.4000%)
Took 597.9062833786011 seconds.
--------- Task 2, DA Epoch 5/15 ---------
              [17920/30000 (0%)]      Loss: 8.087029
Train set: Average loss: 4.7127
Test set: Average loss: 6.2133, Top-1 Accuracy: 1901/6000 (31.6833%)
Took 610.1632432937622 seconds.
Test set: Average loss: 6.2133, Top-5 Accuracy: 5349.0/6000 (89.1500%)
Took 610.1632432937622 seconds.
--------- Task 2, DA Epoch 6/15 ---------
              [17920/30000 (0%)]      Loss: 8.010860
Train set: Average loss: 4.6410
Test set: Average loss: 6.4969, Top-1 Accuracy: 1850/6000 (30.8333%)
Took 622.4650962352753 seconds.
Test set: Average loss: 6.4969, Top-5 Accuracy: 5298.0/6000 (88.3000%)
Took 622.4650962352753 seconds.
--------- Task 2, DA Epoch 7/15 ---------
              [17920/30000 (0%)]      Loss: 7.940997
Train set: Average loss: 4.5720
Test set: Average loss: 6.8603, Top-1 Accuracy: 1786/6000 (29.7667%)
Took 634.6703858375549 seconds.
Test set: Average loss: 6.8603, Top-5 Accuracy: 5262.0/6000 (87.7000%)
Took 634.6703858375549 seconds.
--------- Task 2, DA Epoch 8/15 ---------
              [17920/30000 (0%)]      Loss: 7.870587
Train set: Average loss: 4.5065
Test set: Average loss: 7.2181, Top-1 Accuracy: 1715/6000 (28.5833%)
Took 646.9372179508209 seconds.
Test set: Average loss: 7.2181, Top-5 Accuracy: 5226.0/6000 (87.1000%)
Took 646.9372179508209 seconds.
--------- Task 2, DA Epoch 9/15 ---------
              [17920/30000 (0%)]      Loss: 7.796425
Train set: Average loss: 4.4426
Test set: Average loss: 7.6163, Top-1 Accuracy: 1667/6000 (27.7833%)
Took 659.2006688117981 seconds.
Test set: Average loss: 7.6163, Top-5 Accuracy: 5184.0/6000 (86.4000%)
Took 659.2006688117981 seconds.
--------- Task 2, DA Epoch 10/15 ---------
              [17920/30000 (0%)]      Loss: 7.726560
Train set: Average loss: 4.3810
Test set: Average loss: 7.9727, Top-1 Accuracy: 1631/6000 (27.1833%)
Took 671.4374830722809 seconds.
Test set: Average loss: 7.9727, Top-5 Accuracy: 5131.0/6000 (85.5167%)
Took 671.4374830722809 seconds.
--------- Task 2, DA Epoch 11/15 ---------
              [17920/30000 (0%)]      Loss: 7.665090
Train set: Average loss: 4.3244
Test set: Average loss: 8.3128, Top-1 Accuracy: 1593/6000 (26.5500%)
Took 683.6991922855377 seconds.
Test set: Average loss: 8.3128, Top-5 Accuracy: 5093.0/6000 (84.8833%)
Took 683.6991922855377 seconds.
--------- Task 2, DA Epoch 12/15 ---------
              [17920/30000 (0%)]      Loss: 7.609947
Train set: Average loss: 4.2722
Test set: Average loss: 8.6033, Top-1 Accuracy: 1569/6000 (26.1500%)
Took 695.9509692192078 seconds.
Test set: Average loss: 8.6033, Top-5 Accuracy: 5045.0/6000 (84.0833%)
Took 695.9509692192078 seconds.
--------- Task 2, DA Epoch 13/15 ---------
              [17920/30000 (0%)]      Loss: 7.560243
Train set: Average loss: 4.2239
Test set: Average loss: 8.8288, Top-1 Accuracy: 1548/6000 (25.8000%)
Took 708.2594633102417 seconds.
Test set: Average loss: 8.8288, Top-5 Accuracy: 5001.0/6000 (83.3500%)
Took 708.2594633102417 seconds.
--------- Task 2, DA Epoch 14/15 ---------
              [17920/30000 (0%)]      Loss: 7.511267
Train set: Average loss: 4.1793
Test set: Average loss: 9.0772, Top-1 Accuracy: 1528/6000 (25.4667%)
Took 720.5084362030029 seconds.
Test set: Average loss: 9.0772, Top-5 Accuracy: 4984.0/6000 (83.0667%)
Took 720.5084362030029 seconds.
--------- Task 2, DA Epoch 15/15 ---------
              [17920/30000 (0%)]      Loss: 7.464355
Train set: Average loss: 4.1374
Test set: Average loss: 9.2449, Top-1 Accuracy: 1512/6000 (25.2000%)
Took 732.7303850650787 seconds.
Test set: Average loss: 9.2449, Top-5 Accuracy: 4975.0/6000 (82.9167%)
Took 732.7303850650787 seconds.
[after adaption and growth]
Test set: Average loss: 5.8103, Top-1 Accuracy: 1991/6000 (33.1833%)
Took 734.1842982769012 seconds.
Test set: Average loss: 5.8103, Top-5 Accuracy: 5415.0/6000 (90.2500%)
Took 734.1842982769012 seconds.
 ------ leaf nodes and corresponding confidence:
[2]
tensor([1.], device='cuda:0')
[2]
---------------------------------------------------------------

At layer 2

Processing node 2
---------------- data shape before/after transformer -------------
[1, 64, 4, 4] <class 'list'>
(1, 64, 4, 4) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 4, 4] <class 'list'>
(1, 64, 4, 4) <class 'tuple'>
torch.Size([1, 64, 4, 4])
---------------- data shape before/after transformer -------------
[1, 64, 4, 4] <class 'list'>
torch.Size([1, 64, 2, 2]) <class 'torch.Size'>
/workspace/CDTree/utils/models.py:819: UserWarning: Router kernel too large, shrink it
  warnings.warn('Router kernel too large, shrink it')

---------- Optimizing a binary split ------------
True
True
False

Selectively optimising the parameters below:
          tree_modules.2.router.conv1.weight
          tree_modules.2.router.conv1.bias
          tree_modules.2.router.linear1.weight
          tree_modules.2.router.linear1.bias
          child_left.classifier.fc1.weight
          child_left.classifier.fc1.bias
          child_left.classifier.fc2.weight
          child_left.classifier.fc2.bias
          child_left.classifier.fc3.weight
          child_left.classifier.fc3.bias
          child_right.classifier.fc1.weight
          child_right.classifier.fc1.bias
          child_right.classifier.fc2.weight
          child_right.classifier.fc2.bias
          child_right.classifier.fc3.weight
          child_right.classifier.fc3.bias

----- Layer 2, Node 2, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 1.075368
Train set: Average loss: 1.1268
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1383, Accuracy: 3367/6000 (56%)
Took 746.2085137367249 seconds.
Test set: Average loss: 1.1383, Top-1 Accuracy: 3367/6000 (56.1167%)
Took 747.6037721633911 seconds.
Test set: Average loss: 1.1383, Top-5 Accuracy: 5909.0/6000 (98.4833%)
Took 747.6037721633911 seconds.

----- Layer 2, Node 2, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.986539
Train set: Average loss: 1.0262
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1351, Accuracy: 3399/6000 (57%)
Took 758.3260078430176 seconds.
Test set: Average loss: 1.1351, Top-1 Accuracy: 3399/6000 (56.6500%)
Took 759.7325639724731 seconds.
Test set: Average loss: 1.1351, Top-5 Accuracy: 5911.0/6000 (98.5167%)
Took 759.7325639724731 seconds.

----- Layer 2, Node 2, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.970746
Train set: Average loss: 1.0043
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1337, Accuracy: 3443/6000 (57%)
Took 770.4106202125549 seconds.
Test set: Average loss: 1.1337, Top-1 Accuracy: 3443/6000 (57.3833%)
Took 771.8664131164551 seconds.
Test set: Average loss: 1.1337, Top-5 Accuracy: 5906.0/6000 (98.4333%)
Took 771.8664131164551 seconds.

----- Layer 2, Node 2, Epoch 4/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.958160
Train set: Average loss: 0.9901
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1223, Accuracy: 3467/6000 (58%)
Took 782.5712833404541 seconds.
Test set: Average loss: 1.1223, Top-1 Accuracy: 3467/6000 (57.7833%)
Took 783.9797036647797 seconds.
Test set: Average loss: 1.1223, Top-5 Accuracy: 5904.0/6000 (98.4000%)
Took 783.9797036647797 seconds.

----- Layer 2, Node 2, Epoch 5/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.953470
Train set: Average loss: 0.9801
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1152, Accuracy: 3496/6000 (58%)
Took 794.7438478469849 seconds.
Test set: Average loss: 1.1152, Top-1 Accuracy: 3496/6000 (58.2667%)
Took 796.1543698310852 seconds.
Test set: Average loss: 1.1152, Top-5 Accuracy: 5903.0/6000 (98.3833%)
Took 796.1543698310852 seconds.

----- Layer 2, Node 2, Epoch 6/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.951805
Train set: Average loss: 0.9720
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1077, Accuracy: 3540/6000 (59%)
Took 806.8368072509766 seconds.
Test set: Average loss: 1.1077, Top-1 Accuracy: 3540/6000 (59.0000%)
Took 808.2589647769928 seconds.
Test set: Average loss: 1.1077, Top-5 Accuracy: 5904.0/6000 (98.4000%)
Took 808.2589647769928 seconds.

----- Layer 2, Node 2, Epoch 7/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.947738
Train set: Average loss: 0.9648
Valid set: Average loss: 1.1158, Accuracy: 3522/6000 (59%)
Took 818.988673210144 seconds.
Test set: Average loss: 1.1158, Top-1 Accuracy: 3522/6000 (58.7000%)
Took 820.3975613117218 seconds.
Test set: Average loss: 1.1158, Top-5 Accuracy: 5903.0/6000 (98.3833%)
Took 820.3975613117218 seconds.

----- Layer 2, Node 2, Epoch 8/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.936083
Train set: Average loss: 0.9588
Valid set: Average loss: 1.1333, Accuracy: 3498/6000 (58%)
Took 831.1163785457611 seconds.
Test set: Average loss: 1.1333, Top-1 Accuracy: 3498/6000 (58.3000%)
Took 832.529036283493 seconds.
Test set: Average loss: 1.1333, Top-5 Accuracy: 5905.0/6000 (98.4167%)
Took 832.529036283493 seconds.

----- Layer 2, Node 2, Epoch 9/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.939550
Train set: Average loss: 0.9553
Valid set: Average loss: 1.1321, Accuracy: 3462/6000 (58%)
Took 843.194970369339 seconds.
Test set: Average loss: 1.1321, Top-1 Accuracy: 3462/6000 (57.7000%)
Took 844.6024966239929 seconds.
Test set: Average loss: 1.1321, Top-5 Accuracy: 5911.0/6000 (98.5167%)
Took 844.6024966239929 seconds.

----- Layer 2, Node 2, Epoch 10/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.929225
Train set: Average loss: 0.9525
Valid set: Average loss: 1.1313, Accuracy: 3477/6000 (58%)
Took 855.3474216461182 seconds.
Test set: Average loss: 1.1313, Top-1 Accuracy: 3477/6000 (57.9500%)
Took 856.7539165019989 seconds.
Test set: Average loss: 1.1313, Top-5 Accuracy: 5917.0/6000 (98.6167%)
Took 856.7539165019989 seconds.

----- Layer 2, Node 2, Epoch 11/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.914202
Train set: Average loss: 0.9462
Valid set: Average loss: 1.1449, Accuracy: 3487/6000 (58%)
Took 867.4667537212372 seconds.
Test set: Average loss: 1.1449, Top-1 Accuracy: 3487/6000 (58.1167%)
Took 868.8837251663208 seconds.
Test set: Average loss: 1.1449, Top-5 Accuracy: 5921.0/6000 (98.6833%)
Took 868.8837251663208 seconds.

----- Layer 2, Node 2, Epoch 12/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.911255
Train set: Average loss: 0.9408
Valid set: Average loss: 1.1543, Accuracy: 3455/6000 (58%)
Took 879.5688078403473 seconds.
Test set: Average loss: 1.1543, Top-1 Accuracy: 3455/6000 (57.5833%)
Took 880.9783799648285 seconds.
Test set: Average loss: 1.1543, Top-5 Accuracy: 5915.0/6000 (98.5833%)
Took 880.9783799648285 seconds.

----- Layer 2, Node 2, Epoch 13/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.913688
Train set: Average loss: 0.9379
Valid set: Average loss: 1.1313, Accuracy: 3488/6000 (58%)
Took 891.6504080295563 seconds.
Test set: Average loss: 1.1313, Top-1 Accuracy: 3488/6000 (58.1333%)
Took 893.0429837703705 seconds.
Test set: Average loss: 1.1313, Top-5 Accuracy: 5916.0/6000 (98.6000%)
Took 893.0429837703705 seconds.

----- Layer 2, Node 2, Epoch 14/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.900366
Train set: Average loss: 0.9324
Valid set: Average loss: 1.1411, Accuracy: 3489/6000 (58%)
Took 903.7662651538849 seconds.
Test set: Average loss: 1.1411, Top-1 Accuracy: 3489/6000 (58.1500%)
Took 905.2639729976654 seconds.
Test set: Average loss: 1.1411, Top-5 Accuracy: 5918.0/6000 (98.6333%)
Took 905.2639729976654 seconds.

----- Layer 2, Node 2, Epoch 15/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.902868
Train set: Average loss: 0.9289
Valid set: Average loss: 1.1450, Accuracy: 3472/6000 (58%)
Took 916.4194130897522 seconds.
Test set: Average loss: 1.1450, Top-1 Accuracy: 3472/6000 (57.8667%)
Took 917.8866782188416 seconds.
Test set: Average loss: 1.1450, Top-5 Accuracy: 5911.0/6000 (98.5167%)
Took 917.8866782188416 seconds.

----- Layer 2, Node 2, Epoch 16/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.897614
Train set: Average loss: 0.9247
Valid set: Average loss: 1.1667, Accuracy: 3447/6000 (57%)
Took 929.0588979721069 seconds.
Test set: Average loss: 1.1667, Top-1 Accuracy: 3447/6000 (57.4500%)
Took 930.5273251533508 seconds.
Test set: Average loss: 1.1667, Top-5 Accuracy: 5906.0/6000 (98.4333%)
Took 930.5273251533508 seconds.

----- Layer 2, Node 2, Epoch 17/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.900869
Train set: Average loss: 0.9191
Valid set: Average loss: 1.1473, Accuracy: 3502/6000 (58%)
Took 941.6583836078644 seconds.
Test set: Average loss: 1.1473, Top-1 Accuracy: 3502/6000 (58.3667%)
Took 943.1533830165863 seconds.
Test set: Average loss: 1.1473, Top-5 Accuracy: 5908.0/6000 (98.4667%)
Took 943.1533830165863 seconds.

----- Layer 2, Node 2, Epoch 18/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.894294
Train set: Average loss: 0.9168
Valid set: Average loss: 1.1461, Accuracy: 3492/6000 (58%)
Took 954.2733283042908 seconds.
Test set: Average loss: 1.1461, Top-1 Accuracy: 3492/6000 (58.2000%)
Took 955.7425467967987 seconds.
Test set: Average loss: 1.1461, Top-5 Accuracy: 5897.0/6000 (98.2833%)
Took 955.7425467967987 seconds.

----- Layer 2, Node 2, Epoch 19/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.892499
Train set: Average loss: 0.9125
Valid set: Average loss: 1.1469, Accuracy: 3461/6000 (58%)
Took 966.9128062725067 seconds.
Test set: Average loss: 1.1469, Top-1 Accuracy: 3461/6000 (57.6833%)
Took 968.3805513381958 seconds.
Test set: Average loss: 1.1469, Top-5 Accuracy: 5906.0/6000 (98.4333%)
Took 968.3805513381958 seconds.

----- Layer 2, Node 2, Epoch 20/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.877514
Train set: Average loss: 0.9096
Valid set: Average loss: 1.1570, Accuracy: 3464/6000 (58%)
Took 979.5224673748016 seconds.
Test set: Average loss: 1.1570, Top-1 Accuracy: 3464/6000 (57.7333%)
Took 981.0181367397308 seconds.
Test set: Average loss: 1.1570, Top-5 Accuracy: 5896.0/6000 (98.2667%)
Took 981.0181367397308 seconds.

----- Layer 2, Node 2, Epoch 21/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.878727
Train set: Average loss: 0.9058
Valid set: Average loss: 1.1479, Accuracy: 3454/6000 (58%)
Took 992.1656365394592 seconds.
Test set: Average loss: 1.1479, Top-1 Accuracy: 3454/6000 (57.5667%)
Took 993.6305437088013 seconds.
Test set: Average loss: 1.1479, Top-5 Accuracy: 5902.0/6000 (98.3667%)
Took 993.6305437088013 seconds.

----- Layer 2, Node 2, Epoch 22/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.873232
Train set: Average loss: 0.9009
Valid set: Average loss: 1.1517, Accuracy: 3435/6000 (57%)
Took 1004.6101086139679 seconds.
Test set: Average loss: 1.1517, Top-1 Accuracy: 3435/6000 (57.2500%)
Took 1006.0057246685028 seconds.
Test set: Average loss: 1.1517, Top-5 Accuracy: 5905.0/6000 (98.4167%)
Took 1006.0057246685028 seconds.

----- Layer 2, Node 2, Epoch 23/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.869149
Train set: Average loss: 0.8987
Valid set: Average loss: 1.1754, Accuracy: 3414/6000 (57%)
Took 1016.5793664455414 seconds.
Test set: Average loss: 1.1754, Top-1 Accuracy: 3414/6000 (56.9000%)
Took 1018.0086941719055 seconds.
Test set: Average loss: 1.1754, Top-5 Accuracy: 5905.0/6000 (98.4167%)
Took 1018.0086941719055 seconds.

----- Layer 2, Node 2, Epoch 24/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.868566
Train set: Average loss: 0.8962
Valid set: Average loss: 1.1617, Accuracy: 3432/6000 (57%)
Took 1028.6559422016144 seconds.
Test set: Average loss: 1.1617, Top-1 Accuracy: 3432/6000 (57.2000%)
Took 1030.0492477416992 seconds.
Test set: Average loss: 1.1617, Top-5 Accuracy: 5914.0/6000 (98.5667%)
Took 1030.0492477416992 seconds.

----- Layer 2, Node 2, Epoch 25/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.864711
Train set: Average loss: 0.8936
Valid set: Average loss: 1.1556, Accuracy: 3484/6000 (58%)
Took 1040.771297454834 seconds.
Test set: Average loss: 1.1556, Top-1 Accuracy: 3484/6000 (58.0667%)
Took 1042.1657767295837 seconds.
Test set: Average loss: 1.1556, Top-5 Accuracy: 5909.0/6000 (98.4833%)
Took 1042.1657767295837 seconds.

----- Layer 2, Node 2, Epoch 26/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.829867
Train set: Average loss: 0.8735
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.0906, Accuracy: 3596/6000 (60%)
Took 1052.7743706703186 seconds.
Test set: Average loss: 1.0906, Top-1 Accuracy: 3596/6000 (59.9333%)
Took 1054.1784298419952 seconds.
Test set: Average loss: 1.0906, Top-5 Accuracy: 5920.0/6000 (98.6667%)
Took 1054.1784298419952 seconds.

----- Layer 2, Node 2, Epoch 27/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.828353
Train set: Average loss: 0.8614
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.0857, Accuracy: 3608/6000 (60%)
Took 1064.8754086494446 seconds.
Test set: Average loss: 1.0857, Top-1 Accuracy: 3608/6000 (60.1333%)
Took 1066.2827188968658 seconds.
Test set: Average loss: 1.0857, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 1066.2827188968658 seconds.

----- Layer 2, Node 2, Epoch 28/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.825896
Train set: Average loss: 0.8548
Valid set: Average loss: 1.0881, Accuracy: 3593/6000 (60%)
Took 1076.934784412384 seconds.
Test set: Average loss: 1.0881, Top-1 Accuracy: 3593/6000 (59.8833%)
Took 1078.3468554019928 seconds.
Test set: Average loss: 1.0881, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 1078.3468554019928 seconds.

----- Layer 2, Node 2, Epoch 29/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.821227
Train set: Average loss: 0.8498
Valid set: Average loss: 1.0897, Accuracy: 3598/6000 (60%)
Took 1088.8774406909943 seconds.
Test set: Average loss: 1.0897, Top-1 Accuracy: 3598/6000 (59.9667%)
Took 1090.2696125507355 seconds.
Test set: Average loss: 1.0897, Top-5 Accuracy: 5923.0/6000 (98.7167%)
Took 1090.2696125507355 seconds.

----- Layer 2, Node 2, Epoch 30/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.818794
Train set: Average loss: 0.8457
Valid set: Average loss: 1.0945, Accuracy: 3591/6000 (60%)
Took 1100.9246191978455 seconds.
Test set: Average loss: 1.0945, Top-1 Accuracy: 3591/6000 (59.8500%)
Took 1102.315527677536 seconds.
Test set: Average loss: 1.0945, Top-5 Accuracy: 5924.0/6000 (98.7333%)
Took 1102.315527677536 seconds.
return the node-wise best split model
returning left and right children

----------- Optimizing an extension --------------
True
False
True

Selectively optimising the parameters below:
          child_extension.transform.conv1.weight
          child_extension.transform.conv1.bias
          child_extension.transform.conv2.weight
          child_extension.transform.conv2.bias
          child_extension.transform.bn1.weight
          child_extension.transform.bn1.bias
          child_extension.transform.bn2.weight
          child_extension.transform.bn2.bias
          child_extension.classifier.fc1.weight
          child_extension.classifier.fc1.bias
          child_extension.classifier.fc2.weight
          child_extension.classifier.fc2.bias
          child_extension.classifier.fc3.weight
          child_extension.classifier.fc3.bias

----- Layer 2, Node 2, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.941049
Train set: Average loss: 1.0458
Valid set: Average loss: 1.1512, Accuracy: 3486/6000 (58%)
Took 1112.8952524662018 seconds.
Test set: Average loss: 1.1512, Top-1 Accuracy: 3486/6000 (58.1000%)
Took 1114.3459424972534 seconds.
Test set: Average loss: 1.1512, Top-5 Accuracy: 5895.0/6000 (98.2500%)
Took 1114.3459424972534 seconds.

----- Layer 2, Node 2, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.894443
Train set: Average loss: 0.9247
Valid set: Average loss: 1.1107, Accuracy: 3535/6000 (59%)
Took 1124.9400725364685 seconds.
Test set: Average loss: 1.1107, Top-1 Accuracy: 3535/6000 (58.9167%)
Took 1126.3372416496277 seconds.
Test set: Average loss: 1.1107, Top-5 Accuracy: 5889.0/6000 (98.1500%)
Took 1126.3372416496277 seconds.

----- Layer 2, Node 2, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.857178
Train set: Average loss: 0.8808
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_ext.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_ext.json
Valid set: Average loss: 1.0612, Accuracy: 3650/6000 (61%)
Took 1136.981862783432 seconds.
Test set: Average loss: 1.0612, Top-1 Accuracy: 3650/6000 (60.8333%)
Took 1138.3795795440674 seconds.
Test set: Average loss: 1.0612, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 1138.3795795440674 seconds.

----- Layer 2, Node 2, Epoch 4/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.826607
Train set: Average loss: 0.8450
Valid set: Average loss: 1.1005, Accuracy: 3619/6000 (60%)
Took 1148.9247171878815 seconds.
Test set: Average loss: 1.1005, Top-1 Accuracy: 3619/6000 (60.3167%)
Took 1150.3324418067932 seconds.
Test set: Average loss: 1.1005, Top-5 Accuracy: 5927.0/6000 (98.7833%)
Took 1150.3324418067932 seconds.

----- Layer 2, Node 2, Epoch 5/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.791482
Train set: Average loss: 0.8136
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_ext.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_ext.json
Valid set: Average loss: 1.0964, Accuracy: 3679/6000 (61%)
Took 1160.975793838501 seconds.
Test set: Average loss: 1.0964, Top-1 Accuracy: 3679/6000 (61.3167%)
Took 1162.3709115982056 seconds.
Test set: Average loss: 1.0964, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 1162.3709115982056 seconds.

----- Layer 2, Node 2, Epoch 6/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.761270
Train set: Average loss: 0.7820
Valid set: Average loss: 1.1241, Accuracy: 3637/6000 (61%)
Took 1173.0007002353668 seconds.
Test set: Average loss: 1.1241, Top-1 Accuracy: 3637/6000 (60.6167%)
Took 1174.3948712348938 seconds.
Test set: Average loss: 1.1241, Top-5 Accuracy: 5920.0/6000 (98.6667%)
Took 1174.3948712348938 seconds.

----- Layer 2, Node 2, Epoch 7/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.718845
Train set: Average loss: 0.7476
Valid set: Average loss: 1.1451, Accuracy: 3639/6000 (61%)
Took 1184.9605231285095 seconds.
Test set: Average loss: 1.1451, Top-1 Accuracy: 3639/6000 (60.6500%)
Took 1186.3532254695892 seconds.
Test set: Average loss: 1.1451, Top-5 Accuracy: 5924.0/6000 (98.7333%)
Took 1186.3532254695892 seconds.

----- Layer 2, Node 2, Epoch 8/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.680797
Train set: Average loss: 0.7113
Valid set: Average loss: 1.1651, Accuracy: 3627/6000 (60%)
Took 1197.0118744373322 seconds.
Test set: Average loss: 1.1651, Top-1 Accuracy: 3627/6000 (60.4500%)
Took 1198.4040887355804 seconds.
Test set: Average loss: 1.1651, Top-5 Accuracy: 5924.0/6000 (98.7333%)
Took 1198.4040887355804 seconds.

----- Layer 2, Node 2, Epoch 9/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.658103
Train set: Average loss: 0.6798
Valid set: Average loss: 1.2091, Accuracy: 3642/6000 (61%)
Took 1209.0240240097046 seconds.
Test set: Average loss: 1.2091, Top-1 Accuracy: 3642/6000 (60.7000%)
Took 1210.4347126483917 seconds.
Test set: Average loss: 1.2091, Top-5 Accuracy: 5911.0/6000 (98.5167%)
Took 1210.4347126483917 seconds.

----- Layer 2, Node 2, Epoch 10/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.618251
Train set: Average loss: 0.6435
Valid set: Average loss: 1.3730, Accuracy: 3542/6000 (59%)
Took 1221.0329246520996 seconds.
Test set: Average loss: 1.3730, Top-1 Accuracy: 3542/6000 (59.0333%)
Took 1222.431554555893 seconds.
Test set: Average loss: 1.3730, Top-5 Accuracy: 5904.0/6000 (98.4000%)
Took 1222.431554555893 seconds.

----- Layer 2, Node 2, Epoch 11/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.594258
Train set: Average loss: 0.6096
Valid set: Average loss: 1.4130, Accuracy: 3464/6000 (58%)
Took 1233.08593416214 seconds.
Test set: Average loss: 1.4130, Top-1 Accuracy: 3464/6000 (57.7333%)
Took 1234.4818143844604 seconds.
Test set: Average loss: 1.4130, Top-5 Accuracy: 5900.0/6000 (98.3333%)
Took 1234.4818143844604 seconds.

----- Layer 2, Node 2, Epoch 12/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.559024
Train set: Average loss: 0.5803
Valid set: Average loss: 1.5804, Accuracy: 3390/6000 (56%)
Took 1245.0729463100433 seconds.
Test set: Average loss: 1.5804, Top-1 Accuracy: 3390/6000 (56.5000%)
Took 1246.5154418945312 seconds.
Test set: Average loss: 1.5804, Top-5 Accuracy: 5877.0/6000 (97.9500%)
Took 1246.5154418945312 seconds.

----- Layer 2, Node 2, Epoch 13/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.535729
Train set: Average loss: 0.5608
Valid set: Average loss: 1.6843, Accuracy: 3424/6000 (57%)
Took 1257.1219799518585 seconds.
Test set: Average loss: 1.6843, Top-1 Accuracy: 3424/6000 (57.0667%)
Took 1258.5162191390991 seconds.
Test set: Average loss: 1.6843, Top-5 Accuracy: 5869.0/6000 (97.8167%)
Took 1258.5162191390991 seconds.

----- Layer 2, Node 2, Epoch 14/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.494524
Train set: Average loss: 0.5393
Valid set: Average loss: 1.6070, Accuracy: 3446/6000 (57%)
Took 1269.3417222499847 seconds.
Test set: Average loss: 1.6070, Top-1 Accuracy: 3446/6000 (57.4333%)
Took 1270.8078598976135 seconds.
Test set: Average loss: 1.6070, Top-5 Accuracy: 5893.0/6000 (98.2167%)
Took 1270.8078598976135 seconds.

----- Layer 2, Node 2, Epoch 15/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.484002
Train set: Average loss: 0.5196
Valid set: Average loss: 1.6445, Accuracy: 3466/6000 (58%)
Took 1281.9086980819702 seconds.
Test set: Average loss: 1.6445, Top-1 Accuracy: 3466/6000 (57.7667%)
Took 1283.3861229419708 seconds.
Test set: Average loss: 1.6445, Top-5 Accuracy: 5906.0/6000 (98.4333%)
Took 1283.3861229419708 seconds.

----- Layer 2, Node 2, Epoch 16/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.469297
Train set: Average loss: 0.5015
Valid set: Average loss: 1.6367, Accuracy: 3512/6000 (59%)
Took 1294.552545785904 seconds.
Test set: Average loss: 1.6367, Top-1 Accuracy: 3512/6000 (58.5333%)
Took 1296.0168552398682 seconds.
Test set: Average loss: 1.6367, Top-5 Accuracy: 5901.0/6000 (98.3500%)
Took 1296.0168552398682 seconds.

----- Layer 2, Node 2, Epoch 17/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.426964
Train set: Average loss: 0.4730
Valid set: Average loss: 1.6464, Accuracy: 3490/6000 (58%)
Took 1307.03604388237 seconds.
Test set: Average loss: 1.6464, Top-1 Accuracy: 3490/6000 (58.1667%)
Took 1308.432255268097 seconds.
Test set: Average loss: 1.6464, Top-5 Accuracy: 5918.0/6000 (98.6333%)
Took 1308.432255268097 seconds.

----- Layer 2, Node 2, Epoch 18/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.443025
Train set: Average loss: 0.4601
Valid set: Average loss: 1.6839, Accuracy: 3531/6000 (59%)
Took 1318.9698574543 seconds.
Test set: Average loss: 1.6839, Top-1 Accuracy: 3531/6000 (58.8500%)
Took 1320.366763830185 seconds.
Test set: Average loss: 1.6839, Top-5 Accuracy: 5898.0/6000 (98.3000%)
Took 1320.366763830185 seconds.

----- Layer 2, Node 2, Epoch 19/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.429587
Train set: Average loss: 0.4315
Valid set: Average loss: 1.6652, Accuracy: 3515/6000 (59%)
Took 1331.0208537578583 seconds.
Test set: Average loss: 1.6652, Top-1 Accuracy: 3515/6000 (58.5833%)
Took 1332.416790485382 seconds.
Test set: Average loss: 1.6652, Top-5 Accuracy: 5911.0/6000 (98.5167%)
Took 1332.416790485382 seconds.

----- Layer 2, Node 2, Epoch 20/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.411260
Train set: Average loss: 0.4354
Valid set: Average loss: 1.8485, Accuracy: 3420/6000 (57%)
Took 1343.0709908008575 seconds.
Test set: Average loss: 1.8485, Top-1 Accuracy: 3420/6000 (57.0000%)
Took 1344.4874744415283 seconds.
Test set: Average loss: 1.8485, Top-5 Accuracy: 5886.0/6000 (98.1000%)
Took 1344.4874744415283 seconds.

----- Layer 2, Node 2, Epoch 21/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.361549
Train set: Average loss: 0.3934
Valid set: Average loss: 1.9347, Accuracy: 3389/6000 (56%)
Took 1355.0346901416779 seconds.
Test set: Average loss: 1.9347, Top-1 Accuracy: 3389/6000 (56.4833%)
Took 1356.445053100586 seconds.
Test set: Average loss: 1.9347, Top-5 Accuracy: 5892.0/6000 (98.2000%)
Took 1356.445053100586 seconds.

----- Layer 2, Node 2, Epoch 22/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.334204
Train set: Average loss: 0.3669
Valid set: Average loss: 2.0192, Accuracy: 3405/6000 (57%)
Took 1367.1065843105316 seconds.
Test set: Average loss: 2.0192, Top-1 Accuracy: 3405/6000 (56.7500%)
Took 1368.5008764266968 seconds.
Test set: Average loss: 2.0192, Top-5 Accuracy: 5899.0/6000 (98.3167%)
Took 1368.5008764266968 seconds.
Early stopping by patience!
return the node-wise best extended model
returning an extended child
Average valid loss is reduced by 61.31666564941406

Extending node 2
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 1.0964, Top-1 Accuracy: 3679/6000 (61.3167%)
Took 1369.935194015503 seconds.
Test set: Average loss: 1.0964, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 1369.935194015503 seconds.
False
False
False

Perform global training

----- Layer 2, Node 2, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.895878
Train set: Average loss: 1.3186
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.5212, Accuracy: 9421/18000 (52%)
Took 1389.2192423343658 seconds.
Test set: Average loss: 0.9753, Top-1 Accuracy: 3976/6000 (66.2667%)
Took 1390.6123356819153 seconds.
Test set: Average loss: 0.9753, Top-5 Accuracy: 5924.0/6000 (98.7333%)
Took 1390.6123356819153 seconds.

----- Layer 2, Node 2, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.690900
Train set: Average loss: 0.7312
Valid set: Average loss: 2.9035, Accuracy: 9153/18000 (51%)
Took 1409.872812986374 seconds.
Test set: Average loss: 1.2550, Top-1 Accuracy: 3847/6000 (64.1167%)
Took 1411.2683148384094 seconds.
Test set: Average loss: 1.2550, Top-5 Accuracy: 5896.0/6000 (98.2667%)
Took 1411.2683148384094 seconds.

----- Layer 2, Node 2, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.575722
Train set: Average loss: 0.6026
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.8211, Accuracy: 9556/18000 (53%)
Took 1430.4987387657166 seconds.
Test set: Average loss: 1.2361, Top-1 Accuracy: 3882/6000 (64.7000%)
Took 1431.8906445503235 seconds.
Test set: Average loss: 1.2361, Top-5 Accuracy: 5892.0/6000 (98.2000%)
Took 1431.8906445503235 seconds.

----- Layer 2, Node 2, Epoch 4/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.519846
Train set: Average loss: 0.5192
Valid set: Average loss: 3.5743, Accuracy: 8706/18000 (48%)
Took 1451.1014761924744 seconds.
Test set: Average loss: 1.7396, Top-1 Accuracy: 3646/6000 (60.7667%)
Took 1452.4944446086884 seconds.
Test set: Average loss: 1.7396, Top-5 Accuracy: 5821.0/6000 (97.0167%)
Took 1452.4944446086884 seconds.

----- Layer 2, Node 2, Epoch 5/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.450482
Train set: Average loss: 0.4600
Valid set: Average loss: 3.5217, Accuracy: 9171/18000 (51%)
Took 1471.7565772533417 seconds.
Test set: Average loss: 1.5705, Top-1 Accuracy: 3805/6000 (63.4167%)
Took 1473.1607987880707 seconds.
Test set: Average loss: 1.5705, Top-5 Accuracy: 5870.0/6000 (97.8333%)
Took 1473.1607987880707 seconds.

----- Layer 2, Node 2, Epoch 6/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.418138
Train set: Average loss: 0.4288
Valid set: Average loss: 3.5831, Accuracy: 9107/18000 (51%)
Took 1492.3856616020203 seconds.
Test set: Average loss: 1.8900, Top-1 Accuracy: 3771/6000 (62.8500%)
Took 1493.821135044098 seconds.
Test set: Average loss: 1.8900, Top-5 Accuracy: 5885.0/6000 (98.0833%)
Took 1493.821135044098 seconds.

----- Layer 2, Node 2, Epoch 7/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.383184
Train set: Average loss: 0.3856
Valid set: Average loss: 3.9807, Accuracy: 8676/18000 (48%)
Took 1514.0647892951965 seconds.
Test set: Average loss: 2.6049, Top-1 Accuracy: 3437/6000 (57.2833%)
Took 1515.5401618480682 seconds.
Test set: Average loss: 2.6049, Top-5 Accuracy: 5886.0/6000 (98.1000%)
Took 1515.5401618480682 seconds.

----- Layer 2, Node 2, Epoch 8/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.329865
Train set: Average loss: 0.3457
Valid set: Average loss: 4.8468, Accuracy: 9090/18000 (50%)
Took 1535.727131843567 seconds.
Test set: Average loss: 1.4084, Top-1 Accuracy: 4079/6000 (67.9833%)
Took 1537.190182209015 seconds.
Test set: Average loss: 1.4084, Top-5 Accuracy: 5912.0/6000 (98.5333%)
Took 1537.190182209015 seconds.

----- Layer 2, Node 2, Epoch 9/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.302876
Train set: Average loss: 0.2994
Valid set: Average loss: 4.7717, Accuracy: 9041/18000 (50%)
Took 1557.337525844574 seconds.
Test set: Average loss: 1.4681, Top-1 Accuracy: 4107/6000 (68.4500%)
Took 1558.8020629882812 seconds.
Test set: Average loss: 1.4681, Top-5 Accuracy: 5881.0/6000 (98.0167%)
Took 1558.8020629882812 seconds.

----- Layer 2, Node 2, Epoch 10/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.257035
Train set: Average loss: 0.2843
Valid set: Average loss: 5.1803, Accuracy: 8296/18000 (46%)
Took 1579.0123538970947 seconds.
Test set: Average loss: 1.6872, Top-1 Accuracy: 4046/6000 (67.4333%)
Took 1580.476178407669 seconds.
Test set: Average loss: 1.6872, Top-5 Accuracy: 5891.0/6000 (98.1833%)
Took 1580.476178407669 seconds.

----- Layer 2, Node 2, Epoch 11/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.199391
Train set: Average loss: 0.2557
Valid set: Average loss: 5.8151, Accuracy: 8523/18000 (47%)
Took 1600.6304273605347 seconds.
Test set: Average loss: 1.7820, Top-1 Accuracy: 3939/6000 (65.6500%)
Took 1602.0946493148804 seconds.
Test set: Average loss: 1.7820, Top-5 Accuracy: 5843.0/6000 (97.3833%)
Took 1602.0946493148804 seconds.

----- Layer 2, Node 2, Epoch 12/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.213578
Train set: Average loss: 0.2298
Valid set: Average loss: 5.7894, Accuracy: 8306/18000 (46%)
Took 1622.2166981697083 seconds.
Test set: Average loss: 1.9577, Top-1 Accuracy: 3902/6000 (65.0333%)
Took 1623.6822216510773 seconds.
Test set: Average loss: 1.9577, Top-5 Accuracy: 5778.0/6000 (96.3000%)
Took 1623.6822216510773 seconds.

----- Layer 2, Node 2, Epoch 13/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.195499
Train set: Average loss: 0.2128
Valid set: Average loss: 5.9706, Accuracy: 7926/18000 (44%)
Took 1643.8797860145569 seconds.
Test set: Average loss: 2.1340, Top-1 Accuracy: 3742/6000 (62.3667%)
Took 1645.3716449737549 seconds.
Test set: Average loss: 2.1340, Top-5 Accuracy: 5790.0/6000 (96.5000%)
Took 1645.3716449737549 seconds.

----- Layer 2, Node 2, Epoch 14/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.199556
Train set: Average loss: 0.2042
Valid set: Average loss: 4.9552, Accuracy: 8892/18000 (49%)
Took 1665.568595647812 seconds.
Test set: Average loss: 1.5145, Top-1 Accuracy: 4176/6000 (69.6000%)
Took 1667.0462205410004 seconds.
Test set: Average loss: 1.5145, Top-5 Accuracy: 5872.0/6000 (97.8667%)
Took 1667.0462205410004 seconds.

----- Layer 2, Node 2, Epoch 15/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.169375
Train set: Average loss: 0.1824
Valid set: Average loss: 5.4751, Accuracy: 7968/18000 (44%)
Took 1687.0410306453705 seconds.
Test set: Average loss: 2.0794, Top-1 Accuracy: 3832/6000 (63.8667%)
Took 1688.4340221881866 seconds.
Test set: Average loss: 2.0794, Top-5 Accuracy: 5798.0/6000 (96.6333%)
Took 1688.4340221881866 seconds.

----- Layer 2, Node 2, Epoch 16/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.167867
Train set: Average loss: 0.1741
Valid set: Average loss: 5.0238, Accuracy: 8468/18000 (47%)
Took 1707.7630360126495 seconds.
Test set: Average loss: 1.8531, Top-1 Accuracy: 3889/6000 (64.8167%)
Took 1709.1663103103638 seconds.
Test set: Average loss: 1.8531, Top-5 Accuracy: 5844.0/6000 (97.4000%)
Took 1709.1663103103638 seconds.

----- Layer 2, Node 2, Epoch 17/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.172553
Train set: Average loss: 0.1594
Valid set: Average loss: 6.4472, Accuracy: 7869/18000 (44%)
Took 1728.4319124221802 seconds.
Test set: Average loss: 2.0724, Top-1 Accuracy: 3918/6000 (65.3000%)
Took 1729.82621717453 seconds.
Test set: Average loss: 2.0724, Top-5 Accuracy: 5772.0/6000 (96.2000%)
Took 1729.82621717453 seconds.

----- Layer 2, Node 2, Epoch 18/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.160190
Train set: Average loss: 0.1522
Valid set: Average loss: 5.3795, Accuracy: 8140/18000 (45%)
Took 1749.1090519428253 seconds.
Test set: Average loss: 2.8159, Top-1 Accuracy: 3745/6000 (62.4167%)
Took 1750.5060107707977 seconds.
Test set: Average loss: 2.8159, Top-5 Accuracy: 5610.0/6000 (93.5000%)
Took 1750.5060107707977 seconds.

----- Layer 2, Node 2, Epoch 19/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.162624
Train set: Average loss: 0.1337
Valid set: Average loss: 7.4794, Accuracy: 6796/18000 (38%)
Took 1769.797453403473 seconds.
Test set: Average loss: 2.9356, Top-1 Accuracy: 3585/6000 (59.7500%)
Took 1771.1944377422333 seconds.
Test set: Average loss: 2.9356, Top-5 Accuracy: 5602.0/6000 (93.3667%)
Took 1771.1944377422333 seconds.

----- Layer 2, Node 2, Epoch 20/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.131750
Train set: Average loss: 0.1279
Valid set: Average loss: 5.2209, Accuracy: 8398/18000 (47%)
Took 1790.4573175907135 seconds.
Test set: Average loss: 2.1179, Top-1 Accuracy: 3939/6000 (65.6500%)
Took 1791.8571844100952 seconds.
Test set: Average loss: 2.1179, Top-5 Accuracy: 5753.0/6000 (95.8833%)
Took 1791.8571844100952 seconds.

----- Layer 2, Node 2, Epoch 21/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.093662
Train set: Average loss: 0.1219
Valid set: Average loss: 5.1990, Accuracy: 8900/18000 (49%)
Took 1811.1237671375275 seconds.
Test set: Average loss: 1.9393, Top-1 Accuracy: 4049/6000 (67.4833%)
Took 1812.5228998661041 seconds.
Test set: Average loss: 1.9393, Top-5 Accuracy: 5754.0/6000 (95.9000%)
Took 1812.5228998661041 seconds.

----- Layer 2, Node 2, Epoch 22/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.095289
Train set: Average loss: 0.1081
Valid set: Average loss: 6.0339, Accuracy: 8512/18000 (47%)
Took 1831.7662961483002 seconds.
Test set: Average loss: 1.8034, Top-1 Accuracy: 4177/6000 (69.6167%)
Took 1833.158075094223 seconds.
Test set: Average loss: 1.8034, Top-5 Accuracy: 5815.0/6000 (96.9167%)
Took 1833.158075094223 seconds.

----- Layer 2, Node 2, Epoch 23/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.090112
Train set: Average loss: 0.0929
Valid set: Average loss: 5.3600, Accuracy: 8767/18000 (49%)
Took 1852.40558385849 seconds.
Test set: Average loss: 1.9874, Top-1 Accuracy: 4043/6000 (67.3833%)
Took 1853.83362698555 seconds.
Test set: Average loss: 1.9874, Top-5 Accuracy: 5800.0/6000 (96.6667%)
Took 1853.83362698555 seconds.

----- Layer 2, Node 2, Epoch 24/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.086796
Train set: Average loss: 0.0917
Valid set: Average loss: 6.1208, Accuracy: 8184/18000 (45%)
Took 1874.0112068653107 seconds.
Test set: Average loss: 2.2860, Top-1 Accuracy: 3982/6000 (66.3667%)
Took 1875.4942119121552 seconds.
Test set: Average loss: 2.2860, Top-5 Accuracy: 5747.0/6000 (95.7833%)
Took 1875.4942119121552 seconds.

----- Layer 2, Node 2, Epoch 25/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.085966
Train set: Average loss: 0.0906
Valid set: Average loss: 6.0989, Accuracy: 8383/18000 (47%)
Took 1895.7003998756409 seconds.
Test set: Average loss: 1.9411, Top-1 Accuracy: 4132/6000 (68.8667%)
Took 1897.1660578250885 seconds.
Test set: Average loss: 1.9411, Top-5 Accuracy: 5845.0/6000 (97.4167%)
Took 1897.1660578250885 seconds.

----- Layer 2, Node 2, Epoch 26/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.018136
Train set: Average loss: 0.0506
Valid set: Average loss: 6.6272, Accuracy: 8357/18000 (46%)
Took 1917.3231387138367 seconds.
Test set: Average loss: 2.2823, Top-1 Accuracy: 4073/6000 (67.8833%)
Took 1918.7897741794586 seconds.
Test set: Average loss: 2.2823, Top-5 Accuracy: 5688.0/6000 (94.8000%)
Took 1918.7897741794586 seconds.

----- Layer 2, Node 2, Epoch 27/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.008732
Train set: Average loss: 0.0150
Valid set: Average loss: 7.1580, Accuracy: 8416/18000 (47%)
Took 1938.9952354431152 seconds.
Test set: Average loss: 2.6149, Top-1 Accuracy: 4065/6000 (67.7500%)
Took 1940.459570646286 seconds.
Test set: Average loss: 2.6149, Top-5 Accuracy: 5673.0/6000 (94.5500%)
Took 1940.459570646286 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.2361, Top-1 Accuracy: 3882/6000 (64.7000%)
Took 1941.9541306495667 seconds.
Test set: Average loss: 1.2361, Top-5 Accuracy: 5892.0/6000 (98.2000%)
Took 1941.9541306495667 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 1.0242, Top-1 Accuracy: 4601/6000 (76.6833%)
Took 1942.8567078113556 seconds.
Test set: Average loss: 1.0242, Top-5 Accuracy: 5741.0/6000 (95.6833%)
Took 1942.8567078113556 seconds.
Test set: Average loss: 0.6045, Top-1 Accuracy: 5065/6000 (84.4167%)
Took 1943.9023225307465 seconds.
Test set: Average loss: 0.6045, Top-5 Accuracy: 5864.0/6000 (97.7333%)
Took 1943.9023225307465 seconds.
Test set: Average loss: 1.2361, Top-1 Accuracy: 3882/6000 (64.7000%)
Took 1945.369115114212 seconds.
Test set: Average loss: 1.2361, Top-5 Accuracy: 5892.0/6000 (98.2000%)
Took 1945.369115114212 seconds.

Average Top-1 accuracy: tensor(75.2667)

----- Top1 acc: [83.66666412353516, 82.88333129882812, 75.26667022705078]
----- Top5 acc: [99.71666717529297, 99.16667175292969, 97.20555114746094]
============== Continual learning on task 3 =================

[before adaption and growth]
Test set: Average loss: 1.7829, Top-1 Accuracy: 2933/6000 (48.8833%)
Took 1947.5792319774628 seconds.
Test set: Average loss: 1.7829, Top-5 Accuracy: 5758.0/6000 (95.9667%)
Took 1947.5792319774628 seconds.
old_data shape: torch.Size([15000, 3072])
new_data_1 shape: torch.Size([15000, 3072])
MMD loss:tensor(0.1536, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[3]
tensor([1.], device='cuda:0')
[3]
---------------------------------------------------------------

At layer 3

Processing node 3
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>

---------- Optimizing a binary split ------------
True
True
False

Selectively optimising the parameters below:
          tree_modules.3.router.conv1.weight
          tree_modules.3.router.conv1.bias
          tree_modules.3.router.linear1.weight
          tree_modules.3.router.linear1.bias
          child_left.classifier.fc1.weight
          child_left.classifier.fc1.bias
          child_left.classifier.fc2.weight
          child_left.classifier.fc2.bias
          child_left.classifier.fc3.weight
          child_left.classifier.fc3.bias
          child_right.classifier.fc1.weight
          child_right.classifier.fc1.bias
          child_right.classifier.fc2.weight
          child_right.classifier.fc2.bias
          child_right.classifier.fc3.weight
          child_right.classifier.fc3.bias

----- Layer 3, Node 3, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.659583
Train set: Average loss: 0.7201
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7755, Accuracy: 4319/6000 (72%)
Took 1974.586528301239 seconds.
Test set: Average loss: 0.7755, Top-1 Accuracy: 4319/6000 (71.9833%)
Took 1976.6868591308594 seconds.
Test set: Average loss: 0.7755, Top-5 Accuracy: 5976.0/6000 (99.6000%)
Took 1976.6868591308594 seconds.

----- Layer 3, Node 3, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.631700
Train set: Average loss: 0.6296
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6795, Accuracy: 4497/6000 (75%)
Took 1992.1432106494904 seconds.
Test set: Average loss: 0.6795, Top-1 Accuracy: 4497/6000 (74.9500%)
Took 1994.2455728054047 seconds.
Test set: Average loss: 0.6795, Top-5 Accuracy: 5975.0/6000 (99.5833%)
Took 1994.2455728054047 seconds.

----- Layer 3, Node 3, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.614251
Train set: Average loss: 0.6087
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6765, Accuracy: 4517/6000 (75%)
Took 2009.7249233722687 seconds.
Test set: Average loss: 0.6765, Top-1 Accuracy: 4517/6000 (75.2833%)
Took 2011.8287408351898 seconds.
Test set: Average loss: 0.6765, Top-5 Accuracy: 5980.0/6000 (99.6667%)
Took 2011.8287408351898 seconds.

----- Layer 3, Node 3, Epoch 4/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.602075
Train set: Average loss: 0.5954
Valid set: Average loss: 0.6823, Accuracy: 4499/6000 (75%)
Took 2027.2670214176178 seconds.
Test set: Average loss: 0.6823, Top-1 Accuracy: 4499/6000 (74.9833%)
Took 2029.3811128139496 seconds.
Test set: Average loss: 0.6823, Top-5 Accuracy: 5976.0/6000 (99.6000%)
Took 2029.3811128139496 seconds.

----- Layer 3, Node 3, Epoch 5/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.594272
Train set: Average loss: 0.5873
Valid set: Average loss: 0.6847, Accuracy: 4490/6000 (75%)
Took 2044.8210167884827 seconds.
Test set: Average loss: 0.6847, Top-1 Accuracy: 4490/6000 (74.8333%)
Took 2046.9460701942444 seconds.
Test set: Average loss: 0.6847, Top-5 Accuracy: 5975.0/6000 (99.5833%)
Took 2046.9460701942444 seconds.

----- Layer 3, Node 3, Epoch 6/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.590170
Train set: Average loss: 0.5801
Valid set: Average loss: 0.6908, Accuracy: 4484/6000 (75%)
Took 2062.365417957306 seconds.
Test set: Average loss: 0.6908, Top-1 Accuracy: 4484/6000 (74.7333%)
Took 2064.506275177002 seconds.
Test set: Average loss: 0.6908, Top-5 Accuracy: 5976.0/6000 (99.6000%)
Took 2064.506275177002 seconds.

----- Layer 3, Node 3, Epoch 7/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.581029
Train set: Average loss: 0.5742
Valid set: Average loss: 0.6986, Accuracy: 4458/6000 (74%)
Took 2079.9007108211517 seconds.
Test set: Average loss: 0.6986, Top-1 Accuracy: 4458/6000 (74.3000%)
Took 2082.0176165103912 seconds.
Test set: Average loss: 0.6986, Top-5 Accuracy: 5976.0/6000 (99.6000%)
Took 2082.0176165103912 seconds.

----- Layer 3, Node 3, Epoch 8/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.572236
Train set: Average loss: 0.5690
Valid set: Average loss: 0.7117, Accuracy: 4449/6000 (74%)
Took 2097.454941511154 seconds.
Test set: Average loss: 0.7117, Top-1 Accuracy: 4449/6000 (74.1500%)
Took 2099.5597014427185 seconds.
Test set: Average loss: 0.7117, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 2099.5597014427185 seconds.

----- Layer 3, Node 3, Epoch 9/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.568883
Train set: Average loss: 0.5640
Valid set: Average loss: 0.7117, Accuracy: 4448/6000 (74%)
Took 2114.9796369075775 seconds.
Test set: Average loss: 0.7117, Top-1 Accuracy: 4448/6000 (74.1333%)
Took 2117.082222223282 seconds.
Test set: Average loss: 0.7117, Top-5 Accuracy: 5975.0/6000 (99.5833%)
Took 2117.082222223282 seconds.

----- Layer 3, Node 3, Epoch 10/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.561461
Train set: Average loss: 0.5609
Valid set: Average loss: 0.7133, Accuracy: 4442/6000 (74%)
Took 2132.5231449604034 seconds.
Test set: Average loss: 0.7133, Top-1 Accuracy: 4442/6000 (74.0333%)
Took 2134.624862909317 seconds.
Test set: Average loss: 0.7133, Top-5 Accuracy: 5973.0/6000 (99.5500%)
Took 2134.624862909317 seconds.

----- Layer 3, Node 3, Epoch 11/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.560938
Train set: Average loss: 0.5556
Valid set: Average loss: 0.7139, Accuracy: 4441/6000 (74%)
Took 2150.0582172870636 seconds.
Test set: Average loss: 0.7139, Top-1 Accuracy: 4441/6000 (74.0167%)
Took 2152.160930633545 seconds.
Test set: Average loss: 0.7139, Top-5 Accuracy: 5978.0/6000 (99.6333%)
Took 2152.160930633545 seconds.

----- Layer 3, Node 3, Epoch 12/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.552330
Train set: Average loss: 0.5510
Valid set: Average loss: 0.7138, Accuracy: 4444/6000 (74%)
Took 2167.060674905777 seconds.
Test set: Average loss: 0.7138, Top-1 Accuracy: 4444/6000 (74.0667%)
Took 2169.041039943695 seconds.
Test set: Average loss: 0.7138, Top-5 Accuracy: 5975.0/6000 (99.5833%)
Took 2169.041039943695 seconds.

----- Layer 3, Node 3, Epoch 13/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.550528
Train set: Average loss: 0.5467
Valid set: Average loss: 0.7183, Accuracy: 4437/6000 (74%)
Took 2183.653177022934 seconds.
Test set: Average loss: 0.7183, Top-1 Accuracy: 4437/6000 (73.9500%)
Took 2185.6327397823334 seconds.
Test set: Average loss: 0.7183, Top-5 Accuracy: 5974.0/6000 (99.5667%)
Took 2185.6327397823334 seconds.

----- Layer 3, Node 3, Epoch 14/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.540815
Train set: Average loss: 0.5432
Valid set: Average loss: 0.7307, Accuracy: 4427/6000 (74%)
Took 2200.287278652191 seconds.
Test set: Average loss: 0.7307, Top-1 Accuracy: 4427/6000 (73.7833%)
Took 2202.2665729522705 seconds.
Test set: Average loss: 0.7307, Top-5 Accuracy: 5978.0/6000 (99.6333%)
Took 2202.2665729522705 seconds.

----- Layer 3, Node 3, Epoch 15/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.541192
Train set: Average loss: 0.5396
Valid set: Average loss: 0.7304, Accuracy: 4426/6000 (74%)
Took 2216.896583557129 seconds.
Test set: Average loss: 0.7304, Top-1 Accuracy: 4426/6000 (73.7667%)
Took 2218.8950638771057 seconds.
Test set: Average loss: 0.7304, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 2218.8950638771057 seconds.

----- Layer 3, Node 3, Epoch 16/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.529922
Train set: Average loss: 0.5332
Valid set: Average loss: 0.7410, Accuracy: 4408/6000 (73%)
Took 2233.4299376010895 seconds.
Test set: Average loss: 0.7410, Top-1 Accuracy: 4408/6000 (73.4667%)
Took 2235.4848692417145 seconds.
Test set: Average loss: 0.7410, Top-5 Accuracy: 5978.0/6000 (99.6333%)
Took 2235.4848692417145 seconds.

----- Layer 3, Node 3, Epoch 17/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.529328
Train set: Average loss: 0.5272
Valid set: Average loss: 0.7418, Accuracy: 4433/6000 (74%)
Took 2250.0516889095306 seconds.
Test set: Average loss: 0.7418, Top-1 Accuracy: 4433/6000 (73.8833%)
Took 2252.0546357631683 seconds.
Test set: Average loss: 0.7418, Top-5 Accuracy: 5978.0/6000 (99.6333%)
Took 2252.0546357631683 seconds.

----- Layer 3, Node 3, Epoch 18/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.527576
Train set: Average loss: 0.5250
Valid set: Average loss: 0.7536, Accuracy: 4400/6000 (73%)
Took 2266.7031378746033 seconds.
Test set: Average loss: 0.7536, Top-1 Accuracy: 4400/6000 (73.3333%)
Took 2268.683742284775 seconds.
Test set: Average loss: 0.7536, Top-5 Accuracy: 5978.0/6000 (99.6333%)
Took 2268.683742284775 seconds.

----- Layer 3, Node 3, Epoch 19/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.518523
Train set: Average loss: 0.5211
Valid set: Average loss: 0.7581, Accuracy: 4387/6000 (73%)
Took 2283.283690929413 seconds.
Test set: Average loss: 0.7581, Top-1 Accuracy: 4387/6000 (73.1167%)
Took 2285.264825820923 seconds.
Test set: Average loss: 0.7581, Top-5 Accuracy: 5980.0/6000 (99.6667%)
Took 2285.264825820923 seconds.

----- Layer 3, Node 3, Epoch 20/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.514226
Train set: Average loss: 0.5160
Valid set: Average loss: 0.7571, Accuracy: 4384/6000 (73%)
Took 2300.2840671539307 seconds.
Test set: Average loss: 0.7571, Top-1 Accuracy: 4384/6000 (73.0667%)
Took 2302.372941493988 seconds.
Test set: Average loss: 0.7571, Top-5 Accuracy: 5981.0/6000 (99.6833%)
Took 2302.372941493988 seconds.

----- Layer 3, Node 3, Epoch 21/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.516075
Train set: Average loss: 0.5126
Valid set: Average loss: 0.7727, Accuracy: 4359/6000 (73%)
Took 2317.64616894722 seconds.
Test set: Average loss: 0.7727, Top-1 Accuracy: 4359/6000 (72.6500%)
Took 2319.7201116085052 seconds.
Test set: Average loss: 0.7727, Top-5 Accuracy: 5981.0/6000 (99.6833%)
Took 2319.7201116085052 seconds.
Early stopping by patience!
return the node-wise best split model
returning left and right children

----------- Optimizing an extension --------------
No extension as the transformer is an identity function.
Average valid loss is reduced by 75.28333282470703

Splitting node 3
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 0.6765, Top-1 Accuracy: 4517/6000 (75.2833%)
Took 2321.8223218917847 seconds.
Test set: Average loss: 0.6765, Top-5 Accuracy: 5980.0/6000 (99.6667%)
Took 2321.8223218917847 seconds.
False
False
False

Perform global training

----- Layer 4, Node 4, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.646417
Train set: Average loss: 1.0818
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1763, Accuracy: 15738/24000 (66%)
Took 2347.6918239593506 seconds.
Test set: Average loss: 0.8941, Top-1 Accuracy: 4484/6000 (74.7333%)
Took 2349.794202566147 seconds.
Test set: Average loss: 0.8941, Top-5 Accuracy: 5812.0/6000 (96.8667%)
Took 2349.794202566147 seconds.

----- Layer 4, Node 4, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.484663
Train set: Average loss: 0.5099
Valid set: Average loss: 1.4189, Accuracy: 15729/24000 (66%)
Took 2375.8463389873505 seconds.
Test set: Average loss: 1.0791, Top-1 Accuracy: 4426/6000 (73.7667%)
Took 2377.890217065811 seconds.
Test set: Average loss: 1.0791, Top-5 Accuracy: 5811.0/6000 (96.8500%)
Took 2377.890217065811 seconds.

----- Layer 4, Node 4, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.399197
Train set: Average loss: 0.3989
Valid set: Average loss: 1.6261, Accuracy: 15167/24000 (63%)
Took 2402.888650417328 seconds.
Test set: Average loss: 1.2853, Top-1 Accuracy: 4252/6000 (70.8667%)
Took 2404.913240671158 seconds.
Test set: Average loss: 1.2853, Top-5 Accuracy: 5757.0/6000 (95.9500%)
Took 2404.913240671158 seconds.

----- Layer 4, Node 4, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.371127
Train set: Average loss: 0.3406
Valid set: Average loss: 1.8586, Accuracy: 14881/24000 (62%)
Took 2429.933450937271 seconds.
Test set: Average loss: 1.5593, Top-1 Accuracy: 4049/6000 (67.4833%)
Took 2431.932077884674 seconds.
Test set: Average loss: 1.5593, Top-5 Accuracy: 5731.0/6000 (95.5167%)
Took 2431.932077884674 seconds.

----- Layer 4, Node 4, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.324763
Train set: Average loss: 0.3030
Valid set: Average loss: 1.6483, Accuracy: 15490/24000 (65%)
Took 2456.845993041992 seconds.
Test set: Average loss: 1.1364, Top-1 Accuracy: 4487/6000 (74.7833%)
Took 2458.838701725006 seconds.
Test set: Average loss: 1.1364, Top-5 Accuracy: 5721.0/6000 (95.3500%)
Took 2458.838701725006 seconds.

----- Layer 4, Node 4, Epoch 6/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.271099
Train set: Average loss: 0.2631
Valid set: Average loss: 1.7711, Accuracy: 15119/24000 (63%)
Took 2483.877017259598 seconds.
Test set: Average loss: 1.1796, Top-1 Accuracy: 4441/6000 (74.0167%)
Took 2485.8791134357452 seconds.
Test set: Average loss: 1.1796, Top-5 Accuracy: 5847.0/6000 (97.4500%)
Took 2485.8791134357452 seconds.

----- Layer 4, Node 4, Epoch 7/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.228803
Train set: Average loss: 0.2367
Valid set: Average loss: 2.0521, Accuracy: 14481/24000 (60%)
Took 2510.8082933425903 seconds.
Test set: Average loss: 1.7643, Top-1 Accuracy: 4117/6000 (68.6167%)
Took 2512.8070061206818 seconds.
Test set: Average loss: 1.7643, Top-5 Accuracy: 5554.0/6000 (92.5667%)
Took 2512.8070061206818 seconds.

----- Layer 4, Node 4, Epoch 8/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.189821
Train set: Average loss: 0.1972
Valid set: Average loss: 2.2717, Accuracy: 14100/24000 (59%)
Took 2537.726542711258 seconds.
Test set: Average loss: 1.5939, Top-1 Accuracy: 4401/6000 (73.3500%)
Took 2539.7602083683014 seconds.
Test set: Average loss: 1.5939, Top-5 Accuracy: 5637.0/6000 (93.9500%)
Took 2539.7602083683014 seconds.

----- Layer 4, Node 4, Epoch 9/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.158384
Train set: Average loss: 0.1727
Valid set: Average loss: 2.2468, Accuracy: 14028/24000 (58%)
Took 2564.7704277038574 seconds.
Test set: Average loss: 1.7400, Top-1 Accuracy: 4338/6000 (72.3000%)
Took 2566.7776839733124 seconds.
Test set: Average loss: 1.7400, Top-5 Accuracy: 5511.0/6000 (91.8500%)
Took 2566.7776839733124 seconds.

----- Layer 4, Node 4, Epoch 10/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.131833
Train set: Average loss: 0.1456
Valid set: Average loss: 2.2281, Accuracy: 14846/24000 (62%)
Took 2591.662111520767 seconds.
Test set: Average loss: 1.8442, Top-1 Accuracy: 4200/6000 (70.0000%)
Took 2593.653753042221 seconds.
Test set: Average loss: 1.8442, Top-5 Accuracy: 5661.0/6000 (94.3500%)
Took 2593.653753042221 seconds.

----- Layer 4, Node 4, Epoch 11/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.124544
Train set: Average loss: 0.1446
Valid set: Average loss: 1.9657, Accuracy: 15476/24000 (64%)
Took 2618.681891441345 seconds.
Test set: Average loss: 1.4350, Top-1 Accuracy: 4496/6000 (74.9333%)
Took 2620.6823477745056 seconds.
Test set: Average loss: 1.4350, Top-5 Accuracy: 5755.0/6000 (95.9167%)
Took 2620.6823477745056 seconds.

----- Layer 4, Node 4, Epoch 12/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.114660
Train set: Average loss: 0.1198
Valid set: Average loss: 2.2672, Accuracy: 14883/24000 (62%)
Took 2646.2497959136963 seconds.
Test set: Average loss: 1.8288, Top-1 Accuracy: 4358/6000 (72.6333%)
Took 2648.3489034175873 seconds.
Test set: Average loss: 1.8288, Top-5 Accuracy: 5631.0/6000 (93.8500%)
Took 2648.3489034175873 seconds.

----- Layer 4, Node 4, Epoch 13/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.121318
Train set: Average loss: 0.1156
Valid set: Average loss: 2.0838, Accuracy: 15065/24000 (63%)
Took 2673.4001166820526 seconds.
Test set: Average loss: 1.2705, Top-1 Accuracy: 4587/6000 (76.4500%)
Took 2675.4116814136505 seconds.
Test set: Average loss: 1.2705, Top-5 Accuracy: 5782.0/6000 (96.3667%)
Took 2675.4116814136505 seconds.

----- Layer 4, Node 4, Epoch 14/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.102578
Train set: Average loss: 0.1114
Valid set: Average loss: 1.9908, Accuracy: 15445/24000 (64%)
Took 2700.3279814720154 seconds.
Test set: Average loss: 1.6926, Top-1 Accuracy: 4483/6000 (74.7167%)
Took 2702.320072412491 seconds.
Test set: Average loss: 1.6926, Top-5 Accuracy: 5672.0/6000 (94.5333%)
Took 2702.320072412491 seconds.

----- Layer 4, Node 4, Epoch 15/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.087614
Train set: Average loss: 0.1028
Valid set: Average loss: 2.4750, Accuracy: 14675/24000 (61%)
Took 2727.255373239517 seconds.
Test set: Average loss: 1.8721, Top-1 Accuracy: 4349/6000 (72.4833%)
Took 2729.3528065681458 seconds.
Test set: Average loss: 1.8721, Top-5 Accuracy: 5620.0/6000 (93.6667%)
Took 2729.3528065681458 seconds.

----- Layer 4, Node 4, Epoch 16/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.084906
Train set: Average loss: 0.0950
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.0939, Accuracy: 15741/24000 (66%)
Took 2754.3078315258026 seconds.
Test set: Average loss: 1.4069, Top-1 Accuracy: 4619/6000 (76.9833%)
Took 2756.3144965171814 seconds.
Test set: Average loss: 1.4069, Top-5 Accuracy: 5750.0/6000 (95.8333%)
Took 2756.3144965171814 seconds.

----- Layer 4, Node 4, Epoch 17/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.073456
Train set: Average loss: 0.0816
Valid set: Average loss: 2.0018, Accuracy: 15709/24000 (65%)
Took 2781.2158336639404 seconds.
Test set: Average loss: 1.6297, Top-1 Accuracy: 4426/6000 (73.7667%)
Took 2783.2245059013367 seconds.
Test set: Average loss: 1.6297, Top-5 Accuracy: 5741.0/6000 (95.6833%)
Took 2783.2245059013367 seconds.

----- Layer 4, Node 4, Epoch 18/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.080082
Train set: Average loss: 0.0709
Valid set: Average loss: 2.1886, Accuracy: 15480/24000 (64%)
Took 2808.252941131592 seconds.
Test set: Average loss: 1.7512, Top-1 Accuracy: 4331/6000 (72.1833%)
Took 2810.2475543022156 seconds.
Test set: Average loss: 1.7512, Top-5 Accuracy: 5764.0/6000 (96.0667%)
Took 2810.2475543022156 seconds.

----- Layer 4, Node 4, Epoch 19/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.075524
Train set: Average loss: 0.0764
Valid set: Average loss: 2.1935, Accuracy: 15673/24000 (65%)
Took 2835.211328983307 seconds.
Test set: Average loss: 1.7845, Top-1 Accuracy: 4434/6000 (73.9000%)
Took 2837.2057468891144 seconds.
Test set: Average loss: 1.7845, Top-5 Accuracy: 5730.0/6000 (95.5000%)
Took 2837.2057468891144 seconds.

----- Layer 4, Node 4, Epoch 20/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.051019
Train set: Average loss: 0.0694
Valid set: Average loss: 2.2321, Accuracy: 15452/24000 (64%)
Took 2862.2711741924286 seconds.
Test set: Average loss: 1.5298, Top-1 Accuracy: 4645/6000 (77.4167%)
Took 2864.29163980484 seconds.
Test set: Average loss: 1.5298, Top-5 Accuracy: 5724.0/6000 (95.4000%)
Took 2864.29163980484 seconds.

----- Layer 4, Node 4, Epoch 21/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.074912
Train set: Average loss: 0.0769
Valid set: Average loss: 2.6551, Accuracy: 14688/24000 (61%)
Took 2889.194379091263 seconds.
Test set: Average loss: 2.2603, Top-1 Accuracy: 4227/6000 (70.4500%)
Took 2891.1876995563507 seconds.
Test set: Average loss: 2.2603, Top-5 Accuracy: 5539.0/6000 (92.3167%)
Took 2891.1876995563507 seconds.

----- Layer 4, Node 4, Epoch 22/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.055109
Train set: Average loss: 0.0624
Valid set: Average loss: 2.5481, Accuracy: 14955/24000 (62%)
Took 2916.1319925785065 seconds.
Test set: Average loss: 1.4068, Top-1 Accuracy: 4684/6000 (78.0667%)
Took 2918.184121608734 seconds.
Test set: Average loss: 1.4068, Top-5 Accuracy: 5776.0/6000 (96.2667%)
Took 2918.184121608734 seconds.

----- Layer 4, Node 4, Epoch 23/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.065098
Train set: Average loss: 0.0612
Valid set: Average loss: 2.2425, Accuracy: 15587/24000 (65%)
Took 2943.1661508083344 seconds.
Test set: Average loss: 1.7885, Top-1 Accuracy: 4520/6000 (75.3333%)
Took 2945.180790424347 seconds.
Test set: Average loss: 1.7885, Top-5 Accuracy: 5630.0/6000 (93.8333%)
Took 2945.180790424347 seconds.

----- Layer 4, Node 4, Epoch 24/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.049924
Train set: Average loss: 0.0600
Valid set: Average loss: 2.4456, Accuracy: 15055/24000 (63%)
Took 2970.101810693741 seconds.
Test set: Average loss: 1.8488, Top-1 Accuracy: 4468/6000 (74.4667%)
Took 2972.098905801773 seconds.
Test set: Average loss: 1.8488, Top-5 Accuracy: 5650.0/6000 (94.1667%)
Took 2972.098905801773 seconds.

----- Layer 4, Node 4, Epoch 25/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.060924
Train set: Average loss: 0.0635
Valid set: Average loss: 2.5303, Accuracy: 14767/24000 (62%)
Took 2997.1781833171844 seconds.
Test set: Average loss: 2.3165, Top-1 Accuracy: 4234/6000 (70.5667%)
Took 2999.175325155258 seconds.
Test set: Average loss: 2.3165, Top-5 Accuracy: 5521.0/6000 (92.0167%)
Took 2999.175325155258 seconds.

----- Layer 4, Node 4, Epoch 26/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.006548
Train set: Average loss: 0.0248
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.1806, Accuracy: 15990/24000 (67%)
Took 3024.1067481040955 seconds.
Test set: Average loss: 2.1139, Top-1 Accuracy: 4403/6000 (73.3833%)
Took 3026.1315727233887 seconds.
Test set: Average loss: 2.1139, Top-5 Accuracy: 5612.0/6000 (93.5333%)
Took 3026.1315727233887 seconds.

----- Layer 4, Node 4, Epoch 27/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.001277
Train set: Average loss: 0.0033
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.3488, Accuracy: 16067/24000 (67%)
Took 3051.09557056427 seconds.
Test set: Average loss: 2.1247, Top-1 Accuracy: 4475/6000 (74.5833%)
Took 3053.1397144794464 seconds.
Test set: Average loss: 2.1247, Top-5 Accuracy: 5638.0/6000 (93.9667%)
Took 3053.1397144794464 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 2.1247, Top-1 Accuracy: 4475/6000 (74.5833%)
Took 3055.185396194458 seconds.
Test set: Average loss: 2.1247, Top-5 Accuracy: 5638.0/6000 (93.9667%)
Took 3055.185396194458 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 1.7219, Top-1 Accuracy: 4392/6000 (73.2000%)
Took 3056.046195745468 seconds.
Test set: Average loss: 1.7219, Top-5 Accuracy: 5741.0/6000 (95.6833%)
Took 3056.046195745468 seconds.
Test set: Average loss: 1.2760, Top-1 Accuracy: 4892/6000 (81.5333%)
Took 3057.0485389232635 seconds.
Test set: Average loss: 1.2760, Top-5 Accuracy: 5774.0/6000 (96.2333%)
Took 3057.0485389232635 seconds.
Test set: Average loss: 3.0069, Top-1 Accuracy: 3412/6000 (56.8667%)
Took 3058.443338394165 seconds.
Test set: Average loss: 3.0069, Top-5 Accuracy: 5432.0/6000 (90.5333%)
Took 3058.443338394165 seconds.
Test set: Average loss: 2.1247, Top-1 Accuracy: 4475/6000 (74.5833%)
Took 3060.4369130134583 seconds.
Test set: Average loss: 2.1247, Top-5 Accuracy: 5638.0/6000 (93.9667%)
Took 3060.4369130134583 seconds.

Average Top-1 accuracy: tensor(71.5458)

----- Top1 acc: [83.66666412353516, 82.88333129882812, 75.26667022705078, 71.54583740234375]
----- Top5 acc: [99.71666717529297, 99.16667175292969, 97.20555114746094, 94.10416412353516]
============== Continual learning on task 4 =================

[before adaption and growth]
Test set: Average loss: 3.3773, Top-1 Accuracy: 3391/6000 (56.5167%)
Took 3062.7455220222473 seconds.
Test set: Average loss: 3.3773, Top-5 Accuracy: 5528.0/6000 (92.1333%)
Took 3062.7455220222473 seconds.
old_data shape: torch.Size([10000, 3072])
new_data_1 shape: torch.Size([10000, 3072])
MMD loss:tensor(0.1068, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[4, 5]
tensor([0.7710, 0.2290], device='cuda:0')
[4, 5]
---------------------------------------------------------------

At layer 4

Processing node 4
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>

---------- Optimizing a binary split ------------
True
True
False

Selectively optimising the parameters below:
          tree_modules.4.router.conv1.weight
          tree_modules.4.router.conv1.bias
          tree_modules.4.router.linear1.weight
          tree_modules.4.router.linear1.bias
          child_left.classifier.fc1.weight
          child_left.classifier.fc1.bias
          child_left.classifier.fc2.weight
          child_left.classifier.fc2.bias
          child_left.classifier.fc3.weight
          child_left.classifier.fc3.bias
          child_right.classifier.fc1.weight
          child_right.classifier.fc1.bias
          child_right.classifier.fc2.weight
          child_right.classifier.fc2.bias
          child_right.classifier.fc3.weight
          child_right.classifier.fc3.bias

----- Layer 4, Node 4, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.662299
Train set: Average loss: 0.6454
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.0012, Accuracy: 4260/6000 (71%)
Took 3087.2279419898987 seconds.
Test set: Average loss: 1.0012, Top-1 Accuracy: 4260/6000 (71.0000%)
Took 3089.5463321208954 seconds.
Test set: Average loss: 1.0012, Top-5 Accuracy: 5976.0/6000 (99.6000%)
Took 3089.5463321208954 seconds.

----- Layer 4, Node 4, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.552184
Train set: Average loss: 0.5642
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.9971, Accuracy: 4263/6000 (71%)
Took 3105.614236354828 seconds.
Test set: Average loss: 0.9971, Top-1 Accuracy: 4263/6000 (71.0500%)
Took 3107.920414209366 seconds.
Test set: Average loss: 0.9971, Top-5 Accuracy: 5973.0/6000 (99.5500%)
Took 3107.920414209366 seconds.

----- Layer 4, Node 4, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.544658
Train set: Average loss: 0.5536
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.9968, Accuracy: 4266/6000 (71%)
Took 3124.0134296417236 seconds.
Test set: Average loss: 0.9968, Top-1 Accuracy: 4266/6000 (71.1000%)
Took 3126.313089609146 seconds.
Test set: Average loss: 0.9968, Top-5 Accuracy: 5973.0/6000 (99.5500%)
Took 3126.313089609146 seconds.

----- Layer 4, Node 4, Epoch 4/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.536571
Train set: Average loss: 0.5470
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.0033, Accuracy: 4270/6000 (71%)
Took 3142.3905158042908 seconds.
Test set: Average loss: 1.0033, Top-1 Accuracy: 4270/6000 (71.1667%)
Took 3144.6854453086853 seconds.
Test set: Average loss: 1.0033, Top-5 Accuracy: 5971.0/6000 (99.5167%)
Took 3144.6854453086853 seconds.

----- Layer 4, Node 4, Epoch 5/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.532672
Train set: Average loss: 0.5427
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.0192, Accuracy: 4293/6000 (72%)
Took 3160.787817955017 seconds.
Test set: Average loss: 1.0192, Top-1 Accuracy: 4293/6000 (71.5500%)
Took 3163.0839414596558 seconds.
Test set: Average loss: 1.0192, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3163.0839414596558 seconds.

----- Layer 4, Node 4, Epoch 6/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.528284
Train set: Average loss: 0.5380
Valid set: Average loss: 1.0324, Accuracy: 4269/6000 (71%)
Took 3179.1665308475494 seconds.
Test set: Average loss: 1.0324, Top-1 Accuracy: 4269/6000 (71.1500%)
Took 3181.460866212845 seconds.
Test set: Average loss: 1.0324, Top-5 Accuracy: 5964.0/6000 (99.4000%)
Took 3181.460866212845 seconds.

----- Layer 4, Node 4, Epoch 7/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.520873
Train set: Average loss: 0.5344
Valid set: Average loss: 1.0444, Accuracy: 4271/6000 (71%)
Took 3197.5059797763824 seconds.
Test set: Average loss: 1.0444, Top-1 Accuracy: 4271/6000 (71.1833%)
Took 3199.7998480796814 seconds.
Test set: Average loss: 1.0444, Top-5 Accuracy: 5963.0/6000 (99.3833%)
Took 3199.7998480796814 seconds.

----- Layer 4, Node 4, Epoch 8/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.515706
Train set: Average loss: 0.5290
Valid set: Average loss: 1.0633, Accuracy: 4282/6000 (71%)
Took 3215.929940223694 seconds.
Test set: Average loss: 1.0633, Top-1 Accuracy: 4282/6000 (71.3667%)
Took 3218.2254300117493 seconds.
Test set: Average loss: 1.0633, Top-5 Accuracy: 5963.0/6000 (99.3833%)
Took 3218.2254300117493 seconds.

----- Layer 4, Node 4, Epoch 9/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.515860
Train set: Average loss: 0.5248
Valid set: Average loss: 1.0835, Accuracy: 4258/6000 (71%)
Took 3234.1551415920258 seconds.
Test set: Average loss: 1.0835, Top-1 Accuracy: 4258/6000 (70.9667%)
Took 3236.449315071106 seconds.
Test set: Average loss: 1.0835, Top-5 Accuracy: 5959.0/6000 (99.3167%)
Took 3236.449315071106 seconds.

----- Layer 4, Node 4, Epoch 10/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.509342
Train set: Average loss: 0.5211
Valid set: Average loss: 1.0949, Accuracy: 4242/6000 (71%)
Took 3252.334413766861 seconds.
Test set: Average loss: 1.0949, Top-1 Accuracy: 4242/6000 (70.7000%)
Took 3254.5994136333466 seconds.
Test set: Average loss: 1.0949, Top-5 Accuracy: 5958.0/6000 (99.3000%)
Took 3254.5994136333466 seconds.

----- Layer 4, Node 4, Epoch 11/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.502146
Train set: Average loss: 0.5163
Valid set: Average loss: 1.1012, Accuracy: 4266/6000 (71%)
Took 3270.517338037491 seconds.
Test set: Average loss: 1.1012, Top-1 Accuracy: 4266/6000 (71.1000%)
Took 3272.7826449871063 seconds.
Test set: Average loss: 1.1012, Top-5 Accuracy: 5953.0/6000 (99.2167%)
Took 3272.7826449871063 seconds.

----- Layer 4, Node 4, Epoch 12/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.496707
Train set: Average loss: 0.5114
Valid set: Average loss: 1.1368, Accuracy: 4214/6000 (70%)
Took 3288.660070180893 seconds.
Test set: Average loss: 1.1368, Top-1 Accuracy: 4214/6000 (70.2333%)
Took 3290.9233775138855 seconds.
Test set: Average loss: 1.1368, Top-5 Accuracy: 5959.0/6000 (99.3167%)
Took 3290.9233775138855 seconds.

----- Layer 4, Node 4, Epoch 13/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.489390
Train set: Average loss: 0.5059
Valid set: Average loss: 1.1418, Accuracy: 4223/6000 (70%)
Took 3306.8273940086365 seconds.
Test set: Average loss: 1.1418, Top-1 Accuracy: 4223/6000 (70.3833%)
Took 3309.092958688736 seconds.
Test set: Average loss: 1.1418, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 3309.092958688736 seconds.

----- Layer 4, Node 4, Epoch 14/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.486900
Train set: Average loss: 0.5017
Valid set: Average loss: 1.1850, Accuracy: 4212/6000 (70%)
Took 3324.971102952957 seconds.
Test set: Average loss: 1.1850, Top-1 Accuracy: 4212/6000 (70.2000%)
Took 3327.2529180049896 seconds.
Test set: Average loss: 1.1850, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 3327.2529180049896 seconds.

----- Layer 4, Node 4, Epoch 15/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.482022
Train set: Average loss: 0.4968
Valid set: Average loss: 1.1887, Accuracy: 4205/6000 (70%)
Took 3343.122156858444 seconds.
Test set: Average loss: 1.1887, Top-1 Accuracy: 4205/6000 (70.0833%)
Took 3345.389981985092 seconds.
Test set: Average loss: 1.1887, Top-5 Accuracy: 5958.0/6000 (99.3000%)
Took 3345.389981985092 seconds.

----- Layer 4, Node 4, Epoch 16/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.477392
Train set: Average loss: 0.4907
Valid set: Average loss: 1.2313, Accuracy: 4197/6000 (70%)
Took 3361.3013048171997 seconds.
Test set: Average loss: 1.2313, Top-1 Accuracy: 4197/6000 (69.9500%)
Took 3363.568966150284 seconds.
Test set: Average loss: 1.2313, Top-5 Accuracy: 5957.0/6000 (99.2833%)
Took 3363.568966150284 seconds.

----- Layer 4, Node 4, Epoch 17/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.471472
Train set: Average loss: 0.4875
Valid set: Average loss: 1.2516, Accuracy: 4193/6000 (70%)
Took 3379.672018289566 seconds.
Test set: Average loss: 1.2516, Top-1 Accuracy: 4193/6000 (69.8833%)
Took 3381.9730994701385 seconds.
Test set: Average loss: 1.2516, Top-5 Accuracy: 5959.0/6000 (99.3167%)
Took 3381.9730994701385 seconds.

----- Layer 4, Node 4, Epoch 18/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.470150
Train set: Average loss: 0.4826
Valid set: Average loss: 1.2636, Accuracy: 4180/6000 (70%)
Took 3398.1180336475372 seconds.
Test set: Average loss: 1.2636, Top-1 Accuracy: 4180/6000 (69.6667%)
Took 3400.4166984558105 seconds.
Test set: Average loss: 1.2636, Top-5 Accuracy: 5964.0/6000 (99.4000%)
Took 3400.4166984558105 seconds.
Early stopping by patience!
return the node-wise best split model
returning left and right children

----------- Optimizing an extension --------------
No extension as the transformer is an identity function.
Average valid loss is reduced by 71.55000305175781

Splitting node 4
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json
---------------------------------------------------------------

At layer 4

Processing node 5
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>

---------- Optimizing a binary split ------------
True
True
False

Selectively optimising the parameters below:
          tree_modules.5.router.conv1.weight
          tree_modules.5.router.conv1.bias
          tree_modules.5.router.linear1.weight
          tree_modules.5.router.linear1.bias
          child_left.classifier.fc1.weight
          child_left.classifier.fc1.bias
          child_left.classifier.fc2.weight
          child_left.classifier.fc2.bias
          child_left.classifier.fc3.weight
          child_left.classifier.fc3.bias
          child_right.classifier.fc1.weight
          child_right.classifier.fc1.bias
          child_right.classifier.fc2.weight
          child_right.classifier.fc2.bias
          child_right.classifier.fc3.weight
          child_right.classifier.fc3.bias

----- Layer 4, Node 5, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.410946
Train set: Average loss: 0.4080
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7563, Accuracy: 4401/6000 (73%)
Took 3416.6295351982117 seconds.
Test set: Average loss: 0.7563, Top-1 Accuracy: 4401/6000 (73.3500%)
Took 3418.927859067917 seconds.
Test set: Average loss: 0.7563, Top-5 Accuracy: 5970.0/6000 (99.5000%)
Took 3418.927859067917 seconds.

----- Layer 4, Node 5, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.374618
Train set: Average loss: 0.3977
Valid set: Average loss: 0.7702, Accuracy: 4398/6000 (73%)
Took 3435.0464584827423 seconds.
Test set: Average loss: 0.7702, Top-1 Accuracy: 4398/6000 (73.3000%)
Took 3437.3402338027954 seconds.
Test set: Average loss: 0.7702, Top-5 Accuracy: 5967.0/6000 (99.4500%)
Took 3437.3402338027954 seconds.

----- Layer 4, Node 5, Epoch 3/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.373791
Train set: Average loss: 0.3960
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7540, Accuracy: 4397/6000 (73%)
Took 3453.548413991928 seconds.
Test set: Average loss: 0.7540, Top-1 Accuracy: 4397/6000 (73.2833%)
Took 3455.8460347652435 seconds.
Test set: Average loss: 0.7540, Top-5 Accuracy: 5967.0/6000 (99.4500%)
Took 3455.8460347652435 seconds.

----- Layer 4, Node 5, Epoch 4/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.372469
Train set: Average loss: 0.3944
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7533, Accuracy: 4392/6000 (73%)
Took 3472.028886318207 seconds.
Test set: Average loss: 0.7533, Top-1 Accuracy: 4392/6000 (73.2000%)
Took 3474.32629942894 seconds.
Test set: Average loss: 0.7533, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3474.32629942894 seconds.

----- Layer 4, Node 5, Epoch 5/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.372018
Train set: Average loss: 0.3936
Valid set: Average loss: 0.7553, Accuracy: 4393/6000 (73%)
Took 3490.456238746643 seconds.
Test set: Average loss: 0.7553, Top-1 Accuracy: 4393/6000 (73.2167%)
Took 3492.7615325450897 seconds.
Test set: Average loss: 0.7553, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3492.7615325450897 seconds.

----- Layer 4, Node 5, Epoch 6/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.370607
Train set: Average loss: 0.3928
Valid set: Average loss: 0.7558, Accuracy: 4393/6000 (73%)
Took 3508.8889729976654 seconds.
Test set: Average loss: 0.7558, Top-1 Accuracy: 4393/6000 (73.2167%)
Took 3511.1969130039215 seconds.
Test set: Average loss: 0.7558, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3511.1969130039215 seconds.

----- Layer 4, Node 5, Epoch 7/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.369328
Train set: Average loss: 0.3923
Valid set: Average loss: 0.7584, Accuracy: 4383/6000 (73%)
Took 3527.3526663780212 seconds.
Test set: Average loss: 0.7584, Top-1 Accuracy: 4383/6000 (73.0500%)
Took 3529.6606166362762 seconds.
Test set: Average loss: 0.7584, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3529.6606166362762 seconds.

----- Layer 4, Node 5, Epoch 8/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.368269
Train set: Average loss: 0.3913
Valid set: Average loss: 0.7596, Accuracy: 4381/6000 (73%)
Took 3545.754485607147 seconds.
Test set: Average loss: 0.7596, Top-1 Accuracy: 4381/6000 (73.0167%)
Took 3548.0702772140503 seconds.
Test set: Average loss: 0.7596, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3548.0702772140503 seconds.

----- Layer 4, Node 5, Epoch 9/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.367768
Train set: Average loss: 0.3907
Valid set: Average loss: 0.7588, Accuracy: 4379/6000 (73%)
Took 3564.149837255478 seconds.
Test set: Average loss: 0.7588, Top-1 Accuracy: 4379/6000 (72.9833%)
Took 3566.470584154129 seconds.
Test set: Average loss: 0.7588, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3566.470584154129 seconds.

----- Layer 4, Node 5, Epoch 10/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.365929
Train set: Average loss: 0.3898
Valid set: Average loss: 0.7624, Accuracy: 4381/6000 (73%)
Took 3582.6275844573975 seconds.
Test set: Average loss: 0.7624, Top-1 Accuracy: 4381/6000 (73.0167%)
Took 3584.9589941501617 seconds.
Test set: Average loss: 0.7624, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3584.9589941501617 seconds.

----- Layer 4, Node 5, Epoch 11/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.364141
Train set: Average loss: 0.3889
Valid set: Average loss: 0.7689, Accuracy: 4374/6000 (73%)
Took 3601.0406119823456 seconds.
Test set: Average loss: 0.7689, Top-1 Accuracy: 4374/6000 (72.9000%)
Took 3603.374972820282 seconds.
Test set: Average loss: 0.7689, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3603.374972820282 seconds.

----- Layer 4, Node 5, Epoch 12/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.362881
Train set: Average loss: 0.3879
Valid set: Average loss: 0.7733, Accuracy: 4384/6000 (73%)
Took 3619.462445497513 seconds.
Test set: Average loss: 0.7733, Top-1 Accuracy: 4384/6000 (73.0667%)
Took 3621.801082611084 seconds.
Test set: Average loss: 0.7733, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3621.801082611084 seconds.

----- Layer 4, Node 5, Epoch 13/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.360906
Train set: Average loss: 0.3872
Valid set: Average loss: 0.7770, Accuracy: 4377/6000 (73%)
Took 3637.930388689041 seconds.
Test set: Average loss: 0.7770, Top-1 Accuracy: 4377/6000 (72.9500%)
Took 3640.2826714515686 seconds.
Test set: Average loss: 0.7770, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3640.2826714515686 seconds.

----- Layer 4, Node 5, Epoch 14/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.361543
Train set: Average loss: 0.3862
Valid set: Average loss: 0.7839, Accuracy: 4371/6000 (73%)
Took 3656.3790287971497 seconds.
Test set: Average loss: 0.7839, Top-1 Accuracy: 4371/6000 (72.8500%)
Took 3658.6873219013214 seconds.
Test set: Average loss: 0.7839, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3658.6873219013214 seconds.

----- Layer 4, Node 5, Epoch 15/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.360333
Train set: Average loss: 0.3849
Valid set: Average loss: 0.7785, Accuracy: 4385/6000 (73%)
Took 3674.796156167984 seconds.
Test set: Average loss: 0.7785, Top-1 Accuracy: 4385/6000 (73.0833%)
Took 3677.0935809612274 seconds.
Test set: Average loss: 0.7785, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3677.0935809612274 seconds.

----- Layer 4, Node 5, Epoch 16/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.361258
Train set: Average loss: 0.3839
Valid set: Average loss: 0.7800, Accuracy: 4378/6000 (73%)
Took 3693.23043012619 seconds.
Test set: Average loss: 0.7800, Top-1 Accuracy: 4378/6000 (72.9667%)
Took 3695.5251228809357 seconds.
Test set: Average loss: 0.7800, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3695.5251228809357 seconds.

----- Layer 4, Node 5, Epoch 17/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.358722
Train set: Average loss: 0.3836
Valid set: Average loss: 0.7823, Accuracy: 4378/6000 (73%)
Took 3711.6879642009735 seconds.
Test set: Average loss: 0.7823, Top-1 Accuracy: 4378/6000 (72.9667%)
Took 3713.9842717647552 seconds.
Test set: Average loss: 0.7823, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3713.9842717647552 seconds.

----- Layer 4, Node 5, Epoch 18/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.358274
Train set: Average loss: 0.3829
Valid set: Average loss: 0.7883, Accuracy: 4375/6000 (73%)
Took 3730.1007611751556 seconds.
Test set: Average loss: 0.7883, Top-1 Accuracy: 4375/6000 (72.9167%)
Took 3732.3978514671326 seconds.
Test set: Average loss: 0.7883, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3732.3978514671326 seconds.

----- Layer 4, Node 5, Epoch 19/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.358192
Train set: Average loss: 0.3814
Valid set: Average loss: 0.7906, Accuracy: 4372/6000 (73%)
Took 3748.5253636837006 seconds.
Test set: Average loss: 0.7906, Top-1 Accuracy: 4372/6000 (72.8667%)
Took 3750.829908132553 seconds.
Test set: Average loss: 0.7906, Top-5 Accuracy: 5967.0/6000 (99.4500%)
Took 3750.829908132553 seconds.

----- Layer 4, Node 5, Epoch 20/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.355760
Train set: Average loss: 0.3806
Valid set: Average loss: 0.7849, Accuracy: 4368/6000 (73%)
Took 3766.303073167801 seconds.
Test set: Average loss: 0.7849, Top-1 Accuracy: 4368/6000 (72.8000%)
Took 3768.4805550575256 seconds.
Test set: Average loss: 0.7849, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3768.4805550575256 seconds.

----- Layer 4, Node 5, Epoch 21/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.357646
Train set: Average loss: 0.3805
Valid set: Average loss: 0.7880, Accuracy: 4378/6000 (73%)
Took 3783.7330389022827 seconds.
Test set: Average loss: 0.7880, Top-1 Accuracy: 4378/6000 (72.9667%)
Took 3785.894598007202 seconds.
Test set: Average loss: 0.7880, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3785.894598007202 seconds.
Early stopping by patience!
return the node-wise best split model
returning left and right children

----------- Optimizing an extension --------------
No extension as the transformer is an identity function.
Average valid loss is reduced by 1.7999954223632812

Splitting node 5
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 0.7533, Top-1 Accuracy: 4392/6000 (73.2000%)
Took 3788.1137194633484 seconds.
Test set: Average loss: 0.7533, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 3788.1137194633484 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.659281
Train set: Average loss: 1.0293
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.3574, Accuracy: 19022/30000 (63%)
Took 3816.334508895874 seconds.
Test set: Average loss: 1.0725, Top-1 Accuracy: 3996/6000 (66.6000%)
Took 3818.5568840503693 seconds.
Test set: Average loss: 1.0725, Top-5 Accuracy: 5793.0/6000 (96.5500%)
Took 3818.5568840503693 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.487281
Train set: Average loss: 0.4887
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.5985, Accuracy: 19177/30000 (64%)
Took 3846.6110787391663 seconds.
Test set: Average loss: 1.5377, Top-1 Accuracy: 3824/6000 (63.7333%)
Took 3848.8323097229004 seconds.
Test set: Average loss: 1.5377, Top-5 Accuracy: 5726.0/6000 (95.4333%)
Took 3848.8323097229004 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.372255
Train set: Average loss: 0.3700
Valid set: Average loss: 1.9180, Accuracy: 18689/30000 (62%)
Took 3877.0834090709686 seconds.
Test set: Average loss: 1.5132, Top-1 Accuracy: 3950/6000 (65.8333%)
Took 3879.283889055252 seconds.
Test set: Average loss: 1.5132, Top-5 Accuracy: 5741.0/6000 (95.6833%)
Took 3879.283889055252 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.325315
Train set: Average loss: 0.3262
Valid set: Average loss: 1.9970, Accuracy: 18463/30000 (62%)
Took 3907.415534734726 seconds.
Test set: Average loss: 2.0658, Top-1 Accuracy: 3699/6000 (61.6500%)
Took 3909.6184191703796 seconds.
Test set: Average loss: 2.0658, Top-5 Accuracy: 5574.0/6000 (92.9000%)
Took 3909.6184191703796 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.283254
Train set: Average loss: 0.2981
Valid set: Average loss: 2.3409, Accuracy: 17908/30000 (60%)
Took 3937.703386068344 seconds.
Test set: Average loss: 1.9853, Top-1 Accuracy: 3871/6000 (64.5167%)
Took 3939.896569252014 seconds.
Test set: Average loss: 1.9853, Top-5 Accuracy: 5652.0/6000 (94.2000%)
Took 3939.896569252014 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.256214
Train set: Average loss: 0.2588
Valid set: Average loss: 2.6118, Accuracy: 17229/30000 (57%)
Took 3968.4143846035004 seconds.
Test set: Average loss: 1.9861, Top-1 Accuracy: 3784/6000 (63.0667%)
Took 3970.6468794345856 seconds.
Test set: Average loss: 1.9861, Top-5 Accuracy: 5657.0/6000 (94.2833%)
Took 3970.6468794345856 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.255122
Train set: Average loss: 0.2342
Valid set: Average loss: 2.1449, Accuracy: 18220/30000 (61%)
Took 3999.1912002563477 seconds.
Test set: Average loss: 1.8093, Top-1 Accuracy: 3973/6000 (66.2167%)
Took 4001.459770679474 seconds.
Test set: Average loss: 1.8093, Top-5 Accuracy: 5654.0/6000 (94.2333%)
Took 4001.459770679474 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.197426
Train set: Average loss: 0.2027
Valid set: Average loss: 3.2322, Accuracy: 16663/30000 (56%)
Took 4030.3988082408905 seconds.
Test set: Average loss: 2.1110, Top-1 Accuracy: 4016/6000 (66.9333%)
Took 4032.5897629261017 seconds.
Test set: Average loss: 2.1110, Top-5 Accuracy: 5729.0/6000 (95.4833%)
Took 4032.5897629261017 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.152098
Train set: Average loss: 0.1751
Valid set: Average loss: 2.7585, Accuracy: 18568/30000 (62%)
Took 4061.1584088802338 seconds.
Test set: Average loss: 2.2615, Top-1 Accuracy: 4038/6000 (67.3000%)
Took 4063.3919744491577 seconds.
Test set: Average loss: 2.2615, Top-5 Accuracy: 5723.0/6000 (95.3833%)
Took 4063.3919744491577 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.148796
Train set: Average loss: 0.1645
Valid set: Average loss: 2.6381, Accuracy: 18701/30000 (62%)
Took 4091.867559671402 seconds.
Test set: Average loss: 2.3749, Top-1 Accuracy: 3927/6000 (65.4500%)
Took 4094.098748445511 seconds.
Test set: Average loss: 2.3749, Top-5 Accuracy: 5468.0/6000 (91.1333%)
Took 4094.098748445511 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.134085
Train set: Average loss: 0.1474
Valid set: Average loss: 3.0022, Accuracy: 17461/30000 (58%)
Took 4122.6912541389465 seconds.
Test set: Average loss: 1.9631, Top-1 Accuracy: 4063/6000 (67.7167%)
Took 4124.922690153122 seconds.
Test set: Average loss: 1.9631, Top-5 Accuracy: 5626.0/6000 (93.7667%)
Took 4124.922690153122 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.129056
Train set: Average loss: 0.1278
Valid set: Average loss: 3.0166, Accuracy: 17654/30000 (59%)
Took 4153.450698375702 seconds.
Test set: Average loss: 2.4939, Top-1 Accuracy: 3910/6000 (65.1667%)
Took 4155.710996866226 seconds.
Test set: Average loss: 2.4939, Top-5 Accuracy: 5394.0/6000 (89.9000%)
Took 4155.710996866226 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.115352
Train set: Average loss: 0.1202
Valid set: Average loss: 3.2005, Accuracy: 17556/30000 (59%)
Took 4184.368144750595 seconds.
Test set: Average loss: 2.3695, Top-1 Accuracy: 3937/6000 (65.6167%)
Took 4186.60107755661 seconds.
Test set: Average loss: 2.3695, Top-5 Accuracy: 5508.0/6000 (91.8000%)
Took 4186.60107755661 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.114484
Train set: Average loss: 0.1233
Valid set: Average loss: 2.8489, Accuracy: 18107/30000 (60%)
Took 4215.696843624115 seconds.
Test set: Average loss: 1.9204, Top-1 Accuracy: 4076/6000 (67.9333%)
Took 4217.97301697731 seconds.
Test set: Average loss: 1.9204, Top-5 Accuracy: 5695.0/6000 (94.9167%)
Took 4217.97301697731 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.097709
Train set: Average loss: 0.1061
Valid set: Average loss: 3.7258, Accuracy: 16208/30000 (54%)
Took 4247.007678031921 seconds.
Test set: Average loss: 3.1813, Top-1 Accuracy: 3554/6000 (59.2333%)
Took 4249.31690454483 seconds.
Test set: Average loss: 3.1813, Top-5 Accuracy: 5526.0/6000 (92.1000%)
Took 4249.31690454483 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.084978
Train set: Average loss: 0.1049
Valid set: Average loss: 2.9776, Accuracy: 17782/30000 (59%)
Took 4278.3885016441345 seconds.
Test set: Average loss: 2.5263, Top-1 Accuracy: 3906/6000 (65.1000%)
Took 4280.659854888916 seconds.
Test set: Average loss: 2.5263, Top-5 Accuracy: 5636.0/6000 (93.9333%)
Took 4280.659854888916 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.082736
Train set: Average loss: 0.0813
Valid set: Average loss: 2.8800, Accuracy: 18400/30000 (61%)
Took 4309.7581782341 seconds.
Test set: Average loss: 2.7133, Top-1 Accuracy: 3758/6000 (62.6333%)
Took 4312.0335602760315 seconds.
Test set: Average loss: 2.7133, Top-5 Accuracy: 5566.0/6000 (92.7667%)
Took 4312.0335602760315 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.072844
Train set: Average loss: 0.0809
Valid set: Average loss: 2.9420, Accuracy: 18092/30000 (60%)
Took 4341.07413482666 seconds.
Test set: Average loss: 2.8283, Top-1 Accuracy: 3773/6000 (62.8833%)
Took 4343.368674993515 seconds.
Test set: Average loss: 2.8283, Top-5 Accuracy: 5511.0/6000 (91.8500%)
Took 4343.368674993515 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.048027
Train set: Average loss: 0.0633
Valid set: Average loss: 2.9461, Accuracy: 18420/30000 (61%)
Took 4372.981590270996 seconds.
Test set: Average loss: 2.7728, Top-1 Accuracy: 3849/6000 (64.1500%)
Took 4375.289848327637 seconds.
Test set: Average loss: 2.7728, Top-5 Accuracy: 5505.0/6000 (91.7500%)
Took 4375.289848327637 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.067721
Train set: Average loss: 0.0623
Valid set: Average loss: 2.8213, Accuracy: 18266/30000 (61%)
Took 4404.789375305176 seconds.
Test set: Average loss: 2.4713, Top-1 Accuracy: 3921/6000 (65.3500%)
Took 4407.09686589241 seconds.
Test set: Average loss: 2.4713, Top-5 Accuracy: 5585.0/6000 (93.0833%)
Took 4407.09686589241 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.064997
Train set: Average loss: 0.0722
Valid set: Average loss: 2.7307, Accuracy: 18429/30000 (61%)
Took 4436.6203191280365 seconds.
Test set: Average loss: 2.2521, Top-1 Accuracy: 4004/6000 (66.7333%)
Took 4438.961057186127 seconds.
Test set: Average loss: 2.2521, Top-5 Accuracy: 5661.0/6000 (94.3500%)
Took 4438.961057186127 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.071591
Train set: Average loss: 0.0673
Valid set: Average loss: 3.3373, Accuracy: 17796/30000 (59%)
Took 4468.43025970459 seconds.
Test set: Average loss: 2.8071, Top-1 Accuracy: 3843/6000 (64.0500%)
Took 4470.734613656998 seconds.
Test set: Average loss: 2.8071, Top-5 Accuracy: 5627.0/6000 (93.7833%)
Took 4470.734613656998 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.071556
Train set: Average loss: 0.0601
Valid set: Average loss: 2.7751, Accuracy: 18759/30000 (63%)
Took 4500.278954744339 seconds.
Test set: Average loss: 2.5975, Top-1 Accuracy: 3867/6000 (64.4500%)
Took 4502.583232164383 seconds.
Test set: Average loss: 2.5975, Top-5 Accuracy: 5475.0/6000 (91.2500%)
Took 4502.583232164383 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.059307
Train set: Average loss: 0.0660
Valid set: Average loss: 3.1554, Accuracy: 18147/30000 (60%)
Took 4532.081043720245 seconds.
Test set: Average loss: 2.7791, Top-1 Accuracy: 3718/6000 (61.9667%)
Took 4534.436611413956 seconds.
Test set: Average loss: 2.7791, Top-5 Accuracy: 5583.0/6000 (93.0500%)
Took 4534.436611413956 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.060815
Train set: Average loss: 0.0638
Valid set: Average loss: 3.6384, Accuracy: 16654/30000 (56%)
Took 4563.934380531311 seconds.
Test set: Average loss: 3.2063, Top-1 Accuracy: 3508/6000 (58.4667%)
Took 4566.245965719223 seconds.
Test set: Average loss: 3.2063, Top-5 Accuracy: 5450.0/6000 (90.8333%)
Took 4566.245965719223 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.5377, Top-1 Accuracy: 3824/6000 (63.7333%)
Took 4568.604419469833 seconds.
Test set: Average loss: 1.5377, Top-5 Accuracy: 5726.0/6000 (95.4333%)
Took 4568.604419469833 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 1.4238, Top-1 Accuracy: 4008/6000 (66.8000%)
Took 4569.515119791031 seconds.
Test set: Average loss: 1.4238, Top-5 Accuracy: 5578.0/6000 (92.9667%)
Took 4569.515119791031 seconds.
Test set: Average loss: 1.1002, Top-1 Accuracy: 4650/6000 (77.5000%)
Took 4570.586143493652 seconds.
Test set: Average loss: 1.1002, Top-5 Accuracy: 5737.0/6000 (95.6167%)
Took 4570.586143493652 seconds.
Test set: Average loss: 2.2646, Top-1 Accuracy: 3335/6000 (55.5833%)
Took 4572.087054014206 seconds.
Test set: Average loss: 2.2646, Top-5 Accuracy: 5370.0/6000 (89.5000%)
Took 4572.087054014206 seconds.
Test set: Average loss: 0.8615, Top-1 Accuracy: 4869/6000 (81.1500%)
Took 4574.215742111206 seconds.
Test set: Average loss: 0.8615, Top-5 Accuracy: 5909.0/6000 (98.4833%)
Took 4574.215742111206 seconds.
Test set: Average loss: 1.5377, Top-1 Accuracy: 3824/6000 (63.7333%)
Took 4576.527058601379 seconds.
Test set: Average loss: 1.5377, Top-5 Accuracy: 5726.0/6000 (95.4333%)
Took 4576.527058601379 seconds.

Average Top-1 accuracy: tensor(68.9533)

----- Top1 acc: [83.66666412353516, 82.88333129882812, 75.26667022705078, 71.54583740234375, 68.95333099365234]
----- Top5 acc: [99.71666717529297, 99.16667175292969, 97.20555114746094, 94.10416412353516, 94.4000015258789]
============== Continual learning on task 5 =================

[before adaption and growth]
Test set: Average loss: 1.8820, Top-1 Accuracy: 3639/6000 (60.6500%)
Took 4577.957423448563 seconds.
Test set: Average loss: 1.8820, Top-5 Accuracy: 5257.0/6000 (87.6167%)
Took 4577.957423448563 seconds.
old_data shape: torch.Size([30000, 3072])
new_data_1 shape: torch.Size([30000, 3072])
MMD loss:tensor(0.0213, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.1153, 0.8708, 0.0072, 0.0067], device='cuda:0')
[7, 6, 8, 9]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 1.8820, Top-1 Accuracy: 3639/6000 (60.6500%)
Took 4595.589648008347 seconds.
Test set: Average loss: 1.8820, Top-5 Accuracy: 5257.0/6000 (87.6167%)
Took 4595.589648008347 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.710346
Train set: Average loss: 0.9254
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.5669, Accuracy: 22577/36000 (63%)
Took 4621.1263263225555 seconds.
Test set: Average loss: 0.8388, Top-1 Accuracy: 4686/6000 (78.1000%)
Took 4622.384357452393 seconds.
Test set: Average loss: 0.8388, Top-5 Accuracy: 5822.0/6000 (97.0333%)
Took 4622.384357452393 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.492525
Train set: Average loss: 0.5149
Valid set: Average loss: 1.7369, Accuracy: 22312/36000 (62%)
Took 4647.983927965164 seconds.
Test set: Average loss: 0.9686, Top-1 Accuracy: 4535/6000 (75.5833%)
Took 4649.276518344879 seconds.
Test set: Average loss: 0.9686, Top-5 Accuracy: 5814.0/6000 (96.9000%)
Took 4649.276518344879 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.369316
Train set: Average loss: 0.3764
Valid set: Average loss: 2.1753, Accuracy: 21356/36000 (59%)
Took 4674.81788277626 seconds.
Test set: Average loss: 1.2089, Top-1 Accuracy: 4470/6000 (74.5000%)
Took 4676.073170185089 seconds.
Test set: Average loss: 1.2089, Top-5 Accuracy: 5739.0/6000 (95.6500%)
Took 4676.073170185089 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.306550
Train set: Average loss: 0.3124
Valid set: Average loss: 2.2024, Accuracy: 21461/36000 (60%)
Took 4701.565312862396 seconds.
Test set: Average loss: 1.3457, Top-1 Accuracy: 4364/6000 (72.7333%)
Took 4702.822516202927 seconds.
Test set: Average loss: 1.3457, Top-5 Accuracy: 5728.0/6000 (95.4667%)
Took 4702.822516202927 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.319402
Train set: Average loss: 0.2726
Valid set: Average loss: 2.1322, Accuracy: 21997/36000 (61%)
Took 4728.439303636551 seconds.
Test set: Average loss: 1.6090, Top-1 Accuracy: 4291/6000 (71.5167%)
Took 4729.695115804672 seconds.
Test set: Average loss: 1.6090, Top-5 Accuracy: 5633.0/6000 (93.8833%)
Took 4729.695115804672 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.228036
Train set: Average loss: 0.2390
Valid set: Average loss: 2.4303, Accuracy: 21063/36000 (59%)
Took 4755.196496009827 seconds.
Test set: Average loss: 1.6291, Top-1 Accuracy: 4339/6000 (72.3167%)
Took 4756.4518032073975 seconds.
Test set: Average loss: 1.6291, Top-5 Accuracy: 5574.0/6000 (92.9000%)
Took 4756.4518032073975 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.234325
Train set: Average loss: 0.2171
Valid set: Average loss: 2.2948, Accuracy: 22325/36000 (62%)
Took 4782.0270891189575 seconds.
Test set: Average loss: 1.3697, Top-1 Accuracy: 4613/6000 (76.8833%)
Took 4783.319654226303 seconds.
Test set: Average loss: 1.3697, Top-5 Accuracy: 5704.0/6000 (95.0667%)
Took 4783.319654226303 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.210041
Train set: Average loss: 0.2059
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.1349, Accuracy: 23373/36000 (65%)
Took 4808.601197957993 seconds.
Test set: Average loss: 1.3180, Top-1 Accuracy: 4672/6000 (77.8667%)
Took 4809.839642524719 seconds.
Test set: Average loss: 1.3180, Top-5 Accuracy: 5698.0/6000 (94.9667%)
Took 4809.839642524719 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.208607
Train set: Average loss: 0.1894
Valid set: Average loss: 2.4717, Accuracy: 21860/36000 (61%)
Took 4834.994432926178 seconds.
Test set: Average loss: 1.3920, Top-1 Accuracy: 4576/6000 (76.2667%)
Took 4836.239755630493 seconds.
Test set: Average loss: 1.3920, Top-5 Accuracy: 5777.0/6000 (96.2833%)
Took 4836.239755630493 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.150778
Train set: Average loss: 0.1488
Valid set: Average loss: 2.9563, Accuracy: 21709/36000 (60%)
Took 4861.876403093338 seconds.
Test set: Average loss: 1.5323, Top-1 Accuracy: 4612/6000 (76.8667%)
Took 4863.133625030518 seconds.
Test set: Average loss: 1.5323, Top-5 Accuracy: 5805.0/6000 (96.7500%)
Took 4863.133625030518 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.112419
Train set: Average loss: 0.1342
Valid set: Average loss: 2.6982, Accuracy: 22410/36000 (62%)
Took 4887.992746353149 seconds.
Test set: Average loss: 1.7822, Top-1 Accuracy: 4496/6000 (74.9333%)
Took 4889.18908405304 seconds.
Test set: Average loss: 1.7822, Top-5 Accuracy: 5712.0/6000 (95.2000%)
Took 4889.18908405304 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.110695
Train set: Average loss: 0.1172
Valid set: Average loss: 3.0119, Accuracy: 21510/36000 (60%)
Took 4913.680477142334 seconds.
Test set: Average loss: 2.0646, Top-1 Accuracy: 4283/6000 (71.3833%)
Took 4914.911485671997 seconds.
Test set: Average loss: 2.0646, Top-5 Accuracy: 5626.0/6000 (93.7667%)
Took 4914.911485671997 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.111168
Train set: Average loss: 0.1043
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.2766, Accuracy: 23435/36000 (65%)
Took 4939.226984500885 seconds.
Test set: Average loss: 1.6833, Top-1 Accuracy: 4489/6000 (74.8167%)
Took 4940.422760009766 seconds.
Test set: Average loss: 1.6833, Top-5 Accuracy: 5749.0/6000 (95.8167%)
Took 4940.422760009766 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.093882
Train set: Average loss: 0.0930
Valid set: Average loss: 2.4331, Accuracy: 23134/36000 (64%)
Took 4964.773917913437 seconds.
Test set: Average loss: 1.5384, Top-1 Accuracy: 4592/6000 (76.5333%)
Took 4965.965987205505 seconds.
Test set: Average loss: 1.5384, Top-5 Accuracy: 5726.0/6000 (95.4333%)
Took 4965.965987205505 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.113694
Train set: Average loss: 0.0999
Valid set: Average loss: 2.5239, Accuracy: 22302/36000 (62%)
Took 4990.372404098511 seconds.
Test set: Average loss: 1.7800, Top-1 Accuracy: 4350/6000 (72.5000%)
Took 4991.572729349136 seconds.
Test set: Average loss: 1.7800, Top-5 Accuracy: 5693.0/6000 (94.8833%)
Took 4991.572729349136 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.074836
Train set: Average loss: 0.0832
Valid set: Average loss: 2.5064, Accuracy: 22964/36000 (64%)
Took 5015.903969526291 seconds.
Test set: Average loss: 1.5439, Top-1 Accuracy: 4626/6000 (77.1000%)
Took 5017.1010892391205 seconds.
Test set: Average loss: 1.5439, Top-5 Accuracy: 5749.0/6000 (95.8167%)
Took 5017.1010892391205 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.079204
Train set: Average loss: 0.0789
Valid set: Average loss: 2.5213, Accuracy: 23018/36000 (64%)
Took 5041.447041749954 seconds.
Test set: Average loss: 1.7217, Top-1 Accuracy: 4496/6000 (74.9333%)
Took 5042.636379241943 seconds.
Test set: Average loss: 1.7217, Top-5 Accuracy: 5686.0/6000 (94.7667%)
Took 5042.636379241943 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.067506
Train set: Average loss: 0.0713
Valid set: Average loss: 3.0182, Accuracy: 22135/36000 (61%)
Took 5068.069050073624 seconds.
Test set: Average loss: 1.7977, Top-1 Accuracy: 4552/6000 (75.8667%)
Took 5069.325411081314 seconds.
Test set: Average loss: 1.7977, Top-5 Accuracy: 5758.0/6000 (95.9667%)
Took 5069.325411081314 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.063994
Train set: Average loss: 0.0720
Valid set: Average loss: 2.9100, Accuracy: 22321/36000 (62%)
Took 5094.8905465602875 seconds.
Test set: Average loss: 1.8333, Top-1 Accuracy: 4476/6000 (74.6000%)
Took 5096.147590875626 seconds.
Test set: Average loss: 1.8333, Top-5 Accuracy: 5756.0/6000 (95.9333%)
Took 5096.147590875626 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.073916
Train set: Average loss: 0.0740
Valid set: Average loss: 3.3659, Accuracy: 21556/36000 (60%)
Took 5121.715905427933 seconds.
Test set: Average loss: 1.7996, Top-1 Accuracy: 4495/6000 (74.9167%)
Took 5122.991237640381 seconds.
Test set: Average loss: 1.7996, Top-5 Accuracy: 5790.0/6000 (96.5000%)
Took 5122.991237640381 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.074921
Train set: Average loss: 0.0729
Valid set: Average loss: 2.9897, Accuracy: 21516/36000 (60%)
Took 5148.472526311874 seconds.
Test set: Average loss: 1.7340, Top-1 Accuracy: 4542/6000 (75.7000%)
Took 5149.730975151062 seconds.
Test set: Average loss: 1.7340, Top-5 Accuracy: 5733.0/6000 (95.5500%)
Took 5149.730975151062 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.072424
Train set: Average loss: 0.0779
Valid set: Average loss: 2.6194, Accuracy: 23043/36000 (64%)
Took 5175.220665216446 seconds.
Test set: Average loss: 1.5849, Top-1 Accuracy: 4685/6000 (78.0833%)
Took 5176.475049734116 seconds.
Test set: Average loss: 1.5849, Top-5 Accuracy: 5763.0/6000 (96.0500%)
Took 5176.475049734116 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.078598
Train set: Average loss: 0.0681
Valid set: Average loss: 2.6177, Accuracy: 23144/36000 (64%)
Took 5201.998334169388 seconds.
Test set: Average loss: 1.7905, Top-1 Accuracy: 4514/6000 (75.2333%)
Took 5203.253543376923 seconds.
Test set: Average loss: 1.7905, Top-5 Accuracy: 5719.0/6000 (95.3167%)
Took 5203.253543376923 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.061550
Train set: Average loss: 0.0568
Valid set: Average loss: 2.6336, Accuracy: 22516/36000 (63%)
Took 5228.575757265091 seconds.
Test set: Average loss: 1.7136, Top-1 Accuracy: 4491/6000 (74.8500%)
Took 5229.812882423401 seconds.
Test set: Average loss: 1.7136, Top-5 Accuracy: 5698.0/6000 (94.9667%)
Took 5229.812882423401 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.057023
Train set: Average loss: 0.0616
Valid set: Average loss: 2.8622, Accuracy: 22359/36000 (62%)
Took 5254.978869199753 seconds.
Test set: Average loss: 1.7760, Top-1 Accuracy: 4520/6000 (75.3333%)
Took 5256.233012676239 seconds.
Test set: Average loss: 1.7760, Top-5 Accuracy: 5619.0/6000 (93.6500%)
Took 5256.233012676239 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.010284
Train set: Average loss: 0.0276
Valid set: Average loss: 2.7195, Accuracy: 23167/36000 (64%)
Took 5281.364370346069 seconds.
Test set: Average loss: 1.3970, Top-1 Accuracy: 4809/6000 (80.1500%)
Took 5282.601048231125 seconds.
Test set: Average loss: 1.3970, Top-5 Accuracy: 5787.0/6000 (96.4500%)
Took 5282.601048231125 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.001571
Train set: Average loss: 0.0034
Valid set: Average loss: 2.8987, Accuracy: 23235/36000 (65%)
Took 5307.72146821022 seconds.
Test set: Average loss: 1.5028, Top-1 Accuracy: 4828/6000 (80.4667%)
Took 5308.95849609375 seconds.
Test set: Average loss: 1.5028, Top-5 Accuracy: 5785.0/6000 (96.4167%)
Took 5308.95849609375 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.6833, Top-1 Accuracy: 4489/6000 (74.8167%)
Took 5310.242526769638 seconds.
Test set: Average loss: 1.6833, Top-5 Accuracy: 5749.0/6000 (95.8167%)
Took 5310.242526769638 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 1.9621, Top-1 Accuracy: 4048/6000 (67.4667%)
Took 5311.142030954361 seconds.
Test set: Average loss: 1.9621, Top-5 Accuracy: 5511.0/6000 (91.8500%)
Took 5311.142030954361 seconds.
Test set: Average loss: 1.5829, Top-1 Accuracy: 4589/6000 (76.4833%)
Took 5312.198874950409 seconds.
Test set: Average loss: 1.5829, Top-5 Accuracy: 5591.0/6000 (93.1833%)
Took 5312.198874950409 seconds.
Test set: Average loss: 3.3733, Top-1 Accuracy: 3056/6000 (50.9333%)
Took 5313.681063652039 seconds.
Test set: Average loss: 3.3733, Top-5 Accuracy: 4889.0/6000 (81.4833%)
Took 5313.681063652039 seconds.
Test set: Average loss: 2.0080, Top-1 Accuracy: 4222/6000 (70.3667%)
Took 5315.769711732864 seconds.
Test set: Average loss: 2.0080, Top-5 Accuracy: 5565.0/6000 (92.7500%)
Took 5315.769711732864 seconds.
Test set: Average loss: 3.0547, Top-1 Accuracy: 3444/6000 (57.4000%)
Took 5318.059956550598 seconds.
Test set: Average loss: 3.0547, Top-5 Accuracy: 5348.0/6000 (89.1333%)
Took 5318.059956550598 seconds.
Test set: Average loss: 1.6833, Top-1 Accuracy: 4489/6000 (74.8167%)
Took 5319.295955657959 seconds.
Test set: Average loss: 1.6833, Top-5 Accuracy: 5749.0/6000 (95.8167%)
Took 5319.295955657959 seconds.

Average Top-1 accuracy: tensor(66.2444)

----- Top1 acc: [83.66666412353516, 82.88333129882812, 75.26667022705078, 71.54583740234375, 68.95333099365234, 66.24444580078125]
----- Top5 acc: [99.71666717529297, 99.16667175292969, 97.20555114746094, 94.10416412353516, 94.4000015258789, 90.7027816772461]
============== Continual learning on task 6 =================

[before adaption and growth]
Test set: Average loss: 4.8365, Top-1 Accuracy: 2326/6000 (38.7667%)
Took 5320.490153551102 seconds.
Test set: Average loss: 4.8365, Top-5 Accuracy: 4514.0/6000 (75.2333%)
Took 5320.490153551102 seconds.
old_data shape: torch.Size([25000, 3072])
new_data_1 shape: torch.Size([25000, 3072])
MMD loss:tensor(0.6366, device='cuda:0')

 ------------ start adaptation .............
--------- Task 6, DA Epoch 1/15 ---------
              [23040/30000 (0%)]      Loss: 9.302107
Train set: Average loss: 6.5507
Test set: Average loss: 7.9328, Top-1 Accuracy: 1722/6000 (28.7000%)
Took 5344.387096166611 seconds.
Test set: Average loss: 7.9328, Top-5 Accuracy: 4156.0/6000 (69.2667%)
Took 5344.387096166611 seconds.
--------- Task 6, DA Epoch 2/15 ---------
              [23040/30000 (0%)]      Loss: 9.168629
Train set: Average loss: 6.4605
Test set: Average loss: 7.9407, Top-1 Accuracy: 1703/6000 (28.3833%)
Took 5357.64378619194 seconds.
Test set: Average loss: 7.9407, Top-5 Accuracy: 4149.0/6000 (69.1500%)
Took 5357.64378619194 seconds.
--------- Task 6, DA Epoch 3/15 ---------
              [23040/30000 (0%)]      Loss: 9.041427
Train set: Average loss: 6.3733
Test set: Average loss: 7.9521, Top-1 Accuracy: 1677/6000 (27.9500%)
Took 5370.9160969257355 seconds.
Test set: Average loss: 7.9521, Top-5 Accuracy: 4135.0/6000 (68.9167%)
Took 5370.9160969257355 seconds.
--------- Task 6, DA Epoch 4/15 ---------
              [23040/30000 (0%)]      Loss: 8.903232
Train set: Average loss: 6.2864
Test set: Average loss: 7.9561, Top-1 Accuracy: 1654/6000 (27.5667%)
Took 5384.332706212997 seconds.
Test set: Average loss: 7.9561, Top-5 Accuracy: 4123.0/6000 (68.7167%)
Took 5384.332706212997 seconds.
--------- Task 6, DA Epoch 5/15 ---------
              [23040/30000 (0%)]      Loss: 8.777541
Train set: Average loss: 6.2022
Test set: Average loss: 7.9638, Top-1 Accuracy: 1637/6000 (27.2833%)
Took 5397.775379180908 seconds.
Test set: Average loss: 7.9638, Top-5 Accuracy: 4117.0/6000 (68.6167%)
Took 5397.775379180908 seconds.
--------- Task 6, DA Epoch 6/15 ---------
              [23040/30000 (0%)]      Loss: 8.654717
Train set: Average loss: 6.1205
Test set: Average loss: 7.9795, Top-1 Accuracy: 1619/6000 (26.9833%)
Took 5411.228849411011 seconds.
Test set: Average loss: 7.9795, Top-5 Accuracy: 4116.0/6000 (68.6000%)
Took 5411.228849411011 seconds.
--------- Task 6, DA Epoch 7/15 ---------
              [23040/30000 (0%)]      Loss: 8.542211
Train set: Average loss: 6.0374
Test set: Average loss: 7.9933, Top-1 Accuracy: 1609/6000 (26.8167%)
Took 5424.604759693146 seconds.
Test set: Average loss: 7.9933, Top-5 Accuracy: 4128.0/6000 (68.8000%)
Took 5424.604759693146 seconds.
--------- Task 6, DA Epoch 8/15 ---------
              [23040/30000 (0%)]      Loss: 8.420434
Train set: Average loss: 5.9529
Test set: Average loss: 8.0142, Top-1 Accuracy: 1597/6000 (26.6167%)
Took 5438.056991100311 seconds.
Test set: Average loss: 8.0142, Top-5 Accuracy: 4127.0/6000 (68.7833%)
Took 5438.056991100311 seconds.
--------- Task 6, DA Epoch 9/15 ---------
              [23040/30000 (0%)]      Loss: 8.290802
Train set: Average loss: 5.8667
Test set: Average loss: 8.0439, Top-1 Accuracy: 1570/6000 (26.1667%)
Took 5451.506494045258 seconds.
Test set: Average loss: 8.0439, Top-5 Accuracy: 4104.0/6000 (68.4000%)
Took 5451.506494045258 seconds.
--------- Task 6, DA Epoch 10/15 ---------
              [23040/30000 (0%)]      Loss: 8.176992
Train set: Average loss: 5.7820
Test set: Average loss: 8.0763, Top-1 Accuracy: 1551/6000 (25.8500%)
Took 5464.940317392349 seconds.
Test set: Average loss: 8.0763, Top-5 Accuracy: 4086.0/6000 (68.1000%)
Took 5464.940317392349 seconds.
--------- Task 6, DA Epoch 11/15 ---------
              [23040/30000 (0%)]      Loss: 8.054370
Train set: Average loss: 5.6936
Test set: Average loss: 8.1100, Top-1 Accuracy: 1535/6000 (25.5833%)
Took 5478.349299430847 seconds.
Test set: Average loss: 8.1100, Top-5 Accuracy: 4072.0/6000 (67.8667%)
Took 5478.349299430847 seconds.
--------- Task 6, DA Epoch 12/15 ---------
              [23040/30000 (0%)]      Loss: 7.919432
Train set: Average loss: 5.6040
Test set: Average loss: 8.1534, Top-1 Accuracy: 1513/6000 (25.2167%)
Took 5491.807242870331 seconds.
Test set: Average loss: 8.1534, Top-5 Accuracy: 4055.0/6000 (67.5833%)
Took 5491.807242870331 seconds.
--------- Task 6, DA Epoch 13/15 ---------
              [23040/30000 (0%)]      Loss: 7.800709
Train set: Average loss: 5.5134
Test set: Average loss: 8.2029, Top-1 Accuracy: 1481/6000 (24.6833%)
Took 5505.280589342117 seconds.
Test set: Average loss: 8.2029, Top-5 Accuracy: 4045.0/6000 (67.4167%)
Took 5505.280589342117 seconds.
--------- Task 6, DA Epoch 14/15 ---------
              [23040/30000 (0%)]      Loss: 7.673936
Train set: Average loss: 5.4219
Test set: Average loss: 8.2532, Top-1 Accuracy: 1455/6000 (24.2500%)
Took 5518.644238233566 seconds.
Test set: Average loss: 8.2532, Top-5 Accuracy: 4054.0/6000 (67.5667%)
Took 5518.644238233566 seconds.
--------- Task 6, DA Epoch 15/15 ---------
              [23040/30000 (0%)]      Loss: 7.541412
Train set: Average loss: 5.3283
Test set: Average loss: 8.2964, Top-1 Accuracy: 1445/6000 (24.0833%)
Took 5532.079305410385 seconds.
Test set: Average loss: 8.2964, Top-5 Accuracy: 4058.0/6000 (67.6333%)
Took 5532.079305410385 seconds.
[after adaption and growth]
Test set: Average loss: 4.8365, Top-1 Accuracy: 2326/6000 (38.7667%)
Took 5533.1588180065155 seconds.
Test set: Average loss: 4.8365, Top-5 Accuracy: 4514.0/6000 (75.2333%)
Took 5533.1588180065155 seconds.
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.6408, 0.1989, 0.0205, 0.1398], device='cuda:0')
[6, 7, 9, 8]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 4.8365, Top-1 Accuracy: 2326/6000 (38.7667%)
Took 5536.29772233963 seconds.
Test set: Average loss: 4.8365, Top-5 Accuracy: 4514.0/6000 (75.2333%)
Took 5536.29772233963 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.602336
Train set: Average loss: 0.9553
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7557, Accuracy: 25199/42000 (60%)
Took 5561.617950439453 seconds.
Test set: Average loss: 1.3701, Top-1 Accuracy: 3853/6000 (64.2167%)
Took 5562.689437389374 seconds.
Test set: Average loss: 1.3701, Top-5 Accuracy: 5803.0/6000 (96.7167%)
Took 5562.689437389374 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.405336
Train set: Average loss: 0.4638
Valid set: Average loss: 1.9288, Accuracy: 25197/42000 (60%)
Took 5588.197539329529 seconds.
Test set: Average loss: 1.2856, Top-1 Accuracy: 4079/6000 (67.9833%)
Took 5589.263827323914 seconds.
Test set: Average loss: 1.2856, Top-5 Accuracy: 5844.0/6000 (97.4000%)
Took 5589.263827323914 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.336175
Train set: Average loss: 0.3742
Valid set: Average loss: 2.1060, Accuracy: 24903/42000 (59%)
Took 5614.819409608841 seconds.
Test set: Average loss: 1.4119, Top-1 Accuracy: 4095/6000 (68.2500%)
Took 5615.8957896232605 seconds.
Test set: Average loss: 1.4119, Top-5 Accuracy: 5793.0/6000 (96.5500%)
Took 5615.8957896232605 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.275604
Train set: Average loss: 0.2977
Valid set: Average loss: 2.2356, Accuracy: 24967/42000 (59%)
Took 5641.475551605225 seconds.
Test set: Average loss: 1.3627, Top-1 Accuracy: 4159/6000 (69.3167%)
Took 5642.538811683655 seconds.
Test set: Average loss: 1.3627, Top-5 Accuracy: 5787.0/6000 (96.4500%)
Took 5642.538811683655 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.258978
Train set: Average loss: 0.2696
Valid set: Average loss: 2.3247, Accuracy: 24867/42000 (59%)
Took 5668.050549983978 seconds.
Test set: Average loss: 1.9682, Top-1 Accuracy: 3861/6000 (64.3500%)
Took 5669.113266468048 seconds.
Test set: Average loss: 1.9682, Top-5 Accuracy: 5706.0/6000 (95.1000%)
Took 5669.113266468048 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.209880
Train set: Average loss: 0.2293
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.1834, Accuracy: 25693/42000 (61%)
Took 5694.703901767731 seconds.
Test set: Average loss: 1.6069, Top-1 Accuracy: 4088/6000 (68.1333%)
Took 5695.7729387283325 seconds.
Test set: Average loss: 1.6069, Top-5 Accuracy: 5718.0/6000 (95.3000%)
Took 5695.7729387283325 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.179762
Train set: Average loss: 0.2085
Valid set: Average loss: 2.2289, Accuracy: 25254/42000 (60%)
Took 5721.313915729523 seconds.
Test set: Average loss: 1.6527, Top-1 Accuracy: 4071/6000 (67.8500%)
Took 5722.377366304398 seconds.
Test set: Average loss: 1.6527, Top-5 Accuracy: 5707.0/6000 (95.1167%)
Took 5722.377366304398 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.173535
Train set: Average loss: 0.1848
Valid set: Average loss: 2.4529, Accuracy: 24600/42000 (59%)
Took 5747.962514162064 seconds.
Test set: Average loss: 1.7776, Top-1 Accuracy: 4007/6000 (66.7833%)
Took 5749.043362379074 seconds.
Test set: Average loss: 1.7776, Top-5 Accuracy: 5743.0/6000 (95.7167%)
Took 5749.043362379074 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.135814
Train set: Average loss: 0.1653
Valid set: Average loss: 3.0640, Accuracy: 22969/42000 (55%)
Took 5774.658307790756 seconds.
Test set: Average loss: 2.2559, Top-1 Accuracy: 3912/6000 (65.2000%)
Took 5775.72255563736 seconds.
Test set: Average loss: 2.2559, Top-5 Accuracy: 5700.0/6000 (95.0000%)
Took 5775.72255563736 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.148396
Train set: Average loss: 0.1512
Valid set: Average loss: 2.8414, Accuracy: 23257/42000 (55%)
Took 5801.309614419937 seconds.
Test set: Average loss: 2.1616, Top-1 Accuracy: 3823/6000 (63.7167%)
Took 5802.371489524841 seconds.
Test set: Average loss: 2.1616, Top-5 Accuracy: 5668.0/6000 (94.4667%)
Took 5802.371489524841 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.113943
Train set: Average loss: 0.1400
Valid set: Average loss: 2.9134, Accuracy: 23574/42000 (56%)
Took 5827.995173931122 seconds.
Test set: Average loss: 1.9269, Top-1 Accuracy: 4086/6000 (68.1000%)
Took 5829.055901527405 seconds.
Test set: Average loss: 1.9269, Top-5 Accuracy: 5713.0/6000 (95.2167%)
Took 5829.055901527405 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.127176
Train set: Average loss: 0.1338
Valid set: Average loss: 2.7022, Accuracy: 24833/42000 (59%)
Took 5854.572122097015 seconds.
Test set: Average loss: 1.8406, Top-1 Accuracy: 4104/6000 (68.4000%)
Took 5855.631797075272 seconds.
Test set: Average loss: 1.8406, Top-5 Accuracy: 5712.0/6000 (95.2000%)
Took 5855.631797075272 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.089399
Train set: Average loss: 0.1150
Valid set: Average loss: 2.7701, Accuracy: 25113/42000 (60%)
Took 5880.193219661713 seconds.
Test set: Average loss: 1.6899, Top-1 Accuracy: 4348/6000 (72.4667%)
Took 5881.204041481018 seconds.
Test set: Average loss: 1.6899, Top-5 Accuracy: 5754.0/6000 (95.9000%)
Took 5881.204041481018 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.103125
Train set: Average loss: 0.1059
Valid set: Average loss: 2.6479, Accuracy: 24554/42000 (58%)
Took 5905.419072389603 seconds.
Test set: Average loss: 1.7072, Top-1 Accuracy: 4185/6000 (69.7500%)
Took 5906.425330877304 seconds.
Test set: Average loss: 1.7072, Top-5 Accuracy: 5759.0/6000 (95.9833%)
Took 5906.425330877304 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.078334
Train set: Average loss: 0.0976
Valid set: Average loss: 2.9606, Accuracy: 23770/42000 (57%)
Took 5931.101155996323 seconds.
Test set: Average loss: 2.0871, Top-1 Accuracy: 4050/6000 (67.5000%)
Took 5932.161891937256 seconds.
Test set: Average loss: 2.0871, Top-5 Accuracy: 5677.0/6000 (94.6167%)
Took 5932.161891937256 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.098598
Train set: Average loss: 0.0935
Valid set: Average loss: 2.8619, Accuracy: 23876/42000 (57%)
Took 5956.270826101303 seconds.
Test set: Average loss: 1.9325, Top-1 Accuracy: 4148/6000 (69.1333%)
Took 5957.28404545784 seconds.
Test set: Average loss: 1.9325, Top-5 Accuracy: 5700.0/6000 (95.0000%)
Took 5957.28404545784 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.067604
Train set: Average loss: 0.0940
Valid set: Average loss: 3.6355, Accuracy: 22892/42000 (55%)
Took 5981.499462366104 seconds.
Test set: Average loss: 2.2071, Top-1 Accuracy: 4155/6000 (69.2500%)
Took 5982.49858546257 seconds.
Test set: Average loss: 2.2071, Top-5 Accuracy: 5702.0/6000 (95.0333%)
Took 5982.49858546257 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.070574
Train set: Average loss: 0.0908
Valid set: Average loss: 3.3722, Accuracy: 23546/42000 (56%)
Took 6006.62283372879 seconds.
Test set: Average loss: 1.8688, Top-1 Accuracy: 4199/6000 (69.9833%)
Took 6007.621106624603 seconds.
Test set: Average loss: 1.8688, Top-5 Accuracy: 5762.0/6000 (96.0333%)
Took 6007.621106624603 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.078798
Train set: Average loss: 0.0818
Valid set: Average loss: 3.2442, Accuracy: 23490/42000 (56%)
Took 6031.736227750778 seconds.
Test set: Average loss: 2.0708, Top-1 Accuracy: 4090/6000 (68.1667%)
Took 6032.736830472946 seconds.
Test set: Average loss: 2.0708, Top-5 Accuracy: 5732.0/6000 (95.5333%)
Took 6032.736830472946 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.069872
Train set: Average loss: 0.0757
Valid set: Average loss: 2.9890, Accuracy: 24663/42000 (59%)
Took 6056.950038433075 seconds.
Test set: Average loss: 1.7958, Top-1 Accuracy: 4238/6000 (70.6333%)
Took 6057.94961309433 seconds.
Test set: Average loss: 1.7958, Top-5 Accuracy: 5817.0/6000 (96.9500%)
Took 6057.94961309433 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.082257
Train set: Average loss: 0.0751
Valid set: Average loss: 3.1089, Accuracy: 24459/42000 (58%)
Took 6081.99876999855 seconds.
Test set: Average loss: 1.9100, Top-1 Accuracy: 4250/6000 (70.8333%)
Took 6082.996727228165 seconds.
Test set: Average loss: 1.9100, Top-5 Accuracy: 5692.0/6000 (94.8667%)
Took 6082.996727228165 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.051413
Train set: Average loss: 0.0611
Valid set: Average loss: 4.1034, Accuracy: 22306/42000 (53%)
Took 6107.108871221542 seconds.
Test set: Average loss: 2.5855, Top-1 Accuracy: 3999/6000 (66.6500%)
Took 6108.106478214264 seconds.
Test set: Average loss: 2.5855, Top-5 Accuracy: 5643.0/6000 (94.0500%)
Took 6108.106478214264 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.053236
Train set: Average loss: 0.0661
Valid set: Average loss: 3.3388, Accuracy: 23910/42000 (57%)
Took 6132.276305913925 seconds.
Test set: Average loss: 2.0201, Top-1 Accuracy: 4217/6000 (70.2833%)
Took 6133.274641752243 seconds.
Test set: Average loss: 2.0201, Top-5 Accuracy: 5696.0/6000 (94.9333%)
Took 6133.274641752243 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.053495
Train set: Average loss: 0.0668
Valid set: Average loss: 2.9562, Accuracy: 24449/42000 (58%)
Took 6157.355314016342 seconds.
Test set: Average loss: 1.7202, Top-1 Accuracy: 4302/6000 (71.7000%)
Took 6158.36049413681 seconds.
Test set: Average loss: 1.7202, Top-5 Accuracy: 5719.0/6000 (95.3167%)
Took 6158.36049413681 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.066552
Train set: Average loss: 0.0761
Valid set: Average loss: 3.3907, Accuracy: 23027/42000 (55%)
Took 6182.47261428833 seconds.
Test set: Average loss: 2.2901, Top-1 Accuracy: 4015/6000 (66.9167%)
Took 6183.475375175476 seconds.
Test set: Average loss: 2.2901, Top-5 Accuracy: 5649.0/6000 (94.1500%)
Took 6183.475375175476 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.009798
Train set: Average loss: 0.0335
Valid set: Average loss: 3.2787, Accuracy: 24383/42000 (58%)
Took 6207.668225765228 seconds.
Test set: Average loss: 2.0923, Top-1 Accuracy: 4238/6000 (70.6333%)
Took 6208.682360649109 seconds.
Test set: Average loss: 2.0923, Top-5 Accuracy: 5697.0/6000 (94.9500%)
Took 6208.682360649109 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.001888
Train set: Average loss: 0.0052
Valid set: Average loss: 3.4701, Accuracy: 24491/42000 (58%)
Took 6232.794761180878 seconds.
Test set: Average loss: 2.1739, Top-1 Accuracy: 4262/6000 (71.0333%)
Took 6233.795431137085 seconds.
Test set: Average loss: 2.1739, Top-5 Accuracy: 5705.0/6000 (95.0833%)
Took 6233.795431137085 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.6069, Top-1 Accuracy: 4088/6000 (68.1333%)
Took 6234.83845448494 seconds.
Test set: Average loss: 1.6069, Top-5 Accuracy: 5718.0/6000 (95.3000%)
Took 6234.83845448494 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 1.8363, Top-1 Accuracy: 4066/6000 (67.7667%)
Took 6235.697633266449 seconds.
Test set: Average loss: 1.8363, Top-5 Accuracy: 5599.0/6000 (93.3167%)
Took 6235.697633266449 seconds.
Test set: Average loss: 1.3625, Top-1 Accuracy: 4552/6000 (75.8667%)
Took 6236.695766925812 seconds.
Test set: Average loss: 1.3625, Top-5 Accuracy: 5858.0/6000 (97.6333%)
Took 6236.695766925812 seconds.
Test set: Average loss: 3.1501, Top-1 Accuracy: 3034/6000 (50.5667%)
Took 6238.091090679169 seconds.
Test set: Average loss: 3.1501, Top-5 Accuracy: 5078.0/6000 (84.6333%)
Took 6238.091090679169 seconds.
Test set: Average loss: 1.7244, Top-1 Accuracy: 4327/6000 (72.1167%)
Took 6240.0728170871735 seconds.
Test set: Average loss: 1.7244, Top-5 Accuracy: 5546.0/6000 (92.4333%)
Took 6240.0728170871735 seconds.
Test set: Average loss: 3.3320, Top-1 Accuracy: 3202/6000 (53.3667%)
Took 6242.254486322403 seconds.
Test set: Average loss: 3.3320, Top-5 Accuracy: 4857.0/6000 (80.9500%)
Took 6242.254486322403 seconds.
Test set: Average loss: 2.4197, Top-1 Accuracy: 4083/6000 (68.0500%)
Took 6243.533824443817 seconds.
Test set: Average loss: 2.4197, Top-5 Accuracy: 5321.0/6000 (88.6833%)
Took 6243.533824443817 seconds.
Test set: Average loss: 1.6069, Top-1 Accuracy: 4088/6000 (68.1333%)
Took 6244.608184576035 seconds.
Test set: Average loss: 1.6069, Top-5 Accuracy: 5718.0/6000 (95.3000%)
Took 6244.608184576035 seconds.

Average Top-1 accuracy: tensor(65.1238)

----- Top1 acc: [83.66666412353516, 82.88333129882812, 75.26667022705078, 71.54583740234375, 68.95333099365234, 66.24444580078125, 65.12380981445312]
----- Top5 acc: [99.71666717529297, 99.16667175292969, 97.20555114746094, 94.10416412353516, 94.4000015258789, 90.7027816772461, 90.42143249511719]
============== Continual learning on task 7 =================

[before adaption and growth]
Test set: Average loss: 1.7469, Top-1 Accuracy: 4077/6000 (67.9500%)
Took 6245.823024749756 seconds.
Test set: Average loss: 1.7469, Top-5 Accuracy: 5507.0/6000 (91.7833%)
Took 6245.823024749756 seconds.
old_data shape: torch.Size([20000, 3072])
new_data_1 shape: torch.Size([20000, 3072])
MMD loss:tensor(0.2963, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.7833, 0.1521, 0.0120, 0.0526], device='cuda:0')
[6, 7, 9, 8]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 1.7469, Top-1 Accuracy: 4077/6000 (67.9500%)
Took 6257.159156322479 seconds.
Test set: Average loss: 1.7469, Top-5 Accuracy: 5507.0/6000 (91.7833%)
Took 6257.159156322479 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.401201
Train set: Average loss: 0.5317
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.6501, Accuracy: 31291/48000 (65%)
Took 6282.303633928299 seconds.
Test set: Average loss: 0.6769, Top-1 Accuracy: 4878/6000 (81.3000%)
Took 6283.339396476746 seconds.
Test set: Average loss: 0.6769, Top-5 Accuracy: 5952.0/6000 (99.2000%)
Took 6283.339396476746 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.294849
Train set: Average loss: 0.3007
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.9324, Accuracy: 31629/48000 (66%)
Took 6308.426163434982 seconds.
Test set: Average loss: 0.7380, Top-1 Accuracy: 4961/6000 (82.6833%)
Took 6309.423141717911 seconds.
Test set: Average loss: 0.7380, Top-5 Accuracy: 5962.0/6000 (99.3667%)
Took 6309.423141717911 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.289424
Train set: Average loss: 0.2581
Valid set: Average loss: 1.8701, Accuracy: 31559/48000 (66%)
Took 6334.436498403549 seconds.
Test set: Average loss: 0.8046, Top-1 Accuracy: 4922/6000 (82.0333%)
Took 6335.437115192413 seconds.
Test set: Average loss: 0.8046, Top-5 Accuracy: 5921.0/6000 (98.6833%)
Took 6335.437115192413 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.238717
Train set: Average loss: 0.2271
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.9337, Accuracy: 31762/48000 (66%)
Took 6360.726065158844 seconds.
Test set: Average loss: 0.7822, Top-1 Accuracy: 4994/6000 (83.2333%)
Took 6361.73605632782 seconds.
Test set: Average loss: 0.7822, Top-5 Accuracy: 5947.0/6000 (99.1167%)
Took 6361.73605632782 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.184766
Train set: Average loss: 0.1961
Valid set: Average loss: 2.2857, Accuracy: 30874/48000 (64%)
Took 6386.864511489868 seconds.
Test set: Average loss: 0.9367, Top-1 Accuracy: 4917/6000 (81.9500%)
Took 6387.865495920181 seconds.
Test set: Average loss: 0.9367, Top-5 Accuracy: 5924.0/6000 (98.7333%)
Took 6387.865495920181 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.186333
Train set: Average loss: 0.1717
Valid set: Average loss: 2.2785, Accuracy: 30851/48000 (64%)
Took 6413.052172660828 seconds.
Test set: Average loss: 0.9360, Top-1 Accuracy: 4962/6000 (82.7000%)
Took 6414.078274488449 seconds.
Test set: Average loss: 0.9360, Top-5 Accuracy: 5931.0/6000 (98.8500%)
Took 6414.078274488449 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.177073
Train set: Average loss: 0.1555
Valid set: Average loss: 2.2541, Accuracy: 31679/48000 (66%)
Took 6439.984870433807 seconds.
Test set: Average loss: 0.9641, Top-1 Accuracy: 4964/6000 (82.7333%)
Took 6441.038692474365 seconds.
Test set: Average loss: 0.9641, Top-5 Accuracy: 5937.0/6000 (98.9500%)
Took 6441.038692474365 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.126246
Train set: Average loss: 0.1431
Valid set: Average loss: 2.4793, Accuracy: 30982/48000 (65%)
Took 6466.485612869263 seconds.
Test set: Average loss: 1.0095, Top-1 Accuracy: 4968/6000 (82.8000%)
Took 6467.494367599487 seconds.
Test set: Average loss: 1.0095, Top-5 Accuracy: 5933.0/6000 (98.8833%)
Took 6467.494367599487 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.154527
Train set: Average loss: 0.1440
Valid set: Average loss: 2.7803, Accuracy: 29525/48000 (62%)
Took 6492.871272563934 seconds.
Test set: Average loss: 1.2361, Top-1 Accuracy: 4869/6000 (81.1500%)
Took 6493.8787524700165 seconds.
Test set: Average loss: 1.2361, Top-5 Accuracy: 5883.0/6000 (98.0500%)
Took 6493.8787524700165 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.104224
Train set: Average loss: 0.1171
Valid set: Average loss: 2.6573, Accuracy: 30703/48000 (64%)
Took 6519.16769862175 seconds.
Test set: Average loss: 1.0890, Top-1 Accuracy: 4913/6000 (81.8833%)
Took 6520.180601119995 seconds.
Test set: Average loss: 1.0890, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 6520.180601119995 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.083823
Train set: Average loss: 0.0993
Valid set: Average loss: 2.6215, Accuracy: 31193/48000 (65%)
Took 6545.7424030303955 seconds.
Test set: Average loss: 1.1010, Top-1 Accuracy: 4967/6000 (82.7833%)
Took 6546.770618677139 seconds.
Test set: Average loss: 1.1010, Top-5 Accuracy: 5918.0/6000 (98.6333%)
Took 6546.770618677139 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.090000
Train set: Average loss: 0.0974
Valid set: Average loss: 2.6598, Accuracy: 31341/48000 (65%)
Took 6572.137524604797 seconds.
Test set: Average loss: 1.1742, Top-1 Accuracy: 4946/6000 (82.4333%)
Took 6573.145124435425 seconds.
Test set: Average loss: 1.1742, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 6573.145124435425 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.095766
Train set: Average loss: 0.1085
Valid set: Average loss: 2.5549, Accuracy: 31504/48000 (66%)
Took 6598.428098917007 seconds.
Test set: Average loss: 1.1114, Top-1 Accuracy: 4997/6000 (83.2833%)
Took 6599.438054323196 seconds.
Test set: Average loss: 1.1114, Top-5 Accuracy: 5914.0/6000 (98.5667%)
Took 6599.438054323196 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.088887
Train set: Average loss: 0.0930
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.2383, Accuracy: 32387/48000 (67%)
Took 6624.8551902771 seconds.
Test set: Average loss: 1.1452, Top-1 Accuracy: 4855/6000 (80.9167%)
Took 6625.876343488693 seconds.
Test set: Average loss: 1.1452, Top-5 Accuracy: 5860.0/6000 (97.6667%)
Took 6625.876343488693 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.075337
Train set: Average loss: 0.0823
Valid set: Average loss: 2.6895, Accuracy: 30573/48000 (64%)
Took 6651.220168590546 seconds.
Test set: Average loss: 1.3130, Top-1 Accuracy: 4821/6000 (80.3500%)
Took 6652.231513738632 seconds.
Test set: Average loss: 1.3130, Top-5 Accuracy: 5858.0/6000 (97.6333%)
Took 6652.231513738632 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.055866
Train set: Average loss: 0.0663
Valid set: Average loss: 2.7701, Accuracy: 32148/48000 (67%)
Took 6677.581961631775 seconds.
Test set: Average loss: 1.5606, Top-1 Accuracy: 4855/6000 (80.9167%)
Took 6678.58988404274 seconds.
Test set: Average loss: 1.5606, Top-5 Accuracy: 5880.0/6000 (98.0000%)
Took 6678.58988404274 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.081565
Train set: Average loss: 0.0698
Valid set: Average loss: 2.5828, Accuracy: 31396/48000 (65%)
Took 6704.047390937805 seconds.
Test set: Average loss: 1.2816, Top-1 Accuracy: 4928/6000 (82.1333%)
Took 6705.070513248444 seconds.
Test set: Average loss: 1.2816, Top-5 Accuracy: 5871.0/6000 (97.8500%)
Took 6705.070513248444 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.071086
Train set: Average loss: 0.0691
Valid set: Average loss: 2.8893, Accuracy: 31447/48000 (66%)
Took 6730.730471611023 seconds.
Test set: Average loss: 1.4404, Top-1 Accuracy: 4929/6000 (82.1500%)
Took 6731.793575286865 seconds.
Test set: Average loss: 1.4404, Top-5 Accuracy: 5854.0/6000 (97.5667%)
Took 6731.793575286865 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.076269
Train set: Average loss: 0.0621
Valid set: Average loss: 2.6853, Accuracy: 31592/48000 (66%)
Took 6757.322622299194 seconds.
Test set: Average loss: 1.1523, Top-1 Accuracy: 5034/6000 (83.9000%)
Took 6758.353535890579 seconds.
Test set: Average loss: 1.1523, Top-5 Accuracy: 5922.0/6000 (98.7000%)
Took 6758.353535890579 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.050557
Train set: Average loss: 0.0652
Valid set: Average loss: 2.8994, Accuracy: 31396/48000 (65%)
Took 6783.56876540184 seconds.
Test set: Average loss: 1.2258, Top-1 Accuracy: 5026/6000 (83.7667%)
Took 6784.5672290325165 seconds.
Test set: Average loss: 1.2258, Top-5 Accuracy: 5868.0/6000 (97.8000%)
Took 6784.5672290325165 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.059603
Train set: Average loss: 0.0717
Valid set: Average loss: 2.4801, Accuracy: 31811/48000 (66%)
Took 6809.705250263214 seconds.
Test set: Average loss: 1.1695, Top-1 Accuracy: 4964/6000 (82.7333%)
Took 6810.709656953812 seconds.
Test set: Average loss: 1.1695, Top-5 Accuracy: 5866.0/6000 (97.7667%)
Took 6810.709656953812 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.069978
Train set: Average loss: 0.0644
Valid set: Average loss: 2.5612, Accuracy: 31291/48000 (65%)
Took 6836.218296289444 seconds.
Test set: Average loss: 1.2740, Top-1 Accuracy: 4922/6000 (82.0333%)
Took 6837.241629123688 seconds.
Test set: Average loss: 1.2740, Top-5 Accuracy: 5833.0/6000 (97.2167%)
Took 6837.241629123688 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.059892
Train set: Average loss: 0.0596
Valid set: Average loss: 2.7386, Accuracy: 30612/48000 (64%)
Took 6863.067882299423 seconds.
Test set: Average loss: 1.2395, Top-1 Accuracy: 4955/6000 (82.5833%)
Took 6864.092405080795 seconds.
Test set: Average loss: 1.2395, Top-5 Accuracy: 5878.0/6000 (97.9667%)
Took 6864.092405080795 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.054737
Train set: Average loss: 0.0703
Valid set: Average loss: 3.1227, Accuracy: 29877/48000 (62%)
Took 6891.119311332703 seconds.
Test set: Average loss: 1.4723, Top-1 Accuracy: 4849/6000 (80.8167%)
Took 6892.200470209122 seconds.
Test set: Average loss: 1.4723, Top-5 Accuracy: 5822.0/6000 (97.0333%)
Took 6892.200470209122 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.046188
Train set: Average loss: 0.0556
Valid set: Average loss: 2.6174, Accuracy: 31997/48000 (67%)
Took 6919.108165502548 seconds.
Test set: Average loss: 1.2784, Top-1 Accuracy: 4958/6000 (82.6333%)
Took 6920.181696176529 seconds.
Test set: Average loss: 1.2784, Top-5 Accuracy: 5836.0/6000 (97.2667%)
Took 6920.181696176529 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.012903
Train set: Average loss: 0.0214
Valid set: Average loss: 2.6777, Accuracy: 31947/48000 (67%)
Took 6947.159177541733 seconds.
Test set: Average loss: 1.2306, Top-1 Accuracy: 5006/6000 (83.4333%)
Took 6948.239539384842 seconds.
Test set: Average loss: 1.2306, Top-5 Accuracy: 5875.0/6000 (97.9167%)
Took 6948.239539384842 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.001721
Train set: Average loss: 0.0033
Valid set: Average loss: 2.8838, Accuracy: 31804/48000 (66%)
Took 6975.256084442139 seconds.
Test set: Average loss: 1.3542, Top-1 Accuracy: 4981/6000 (83.0167%)
Took 6976.327928781509 seconds.
Test set: Average loss: 1.3542, Top-5 Accuracy: 5866.0/6000 (97.7667%)
Took 6976.327928781509 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.1452, Top-1 Accuracy: 4855/6000 (80.9167%)
Took 6977.442654848099 seconds.
Test set: Average loss: 1.1452, Top-5 Accuracy: 5860.0/6000 (97.6667%)
Took 6977.442654848099 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 2.2115, Top-1 Accuracy: 4030/6000 (67.1667%)
Took 6978.360716104507 seconds.
Test set: Average loss: 2.2115, Top-5 Accuracy: 5494.0/6000 (91.5667%)
Took 6978.360716104507 seconds.
Test set: Average loss: 1.6299, Top-1 Accuracy: 4596/6000 (76.6000%)
Took 6979.430437088013 seconds.
Test set: Average loss: 1.6299, Top-5 Accuracy: 5634.0/6000 (93.9000%)
Took 6979.430437088013 seconds.
Test set: Average loss: 3.1849, Top-1 Accuracy: 3193/6000 (53.2167%)
Took 6980.925535202026 seconds.
Test set: Average loss: 3.1849, Top-5 Accuracy: 5381.0/6000 (89.6833%)
Took 6980.925535202026 seconds.
Test set: Average loss: 1.7444, Top-1 Accuracy: 4386/6000 (73.1000%)
Took 6983.061908960342 seconds.
Test set: Average loss: 1.7444, Top-5 Accuracy: 5749.0/6000 (95.8167%)
Took 6983.061908960342 seconds.
Test set: Average loss: 3.2672, Top-1 Accuracy: 3325/6000 (55.4167%)
Took 6985.441568136215 seconds.
Test set: Average loss: 3.2672, Top-5 Accuracy: 5445.0/6000 (90.7500%)
Took 6985.441568136215 seconds.
Test set: Average loss: 1.9854, Top-1 Accuracy: 4425/6000 (73.7500%)
Took 6986.71758890152 seconds.
Test set: Average loss: 1.9854, Top-5 Accuracy: 5613.0/6000 (93.5500%)
Took 6986.71758890152 seconds.
Test set: Average loss: 3.7809, Top-1 Accuracy: 2774/6000 (46.2333%)
Took 6987.792439699173 seconds.
Test set: Average loss: 3.7809, Top-5 Accuracy: 4996.0/6000 (83.2667%)
Took 6987.792439699173 seconds.
Test set: Average loss: 1.1452, Top-1 Accuracy: 4855/6000 (80.9167%)
Took 6988.871719837189 seconds.
Test set: Average loss: 1.1452, Top-5 Accuracy: 5860.0/6000 (97.6667%)
Took 6988.871719837189 seconds.

Average Top-1 accuracy: tensor(65.8000)

----- Top1 acc: [83.66666412353516, 82.88333129882812, 75.26667022705078, 71.54583740234375, 68.95333099365234, 66.24444580078125, 65.12380981445312, 65.80000305175781]
----- Top5 acc: [99.71666717529297, 99.16667175292969, 97.20555114746094, 94.10416412353516, 94.4000015258789, 90.7027816772461, 90.42143249511719, 92.0250015258789]
============== Continual learning on task 8 =================

[before adaption and growth]
Test set: Average loss: 4.0902, Top-1 Accuracy: 2190/6000 (36.5000%)
Took 6990.485741615295 seconds.
Test set: Average loss: 4.0902, Top-5 Accuracy: 4511.0/6000 (75.1833%)
Took 6990.485741615295 seconds.
old_data shape: torch.Size([15000, 3072])
new_data_1 shape: torch.Size([15000, 3072])
MMD loss:tensor(1.3514, device='cuda:0')

 ------------ start adaptation .............
--------- Task 8, DA Epoch 1/15 ---------
              [12800/30000 (0%)]      Loss: 9.772622
Train set: Average loss: 3.8395
Test set: Average loss: 5.0930, Top-1 Accuracy: 2816/6000 (46.9333%)
Took 7008.265105724335 seconds.
Test set: Average loss: 5.0930, Top-5 Accuracy: 5000.0/6000 (83.3333%)
Took 7008.265105724335 seconds.
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json
--------- Task 8, DA Epoch 2/15 ---------
              [12800/30000 (0%)]      Loss: 9.720092
Train set: Average loss: 3.8122
Test set: Average loss: 5.1059, Top-1 Accuracy: 2817/6000 (46.9500%)
Took 7018.350099802017 seconds.
Test set: Average loss: 5.1059, Top-5 Accuracy: 4997.0/6000 (83.2833%)
Took 7018.350099802017 seconds.
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json
--------- Task 8, DA Epoch 3/15 ---------
              [12800/30000 (0%)]      Loss: 9.674449
Train set: Average loss: 3.7874
Test set: Average loss: 5.1119, Top-1 Accuracy: 2805/6000 (46.7500%)
Took 7028.521748304367 seconds.
Test set: Average loss: 5.1119, Top-5 Accuracy: 4991.0/6000 (83.1833%)
Took 7028.521748304367 seconds.
--------- Task 8, DA Epoch 4/15 ---------
              [12800/30000 (0%)]      Loss: 9.635360
Train set: Average loss: 3.7639
Test set: Average loss: 5.1166, Top-1 Accuracy: 2795/6000 (46.5833%)
Took 7038.583332061768 seconds.
Test set: Average loss: 5.1166, Top-5 Accuracy: 4987.0/6000 (83.1167%)
Took 7038.583332061768 seconds.
--------- Task 8, DA Epoch 5/15 ---------
              [12800/30000 (0%)]      Loss: 9.606128
Train set: Average loss: 3.7422
Test set: Average loss: 5.1237, Top-1 Accuracy: 2800/6000 (46.6667%)
Took 7048.741393327713 seconds.
Test set: Average loss: 5.1237, Top-5 Accuracy: 4990.0/6000 (83.1667%)
Took 7048.741393327713 seconds.
--------- Task 8, DA Epoch 6/15 ---------
              [12800/30000 (0%)]      Loss: 9.574175
Train set: Average loss: 3.7213
Test set: Average loss: 5.1245, Top-1 Accuracy: 2798/6000 (46.6333%)
Took 7058.809437513351 seconds.
Test set: Average loss: 5.1245, Top-5 Accuracy: 4992.0/6000 (83.2000%)
Took 7058.809437513351 seconds.
--------- Task 8, DA Epoch 7/15 ---------
              [12800/30000 (0%)]      Loss: 9.543775
Train set: Average loss: 3.7003
Test set: Average loss: 5.1262, Top-1 Accuracy: 2802/6000 (46.7000%)
Took 7068.608704805374 seconds.
Test set: Average loss: 5.1262, Top-5 Accuracy: 4992.0/6000 (83.2000%)
Took 7068.608704805374 seconds.
--------- Task 8, DA Epoch 8/15 ---------
              [12800/30000 (0%)]      Loss: 9.504259
Train set: Average loss: 3.6787
Test set: Average loss: 5.1328, Top-1 Accuracy: 2790/6000 (46.5000%)
Took 7078.248302221298 seconds.
Test set: Average loss: 5.1328, Top-5 Accuracy: 4995.0/6000 (83.2500%)
Took 7078.248302221298 seconds.
--------- Task 8, DA Epoch 9/15 ---------
              [12800/30000 (0%)]      Loss: 9.473840
Train set: Average loss: 3.6577
Test set: Average loss: 5.1411, Top-1 Accuracy: 2789/6000 (46.4833%)
Took 7087.952946186066 seconds.
Test set: Average loss: 5.1411, Top-5 Accuracy: 4989.0/6000 (83.1500%)
Took 7087.952946186066 seconds.
--------- Task 8, DA Epoch 10/15 ---------
              [12800/30000 (0%)]      Loss: 9.446817
Train set: Average loss: 3.6371
Test set: Average loss: 5.1526, Top-1 Accuracy: 2787/6000 (46.4500%)
Took 7097.620092868805 seconds.
Test set: Average loss: 5.1526, Top-5 Accuracy: 4994.0/6000 (83.2333%)
Took 7097.620092868805 seconds.
--------- Task 8, DA Epoch 11/15 ---------
              [12800/30000 (0%)]      Loss: 9.421140
Train set: Average loss: 3.6178
Test set: Average loss: 5.1624, Top-1 Accuracy: 2788/6000 (46.4667%)
Took 7107.304527759552 seconds.
Test set: Average loss: 5.1624, Top-5 Accuracy: 4990.0/6000 (83.1667%)
Took 7107.304527759552 seconds.
--------- Task 8, DA Epoch 12/15 ---------
              [12800/30000 (0%)]      Loss: 9.396517
Train set: Average loss: 3.5996
Test set: Average loss: 5.1715, Top-1 Accuracy: 2780/6000 (46.3333%)
Took 7116.975160121918 seconds.
Test set: Average loss: 5.1715, Top-5 Accuracy: 4992.0/6000 (83.2000%)
Took 7116.975160121918 seconds.
--------- Task 8, DA Epoch 13/15 ---------
              [12800/30000 (0%)]      Loss: 9.368029
Train set: Average loss: 3.5812
Test set: Average loss: 5.1814, Top-1 Accuracy: 2773/6000 (46.2167%)
Took 7126.663051843643 seconds.
Test set: Average loss: 5.1814, Top-5 Accuracy: 4989.0/6000 (83.1500%)
Took 7126.663051843643 seconds.
--------- Task 8, DA Epoch 14/15 ---------
              [12800/30000 (0%)]      Loss: 9.340258
Train set: Average loss: 3.5625
Test set: Average loss: 5.1943, Top-1 Accuracy: 2760/6000 (46.0000%)
Took 7136.355798244476 seconds.
Test set: Average loss: 5.1943, Top-5 Accuracy: 4990.0/6000 (83.1667%)
Took 7136.355798244476 seconds.
--------- Task 8, DA Epoch 15/15 ---------
              [12800/30000 (0%)]      Loss: 9.310093
Train set: Average loss: 3.5441
Test set: Average loss: 5.2127, Top-1 Accuracy: 2744/6000 (45.7333%)
Took 7146.040344238281 seconds.
Test set: Average loss: 5.2127, Top-5 Accuracy: 4977.0/6000 (82.9500%)
Took 7146.040344238281 seconds.
[after adaption and growth]
Test set: Average loss: 5.1059, Top-1 Accuracy: 2817/6000 (46.9500%)
Took 7147.489549875259 seconds.
Test set: Average loss: 5.1059, Top-5 Accuracy: 4997.0/6000 (83.2833%)
Took 7147.489549875259 seconds.
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([8.7591e-01, 9.6686e-02, 2.3521e-04, 2.7165e-02], device='cuda:0')
[6, 7, 9, 8]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 5.1059, Top-1 Accuracy: 2817/6000 (46.9500%)
Took 7151.303292274475 seconds.
Test set: Average loss: 5.1059, Top-5 Accuracy: 4997.0/6000 (83.2833%)
Took 7151.303292274475 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.798476
Train set: Average loss: 0.9628
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.5799, Accuracy: 26272/54000 (49%)
Took 7180.734602212906 seconds.
Test set: Average loss: 0.7934, Top-1 Accuracy: 4511/6000 (75.1833%)
Took 7182.168281316757 seconds.
Test set: Average loss: 0.7934, Top-5 Accuracy: 5898.0/6000 (98.3000%)
Took 7182.168281316757 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.568946
Train set: Average loss: 0.5863
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 3.3207, Accuracy: 26622/54000 (49%)
Took 7211.544155597687 seconds.
Test set: Average loss: 0.8743, Top-1 Accuracy: 4454/6000 (74.2333%)
Took 7213.013535737991 seconds.
Test set: Average loss: 0.8743, Top-5 Accuracy: 5903.0/6000 (98.3833%)
Took 7213.013535737991 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.427475
Train set: Average loss: 0.4320
Valid set: Average loss: 4.0236, Accuracy: 26246/54000 (49%)
Took 7242.295543432236 seconds.
Test set: Average loss: 0.9347, Top-1 Accuracy: 4539/6000 (75.6500%)
Took 7243.715748310089 seconds.
Test set: Average loss: 0.9347, Top-5 Accuracy: 5898.0/6000 (98.3000%)
Took 7243.715748310089 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.342746
Train set: Average loss: 0.3415
Valid set: Average loss: 4.9033, Accuracy: 25879/54000 (48%)
Took 7273.050090789795 seconds.
Test set: Average loss: 1.0181, Top-1 Accuracy: 4541/6000 (75.6833%)
Took 7274.480123758316 seconds.
Test set: Average loss: 1.0181, Top-5 Accuracy: 5903.0/6000 (98.3833%)
Took 7274.480123758316 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.308344
Train set: Average loss: 0.2971
Valid set: Average loss: 5.4585, Accuracy: 23675/54000 (44%)
Took 7303.863777637482 seconds.
Test set: Average loss: 1.5132, Top-1 Accuracy: 4167/6000 (69.4500%)
Took 7305.293897151947 seconds.
Test set: Average loss: 1.5132, Top-5 Accuracy: 5710.0/6000 (95.1667%)
Took 7305.293897151947 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.257042
Train set: Average loss: 0.2765
Valid set: Average loss: 4.8372, Accuracy: 25329/54000 (47%)
Took 7334.697460174561 seconds.
Test set: Average loss: 1.1236, Top-1 Accuracy: 4493/6000 (74.8833%)
Took 7336.13157749176 seconds.
Test set: Average loss: 1.1236, Top-5 Accuracy: 5851.0/6000 (97.5167%)
Took 7336.13157749176 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.221971
Train set: Average loss: 0.2363
Valid set: Average loss: 5.4497, Accuracy: 25085/54000 (46%)
Took 7365.508629083633 seconds.
Test set: Average loss: 1.2986, Top-1 Accuracy: 4496/6000 (74.9333%)
Took 7366.943866968155 seconds.
Test set: Average loss: 1.2986, Top-5 Accuracy: 5875.0/6000 (97.9167%)
Took 7366.943866968155 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.206301
Train set: Average loss: 0.2086
Valid set: Average loss: 7.1959, Accuracy: 23314/54000 (43%)
Took 7396.08794760704 seconds.
Test set: Average loss: 1.3474, Top-1 Accuracy: 4513/6000 (75.2167%)
Took 7397.511512517929 seconds.
Test set: Average loss: 1.3474, Top-5 Accuracy: 5823.0/6000 (97.0500%)
Took 7397.511512517929 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.207233
Train set: Average loss: 0.2082
Valid set: Average loss: 4.9913, Accuracy: 25044/54000 (46%)
Took 7426.946944952011 seconds.
Test set: Average loss: 1.2790, Top-1 Accuracy: 4454/6000 (74.2333%)
Took 7428.376477241516 seconds.
Test set: Average loss: 1.2790, Top-5 Accuracy: 5874.0/6000 (97.9000%)
Took 7428.376477241516 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.149134
Train set: Average loss: 0.1815
Valid set: Average loss: 5.9688, Accuracy: 25151/54000 (47%)
Took 7458.0156445503235 seconds.
Test set: Average loss: 1.4004, Top-1 Accuracy: 4437/6000 (73.9500%)
Took 7459.47442650795 seconds.
Test set: Average loss: 1.4004, Top-5 Accuracy: 5881.0/6000 (98.0167%)
Took 7459.47442650795 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.153601
Train set: Average loss: 0.1536
Valid set: Average loss: 5.8283, Accuracy: 26196/54000 (49%)
Took 7488.866748809814 seconds.
Test set: Average loss: 1.6116, Top-1 Accuracy: 4376/6000 (72.9333%)
Took 7490.318761110306 seconds.
Test set: Average loss: 1.6116, Top-5 Accuracy: 5885.0/6000 (98.0833%)
Took 7490.318761110306 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.132302
Train set: Average loss: 0.1476
Valid set: Average loss: 5.2318, Accuracy: 26349/54000 (49%)
Took 7519.7500121593475 seconds.
Test set: Average loss: 1.6144, Top-1 Accuracy: 4291/6000 (71.5167%)
Took 7521.186127662659 seconds.
Test set: Average loss: 1.6144, Top-5 Accuracy: 5792.0/6000 (96.5333%)
Took 7521.186127662659 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.129419
Train set: Average loss: 0.1409
Valid set: Average loss: 7.0050, Accuracy: 24731/54000 (46%)
Took 7551.128195762634 seconds.
Test set: Average loss: 1.9855, Top-1 Accuracy: 4161/6000 (69.3500%)
Took 7552.563207864761 seconds.
Test set: Average loss: 1.9855, Top-5 Accuracy: 5713.0/6000 (95.2167%)
Took 7552.563207864761 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.103161
Train set: Average loss: 0.1413
Valid set: Average loss: 7.6440, Accuracy: 23721/54000 (44%)
Took 7582.570500135422 seconds.
Test set: Average loss: 1.6225, Top-1 Accuracy: 4277/6000 (71.2833%)
Took 7584.002210140228 seconds.
Test set: Average loss: 1.6225, Top-5 Accuracy: 5844.0/6000 (97.4000%)
Took 7584.002210140228 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.107993
Train set: Average loss: 0.1169
Valid set: Average loss: 6.7799, Accuracy: 23931/54000 (44%)
Took 7614.105232715607 seconds.
Test set: Average loss: 1.9970, Top-1 Accuracy: 4292/6000 (71.5333%)
Took 7615.538514375687 seconds.
Test set: Average loss: 1.9970, Top-5 Accuracy: 5792.0/6000 (96.5333%)
Took 7615.538514375687 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.109685
Train set: Average loss: 0.1184
Valid set: Average loss: 7.1459, Accuracy: 25339/54000 (47%)
Took 7645.220214605331 seconds.
Test set: Average loss: 1.7561, Top-1 Accuracy: 4400/6000 (73.3333%)
Took 7646.610397815704 seconds.
Test set: Average loss: 1.7561, Top-5 Accuracy: 5846.0/6000 (97.4333%)
Took 7646.610397815704 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.105410
Train set: Average loss: 0.1019
Valid set: Average loss: 8.7296, Accuracy: 23499/54000 (44%)
Took 7676.258103132248 seconds.
Test set: Average loss: 1.6830, Top-1 Accuracy: 4528/6000 (75.4667%)
Took 7677.693079471588 seconds.
Test set: Average loss: 1.6830, Top-5 Accuracy: 5847.0/6000 (97.4500%)
Took 7677.693079471588 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.085554
Train set: Average loss: 0.0906
Valid set: Average loss: 7.9247, Accuracy: 24948/54000 (46%)
Took 7706.645750045776 seconds.
Test set: Average loss: 1.7468, Top-1 Accuracy: 4537/6000 (75.6167%)
Took 7708.068877696991 seconds.
Test set: Average loss: 1.7468, Top-5 Accuracy: 5834.0/6000 (97.2333%)
Took 7708.068877696991 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.120950
Train set: Average loss: 0.1048
Valid set: Average loss: 7.8827, Accuracy: 23272/54000 (43%)
Took 7737.837785243988 seconds.
Test set: Average loss: 1.7302, Top-1 Accuracy: 4458/6000 (74.3000%)
Took 7739.311985015869 seconds.
Test set: Average loss: 1.7302, Top-5 Accuracy: 5849.0/6000 (97.4833%)
Took 7739.311985015869 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.099133
Train set: Average loss: 0.0866
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 5.8946, Accuracy: 27137/54000 (50%)
Took 7769.711586236954 seconds.
Test set: Average loss: 1.6050, Top-1 Accuracy: 4480/6000 (74.6667%)
Took 7771.195457935333 seconds.
Test set: Average loss: 1.6050, Top-5 Accuracy: 5845.0/6000 (97.4167%)
Took 7771.195457935333 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.064276
Train set: Average loss: 0.0726
Valid set: Average loss: 5.3846, Accuracy: 26881/54000 (50%)
Took 7801.364797592163 seconds.
Test set: Average loss: 1.7844, Top-1 Accuracy: 4428/6000 (73.8000%)
Took 7802.873226881027 seconds.
Test set: Average loss: 1.7844, Top-5 Accuracy: 5810.0/6000 (96.8333%)
Took 7802.873226881027 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.079288
Train set: Average loss: 0.0764
Valid set: Average loss: 6.7892, Accuracy: 25251/54000 (47%)
Took 7833.1848022937775 seconds.
Test set: Average loss: 1.7889, Top-1 Accuracy: 4406/6000 (73.4333%)
Took 7834.65935754776 seconds.
Test set: Average loss: 1.7889, Top-5 Accuracy: 5839.0/6000 (97.3167%)
Took 7834.65935754776 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.081697
Train set: Average loss: 0.0732
Valid set: Average loss: 8.8284, Accuracy: 22815/54000 (42%)
Took 7864.8784437179565 seconds.
Test set: Average loss: 1.8198, Top-1 Accuracy: 4379/6000 (72.9833%)
Took 7866.352484703064 seconds.
Test set: Average loss: 1.8198, Top-5 Accuracy: 5830.0/6000 (97.1667%)
Took 7866.352484703064 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.053456
Train set: Average loss: 0.0673
Valid set: Average loss: 7.1687, Accuracy: 24698/54000 (46%)
Took 7896.480382442474 seconds.
Test set: Average loss: 1.9140, Top-1 Accuracy: 4367/6000 (72.7833%)
Took 7897.976009607315 seconds.
Test set: Average loss: 1.9140, Top-5 Accuracy: 5841.0/6000 (97.3500%)
Took 7897.976009607315 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.051892
Train set: Average loss: 0.0655
Valid set: Average loss: 6.5666, Accuracy: 25603/54000 (47%)
Took 7928.118773698807 seconds.
Test set: Average loss: 1.7599, Top-1 Accuracy: 4469/6000 (74.4833%)
Took 7929.58708691597 seconds.
Test set: Average loss: 1.7599, Top-5 Accuracy: 5834.0/6000 (97.2333%)
Took 7929.58708691597 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.011746
Train set: Average loss: 0.0341
Valid set: Average loss: 6.7820, Accuracy: 25407/54000 (47%)
Took 7959.73015332222 seconds.
Test set: Average loss: 1.5706, Top-1 Accuracy: 4594/6000 (76.5667%)
Took 7961.200875759125 seconds.
Test set: Average loss: 1.5706, Top-5 Accuracy: 5850.0/6000 (97.5000%)
Took 7961.200875759125 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.004469
Train set: Average loss: 0.0090
Valid set: Average loss: 6.8425, Accuracy: 25818/54000 (48%)
Took 7990.957921504974 seconds.
Test set: Average loss: 1.6591, Top-1 Accuracy: 4615/6000 (76.9167%)
Took 7992.45364356041 seconds.
Test set: Average loss: 1.6591, Top-5 Accuracy: 5844.0/6000 (97.4000%)
Took 7992.45364356041 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.6050, Top-1 Accuracy: 4480/6000 (74.6667%)
Took 7993.941535234451 seconds.
Test set: Average loss: 1.6050, Top-5 Accuracy: 5845.0/6000 (97.4167%)
Took 7993.941535234451 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 3.2270, Top-1 Accuracy: 3499/6000 (58.3167%)
Took 7994.828476905823 seconds.
Test set: Average loss: 3.2270, Top-5 Accuracy: 5045.0/6000 (84.0833%)
Took 7994.828476905823 seconds.
Test set: Average loss: 2.1493, Top-1 Accuracy: 4251/6000 (70.8500%)
Took 7995.8578560352325 seconds.
Test set: Average loss: 2.1493, Top-5 Accuracy: 5580.0/6000 (93.0000%)
Took 7995.8578560352325 seconds.
Test set: Average loss: 2.7976, Top-1 Accuracy: 3544/6000 (59.0667%)
Took 7997.294425010681 seconds.
Test set: Average loss: 2.7976, Top-5 Accuracy: 5498.0/6000 (91.6333%)
Took 7997.294425010681 seconds.
Test set: Average loss: 1.0296, Top-1 Accuracy: 4995/6000 (83.2500%)
Took 7999.340890884399 seconds.
Test set: Average loss: 1.0296, Top-5 Accuracy: 5922.0/6000 (98.7000%)
Took 7999.340890884399 seconds.
Test set: Average loss: 2.8145, Top-1 Accuracy: 3657/6000 (60.9500%)
Took 8001.576902627945 seconds.
Test set: Average loss: 2.8145, Top-5 Accuracy: 5480.0/6000 (91.3333%)
Took 8001.576902627945 seconds.
Test set: Average loss: 4.2467, Top-1 Accuracy: 3378/6000 (56.3000%)
Took 8002.797290563583 seconds.
Test set: Average loss: 4.2467, Top-5 Accuracy: 4900.0/6000 (81.6667%)
Took 8002.797290563583 seconds.
Test set: Average loss: 5.6466, Top-1 Accuracy: 2212/6000 (36.8667%)
Took 8003.820031642914 seconds.
Test set: Average loss: 5.6466, Top-5 Accuracy: 4501.0/6000 (75.0167%)
Took 8003.820031642914 seconds.
Test set: Average loss: 1.7445, Top-1 Accuracy: 4491/6000 (74.8500%)
Took 8004.8467535972595 seconds.
Test set: Average loss: 1.7445, Top-5 Accuracy: 5760.0/6000 (96.0000%)
Took 8004.8467535972595 seconds.
Test set: Average loss: 1.6050, Top-1 Accuracy: 4480/6000 (74.6667%)
Took 8006.282931566238 seconds.
Test set: Average loss: 1.6050, Top-5 Accuracy: 5845.0/6000 (97.4167%)
Took 8006.282931566238 seconds.

Average Top-1 accuracy: tensor(63.9019)

----- Top1 acc: [83.66666412353516, 82.88333129882812, 75.26667022705078, 71.54583740234375, 68.95333099365234, 66.24444580078125, 65.12380981445312, 65.80000305175781, 63.90185546875]
----- Top5 acc: [99.71666717529297, 99.16667175292969, 97.20555114746094, 94.10416412353516, 94.4000015258789, 90.7027816772461, 90.42143249511719, 92.0250015258789, 89.87223052978516]
============== Continual learning on task 9 =================

[before adaption and growth]
Test set: Average loss: 4.8464, Top-1 Accuracy: 3109/6000 (51.8167%)
Took 8007.320970058441 seconds.
Test set: Average loss: 4.8464, Top-5 Accuracy: 5324.0/6000 (88.7333%)
Took 8007.320970058441 seconds.
old_data shape: torch.Size([10000, 3072])
new_data_1 shape: torch.Size([10000, 3072])
MMD loss:tensor(0.0129, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.5487, 0.3130, 0.0344, 0.1038], device='cuda:0')
[6, 7, 9, 8]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 4.8464, Top-1 Accuracy: 3109/6000 (51.8167%)
Took 8014.366044998169 seconds.
Test set: Average loss: 4.8464, Top-5 Accuracy: 5324.0/6000 (88.7333%)
Took 8014.366044998169 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.416229
Train set: Average loss: 0.6034
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8064, Accuracy: 36984/60000 (62%)
Took 8042.946196317673 seconds.
Test set: Average loss: 0.7973, Top-1 Accuracy: 4559/6000 (75.9833%)
Took 8043.865710020065 seconds.
Test set: Average loss: 0.7973, Top-5 Accuracy: 5895.0/6000 (98.2500%)
Took 8043.865710020065 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.214658
Train set: Average loss: 0.2818
Valid set: Average loss: 2.2427, Accuracy: 36956/60000 (62%)
Took 8072.543574094772 seconds.
Test set: Average loss: 1.0432, Top-1 Accuracy: 4590/6000 (76.5000%)
Took 8073.461908817291 seconds.
Test set: Average loss: 1.0432, Top-5 Accuracy: 5887.0/6000 (98.1167%)
Took 8073.461908817291 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.161692
Train set: Average loss: 0.1743
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.5936, Accuracy: 37101/60000 (62%)
Took 8102.0591740608215 seconds.
Test set: Average loss: 1.1754, Top-1 Accuracy: 4635/6000 (77.2500%)
Took 8102.978497982025 seconds.
Test set: Average loss: 1.1754, Top-5 Accuracy: 5907.0/6000 (98.4500%)
Took 8102.978497982025 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.133277
Train set: Average loss: 0.1348
Valid set: Average loss: 2.8018, Accuracy: 36196/60000 (60%)
Took 8131.626681566238 seconds.
Test set: Average loss: 1.4041, Top-1 Accuracy: 4528/6000 (75.4667%)
Took 8132.548375844955 seconds.
Test set: Average loss: 1.4041, Top-5 Accuracy: 5871.0/6000 (97.8500%)
Took 8132.548375844955 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.120966
Train set: Average loss: 0.1215
Valid set: Average loss: 2.8370, Accuracy: 35223/60000 (59%)
Took 8160.973252296448 seconds.
Test set: Average loss: 1.2962, Top-1 Accuracy: 4566/6000 (76.1000%)
Took 8161.899036169052 seconds.
Test set: Average loss: 1.2962, Top-5 Accuracy: 5893.0/6000 (98.2167%)
Took 8161.899036169052 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.087164
Train set: Average loss: 0.1057
Valid set: Average loss: 2.8570, Accuracy: 35418/60000 (59%)
Took 8189.414407968521 seconds.
Test set: Average loss: 1.5688, Top-1 Accuracy: 4482/6000 (74.7000%)
Took 8190.290641069412 seconds.
Test set: Average loss: 1.5688, Top-5 Accuracy: 5857.0/6000 (97.6167%)
Took 8190.290641069412 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.067023
Train set: Average loss: 0.0946
Valid set: Average loss: 2.9439, Accuracy: 35787/60000 (60%)
Took 8218.460327625275 seconds.
Test set: Average loss: 1.6854, Top-1 Accuracy: 4430/6000 (73.8333%)
Took 8219.401288032532 seconds.
Test set: Average loss: 1.6854, Top-5 Accuracy: 5828.0/6000 (97.1333%)
Took 8219.401288032532 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.071161
Train set: Average loss: 0.0903
Valid set: Average loss: 2.8002, Accuracy: 36498/60000 (61%)
Took 8248.214353322983 seconds.
Test set: Average loss: 1.4318, Top-1 Accuracy: 4541/6000 (75.6833%)
Took 8249.134338378906 seconds.
Test set: Average loss: 1.4318, Top-5 Accuracy: 5878.0/6000 (97.9667%)
Took 8249.134338378906 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.069565
Train set: Average loss: 0.0846
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 3.0653, Accuracy: 37144/60000 (62%)
Took 8277.935007095337 seconds.
Test set: Average loss: 2.0555, Top-1 Accuracy: 4315/6000 (71.9167%)
Took 8278.8668384552 seconds.
Test set: Average loss: 2.0555, Top-5 Accuracy: 5829.0/6000 (97.1500%)
Took 8278.8668384552 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.067941
Train set: Average loss: 0.0715
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.9293, Accuracy: 37311/60000 (62%)
Took 8307.843984127045 seconds.
Test set: Average loss: 1.4251, Top-1 Accuracy: 4675/6000 (77.9167%)
Took 8308.766942501068 seconds.
Test set: Average loss: 1.4251, Top-5 Accuracy: 5886.0/6000 (98.1000%)
Took 8308.766942501068 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.085996
Train set: Average loss: 0.0674
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.8470, Accuracy: 38065/60000 (63%)
Took 8337.789536476135 seconds.
Test set: Average loss: 1.5158, Top-1 Accuracy: 4571/6000 (76.1833%)
Took 8338.715259313583 seconds.
Test set: Average loss: 1.5158, Top-5 Accuracy: 5877.0/6000 (97.9500%)
Took 8338.715259313583 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.102359
Train set: Average loss: 0.0702
Valid set: Average loss: 3.2095, Accuracy: 35510/60000 (59%)
Took 8367.391227006912 seconds.
Test set: Average loss: 1.6081, Top-1 Accuracy: 4532/6000 (75.5333%)
Took 8368.313967466354 seconds.
Test set: Average loss: 1.6081, Top-5 Accuracy: 5799.0/6000 (96.6500%)
Took 8368.313967466354 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.053793
Train set: Average loss: 0.0963
Valid set: Average loss: 2.9258, Accuracy: 36800/60000 (61%)
Took 8397.508412122726 seconds.
Test set: Average loss: 1.4918, Top-1 Accuracy: 4634/6000 (77.2333%)
Took 8398.429897069931 seconds.
Test set: Average loss: 1.4918, Top-5 Accuracy: 5861.0/6000 (97.6833%)
Took 8398.429897069931 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.050920
Train set: Average loss: 0.0451
Valid set: Average loss: 3.2339, Accuracy: 36390/60000 (61%)
Took 8427.13756275177 seconds.
Test set: Average loss: 1.5666, Top-1 Accuracy: 4665/6000 (77.7500%)
Took 8428.080514907837 seconds.
Test set: Average loss: 1.5666, Top-5 Accuracy: 5875.0/6000 (97.9167%)
Took 8428.080514907837 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.040123
Train set: Average loss: 0.0494
Valid set: Average loss: 3.2497, Accuracy: 36861/60000 (61%)
Took 8457.082243919373 seconds.
Test set: Average loss: 1.4734, Top-1 Accuracy: 4692/6000 (78.2000%)
Took 8458.00888967514 seconds.
Test set: Average loss: 1.4734, Top-5 Accuracy: 5852.0/6000 (97.5333%)
Took 8458.00888967514 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.046323
Train set: Average loss: 0.0484
Valid set: Average loss: 3.1717, Accuracy: 36026/60000 (60%)
Took 8486.932338953018 seconds.
Test set: Average loss: 1.5491, Top-1 Accuracy: 4610/6000 (76.8333%)
Took 8487.856180906296 seconds.
Test set: Average loss: 1.5491, Top-5 Accuracy: 5824.0/6000 (97.0667%)
Took 8487.856180906296 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.047269
Train set: Average loss: 0.0455
Valid set: Average loss: 3.1372, Accuracy: 36993/60000 (62%)
Took 8516.585259437561 seconds.
Test set: Average loss: 1.5637, Top-1 Accuracy: 4641/6000 (77.3500%)
Took 8517.505975723267 seconds.
Test set: Average loss: 1.5637, Top-5 Accuracy: 5867.0/6000 (97.7833%)
Took 8517.505975723267 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.045073
Train set: Average loss: 0.0430
Valid set: Average loss: 3.1433, Accuracy: 36492/60000 (61%)
Took 8546.328570365906 seconds.
Test set: Average loss: 1.7604, Top-1 Accuracy: 4518/6000 (75.3000%)
Took 8547.249100208282 seconds.
Test set: Average loss: 1.7604, Top-5 Accuracy: 5830.0/6000 (97.1667%)
Took 8547.249100208282 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.057465
Train set: Average loss: 0.0717
Valid set: Average loss: 3.1092, Accuracy: 35196/60000 (59%)
Took 8576.370971441269 seconds.
Test set: Average loss: 1.5198, Top-1 Accuracy: 4621/6000 (77.0167%)
Took 8577.291525363922 seconds.
Test set: Average loss: 1.5198, Top-5 Accuracy: 5850.0/6000 (97.5000%)
Took 8577.291525363922 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.042538
Train set: Average loss: 0.0496
Valid set: Average loss: 2.9542, Accuracy: 37356/60000 (62%)
Took 8605.887136936188 seconds.
Test set: Average loss: 1.5506, Top-1 Accuracy: 4649/6000 (77.4833%)
Took 8606.794983148575 seconds.
Test set: Average loss: 1.5506, Top-5 Accuracy: 5825.0/6000 (97.0833%)
Took 8606.794983148575 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.050453
Train set: Average loss: 0.0437
Valid set: Average loss: 3.4737, Accuracy: 35100/60000 (58%)
Took 8635.173127174377 seconds.
Test set: Average loss: 1.8675, Top-1 Accuracy: 4548/6000 (75.8000%)
Took 8636.09951043129 seconds.
Test set: Average loss: 1.8675, Top-5 Accuracy: 5839.0/6000 (97.3167%)
Took 8636.09951043129 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.033826
Train set: Average loss: 0.0406
Valid set: Average loss: 3.0661, Accuracy: 36446/60000 (61%)
Took 8664.507553100586 seconds.
Test set: Average loss: 1.5992, Top-1 Accuracy: 4601/6000 (76.6833%)
Took 8665.41661477089 seconds.
Test set: Average loss: 1.5992, Top-5 Accuracy: 5813.0/6000 (96.8833%)
Took 8665.41661477089 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.053614
Train set: Average loss: 0.0341
Valid set: Average loss: 3.0147, Accuracy: 37001/60000 (62%)
Took 8693.911512374878 seconds.
Test set: Average loss: 1.5664, Top-1 Accuracy: 4685/6000 (78.0833%)
Took 8694.873740673065 seconds.
Test set: Average loss: 1.5664, Top-5 Accuracy: 5804.0/6000 (96.7333%)
Took 8694.873740673065 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.024177
Train set: Average loss: 0.0293
Valid set: Average loss: 3.2279, Accuracy: 37002/60000 (62%)
Took 8723.257914543152 seconds.
Test set: Average loss: 1.7716, Top-1 Accuracy: 4591/6000 (76.5167%)
Took 8724.166432857513 seconds.
Test set: Average loss: 1.7716, Top-5 Accuracy: 5824.0/6000 (97.0667%)
Took 8724.166432857513 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.044195
Train set: Average loss: 0.0355
Valid set: Average loss: 3.2237, Accuracy: 36783/60000 (61%)
Took 8752.930218696594 seconds.
Test set: Average loss: 1.8094, Top-1 Accuracy: 4519/6000 (75.3167%)
Took 8753.849156618118 seconds.
Test set: Average loss: 1.8094, Top-5 Accuracy: 5751.0/6000 (95.8500%)
Took 8753.849156618118 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.004076
Train set: Average loss: 0.0179
Valid set: Average loss: 3.1382, Accuracy: 37887/60000 (63%)
Took 8782.307929039001 seconds.
Test set: Average loss: 1.5910, Top-1 Accuracy: 4736/6000 (78.9333%)
Took 8783.217440128326 seconds.
Test set: Average loss: 1.5910, Top-5 Accuracy: 5828.0/6000 (97.1333%)
Took 8783.217440128326 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.000884
Train set: Average loss: 0.0027
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 3.1944, Accuracy: 38072/60000 (63%)
Took 8811.650104761124 seconds.
Test set: Average loss: 1.6886, Top-1 Accuracy: 4729/6000 (78.8167%)
Took 8812.561141729355 seconds.
Test set: Average loss: 1.6886, Top-5 Accuracy: 5810.0/6000 (96.8333%)
Took 8812.561141729355 seconds.

----- Layer 5, Node 8, Epoch 28/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.000556
Train set: Average loss: 0.0016
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 3.2801, Accuracy: 38112/60000 (64%)
Took 8840.893139362335 seconds.
Test set: Average loss: 1.7280, Top-1 Accuracy: 4737/6000 (78.9500%)
Took 8841.80456495285 seconds.
Test set: Average loss: 1.7280, Top-5 Accuracy: 5809.0/6000 (96.8167%)
Took 8841.80456495285 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.7280, Top-1 Accuracy: 4737/6000 (78.9500%)
Took 8842.756858587265 seconds.
Test set: Average loss: 1.7280, Top-5 Accuracy: 5809.0/6000 (96.8167%)
Took 8842.756858587265 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 3.4666, Top-1 Accuracy: 3411/6000 (56.8500%)
Took 8843.662694454193 seconds.
Test set: Average loss: 3.4666, Top-5 Accuracy: 5347.0/6000 (89.1167%)
Took 8843.662694454193 seconds.
Test set: Average loss: 2.8657, Top-1 Accuracy: 4040/6000 (67.3333%)
Took 8844.71535205841 seconds.
Test set: Average loss: 2.8657, Top-5 Accuracy: 5444.0/6000 (90.7333%)
Took 8844.71535205841 seconds.
Test set: Average loss: 4.3509, Top-1 Accuracy: 3058/6000 (50.9667%)
Took 8846.21478509903 seconds.
Test set: Average loss: 4.3509, Top-5 Accuracy: 4953.0/6000 (82.5500%)
Took 8846.21478509903 seconds.
Test set: Average loss: 1.9834, Top-1 Accuracy: 4615/6000 (76.9167%)
Took 8848.351330280304 seconds.
Test set: Average loss: 1.9834, Top-5 Accuracy: 5729.0/6000 (95.4833%)
Took 8848.351330280304 seconds.
Test set: Average loss: 2.7011, Top-1 Accuracy: 4117/6000 (68.6167%)
Took 8850.652258396149 seconds.
Test set: Average loss: 2.7011, Top-5 Accuracy: 5616.0/6000 (93.6000%)
Took 8850.652258396149 seconds.
Test set: Average loss: 2.8074, Top-1 Accuracy: 4056/6000 (67.6000%)
Took 8851.902635335922 seconds.
Test set: Average loss: 2.8074, Top-5 Accuracy: 5558.0/6000 (92.6333%)
Took 8851.902635335922 seconds.
Test set: Average loss: 6.0867, Top-1 Accuracy: 2154/6000 (35.9000%)
Took 8852.954639196396 seconds.
Test set: Average loss: 6.0867, Top-5 Accuracy: 4390.0/6000 (73.1667%)
Took 8852.954639196396 seconds.
Test set: Average loss: 1.6121, Top-1 Accuracy: 4767/6000 (79.4500%)
Took 8854.003583908081 seconds.
Test set: Average loss: 1.6121, Top-5 Accuracy: 5814.0/6000 (96.9000%)
Took 8854.003583908081 seconds.
Test set: Average loss: 2.8720, Top-1 Accuracy: 4066/6000 (67.7667%)
Took 8855.477414369583 seconds.
Test set: Average loss: 2.8720, Top-5 Accuracy: 5511.0/6000 (91.8500%)
Took 8855.477414369583 seconds.
Test set: Average loss: 1.7280, Top-1 Accuracy: 4737/6000 (78.9500%)
Took 8856.389990329742 seconds.
Test set: Average loss: 1.7280, Top-5 Accuracy: 5809.0/6000 (96.8167%)
Took 8856.389990329742 seconds.

Average Top-1 accuracy: tensor(65.0350)

----- Top1 acc: [83.66666412353516, 82.88333129882812, 75.26667022705078, 71.54583740234375, 68.95333099365234, 66.24444580078125, 65.12380981445312, 65.80000305175781, 63.90185546875, 65.03499603271484]
----- Top5 acc: [99.71666717529297, 99.16667175292969, 97.20555114746094, 94.10416412353516, 94.4000015258789, 90.7027816772461, 90.42143249511719, 92.0250015258789, 89.87223052978516, 90.28500366210938]
