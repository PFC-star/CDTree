root@828b5a21edb1:/workspace/CDTree# sh train_init.sh
Files already downloaded and verified
Files already downloaded and verified
============== Performance on task 0 =================
/workspace/CDTree/utils/models.py:1070: UserWarning: Implicit dimension choice for log_softmax has been deprecated. Change the call to inc
  return F.log_softmax(out)
/opt/conda/lib/python3.7/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use
  warnings.warn(warning.format(ret))
Test set: Average loss: 1.2063, Top-1 Accuracy: 5020/6000 (83.6667%)
Took 4.059726238250732 seconds.
Test set: Average loss: 1.2063, Top-5 Accuracy: 5983.0/6000 (99.7167%)
Took 4.059726238250732 seconds.

----- Top1 acc: [83.66666412353516]
----- Top5 acc: [99.71666717529297]
============== Continual learning on task 1 =================

[before adaption and growth]
Test set: Average loss: 2.0534, Top-1 Accuracy: 4276/6000 (71.2667%)
Took 5.194459438323975 seconds.
Test set: Average loss: 2.0534, Top-5 Accuracy: 5934.0/6000 (98.9000%)
Took 5.194459438323975 seconds.
old_data shape: torch.Size([25000, 3072])
new_data_1 shape: torch.Size([25000, 3072])
MMD loss:tensor(0.3035, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[2]
tensor([1.], device='cuda:0')
[2]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 2.0534, Top-1 Accuracy: 4276/6000 (71.2667%)
Took 17.915783166885376 seconds.
Test set: Average loss: 2.0534, Top-5 Accuracy: 5934.0/6000 (98.9000%)
Took 17.915783166885376 seconds.
False
False
False

Perform global training

----- Layer 1, Node 1, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.390177
Train set: Average loss: 0.5554
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8371, Accuracy: 8262/12000 (69%)
Took 33.93138027191162 seconds.
Test set: Average loss: 1.9357, Top-1 Accuracy: 3917/6000 (65.2833%)
Took 34.954049587249756 seconds.
Test set: Average loss: 1.9357, Top-5 Accuracy: 5866.0/6000 (97.7667%)
Took 34.954049587249756 seconds.

----- Layer 1, Node 1, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.283027
Train set: Average loss: 0.3313
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7758, Accuracy: 8379/12000 (70%)
Took 51.033886432647705 seconds.
Test set: Average loss: 1.9507, Top-1 Accuracy: 3953/6000 (65.8833%)
Took 52.056214809417725 seconds.
Test set: Average loss: 1.9507, Top-5 Accuracy: 5923.0/6000 (98.7167%)
Took 52.056214809417725 seconds.

----- Layer 1, Node 1, Epoch 3/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.239082
Train set: Average loss: 0.2597
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.6393, Accuracy: 8649/12000 (72%)
Took 68.04865884780884 seconds.
Test set: Average loss: 1.7227, Top-1 Accuracy: 4147/6000 (69.1167%)
Took 69.06936430931091 seconds.
Test set: Average loss: 1.7227, Top-5 Accuracy: 5959.0/6000 (99.3167%)
Took 69.06936430931091 seconds.

----- Layer 1, Node 1, Epoch 4/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.215665
Train set: Average loss: 0.2284
Valid set: Average loss: 2.2375, Accuracy: 8326/12000 (69%)
Took 85.1108295917511 seconds.
Test set: Average loss: 2.3097, Top-1 Accuracy: 4027/6000 (67.1167%)
Took 86.15366768836975 seconds.
Test set: Average loss: 2.3097, Top-5 Accuracy: 5913.0/6000 (98.5500%)
Took 86.15366768836975 seconds.

----- Layer 1, Node 1, Epoch 5/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.180765
Train set: Average loss: 0.2033
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8963, Accuracy: 8662/12000 (72%)
Took 102.38317513465881 seconds.
Test set: Average loss: 1.9639, Top-1 Accuracy: 4181/6000 (69.6833%)
Took 103.44145727157593 seconds.
Test set: Average loss: 1.9639, Top-5 Accuracy: 5947.0/6000 (99.1167%)
Took 103.44145727157593 seconds.

----- Layer 1, Node 1, Epoch 6/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.151233
Train set: Average loss: 0.1760
Valid set: Average loss: 2.5215, Accuracy: 8132/12000 (68%)
Took 119.43197178840637 seconds.
Test set: Average loss: 2.6265, Top-1 Accuracy: 3921/6000 (65.3500%)
Took 120.45125484466553 seconds.
Test set: Average loss: 2.6265, Top-5 Accuracy: 5946.0/6000 (99.1000%)
Took 120.45125484466553 seconds.

----- Layer 1, Node 1, Epoch 7/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.128669
Train set: Average loss: 0.1643
Valid set: Average loss: 2.0159, Accuracy: 8570/12000 (71%)
Took 136.713228225708 seconds.
Test set: Average loss: 2.0478, Top-1 Accuracy: 4189/6000 (69.8167%)
Took 137.7480013370514 seconds.
Test set: Average loss: 2.0478, Top-5 Accuracy: 5946.0/6000 (99.1000%)
Took 137.7480013370514 seconds.

----- Layer 1, Node 1, Epoch 8/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.121860
Train set: Average loss: 0.1429
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.6977, Accuracy: 8950/12000 (75%)
Took 153.33282947540283 seconds.
Test set: Average loss: 1.6491, Top-1 Accuracy: 4418/6000 (73.6333%)
Took 154.3189947605133 seconds.
Test set: Average loss: 1.6491, Top-5 Accuracy: 5956.0/6000 (99.2667%)
Took 154.3189947605133 seconds.

----- Layer 1, Node 1, Epoch 9/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.104334
Train set: Average loss: 0.1235
Valid set: Average loss: 1.8254, Accuracy: 8947/12000 (75%)
Took 169.8390920162201 seconds.
Test set: Average loss: 1.8220, Top-1 Accuracy: 4413/6000 (73.5500%)
Took 170.85532116889954 seconds.
Test set: Average loss: 1.8220, Top-5 Accuracy: 5949.0/6000 (99.1500%)
Took 170.85532116889954 seconds.

----- Layer 1, Node 1, Epoch 10/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.106805
Train set: Average loss: 0.1186
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7758, Accuracy: 8995/12000 (75%)
Took 186.7645721435547 seconds.
Test set: Average loss: 1.6410, Top-1 Accuracy: 4470/6000 (74.5000%)
Took 187.80438017845154 seconds.
Test set: Average loss: 1.6410, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 187.80438017845154 seconds.

----- Layer 1, Node 1, Epoch 11/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.107058
Train set: Average loss: 0.1138
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.6805, Accuracy: 9010/12000 (75%)
Took 203.9760925769806 seconds.
Test set: Average loss: 1.8779, Top-1 Accuracy: 4362/6000 (72.7000%)
Took 204.99576616287231 seconds.
Test set: Average loss: 1.8779, Top-5 Accuracy: 5926.0/6000 (98.7667%)
Took 204.99576616287231 seconds.

----- Layer 1, Node 1, Epoch 12/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.100269
Train set: Average loss: 0.1021
Valid set: Average loss: 1.7238, Accuracy: 8940/12000 (74%)
Took 221.056321144104 seconds.
Test set: Average loss: 1.8013, Top-1 Accuracy: 4366/6000 (72.7667%)
Took 222.08203196525574 seconds.
Test set: Average loss: 1.8013, Top-5 Accuracy: 5934.0/6000 (98.9000%)
Took 222.08203196525574 seconds.

----- Layer 1, Node 1, Epoch 13/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.085988
Train set: Average loss: 0.0934
Valid set: Average loss: 2.2619, Accuracy: 8738/12000 (73%)
Took 238.08626866340637 seconds.
Test set: Average loss: 2.4902, Top-1 Accuracy: 4208/6000 (70.1333%)
Took 239.12032461166382 seconds.
Test set: Average loss: 2.4902, Top-5 Accuracy: 5899.0/6000 (98.3167%)
Took 239.12032461166382 seconds.

----- Layer 1, Node 1, Epoch 14/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.073834
Train set: Average loss: 0.0894
Valid set: Average loss: 2.2175, Accuracy: 8721/12000 (73%)
Took 255.0535385608673 seconds.
Test set: Average loss: 2.2381, Top-1 Accuracy: 4297/6000 (71.6167%)
Took 256.0996255874634 seconds.
Test set: Average loss: 2.2381, Top-5 Accuracy: 5927.0/6000 (98.7833%)
Took 256.0996255874634 seconds.

----- Layer 1, Node 1, Epoch 15/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.099964
Train set: Average loss: 0.0827
Valid set: Average loss: 1.9460, Accuracy: 9003/12000 (75%)
Took 272.0185694694519 seconds.
Test set: Average loss: 2.0189, Top-1 Accuracy: 4383/6000 (73.0500%)
Took 273.04330801963806 seconds.
Test set: Average loss: 2.0189, Top-5 Accuracy: 5938.0/6000 (98.9667%)
Took 273.04330801963806 seconds.

----- Layer 1, Node 1, Epoch 16/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.109382
Train set: Average loss: 0.0933
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8761, Accuracy: 9182/12000 (77%)
Took 289.0545766353607 seconds.
Test set: Average loss: 1.8989, Top-1 Accuracy: 4489/6000 (74.8167%)
Took 290.0786623954773 seconds.
Test set: Average loss: 1.8989, Top-5 Accuracy: 5962.0/6000 (99.3667%)
Took 290.0786623954773 seconds.

----- Layer 1, Node 1, Epoch 17/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.063526
Train set: Average loss: 0.0797
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7311, Accuracy: 9203/12000 (77%)
Took 306.0313341617584 seconds.
Test set: Average loss: 1.8592, Top-1 Accuracy: 4410/6000 (73.5000%)
Took 307.05375838279724 seconds.
Test set: Average loss: 1.8592, Top-5 Accuracy: 5965.0/6000 (99.4167%)
Took 307.05375838279724 seconds.

----- Layer 1, Node 1, Epoch 18/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.054749
Train set: Average loss: 0.0710
Valid set: Average loss: 1.7265, Accuracy: 9115/12000 (76%)
Took 323.2855007648468 seconds.
Test set: Average loss: 1.6670, Top-1 Accuracy: 4501/6000 (75.0167%)
Took 324.3299894332886 seconds.
Test set: Average loss: 1.6670, Top-5 Accuracy: 5950.0/6000 (99.1667%)
Took 324.3299894332886 seconds.

----- Layer 1, Node 1, Epoch 19/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.071260
Train set: Average loss: 0.0591
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7423, Accuracy: 9261/12000 (77%)
Took 340.5809373855591 seconds.
Test set: Average loss: 1.4791, Top-1 Accuracy: 4681/6000 (78.0167%)
Took 341.617148399353 seconds.
Test set: Average loss: 1.4791, Top-5 Accuracy: 5953.0/6000 (99.2167%)
Took 341.617148399353 seconds.

----- Layer 1, Node 1, Epoch 20/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.044477
Train set: Average loss: 0.0479
Valid set: Average loss: 2.0399, Accuracy: 9070/12000 (76%)
Took 357.8885221481323 seconds.
Test set: Average loss: 2.0208, Top-1 Accuracy: 4459/6000 (74.3167%)
Took 358.9246380329132 seconds.
Test set: Average loss: 2.0208, Top-5 Accuracy: 5933.0/6000 (98.8833%)
Took 358.9246380329132 seconds.

----- Layer 1, Node 1, Epoch 21/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.053721
Train set: Average loss: 0.0579
Valid set: Average loss: 1.8588, Accuracy: 9153/12000 (76%)
Took 375.111207485199 seconds.
Test set: Average loss: 1.5639, Top-1 Accuracy: 4682/6000 (78.0333%)
Took 376.1355872154236 seconds.
Test set: Average loss: 1.5639, Top-5 Accuracy: 5938.0/6000 (98.9667%)
Took 376.1355872154236 seconds.

----- Layer 1, Node 1, Epoch 22/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.047691
Train set: Average loss: 0.0494
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.5840, Accuracy: 9532/12000 (79%)
Took 392.2268633842468 seconds.
Test set: Average loss: 1.4777, Top-1 Accuracy: 4776/6000 (79.6000%)
Took 393.25615906715393 seconds.
Test set: Average loss: 1.4777, Top-5 Accuracy: 5914.0/6000 (98.5667%)
Took 393.25615906715393 seconds.

----- Layer 1, Node 1, Epoch 23/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.063976
Train set: Average loss: 0.0532
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.3000, Accuracy: 9724/12000 (81%)
Took 409.5298569202423 seconds.
Test set: Average loss: 1.1785, Top-1 Accuracy: 4882/6000 (81.3667%)
Took 410.56496000289917 seconds.
Test set: Average loss: 1.1785, Top-5 Accuracy: 5942.0/6000 (99.0333%)
Took 410.56496000289917 seconds.

----- Layer 1, Node 1, Epoch 24/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.062911
Train set: Average loss: 0.0545
Valid set: Average loss: 1.8453, Accuracy: 9327/12000 (78%)
Took 426.70063948631287 seconds.
Test set: Average loss: 2.0836, Top-1 Accuracy: 4508/6000 (75.1333%)
Took 427.7395181655884 seconds.
Test set: Average loss: 2.0836, Top-5 Accuracy: 5941.0/6000 (99.0167%)
Took 427.7395181655884 seconds.

----- Layer 1, Node 1, Epoch 25/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.046596
Train set: Average loss: 0.0528
Valid set: Average loss: 2.2044, Accuracy: 8723/12000 (73%)
Took 443.77565598487854 seconds.
Test set: Average loss: 2.0883, Top-1 Accuracy: 4368/6000 (72.8000%)
Took 444.8219931125641 seconds.
Test set: Average loss: 2.0883, Top-5 Accuracy: 5899.0/6000 (98.3167%)
Took 444.8219931125641 seconds.

----- Layer 1, Node 1, Epoch 26/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.006879
Train set: Average loss: 0.0247
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.3967, Accuracy: 9761/12000 (81%)
Took 460.85720348358154 seconds.
Test set: Average loss: 1.1762, Top-1 Accuracy: 4967/6000 (82.7833%)
Took 461.8852095603943 seconds.
Test set: Average loss: 1.1762, Top-5 Accuracy: 5964.0/6000 (99.4000%)
Took 461.8852095603943 seconds.

----- Layer 1, Node 1, Epoch 27/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.002317
Train set: Average loss: 0.0061
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.4122, Accuracy: 9818/12000 (82%)
Took 477.92882657051086 seconds.
Test set: Average loss: 1.2645, Top-1 Accuracy: 4947/6000 (82.4500%)
Took 478.9558033943176 seconds.
Test set: Average loss: 1.2645, Top-5 Accuracy: 5967.0/6000 (99.4500%)
Took 478.9558033943176 seconds.

----- Layer 1, Node 1, Epoch 28/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.001052
Train set: Average loss: 0.0031
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.4828, Accuracy: 9828/12000 (82%)
Took 495.029283285141 seconds.
Test set: Average loss: 1.3341, Top-1 Accuracy: 4952/6000 (82.5333%)
Took 496.0636067390442 seconds.
Test set: Average loss: 1.3341, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 496.0636067390442 seconds.

----- Layer 1, Node 1, Epoch 29/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.000739
Train set: Average loss: 0.0023
Valid set: Average loss: 1.5802, Accuracy: 9783/12000 (82%)
Took 512.1152722835541 seconds.
Test set: Average loss: 1.4430, Top-1 Accuracy: 4916/6000 (81.9333%)
Took 513.141175031662 seconds.
Test set: Average loss: 1.4430, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 513.141175031662 seconds.

----- Layer 1, Node 1, Epoch 30/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.000539
Train set: Average loss: 0.0022
Valid set: Average loss: 1.6040, Accuracy: 9798/12000 (82%)
Took 529.0592772960663 seconds.
Test set: Average loss: 1.4733, Top-1 Accuracy: 4917/6000 (81.9500%)
Took 530.0671226978302 seconds.
Test set: Average loss: 1.4733, Top-5 Accuracy: 5958.0/6000 (99.3000%)
Took 530.0671226978302 seconds.
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.3341, Top-1 Accuracy: 4952/6000 (82.5333%)
Took 531.0999257564545 seconds.
Test set: Average loss: 1.3341, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 531.0999257564545 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 1.6316, Top-1 Accuracy: 4876/6000 (81.2667%)
Took 531.9661452770233 seconds.
Test set: Average loss: 1.6316, Top-5 Accuracy: 5915.0/6000 (98.5833%)
Took 531.9661452770233 seconds.
Test set: Average loss: 1.3341, Top-1 Accuracy: 4952/6000 (82.5333%)
Took 532.9894711971283 seconds.
Test set: Average loss: 1.3341, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 532.9894711971283 seconds.

Average Top-1 accuracy: tensor(81.9000)

----- Top1 acc: [83.66666412353516, 81.9000015258789]
----- Top5 acc: [99.71666717529297, 98.95833587646484]
============== Continual learning on task 2 =================

[before adaption and growth]
Test set: Average loss: 5.1534, Top-1 Accuracy: 1783/6000 (29.7167%)
Took 534.5335946083069 seconds.
Test set: Average loss: 5.1534, Top-5 Accuracy: 5249.0/6000 (87.4833%)
Took 534.5335946083069 seconds.
old_data shape: torch.Size([20000, 3072])
new_data_1 shape: torch.Size([20000, 3072])
MMD loss:tensor(1.3463, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[2]
tensor([1.], device='cuda:0')
[2]
---------------------------------------------------------------

At layer 2

Processing node 2
---------------- data shape before/after transformer -------------
[1, 64, 4, 4] <class 'list'>
(1, 64, 4, 4) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 4, 4] <class 'list'>
(1, 64, 4, 4) <class 'tuple'>
torch.Size([1, 64, 4, 4])
---------------- data shape before/after transformer -------------
[1, 64, 4, 4] <class 'list'>
torch.Size([1, 64, 2, 2]) <class 'torch.Size'>
/workspace/CDTree/utils/models.py:819: UserWarning: Router kernel too large, shrink it
  warnings.warn('Router kernel too large, shrink it')

---------- Optimizing a binary split ------------
True
True
False

Selectively optimising the parameters below:
          tree_modules.2.router.conv1.weight
          tree_modules.2.router.conv1.bias
          tree_modules.2.router.linear1.weight
          tree_modules.2.router.linear1.bias
          child_left.classifier.fc1.weight
          child_left.classifier.fc1.bias
          child_left.classifier.fc2.weight
          child_left.classifier.fc2.bias
          child_left.classifier.fc3.weight
          child_left.classifier.fc3.bias
          child_right.classifier.fc1.weight
          child_right.classifier.fc1.bias
          child_right.classifier.fc2.weight
          child_right.classifier.fc2.bias
          child_right.classifier.fc3.weight
          child_right.classifier.fc3.bias

----- Layer 2, Node 2, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 1.075763
Train set: Average loss: 1.1337
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1380, Accuracy: 3358/6000 (56%)
Took 556.8646881580353 seconds.
Test set: Average loss: 1.1380, Top-1 Accuracy: 3358/6000 (55.9667%)
Took 558.3146419525146 seconds.
Test set: Average loss: 1.1380, Top-5 Accuracy: 5907.0/6000 (98.4500%)
Took 558.3146419525146 seconds.

----- Layer 2, Node 2, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.991853
Train set: Average loss: 1.0318
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1252, Accuracy: 3420/6000 (57%)
Took 569.2698304653168 seconds.
Test set: Average loss: 1.1252, Top-1 Accuracy: 3420/6000 (57.0000%)
Took 570.7057819366455 seconds.
Test set: Average loss: 1.1252, Top-5 Accuracy: 5913.0/6000 (98.5500%)
Took 570.7057819366455 seconds.

----- Layer 2, Node 2, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.971821
Train set: Average loss: 1.0082
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.1117, Accuracy: 3451/6000 (58%)
Took 581.6521596908569 seconds.
Test set: Average loss: 1.1117, Top-1 Accuracy: 3451/6000 (57.5167%)
Took 583.0878791809082 seconds.
Test set: Average loss: 1.1117, Top-5 Accuracy: 5913.0/6000 (98.5500%)
Took 583.0878791809082 seconds.

----- Layer 2, Node 2, Epoch 4/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.964925
Train set: Average loss: 0.9942
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.0910, Accuracy: 3501/6000 (58%)
Took 593.9982678890228 seconds.
Test set: Average loss: 1.0910, Top-1 Accuracy: 3501/6000 (58.3500%)
Took 595.4312596321106 seconds.
Test set: Average loss: 1.0910, Top-5 Accuracy: 5924.0/6000 (98.7333%)
Took 595.4312596321106 seconds.

----- Layer 2, Node 2, Epoch 5/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.954037
Train set: Average loss: 0.9844
Valid set: Average loss: 1.0960, Accuracy: 3496/6000 (58%)
Took 606.3864831924438 seconds.
Test set: Average loss: 1.0960, Top-1 Accuracy: 3496/6000 (58.2667%)
Took 607.8168506622314 seconds.
Test set: Average loss: 1.0960, Top-5 Accuracy: 5922.0/6000 (98.7000%)
Took 607.8168506622314 seconds.

----- Layer 2, Node 2, Epoch 6/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.946324
Train set: Average loss: 0.9766
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.0863, Accuracy: 3546/6000 (59%)
Took 618.7739269733429 seconds.
Test set: Average loss: 1.0863, Top-1 Accuracy: 3546/6000 (59.1000%)
Took 620.213436126709 seconds.
Test set: Average loss: 1.0863, Top-5 Accuracy: 5920.0/6000 (98.6667%)
Took 620.213436126709 seconds.

----- Layer 2, Node 2, Epoch 7/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.941325
Train set: Average loss: 0.9716
Valid set: Average loss: 1.1096, Accuracy: 3513/6000 (59%)
Took 631.1565012931824 seconds.
Test set: Average loss: 1.1096, Top-1 Accuracy: 3513/6000 (58.5500%)
Took 632.5927777290344 seconds.
Test set: Average loss: 1.1096, Top-5 Accuracy: 5919.0/6000 (98.6500%)
Took 632.5927777290344 seconds.

----- Layer 2, Node 2, Epoch 8/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.942394
Train set: Average loss: 0.9680
Valid set: Average loss: 1.1265, Accuracy: 3491/6000 (58%)
Took 643.578780412674 seconds.
Test set: Average loss: 1.1265, Top-1 Accuracy: 3491/6000 (58.1833%)
Took 645.0097072124481 seconds.
Test set: Average loss: 1.1265, Top-5 Accuracy: 5913.0/6000 (98.5500%)
Took 645.0097072124481 seconds.

----- Layer 2, Node 2, Epoch 9/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.935263
Train set: Average loss: 0.9622
Valid set: Average loss: 1.1372, Accuracy: 3498/6000 (58%)
Took 655.9283170700073 seconds.
Test set: Average loss: 1.1372, Top-1 Accuracy: 3498/6000 (58.3000%)
Took 657.3732583522797 seconds.
Test set: Average loss: 1.1372, Top-5 Accuracy: 5912.0/6000 (98.5333%)
Took 657.3732583522797 seconds.

----- Layer 2, Node 2, Epoch 10/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.932927
Train set: Average loss: 0.9563
Valid set: Average loss: 1.1266, Accuracy: 3482/6000 (58%)
Took 668.2449722290039 seconds.
Test set: Average loss: 1.1266, Top-1 Accuracy: 3482/6000 (58.0333%)
Took 669.6750345230103 seconds.
Test set: Average loss: 1.1266, Top-5 Accuracy: 5911.0/6000 (98.5167%)
Took 669.6750345230103 seconds.

----- Layer 2, Node 2, Epoch 11/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.927700
Train set: Average loss: 0.9513
Valid set: Average loss: 1.1271, Accuracy: 3456/6000 (58%)
Took 680.5836336612701 seconds.
Test set: Average loss: 1.1271, Top-1 Accuracy: 3456/6000 (57.6000%)
Took 682.0160973072052 seconds.
Test set: Average loss: 1.1271, Top-5 Accuracy: 5910.0/6000 (98.5000%)
Took 682.0160973072052 seconds.

----- Layer 2, Node 2, Epoch 12/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.919485
Train set: Average loss: 0.9442
Valid set: Average loss: 1.1350, Accuracy: 3449/6000 (57%)
Took 692.9192643165588 seconds.
Test set: Average loss: 1.1350, Top-1 Accuracy: 3449/6000 (57.4833%)
Took 694.3723411560059 seconds.
Test set: Average loss: 1.1350, Top-5 Accuracy: 5909.0/6000 (98.4833%)
Took 694.3723411560059 seconds.

----- Layer 2, Node 2, Epoch 13/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.915949
Train set: Average loss: 0.9399
Valid set: Average loss: 1.1200, Accuracy: 3477/6000 (58%)
Took 705.2404792308807 seconds.
Test set: Average loss: 1.1200, Top-1 Accuracy: 3477/6000 (57.9500%)
Took 706.6680972576141 seconds.
Test set: Average loss: 1.1200, Top-5 Accuracy: 5908.0/6000 (98.4667%)
Took 706.6680972576141 seconds.

----- Layer 2, Node 2, Epoch 14/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.916180
Train set: Average loss: 0.9374
Valid set: Average loss: 1.1224, Accuracy: 3468/6000 (58%)
Took 717.727114200592 seconds.
Test set: Average loss: 1.1224, Top-1 Accuracy: 3468/6000 (57.8000%)
Took 719.1552584171295 seconds.
Test set: Average loss: 1.1224, Top-5 Accuracy: 5911.0/6000 (98.5167%)
Took 719.1552584171295 seconds.

----- Layer 2, Node 2, Epoch 15/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.912727
Train set: Average loss: 0.9318
Valid set: Average loss: 1.1208, Accuracy: 3475/6000 (58%)
Took 730.0266070365906 seconds.
Test set: Average loss: 1.1208, Top-1 Accuracy: 3475/6000 (57.9167%)
Took 731.4864981174469 seconds.
Test set: Average loss: 1.1208, Top-5 Accuracy: 5913.0/6000 (98.5500%)
Took 731.4864981174469 seconds.

----- Layer 2, Node 2, Epoch 16/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.907292
Train set: Average loss: 0.9291
Valid set: Average loss: 1.1118, Accuracy: 3483/6000 (58%)
Took 742.4945209026337 seconds.
Test set: Average loss: 1.1118, Top-1 Accuracy: 3483/6000 (58.0500%)
Took 743.9405319690704 seconds.
Test set: Average loss: 1.1118, Top-5 Accuracy: 5906.0/6000 (98.4333%)
Took 743.9405319690704 seconds.

----- Layer 2, Node 2, Epoch 17/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.908103
Train set: Average loss: 0.9249
Valid set: Average loss: 1.1090, Accuracy: 3515/6000 (59%)
Took 754.9790909290314 seconds.
Test set: Average loss: 1.1090, Top-1 Accuracy: 3515/6000 (58.5833%)
Took 756.4290728569031 seconds.
Test set: Average loss: 1.1090, Top-5 Accuracy: 5914.0/6000 (98.5667%)
Took 756.4290728569031 seconds.

----- Layer 2, Node 2, Epoch 18/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.899435
Train set: Average loss: 0.9218
Valid set: Average loss: 1.1165, Accuracy: 3485/6000 (58%)
Took 767.4461653232574 seconds.
Test set: Average loss: 1.1165, Top-1 Accuracy: 3485/6000 (58.0833%)
Took 769.0461497306824 seconds.
Test set: Average loss: 1.1165, Top-5 Accuracy: 5909.0/6000 (98.4833%)
Took 769.0461497306824 seconds.

----- Layer 2, Node 2, Epoch 19/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.898798
Train set: Average loss: 0.9187
Valid set: Average loss: 1.1079, Accuracy: 3519/6000 (59%)
Took 780.0710978507996 seconds.
Test set: Average loss: 1.1079, Top-1 Accuracy: 3519/6000 (58.6500%)
Took 781.5191061496735 seconds.
Test set: Average loss: 1.1079, Top-5 Accuracy: 5921.0/6000 (98.6833%)
Took 781.5191061496735 seconds.

----- Layer 2, Node 2, Epoch 20/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.896236
Train set: Average loss: 0.9155
Valid set: Average loss: 1.1004, Accuracy: 3520/6000 (59%)
Took 792.4342727661133 seconds.
Test set: Average loss: 1.1004, Top-1 Accuracy: 3520/6000 (58.6667%)
Took 793.8357236385345 seconds.
Test set: Average loss: 1.1004, Top-5 Accuracy: 5925.0/6000 (98.7500%)
Took 793.8357236385345 seconds.

----- Layer 2, Node 2, Epoch 21/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.892363
Train set: Average loss: 0.9159
Valid set: Average loss: 1.1201, Accuracy: 3484/6000 (58%)
Took 804.4700968265533 seconds.
Test set: Average loss: 1.1201, Top-1 Accuracy: 3484/6000 (58.0667%)
Took 805.8946897983551 seconds.
Test set: Average loss: 1.1201, Top-5 Accuracy: 5917.0/6000 (98.6167%)
Took 805.8946897983551 seconds.

----- Layer 2, Node 2, Epoch 22/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.892920
Train set: Average loss: 0.9085
Valid set: Average loss: 1.1167, Accuracy: 3489/6000 (58%)
Took 816.6025803089142 seconds.
Test set: Average loss: 1.1167, Top-1 Accuracy: 3489/6000 (58.1500%)
Took 817.9887311458588 seconds.
Test set: Average loss: 1.1167, Top-5 Accuracy: 5915.0/6000 (98.5833%)
Took 817.9887311458588 seconds.

----- Layer 2, Node 2, Epoch 23/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.890355
Train set: Average loss: 0.9081
Valid set: Average loss: 1.1139, Accuracy: 3507/6000 (58%)
Took 828.6276383399963 seconds.
Test set: Average loss: 1.1139, Top-1 Accuracy: 3507/6000 (58.4500%)
Took 830.0089573860168 seconds.
Test set: Average loss: 1.1139, Top-5 Accuracy: 5916.0/6000 (98.6000%)
Took 830.0089573860168 seconds.

----- Layer 2, Node 2, Epoch 24/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.883368
Train set: Average loss: 0.9016
Valid set: Average loss: 1.1012, Accuracy: 3522/6000 (59%)
Took 840.5167706012726 seconds.
Test set: Average loss: 1.1012, Top-1 Accuracy: 3522/6000 (58.7000%)
Took 841.8956053256989 seconds.
Test set: Average loss: 1.1012, Top-5 Accuracy: 5914.0/6000 (98.5667%)
Took 841.8956053256989 seconds.

----- Layer 2, Node 2, Epoch 25/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.884024
Train set: Average loss: 0.8954
Valid set: Average loss: 1.1171, Accuracy: 3528/6000 (59%)
Took 852.492448091507 seconds.
Test set: Average loss: 1.1171, Top-1 Accuracy: 3528/6000 (58.8000%)
Took 853.8737194538116 seconds.
Test set: Average loss: 1.1171, Top-5 Accuracy: 5907.0/6000 (98.4500%)
Took 853.8737194538116 seconds.

----- Layer 2, Node 2, Epoch 26/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.839368
Train set: Average loss: 0.8723
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.0800, Accuracy: 3603/6000 (60%)
Took 864.4321610927582 seconds.
Test set: Average loss: 1.0800, Top-1 Accuracy: 3603/6000 (60.0500%)
Took 865.8299024105072 seconds.
Test set: Average loss: 1.0800, Top-5 Accuracy: 5919.0/6000 (98.6500%)
Took 865.8299024105072 seconds.

----- Layer 2, Node 2, Epoch 27/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.836242
Train set: Average loss: 0.8618
Valid set: Average loss: 1.0862, Accuracy: 3601/6000 (60%)
Took 876.3547434806824 seconds.
Test set: Average loss: 1.0862, Top-1 Accuracy: 3601/6000 (60.0167%)
Took 877.7387707233429 seconds.
Test set: Average loss: 1.0862, Top-5 Accuracy: 5920.0/6000 (98.6667%)
Took 877.7387707233429 seconds.

----- Layer 2, Node 2, Epoch 28/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.832167
Train set: Average loss: 0.8560
Valid set: Average loss: 1.0893, Accuracy: 3601/6000 (60%)
Took 888.3254673480988 seconds.
Test set: Average loss: 1.0893, Top-1 Accuracy: 3601/6000 (60.0167%)
Took 889.7127983570099 seconds.
Test set: Average loss: 1.0893, Top-5 Accuracy: 5920.0/6000 (98.6667%)
Took 889.7127983570099 seconds.

----- Layer 2, Node 2, Epoch 29/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.828609
Train set: Average loss: 0.8508
Valid set: Average loss: 1.0938, Accuracy: 3593/6000 (60%)
Took 900.2695987224579 seconds.
Test set: Average loss: 1.0938, Top-1 Accuracy: 3593/6000 (59.8833%)
Took 901.6905314922333 seconds.
Test set: Average loss: 1.0938, Top-5 Accuracy: 5919.0/6000 (98.6500%)
Took 901.6905314922333 seconds.

----- Layer 2, Node 2, Epoch 30/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.825276
Train set: Average loss: 0.8463
Valid set: Average loss: 1.0968, Accuracy: 3595/6000 (60%)
Took 912.2649159431458 seconds.
Test set: Average loss: 1.0968, Top-1 Accuracy: 3595/6000 (59.9167%)
Took 913.652491569519 seconds.
Test set: Average loss: 1.0968, Top-5 Accuracy: 5920.0/6000 (98.6667%)
Took 913.652491569519 seconds.
return the node-wise best split model
returning left and right children

----------- Optimizing an extension --------------
True
False
True

Selectively optimising the parameters below:
          child_extension.transform.conv1.weight
          child_extension.transform.conv1.bias
          child_extension.transform.conv2.weight
          child_extension.transform.conv2.bias
          child_extension.transform.bn1.weight
          child_extension.transform.bn1.bias
          child_extension.transform.bn2.weight
          child_extension.transform.bn2.bias
          child_extension.classifier.fc1.weight
          child_extension.classifier.fc1.bias
          child_extension.classifier.fc2.weight
          child_extension.classifier.fc2.bias
          child_extension.classifier.fc3.weight
          child_extension.classifier.fc3.bias

----- Layer 2, Node 2, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.946329
Train set: Average loss: 1.0506
Valid set: Average loss: 1.1122, Accuracy: 3542/6000 (59%)
Took 924.2240722179413 seconds.
Test set: Average loss: 1.1122, Top-1 Accuracy: 3542/6000 (59.0333%)
Took 925.6119523048401 seconds.
Test set: Average loss: 1.1122, Top-5 Accuracy: 5891.0/6000 (98.1833%)
Took 925.6119523048401 seconds.

----- Layer 2, Node 2, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.890996
Train set: Average loss: 0.9294
Valid set: Average loss: 1.0999, Accuracy: 3565/6000 (59%)
Took 936.1169528961182 seconds.
Test set: Average loss: 1.0999, Top-1 Accuracy: 3565/6000 (59.4167%)
Took 937.5025901794434 seconds.
Test set: Average loss: 1.0999, Top-5 Accuracy: 5910.0/6000 (98.5000%)
Took 937.5025901794434 seconds.

----- Layer 2, Node 2, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.854030
Train set: Average loss: 0.8841
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_ext.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_ext.json
Valid set: Average loss: 1.0959, Accuracy: 3612/6000 (60%)
Took 948.0713353157043 seconds.
Test set: Average loss: 1.0959, Top-1 Accuracy: 3612/6000 (60.2000%)
Took 949.4575924873352 seconds.
Test set: Average loss: 1.0959, Top-5 Accuracy: 5915.0/6000 (98.5833%)
Took 949.4575924873352 seconds.

----- Layer 2, Node 2, Epoch 4/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.819214
Train set: Average loss: 0.8496
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_ext.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_ext.json
Valid set: Average loss: 1.0778, Accuracy: 3642/6000 (61%)
Took 960.0334277153015 seconds.
Test set: Average loss: 1.0778, Top-1 Accuracy: 3642/6000 (60.7000%)
Took 961.431606054306 seconds.
Test set: Average loss: 1.0778, Top-5 Accuracy: 5919.0/6000 (98.6500%)
Took 961.431606054306 seconds.

----- Layer 2, Node 2, Epoch 5/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.792297
Train set: Average loss: 0.8183
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_ext.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_ext.json
Valid set: Average loss: 1.0641, Accuracy: 3701/6000 (62%)
Took 971.9152791500092 seconds.
Test set: Average loss: 1.0641, Top-1 Accuracy: 3701/6000 (61.6833%)
Took 973.3021969795227 seconds.
Test set: Average loss: 1.0641, Top-5 Accuracy: 5926.0/6000 (98.7667%)
Took 973.3021969795227 seconds.

----- Layer 2, Node 2, Epoch 6/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.772207
Train set: Average loss: 0.7887
Valid set: Average loss: 1.1200, Accuracy: 3643/6000 (61%)
Took 983.9875621795654 seconds.
Test set: Average loss: 1.1200, Top-1 Accuracy: 3643/6000 (60.7167%)
Took 985.3887150287628 seconds.
Test set: Average loss: 1.1200, Top-5 Accuracy: 5917.0/6000 (98.6167%)
Took 985.3887150287628 seconds.

----- Layer 2, Node 2, Epoch 7/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.739556
Train set: Average loss: 0.7587
Valid set: Average loss: 1.1347, Accuracy: 3645/6000 (61%)
Took 996.3757214546204 seconds.
Test set: Average loss: 1.1347, Top-1 Accuracy: 3645/6000 (60.7500%)
Took 997.8408238887787 seconds.
Test set: Average loss: 1.1347, Top-5 Accuracy: 5916.0/6000 (98.6000%)
Took 997.8408238887787 seconds.

----- Layer 2, Node 2, Epoch 8/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.719741
Train set: Average loss: 0.7294
Valid set: Average loss: 1.1457, Accuracy: 3628/6000 (60%)
Took 1008.8127825260162 seconds.
Test set: Average loss: 1.1457, Top-1 Accuracy: 3628/6000 (60.4667%)
Took 1010.2522666454315 seconds.
Test set: Average loss: 1.1457, Top-5 Accuracy: 5920.0/6000 (98.6667%)
Took 1010.2522666454315 seconds.

----- Layer 2, Node 2, Epoch 9/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.684008
Train set: Average loss: 0.6930
Valid set: Average loss: 1.2311, Accuracy: 3621/6000 (60%)
Took 1021.5272965431213 seconds.
Test set: Average loss: 1.2311, Top-1 Accuracy: 3621/6000 (60.3500%)
Took 1022.9818148612976 seconds.
Test set: Average loss: 1.2311, Top-5 Accuracy: 5894.0/6000 (98.2333%)
Took 1022.9818148612976 seconds.

----- Layer 2, Node 2, Epoch 10/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.666213
Train set: Average loss: 0.6646
Valid set: Average loss: 1.2975, Accuracy: 3592/6000 (60%)
Took 1034.0306227207184 seconds.
Test set: Average loss: 1.2975, Top-1 Accuracy: 3592/6000 (59.8667%)
Took 1035.51123046875 seconds.
Test set: Average loss: 1.2975, Top-5 Accuracy: 5896.0/6000 (98.2667%)
Took 1035.51123046875 seconds.

----- Layer 2, Node 2, Epoch 11/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.639658
Train set: Average loss: 0.6354
Valid set: Average loss: 1.2959, Accuracy: 3559/6000 (59%)
Took 1046.5345695018768 seconds.
Test set: Average loss: 1.2959, Top-1 Accuracy: 3559/6000 (59.3167%)
Took 1047.9895350933075 seconds.
Test set: Average loss: 1.2959, Top-5 Accuracy: 5897.0/6000 (98.2833%)
Took 1047.9895350933075 seconds.

----- Layer 2, Node 2, Epoch 12/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.588338
Train set: Average loss: 0.6007
Valid set: Average loss: 1.3482, Accuracy: 3486/6000 (58%)
Took 1058.9521901607513 seconds.
Test set: Average loss: 1.3482, Top-1 Accuracy: 3486/6000 (58.1000%)
Took 1060.3806211948395 seconds.
Test set: Average loss: 1.3482, Top-5 Accuracy: 5899.0/6000 (98.3167%)
Took 1060.3806211948395 seconds.

----- Layer 2, Node 2, Epoch 13/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.550438
Train set: Average loss: 0.5761
Valid set: Average loss: 1.3496, Accuracy: 3553/6000 (59%)
Took 1071.213050365448 seconds.
Test set: Average loss: 1.3496, Top-1 Accuracy: 3553/6000 (59.2167%)
Took 1072.6673922538757 seconds.
Test set: Average loss: 1.3496, Top-5 Accuracy: 5897.0/6000 (98.2833%)
Took 1072.6673922538757 seconds.

----- Layer 2, Node 2, Epoch 14/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.528444
Train set: Average loss: 0.5479
Valid set: Average loss: 1.4143, Accuracy: 3561/6000 (59%)
Took 1083.5673880577087 seconds.
Test set: Average loss: 1.4143, Top-1 Accuracy: 3561/6000 (59.3500%)
Took 1084.996927022934 seconds.
Test set: Average loss: 1.4143, Top-5 Accuracy: 5890.0/6000 (98.1667%)
Took 1084.996927022934 seconds.

----- Layer 2, Node 2, Epoch 15/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.499344
Train set: Average loss: 0.5281
Valid set: Average loss: 1.5815, Accuracy: 3472/6000 (58%)
Took 1095.963448524475 seconds.
Test set: Average loss: 1.5815, Top-1 Accuracy: 3472/6000 (57.8667%)
Took 1097.4108119010925 seconds.
Test set: Average loss: 1.5815, Top-5 Accuracy: 5881.0/6000 (98.0167%)
Took 1097.4108119010925 seconds.

----- Layer 2, Node 2, Epoch 16/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.465085
Train set: Average loss: 0.4926
Valid set: Average loss: 1.6538, Accuracy: 3490/6000 (58%)
Took 1108.3968660831451 seconds.
Test set: Average loss: 1.6538, Top-1 Accuracy: 3490/6000 (58.1667%)
Took 1109.8623068332672 seconds.
Test set: Average loss: 1.6538, Top-5 Accuracy: 5864.0/6000 (97.7333%)
Took 1109.8623068332672 seconds.

----- Layer 2, Node 2, Epoch 17/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.452850
Train set: Average loss: 0.4679
Valid set: Average loss: 1.9527, Accuracy: 3342/6000 (56%)
Took 1120.864785194397 seconds.
Test set: Average loss: 1.9527, Top-1 Accuracy: 3342/6000 (55.7000%)
Took 1122.3091704845428 seconds.
Test set: Average loss: 1.9527, Top-5 Accuracy: 5855.0/6000 (97.5833%)
Took 1122.3091704845428 seconds.

----- Layer 2, Node 2, Epoch 18/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.429599
Train set: Average loss: 0.4556
Valid set: Average loss: 1.8552, Accuracy: 3485/6000 (58%)
Took 1133.3440420627594 seconds.
Test set: Average loss: 1.8552, Top-1 Accuracy: 3485/6000 (58.0833%)
Took 1134.7933852672577 seconds.
Test set: Average loss: 1.8552, Top-5 Accuracy: 5836.0/6000 (97.2667%)
Took 1134.7933852672577 seconds.

----- Layer 2, Node 2, Epoch 19/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.415940
Train set: Average loss: 0.4304
Valid set: Average loss: 1.9253, Accuracy: 3501/6000 (58%)
Took 1145.7693874835968 seconds.
Test set: Average loss: 1.9253, Top-1 Accuracy: 3501/6000 (58.3500%)
Took 1147.2248487472534 seconds.
Test set: Average loss: 1.9253, Top-5 Accuracy: 5830.0/6000 (97.1667%)
Took 1147.2248487472534 seconds.

----- Layer 2, Node 2, Epoch 20/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.449027
Train set: Average loss: 0.4116
Valid set: Average loss: 1.7630, Accuracy: 3572/6000 (60%)
Took 1158.2522265911102 seconds.
Test set: Average loss: 1.7630, Top-1 Accuracy: 3572/6000 (59.5333%)
Took 1159.7106823921204 seconds.
Test set: Average loss: 1.7630, Top-5 Accuracy: 5872.0/6000 (97.8667%)
Took 1159.7106823921204 seconds.

----- Layer 2, Node 2, Epoch 21/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.481123
Train set: Average loss: 0.4198
Valid set: Average loss: 1.7246, Accuracy: 3453/6000 (58%)
Took 1170.7476766109467 seconds.
Test set: Average loss: 1.7246, Top-1 Accuracy: 3453/6000 (57.5500%)
Took 1172.1970474720001 seconds.
Test set: Average loss: 1.7246, Top-5 Accuracy: 5834.0/6000 (97.2333%)
Took 1172.1970474720001 seconds.

----- Layer 2, Node 2, Epoch 22/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.438469
Train set: Average loss: 0.4113
Valid set: Average loss: 1.6666, Accuracy: 3447/6000 (57%)
Took 1183.1895506381989 seconds.
Test set: Average loss: 1.6666, Top-1 Accuracy: 3447/6000 (57.4500%)
Took 1184.6335611343384 seconds.
Test set: Average loss: 1.6666, Top-5 Accuracy: 5852.0/6000 (97.5333%)
Took 1184.6335611343384 seconds.

----- Layer 2, Node 2, Epoch 23/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.370144
Train set: Average loss: 0.3537
Valid set: Average loss: 2.0681, Accuracy: 3393/6000 (57%)
Took 1195.7262806892395 seconds.
Test set: Average loss: 2.0681, Top-1 Accuracy: 3393/6000 (56.5500%)
Took 1197.2017614841461 seconds.
Test set: Average loss: 2.0681, Top-5 Accuracy: 5821.0/6000 (97.0167%)
Took 1197.2017614841461 seconds.

----- Layer 2, Node 2, Epoch 24/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.335638
Train set: Average loss: 0.3150
Valid set: Average loss: 2.4597, Accuracy: 3295/6000 (55%)
Took 1208.2959833145142 seconds.
Test set: Average loss: 2.4597, Top-1 Accuracy: 3295/6000 (54.9167%)
Took 1209.7514507770538 seconds.
Test set: Average loss: 2.4597, Top-5 Accuracy: 5793.0/6000 (96.5500%)
Took 1209.7514507770538 seconds.

----- Layer 2, Node 2, Epoch 25/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.303249
Train set: Average loss: 0.3119
Valid set: Average loss: 2.7597, Accuracy: 3269/6000 (54%)
Took 1220.7790310382843 seconds.
Test set: Average loss: 2.7597, Top-1 Accuracy: 3269/6000 (54.4833%)
Took 1222.2388367652893 seconds.
Test set: Average loss: 2.7597, Top-5 Accuracy: 5808.0/6000 (96.8000%)
Took 1222.2388367652893 seconds.
Early stopping by patience!
return the node-wise best extended model
returning an extended child
Average valid loss is reduced by 61.68333435058594

Extending node 2
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 1.0641, Top-1 Accuracy: 3701/6000 (61.6833%)
Took 1223.741661787033 seconds.
Test set: Average loss: 1.0641, Top-5 Accuracy: 5926.0/6000 (98.7667%)
Took 1223.741661787033 seconds.
False
False
False

Perform global training

----- Layer 2, Node 2, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.858693
Train set: Average loss: 1.3125
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.4155, Accuracy: 9209/18000 (51%)
Took 1243.8718976974487 seconds.
Test set: Average loss: 1.1146, Top-1 Accuracy: 3848/6000 (64.1333%)
Took 1245.3320240974426 seconds.
Test set: Average loss: 1.1146, Top-5 Accuracy: 5894.0/6000 (98.2333%)
Took 1245.3320240974426 seconds.

----- Layer 2, Node 2, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.665699
Train set: Average loss: 0.7216
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.4426, Accuracy: 9613/18000 (53%)
Took 1265.4252984523773 seconds.
Test set: Average loss: 1.1874, Top-1 Accuracy: 3957/6000 (65.9500%)
Took 1266.878006219864 seconds.
Test set: Average loss: 1.1874, Top-5 Accuracy: 5910.0/6000 (98.5000%)
Took 1266.878006219864 seconds.

----- Layer 2, Node 2, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.562305
Train set: Average loss: 0.6042
Valid set: Average loss: 2.8725, Accuracy: 9339/18000 (52%)
Took 1286.9401984214783 seconds.
Test set: Average loss: 1.1902, Top-1 Accuracy: 3964/6000 (66.0667%)
Took 1288.3901839256287 seconds.
Test set: Average loss: 1.1902, Top-5 Accuracy: 5918.0/6000 (98.6333%)
Took 1288.3901839256287 seconds.

----- Layer 2, Node 2, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.529677
Train set: Average loss: 0.5379
Valid set: Average loss: 3.9609, Accuracy: 8538/18000 (47%)
Took 1308.3737633228302 seconds.
Test set: Average loss: 1.5835, Top-1 Accuracy: 3739/6000 (62.3167%)
Took 1309.8283669948578 seconds.
Test set: Average loss: 1.5835, Top-5 Accuracy: 5801.0/6000 (96.6833%)
Took 1309.8283669948578 seconds.

----- Layer 2, Node 2, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.511258
Train set: Average loss: 0.4798
Valid set: Average loss: 3.8019, Accuracy: 8817/18000 (49%)
Took 1329.9738836288452 seconds.
Test set: Average loss: 1.4866, Top-1 Accuracy: 3862/6000 (64.3667%)
Took 1331.4285669326782 seconds.
Test set: Average loss: 1.4866, Top-5 Accuracy: 5859.0/6000 (97.6500%)
Took 1331.4285669326782 seconds.

----- Layer 2, Node 2, Epoch 6/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.390902
Train set: Average loss: 0.4230
Valid set: Average loss: 5.0162, Accuracy: 7207/18000 (40%)
Took 1351.4166750907898 seconds.
Test set: Average loss: 2.6291, Top-1 Accuracy: 3255/6000 (54.2500%)
Took 1352.853022813797 seconds.
Test set: Average loss: 2.6291, Top-5 Accuracy: 5833.0/6000 (97.2167%)
Took 1352.853022813797 seconds.

----- Layer 2, Node 2, Epoch 7/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.353725
Train set: Average loss: 0.3777
Valid set: Average loss: 3.5910, Accuracy: 8774/18000 (49%)
Took 1372.8539106845856 seconds.
Test set: Average loss: 1.8687, Top-1 Accuracy: 3759/6000 (62.6500%)
Took 1374.305116891861 seconds.
Test set: Average loss: 1.8687, Top-5 Accuracy: 5927.0/6000 (98.7833%)
Took 1374.305116891861 seconds.

----- Layer 2, Node 2, Epoch 8/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.315768
Train set: Average loss: 0.3462
Valid set: Average loss: 4.5394, Accuracy: 8062/18000 (45%)
Took 1394.3020994663239 seconds.
Test set: Average loss: 2.4770, Top-1 Accuracy: 3581/6000 (59.6833%)
Took 1395.7774541378021 seconds.
Test set: Average loss: 2.4770, Top-5 Accuracy: 5827.0/6000 (97.1167%)
Took 1395.7774541378021 seconds.

----- Layer 2, Node 2, Epoch 9/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.264672
Train set: Average loss: 0.2988
Valid set: Average loss: 4.1421, Accuracy: 8414/18000 (47%)
Took 1415.7490439414978 seconds.
Test set: Average loss: 1.7298, Top-1 Accuracy: 3812/6000 (63.5333%)
Took 1417.210932970047 seconds.
Test set: Average loss: 1.7298, Top-5 Accuracy: 5882.0/6000 (98.0333%)
Took 1417.210932970047 seconds.

----- Layer 2, Node 2, Epoch 10/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.266002
Train set: Average loss: 0.2914
Valid set: Average loss: 4.9508, Accuracy: 7918/18000 (44%)
Took 1437.0884177684784 seconds.
Test set: Average loss: 2.0140, Top-1 Accuracy: 3829/6000 (63.8167%)
Took 1438.5479831695557 seconds.
Test set: Average loss: 2.0140, Top-5 Accuracy: 5816.0/6000 (96.9333%)
Took 1438.5479831695557 seconds.

----- Layer 2, Node 2, Epoch 11/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.232656
Train set: Average loss: 0.2586
Valid set: Average loss: 5.0531, Accuracy: 8132/18000 (45%)
Took 1458.6556100845337 seconds.
Test set: Average loss: 2.2965, Top-1 Accuracy: 3670/6000 (61.1667%)
Took 1460.1101689338684 seconds.
Test set: Average loss: 2.2965, Top-5 Accuracy: 5822.0/6000 (97.0333%)
Took 1460.1101689338684 seconds.

----- Layer 2, Node 2, Epoch 12/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.238341
Train set: Average loss: 0.2411
Valid set: Average loss: 6.3234, Accuracy: 7140/18000 (40%)
Took 1480.152619600296 seconds.
Test set: Average loss: 2.7908, Top-1 Accuracy: 3479/6000 (57.9833%)
Took 1481.6061403751373 seconds.
Test set: Average loss: 2.7908, Top-5 Accuracy: 5728.0/6000 (95.4667%)
Took 1481.6061403751373 seconds.

----- Layer 2, Node 2, Epoch 13/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.231176
Train set: Average loss: 0.2314
Valid set: Average loss: 4.5279, Accuracy: 8614/18000 (48%)
Took 1502.0087838172913 seconds.
Test set: Average loss: 2.1154, Top-1 Accuracy: 3757/6000 (62.6167%)
Took 1503.4634540081024 seconds.
Test set: Average loss: 2.1154, Top-5 Accuracy: 5700.0/6000 (95.0000%)
Took 1503.4634540081024 seconds.

----- Layer 2, Node 2, Epoch 14/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.198058
Train set: Average loss: 0.2023
Valid set: Average loss: 5.2764, Accuracy: 8401/18000 (47%)
Took 1523.7921106815338 seconds.
Test set: Average loss: 2.3399, Top-1 Accuracy: 3841/6000 (64.0167%)
Took 1525.2430894374847 seconds.
Test set: Average loss: 2.3399, Top-5 Accuracy: 5840.0/6000 (97.3333%)
Took 1525.2430894374847 seconds.

----- Layer 2, Node 2, Epoch 15/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.164370
Train set: Average loss: 0.1869
Valid set: Average loss: 4.4449, Accuracy: 8966/18000 (50%)
Took 1545.3650732040405 seconds.
Test set: Average loss: 1.8402, Top-1 Accuracy: 4054/6000 (67.5667%)
Took 1546.8442871570587 seconds.
Test set: Average loss: 1.8402, Top-5 Accuracy: 5829.0/6000 (97.1500%)
Took 1546.8442871570587 seconds.

----- Layer 2, Node 2, Epoch 16/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.165082
Train set: Average loss: 0.1707
Valid set: Average loss: 6.0966, Accuracy: 7805/18000 (43%)
Took 1566.9769933223724 seconds.
Test set: Average loss: 2.5246, Top-1 Accuracy: 3697/6000 (61.6167%)
Took 1568.4444744586945 seconds.
Test set: Average loss: 2.5246, Top-5 Accuracy: 5844.0/6000 (97.4000%)
Took 1568.4444744586945 seconds.

----- Layer 2, Node 2, Epoch 17/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.169755
Train set: Average loss: 0.1667
Valid set: Average loss: 4.7771, Accuracy: 8192/18000 (46%)
Took 1588.412748336792 seconds.
Test set: Average loss: 2.2158, Top-1 Accuracy: 3721/6000 (62.0167%)
Took 1589.8185029029846 seconds.
Test set: Average loss: 2.2158, Top-5 Accuracy: 5709.0/6000 (95.1500%)
Took 1589.8185029029846 seconds.

----- Layer 2, Node 2, Epoch 18/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.140177
Train set: Average loss: 0.1410
Valid set: Average loss: 6.0980, Accuracy: 8375/18000 (47%)
Took 1609.2168598175049 seconds.
Test set: Average loss: 2.5207, Top-1 Accuracy: 3742/6000 (62.3667%)
Took 1610.6406621932983 seconds.
Test set: Average loss: 2.5207, Top-5 Accuracy: 5798.0/6000 (96.6333%)
Took 1610.6406621932983 seconds.

----- Layer 2, Node 2, Epoch 19/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.123323
Train set: Average loss: 0.1423
Valid set: Average loss: 4.8038, Accuracy: 9010/18000 (50%)
Took 1630.1883809566498 seconds.
Test set: Average loss: 2.2227, Top-1 Accuracy: 3989/6000 (66.4833%)
Took 1631.5912296772003 seconds.
Test set: Average loss: 2.2227, Top-5 Accuracy: 5723.0/6000 (95.3833%)
Took 1631.5912296772003 seconds.

----- Layer 2, Node 2, Epoch 20/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.147891
Train set: Average loss: 0.1377
Valid set: Average loss: 4.7044, Accuracy: 8924/18000 (50%)
Took 1650.986391544342 seconds.
Test set: Average loss: 1.8779, Top-1 Accuracy: 4074/6000 (67.9000%)
Took 1652.3828682899475 seconds.
Test set: Average loss: 1.8779, Top-5 Accuracy: 5835.0/6000 (97.2500%)
Took 1652.3828682899475 seconds.

----- Layer 2, Node 2, Epoch 21/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.118188
Train set: Average loss: 0.1226
Valid set: Average loss: 4.7414, Accuracy: 9311/18000 (52%)
Took 1671.735202074051 seconds.
Test set: Average loss: 2.3148, Top-1 Accuracy: 3927/6000 (65.4500%)
Took 1673.135803937912 seconds.
Test set: Average loss: 2.3148, Top-5 Accuracy: 5849.0/6000 (97.4833%)
Took 1673.135803937912 seconds.

----- Layer 2, Node 2, Epoch 22/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.132650
Train set: Average loss: 0.1274
Valid set: Average loss: 4.5075, Accuracy: 9258/18000 (51%)
Took 1692.7334361076355 seconds.
Test set: Average loss: 1.9838, Top-1 Accuracy: 4011/6000 (66.8500%)
Took 1694.1334233283997 seconds.
Test set: Average loss: 1.9838, Top-5 Accuracy: 5875.0/6000 (97.9167%)
Took 1694.1334233283997 seconds.

----- Layer 2, Node 2, Epoch 23/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.089713
Train set: Average loss: 0.1117
Valid set: Average loss: 5.0728, Accuracy: 9356/18000 (52%)
Took 1713.7505922317505 seconds.
Test set: Average loss: 2.3931, Top-1 Accuracy: 4036/6000 (67.2667%)
Took 1715.151703596115 seconds.
Test set: Average loss: 2.3931, Top-5 Accuracy: 5873.0/6000 (97.8833%)
Took 1715.151703596115 seconds.

----- Layer 2, Node 2, Epoch 24/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.087144
Train set: Average loss: 0.1071
Valid set: Average loss: 6.6501, Accuracy: 8354/18000 (46%)
Took 1734.751200914383 seconds.
Test set: Average loss: 3.1992, Top-1 Accuracy: 3660/6000 (61.0000%)
Took 1736.1582973003387 seconds.
Test set: Average loss: 3.1992, Top-5 Accuracy: 5527.0/6000 (92.1167%)
Took 1736.1582973003387 seconds.

----- Layer 2, Node 2, Epoch 25/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.086798
Train set: Average loss: 0.0989
Valid set: Average loss: 4.8701, Accuracy: 9508/18000 (53%)
Took 1755.7596471309662 seconds.
Test set: Average loss: 1.9552, Top-1 Accuracy: 4184/6000 (69.7333%)
Took 1757.188806772232 seconds.
Test set: Average loss: 1.9552, Top-5 Accuracy: 5803.0/6000 (96.7167%)
Took 1757.188806772232 seconds.

----- Layer 2, Node 2, Epoch 26/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.018767
Train set: Average loss: 0.0512
Valid set: Average loss: 4.9649, Accuracy: 9575/18000 (53%)
Took 1776.8542284965515 seconds.
Test set: Average loss: 2.2717, Top-1 Accuracy: 4069/6000 (67.8167%)
Took 1778.263072013855 seconds.
Test set: Average loss: 2.2717, Top-5 Accuracy: 5704.0/6000 (95.0667%)
Took 1778.263072013855 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.1874, Top-1 Accuracy: 3957/6000 (65.9500%)
Took 1779.692229270935 seconds.
Test set: Average loss: 1.1874, Top-5 Accuracy: 5910.0/6000 (98.5000%)
Took 1779.692229270935 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 3.4993, Top-1 Accuracy: 2485/6000 (41.4167%)
Took 1780.5599858760834 seconds.
Test set: Average loss: 3.4993, Top-5 Accuracy: 4743.0/6000 (79.0500%)
Took 1780.5599858760834 seconds.
Test set: Average loss: 2.6410, Top-1 Accuracy: 3171/6000 (52.8500%)
Took 1781.569400548935 seconds.
Test set: Average loss: 2.6410, Top-5 Accuracy: 5054.0/6000 (84.2333%)
Took 1781.569400548935 seconds.
Test set: Average loss: 1.1874, Top-1 Accuracy: 3957/6000 (65.9500%)
Took 1782.9689309597015 seconds.
Test set: Average loss: 1.1874, Top-5 Accuracy: 5910.0/6000 (98.5000%)
Took 1782.9689309597015 seconds.

Average Top-1 accuracy: tensor(53.4056)

----- Top1 acc: [83.66666412353516, 81.9000015258789, 53.40555191040039]
----- Top5 acc: [99.71666717529297, 98.95833587646484, 87.2611083984375]
============== Continual learning on task 3 =================

[before adaption and growth]
Test set: Average loss: 1.9165, Top-1 Accuracy: 2986/6000 (49.7667%)
Took 1785.069304227829 seconds.
Test set: Average loss: 1.9165, Top-5 Accuracy: 5604.0/6000 (93.4000%)
Took 1785.069304227829 seconds.
old_data shape: torch.Size([15000, 3072])
new_data_1 shape: torch.Size([15000, 3072])
MMD loss:tensor(0.1536, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[3]
tensor([1.], device='cuda:0')
[3]
---------------------------------------------------------------

At layer 3

Processing node 3
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>

---------- Optimizing a binary split ------------
True
True
False

Selectively optimising the parameters below:
          tree_modules.3.router.conv1.weight
          tree_modules.3.router.conv1.bias
          tree_modules.3.router.linear1.weight
          tree_modules.3.router.linear1.bias
          child_left.classifier.fc1.weight
          child_left.classifier.fc1.bias
          child_left.classifier.fc2.weight
          child_left.classifier.fc2.bias
          child_left.classifier.fc3.weight
          child_left.classifier.fc3.bias
          child_right.classifier.fc1.weight
          child_right.classifier.fc1.bias
          child_right.classifier.fc2.weight
          child_right.classifier.fc2.bias
          child_right.classifier.fc3.weight
          child_right.classifier.fc3.bias

----- Layer 3, Node 3, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.623576
Train set: Average loss: 0.6972
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6977, Accuracy: 4465/6000 (74%)
Took 1810.73646068573 seconds.
Test set: Average loss: 0.6977, Top-1 Accuracy: 4465/6000 (74.4167%)
Took 1812.7490677833557 seconds.
Test set: Average loss: 0.6977, Top-5 Accuracy: 5978.0/6000 (99.6333%)
Took 1812.7490677833557 seconds.

----- Layer 3, Node 3, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.611866
Train set: Average loss: 0.5937
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6569, Accuracy: 4518/6000 (75%)
Took 1827.5073783397675 seconds.
Test set: Average loss: 0.6569, Top-1 Accuracy: 4518/6000 (75.3000%)
Took 1829.5068910121918 seconds.
Test set: Average loss: 0.6569, Top-5 Accuracy: 5976.0/6000 (99.6000%)
Took 1829.5068910121918 seconds.

----- Layer 3, Node 3, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.594939
Train set: Average loss: 0.5781
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6537, Accuracy: 4530/6000 (76%)
Took 1844.235357284546 seconds.
Test set: Average loss: 0.6537, Top-1 Accuracy: 4530/6000 (75.5000%)
Took 1846.238097190857 seconds.
Test set: Average loss: 0.6537, Top-5 Accuracy: 5976.0/6000 (99.6000%)
Took 1846.238097190857 seconds.

----- Layer 3, Node 3, Epoch 4/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.583026
Train set: Average loss: 0.5682
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6493, Accuracy: 4556/6000 (76%)
Took 1861.0017278194427 seconds.
Test set: Average loss: 0.6493, Top-1 Accuracy: 4556/6000 (75.9333%)
Took 1863.0006668567657 seconds.
Test set: Average loss: 0.6493, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 1863.0006668567657 seconds.

----- Layer 3, Node 3, Epoch 5/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.573899
Train set: Average loss: 0.5602
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6493, Accuracy: 4557/6000 (76%)
Took 1877.8161671161652 seconds.
Test set: Average loss: 0.6493, Top-1 Accuracy: 4557/6000 (75.9500%)
Took 1879.8803763389587 seconds.
Test set: Average loss: 0.6493, Top-5 Accuracy: 5975.0/6000 (99.5833%)
Took 1879.8803763389587 seconds.

----- Layer 3, Node 3, Epoch 6/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.567285
Train set: Average loss: 0.5528
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6490, Accuracy: 4572/6000 (76%)
Took 1895.2022268772125 seconds.
Test set: Average loss: 0.6490, Top-1 Accuracy: 4572/6000 (76.2000%)
Took 1897.2045242786407 seconds.
Test set: Average loss: 0.6490, Top-5 Accuracy: 5975.0/6000 (99.5833%)
Took 1897.2045242786407 seconds.

----- Layer 3, Node 3, Epoch 7/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.562133
Train set: Average loss: 0.5478
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6453, Accuracy: 4580/6000 (76%)
Took 1911.9115493297577 seconds.
Test set: Average loss: 0.6453, Top-1 Accuracy: 4580/6000 (76.3333%)
Took 1913.9092462062836 seconds.
Test set: Average loss: 0.6453, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 1913.9092462062836 seconds.

----- Layer 3, Node 3, Epoch 8/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.555015
Train set: Average loss: 0.5432
Valid set: Average loss: 0.6500, Accuracy: 4559/6000 (76%)
Took 1928.6431894302368 seconds.
Test set: Average loss: 0.6500, Top-1 Accuracy: 4559/6000 (75.9833%)
Took 1930.6818706989288 seconds.
Test set: Average loss: 0.6500, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 1930.6818706989288 seconds.

----- Layer 3, Node 3, Epoch 9/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.547448
Train set: Average loss: 0.5387
Valid set: Average loss: 0.6480, Accuracy: 4569/6000 (76%)
Took 1945.3574602603912 seconds.
Test set: Average loss: 0.6480, Top-1 Accuracy: 4569/6000 (76.1500%)
Took 1947.3983464241028 seconds.
Test set: Average loss: 0.6480, Top-5 Accuracy: 5979.0/6000 (99.6500%)
Took 1947.3983464241028 seconds.

----- Layer 3, Node 3, Epoch 10/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.546021
Train set: Average loss: 0.5346
Valid set: Average loss: 0.6597, Accuracy: 4573/6000 (76%)
Took 1962.0674703121185 seconds.
Test set: Average loss: 0.6597, Top-1 Accuracy: 4573/6000 (76.2167%)
Took 1964.072871208191 seconds.
Test set: Average loss: 0.6597, Top-5 Accuracy: 5979.0/6000 (99.6500%)
Took 1964.072871208191 seconds.

----- Layer 3, Node 3, Epoch 11/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.538438
Train set: Average loss: 0.5310
Valid set: Average loss: 0.6689, Accuracy: 4557/6000 (76%)
Took 1978.7927017211914 seconds.
Test set: Average loss: 0.6689, Top-1 Accuracy: 4557/6000 (75.9500%)
Took 1980.790202140808 seconds.
Test set: Average loss: 0.6689, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 1980.790202140808 seconds.

----- Layer 3, Node 3, Epoch 12/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.536250
Train set: Average loss: 0.5270
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.6596, Accuracy: 4582/6000 (76%)
Took 1995.5506031513214 seconds.
Test set: Average loss: 0.6596, Top-1 Accuracy: 4582/6000 (76.3667%)
Took 1997.5507369041443 seconds.
Test set: Average loss: 0.6596, Top-5 Accuracy: 5980.0/6000 (99.6667%)
Took 1997.5507369041443 seconds.

----- Layer 3, Node 3, Epoch 13/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.531785
Train set: Average loss: 0.5238
Valid set: Average loss: 0.6690, Accuracy: 4569/6000 (76%)
Took 2012.2696104049683 seconds.
Test set: Average loss: 0.6690, Top-1 Accuracy: 4569/6000 (76.1500%)
Took 2014.2685387134552 seconds.
Test set: Average loss: 0.6690, Top-5 Accuracy: 5979.0/6000 (99.6500%)
Took 2014.2685387134552 seconds.

----- Layer 3, Node 3, Epoch 14/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.530955
Train set: Average loss: 0.5201
Valid set: Average loss: 0.6684, Accuracy: 4559/6000 (76%)
Took 2029.1964411735535 seconds.
Test set: Average loss: 0.6684, Top-1 Accuracy: 4559/6000 (75.9833%)
Took 2031.1993417739868 seconds.
Test set: Average loss: 0.6684, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 2031.1993417739868 seconds.

----- Layer 3, Node 3, Epoch 15/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.525720
Train set: Average loss: 0.5158
Valid set: Average loss: 0.6640, Accuracy: 4562/6000 (76%)
Took 2045.9410605430603 seconds.
Test set: Average loss: 0.6640, Top-1 Accuracy: 4562/6000 (76.0333%)
Took 2047.9584348201752 seconds.
Test set: Average loss: 0.6640, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 2047.9584348201752 seconds.

----- Layer 3, Node 3, Epoch 16/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.520367
Train set: Average loss: 0.5123
Valid set: Average loss: 0.6737, Accuracy: 4570/6000 (76%)
Took 2062.8458728790283 seconds.
Test set: Average loss: 0.6737, Top-1 Accuracy: 4570/6000 (76.1667%)
Took 2064.8594212532043 seconds.
Test set: Average loss: 0.6737, Top-5 Accuracy: 5969.0/6000 (99.4833%)
Took 2064.8594212532043 seconds.

----- Layer 3, Node 3, Epoch 17/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.518053
Train set: Average loss: 0.5093
Valid set: Average loss: 0.6815, Accuracy: 4547/6000 (76%)
Took 2079.644428253174 seconds.
Test set: Average loss: 0.6815, Top-1 Accuracy: 4547/6000 (75.7833%)
Took 2081.6693279743195 seconds.
Test set: Average loss: 0.6815, Top-5 Accuracy: 5973.0/6000 (99.5500%)
Took 2081.6693279743195 seconds.

----- Layer 3, Node 3, Epoch 18/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.516235
Train set: Average loss: 0.5074
Valid set: Average loss: 0.6811, Accuracy: 4555/6000 (76%)
Took 2096.4550251960754 seconds.
Test set: Average loss: 0.6811, Top-1 Accuracy: 4555/6000 (75.9167%)
Took 2098.6734001636505 seconds.
Test set: Average loss: 0.6811, Top-5 Accuracy: 5972.0/6000 (99.5333%)
Took 2098.6734001636505 seconds.

----- Layer 3, Node 3, Epoch 19/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.511833
Train set: Average loss: 0.5024
Valid set: Average loss: 0.6770, Accuracy: 4565/6000 (76%)
Took 2113.478240966797 seconds.
Test set: Average loss: 0.6770, Top-1 Accuracy: 4565/6000 (76.0833%)
Took 2115.4911227226257 seconds.
Test set: Average loss: 0.6770, Top-5 Accuracy: 5969.0/6000 (99.4833%)
Took 2115.4911227226257 seconds.

----- Layer 3, Node 3, Epoch 20/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.508930
Train set: Average loss: 0.4994
Valid set: Average loss: 0.6951, Accuracy: 4542/6000 (76%)
Took 2130.744073152542 seconds.
Test set: Average loss: 0.6951, Top-1 Accuracy: 4542/6000 (75.7000%)
Took 2132.8197996616364 seconds.
Test set: Average loss: 0.6951, Top-5 Accuracy: 5972.0/6000 (99.5333%)
Took 2132.8197996616364 seconds.

----- Layer 3, Node 3, Epoch 21/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.506726
Train set: Average loss: 0.4972
Valid set: Average loss: 0.7026, Accuracy: 4553/6000 (76%)
Took 2148.18922996521 seconds.
Test set: Average loss: 0.7026, Top-1 Accuracy: 4553/6000 (75.8833%)
Took 2150.28066945076 seconds.
Test set: Average loss: 0.7026, Top-5 Accuracy: 5969.0/6000 (99.4833%)
Took 2150.28066945076 seconds.

----- Layer 3, Node 3, Epoch 22/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.501878
Train set: Average loss: 0.4956
Valid set: Average loss: 0.6988, Accuracy: 4576/6000 (76%)
Took 2165.72407746315 seconds.
Test set: Average loss: 0.6988, Top-1 Accuracy: 4576/6000 (76.2667%)
Took 2167.79789018631 seconds.
Test set: Average loss: 0.6988, Top-5 Accuracy: 5969.0/6000 (99.4833%)
Took 2167.79789018631 seconds.

----- Layer 3, Node 3, Epoch 23/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.497326
Train set: Average loss: 0.4896
Valid set: Average loss: 0.7178, Accuracy: 4567/6000 (76%)
Took 2183.067022562027 seconds.
Test set: Average loss: 0.7178, Top-1 Accuracy: 4567/6000 (76.1167%)
Took 2185.1475064754486 seconds.
Test set: Average loss: 0.7178, Top-5 Accuracy: 5971.0/6000 (99.5167%)
Took 2185.1475064754486 seconds.

----- Layer 3, Node 3, Epoch 24/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.489396
Train set: Average loss: 0.4867
Valid set: Average loss: 0.7225, Accuracy: 4548/6000 (76%)
Took 2200.4361469745636 seconds.
Test set: Average loss: 0.7225, Top-1 Accuracy: 4548/6000 (75.8000%)
Took 2202.5194227695465 seconds.
Test set: Average loss: 0.7225, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 2202.5194227695465 seconds.

----- Layer 3, Node 3, Epoch 25/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.500873
Train set: Average loss: 0.4844
Valid set: Average loss: 0.7306, Accuracy: 4533/6000 (76%)
Took 2217.846630334854 seconds.
Test set: Average loss: 0.7306, Top-1 Accuracy: 4533/6000 (75.5500%)
Took 2219.9294381141663 seconds.
Test set: Average loss: 0.7306, Top-5 Accuracy: 5968.0/6000 (99.4667%)
Took 2219.9294381141663 seconds.

----- Layer 3, Node 3, Epoch 26/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.455481
Train set: Average loss: 0.4650
Valid set: Average loss: 0.6934, Accuracy: 4546/6000 (76%)
Took 2235.205321073532 seconds.
Test set: Average loss: 0.6934, Top-1 Accuracy: 4546/6000 (75.7667%)
Took 2237.2809052467346 seconds.
Test set: Average loss: 0.6934, Top-5 Accuracy: 5979.0/6000 (99.6500%)
Took 2237.2809052467346 seconds.

----- Layer 3, Node 3, Epoch 27/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.450470
Train set: Average loss: 0.4537
Valid set: Average loss: 0.6933, Accuracy: 4540/6000 (76%)
Took 2252.5348739624023 seconds.
Test set: Average loss: 0.6933, Top-1 Accuracy: 4540/6000 (75.6667%)
Took 2254.6137194633484 seconds.
Test set: Average loss: 0.6933, Top-5 Accuracy: 5978.0/6000 (99.6333%)
Took 2254.6137194633484 seconds.

----- Layer 3, Node 3, Epoch 28/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.446867
Train set: Average loss: 0.4490
Valid set: Average loss: 0.6973, Accuracy: 4539/6000 (76%)
Took 2269.90869140625 seconds.
Test set: Average loss: 0.6973, Top-1 Accuracy: 4539/6000 (75.6500%)
Took 2272.0617892742157 seconds.
Test set: Average loss: 0.6973, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 2272.0617892742157 seconds.

----- Layer 3, Node 3, Epoch 29/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.442727
Train set: Average loss: 0.4450
Valid set: Average loss: 0.7025, Accuracy: 4531/6000 (76%)
Took 2287.2785041332245 seconds.
Test set: Average loss: 0.7025, Top-1 Accuracy: 4531/6000 (75.5167%)
Took 2289.5124073028564 seconds.
Test set: Average loss: 0.7025, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 2289.5124073028564 seconds.

----- Layer 3, Node 3, Epoch 30/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.440448
Train set: Average loss: 0.4415
Valid set: Average loss: 0.7046, Accuracy: 4533/6000 (76%)
Took 2304.7118394374847 seconds.
Test set: Average loss: 0.7046, Top-1 Accuracy: 4533/6000 (75.5500%)
Took 2306.8062374591827 seconds.
Test set: Average loss: 0.7046, Top-5 Accuracy: 5975.0/6000 (99.5833%)
Took 2306.8062374591827 seconds.
Early stopping by patience!
return the node-wise best split model
returning left and right children

----------- Optimizing an extension --------------
No extension as the transformer is an identity function.
Average valid loss is reduced by 76.36666870117188

Splitting node 3
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 0.6596, Top-1 Accuracy: 4582/6000 (76.3667%)
Took 2308.969282388687 seconds.
Test set: Average loss: 0.6596, Top-5 Accuracy: 5980.0/6000 (99.6667%)
Took 2308.969282388687 seconds.
False
False
False

Perform global training

----- Layer 4, Node 4, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.666206
Train set: Average loss: 1.1505
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.3064, Accuracy: 15201/24000 (63%)
Took 2334.8603515625 seconds.
Test set: Average loss: 0.9541, Top-1 Accuracy: 4321/6000 (72.0167%)
Took 2336.933389902115 seconds.
Test set: Average loss: 0.9541, Top-5 Accuracy: 5754.0/6000 (95.9000%)
Took 2336.933389902115 seconds.

----- Layer 4, Node 4, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.510437
Train set: Average loss: 0.5498
Valid set: Average loss: 1.5393, Accuracy: 14919/24000 (62%)
Took 2362.8467104434967 seconds.
Test set: Average loss: 1.2758, Top-1 Accuracy: 4155/6000 (69.2500%)
Took 2364.961621761322 seconds.
Test set: Average loss: 1.2758, Top-5 Accuracy: 5559.0/6000 (92.6500%)
Took 2364.961621761322 seconds.

----- Layer 4, Node 4, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.423904
Train set: Average loss: 0.4232
Valid set: Average loss: 1.6630, Accuracy: 14675/24000 (61%)
Took 2390.962799549103 seconds.
Test set: Average loss: 1.1522, Top-1 Accuracy: 4263/6000 (71.0500%)
Took 2393.0353162288666 seconds.
Test set: Average loss: 1.1522, Top-5 Accuracy: 5773.0/6000 (96.2167%)
Took 2393.0353162288666 seconds.

----- Layer 4, Node 4, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.349394
Train set: Average loss: 0.3575
Valid set: Average loss: 1.8145, Accuracy: 14695/24000 (61%)
Took 2419.0548367500305 seconds.
Test set: Average loss: 1.4059, Top-1 Accuracy: 4297/6000 (71.6167%)
Took 2421.151168346405 seconds.
Test set: Average loss: 1.4059, Top-5 Accuracy: 5710.0/6000 (95.1667%)
Took 2421.151168346405 seconds.

----- Layer 4, Node 4, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.337303
Train set: Average loss: 0.3176
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7755, Accuracy: 15387/24000 (64%)
Took 2447.1023926734924 seconds.
Test set: Average loss: 1.0937, Top-1 Accuracy: 4503/6000 (75.0500%)
Took 2449.1746830940247 seconds.
Test set: Average loss: 1.0937, Top-5 Accuracy: 5852.0/6000 (97.5333%)
Took 2449.1746830940247 seconds.

----- Layer 4, Node 4, Epoch 6/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.255799
Train set: Average loss: 0.2725
Valid set: Average loss: 1.8214, Accuracy: 15042/24000 (63%)
Took 2475.118180513382 seconds.
Test set: Average loss: 1.2622, Top-1 Accuracy: 4371/6000 (72.8500%)
Took 2477.208655834198 seconds.
Test set: Average loss: 1.2622, Top-5 Accuracy: 5780.0/6000 (96.3333%)
Took 2477.208655834198 seconds.

----- Layer 4, Node 4, Epoch 7/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.254994
Train set: Average loss: 0.2420
Valid set: Average loss: 1.7882, Accuracy: 15218/24000 (63%)
Took 2503.5137066841125 seconds.
Test set: Average loss: 1.4639, Top-1 Accuracy: 4303/6000 (71.7167%)
Took 2505.602049589157 seconds.
Test set: Average loss: 1.4639, Top-5 Accuracy: 5712.0/6000 (95.2000%)
Took 2505.602049589157 seconds.

----- Layer 4, Node 4, Epoch 8/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.209726
Train set: Average loss: 0.2188
Valid set: Average loss: 1.8578, Accuracy: 15067/24000 (63%)
Took 2531.578899860382 seconds.
Test set: Average loss: 1.2299, Top-1 Accuracy: 4392/6000 (73.2000%)
Took 2533.652289867401 seconds.
Test set: Average loss: 1.2299, Top-5 Accuracy: 5759.0/6000 (95.9833%)
Took 2533.652289867401 seconds.

----- Layer 4, Node 4, Epoch 9/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.185305
Train set: Average loss: 0.1980
Valid set: Average loss: 2.0553, Accuracy: 14274/24000 (59%)
Took 2558.5111293792725 seconds.
Test set: Average loss: 1.1364, Top-1 Accuracy: 4541/6000 (75.6833%)
Took 2560.485406398773 seconds.
Test set: Average loss: 1.1364, Top-5 Accuracy: 5774.0/6000 (96.2333%)
Took 2560.485406398773 seconds.

----- Layer 4, Node 4, Epoch 10/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.144205
Train set: Average loss: 0.1682
Valid set: Average loss: 2.2256, Accuracy: 14354/24000 (60%)
Took 2585.286845445633 seconds.
Test set: Average loss: 1.3533, Top-1 Accuracy: 4453/6000 (74.2167%)
Took 2587.256812810898 seconds.
Test set: Average loss: 1.3533, Top-5 Accuracy: 5709.0/6000 (95.1500%)
Took 2587.256812810898 seconds.

----- Layer 4, Node 4, Epoch 11/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.141046
Train set: Average loss: 0.1447
Valid set: Average loss: 2.2925, Accuracy: 14424/24000 (60%)
Took 2612.4299879074097 seconds.
Test set: Average loss: 1.6110, Top-1 Accuracy: 4351/6000 (72.5167%)
Took 2614.41854763031 seconds.
Test set: Average loss: 1.6110, Top-5 Accuracy: 5627.0/6000 (93.7833%)
Took 2614.41854763031 seconds.

----- Layer 4, Node 4, Epoch 12/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.120582
Train set: Average loss: 0.1377
Valid set: Average loss: 1.9626, Accuracy: 14905/24000 (62%)
Took 2639.45418715477 seconds.
Test set: Average loss: 1.4136, Top-1 Accuracy: 4422/6000 (73.7000%)
Took 2641.440316438675 seconds.
Test set: Average loss: 1.4136, Top-5 Accuracy: 5752.0/6000 (95.8667%)
Took 2641.440316438675 seconds.

----- Layer 4, Node 4, Epoch 13/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.132432
Train set: Average loss: 0.1268
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.9280, Accuracy: 15472/24000 (64%)
Took 2666.5634775161743 seconds.
Test set: Average loss: 1.2108, Top-1 Accuracy: 4603/6000 (76.7167%)
Took 2668.6060135364532 seconds.
Test set: Average loss: 1.2108, Top-5 Accuracy: 5808.0/6000 (96.8000%)
Took 2668.6060135364532 seconds.

----- Layer 4, Node 4, Epoch 14/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.122875
Train set: Average loss: 0.1205
Valid set: Average loss: 2.3695, Accuracy: 14557/24000 (61%)
Took 2693.658433675766 seconds.
Test set: Average loss: 1.6994, Top-1 Accuracy: 4459/6000 (74.3167%)
Took 2695.661271572113 seconds.
Test set: Average loss: 1.6994, Top-5 Accuracy: 5682.0/6000 (94.7000%)
Took 2695.661271572113 seconds.

----- Layer 4, Node 4, Epoch 15/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.081702
Train set: Average loss: 0.1037
Valid set: Average loss: 2.1109, Accuracy: 15423/24000 (64%)
Took 2720.6279966831207 seconds.
Test set: Average loss: 2.1831, Top-1 Accuracy: 4186/6000 (69.7667%)
Took 2722.635836839676 seconds.
Test set: Average loss: 2.1831, Top-5 Accuracy: 5633.0/6000 (93.8833%)
Took 2722.635836839676 seconds.

----- Layer 4, Node 4, Epoch 16/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.101823
Train set: Average loss: 0.0864
Valid set: Average loss: 2.3036, Accuracy: 14726/24000 (61%)
Took 2747.6839039325714 seconds.
Test set: Average loss: 1.7227, Top-1 Accuracy: 4374/6000 (72.9000%)
Took 2749.6671464443207 seconds.
Test set: Average loss: 1.7227, Top-5 Accuracy: 5633.0/6000 (93.8833%)
Took 2749.6671464443207 seconds.

----- Layer 4, Node 4, Epoch 17/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.096476
Train set: Average loss: 0.0815
Valid set: Average loss: 2.0893, Accuracy: 15232/24000 (63%)
Took 2774.539944410324 seconds.
Test set: Average loss: 1.8175, Top-1 Accuracy: 4362/6000 (72.7000%)
Took 2776.5312869548798 seconds.
Test set: Average loss: 1.8175, Top-5 Accuracy: 5667.0/6000 (94.4500%)
Took 2776.5312869548798 seconds.

----- Layer 4, Node 4, Epoch 18/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.084598
Train set: Average loss: 0.0770
Valid set: Average loss: 2.3470, Accuracy: 15227/24000 (63%)
Took 2801.4753284454346 seconds.
Test set: Average loss: 1.6932, Top-1 Accuracy: 4478/6000 (74.6333%)
Took 2803.481957912445 seconds.
Test set: Average loss: 1.6932, Top-5 Accuracy: 5755.0/6000 (95.9167%)
Took 2803.481957912445 seconds.

----- Layer 4, Node 4, Epoch 19/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.059365
Train set: Average loss: 0.0683
Valid set: Average loss: 2.4616, Accuracy: 15202/24000 (63%)
Took 2828.3477642536163 seconds.
Test set: Average loss: 1.7925, Top-1 Accuracy: 4511/6000 (75.1833%)
Took 2830.362977743149 seconds.
Test set: Average loss: 1.7925, Top-5 Accuracy: 5707.0/6000 (95.1167%)
Took 2830.362977743149 seconds.

----- Layer 4, Node 4, Epoch 20/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.055887
Train set: Average loss: 0.0653
Valid set: Average loss: 2.7771, Accuracy: 14230/24000 (59%)
Took 2855.1947798728943 seconds.
Test set: Average loss: 1.8546, Top-1 Accuracy: 4416/6000 (73.6000%)
Took 2857.1855499744415 seconds.
Test set: Average loss: 1.8546, Top-5 Accuracy: 5655.0/6000 (94.2500%)
Took 2857.1855499744415 seconds.

----- Layer 4, Node 4, Epoch 21/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.064435
Train set: Average loss: 0.0710
Valid set: Average loss: 2.7494, Accuracy: 14681/24000 (61%)
Took 2882.083611726761 seconds.
Test set: Average loss: 1.9612, Top-1 Accuracy: 4406/6000 (73.4333%)
Took 2884.0724284648895 seconds.
Test set: Average loss: 1.9612, Top-5 Accuracy: 5763.0/6000 (96.0500%)
Took 2884.0724284648895 seconds.

----- Layer 4, Node 4, Epoch 22/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.077205
Train set: Average loss: 0.0670
Valid set: Average loss: 2.1719, Accuracy: 15333/24000 (64%)
Took 2908.985648870468 seconds.
Test set: Average loss: 1.8979, Top-1 Accuracy: 4339/6000 (72.3167%)
Took 2910.9732961654663 seconds.
Test set: Average loss: 1.8979, Top-5 Accuracy: 5617.0/6000 (93.6167%)
Took 2910.9732961654663 seconds.

----- Layer 4, Node 4, Epoch 23/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.042560
Train set: Average loss: 0.0596
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.5273, Accuracy: 15629/24000 (65%)
Took 2935.988326072693 seconds.
Test set: Average loss: 1.8272, Top-1 Accuracy: 4512/6000 (75.2000%)
Took 2937.9874765872955 seconds.
Test set: Average loss: 1.8272, Top-5 Accuracy: 5732.0/6000 (95.5333%)
Took 2937.9874765872955 seconds.

----- Layer 4, Node 4, Epoch 24/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.050756
Train set: Average loss: 0.0628
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.3275, Accuracy: 16003/24000 (67%)
Took 2963.095378637314 seconds.
Test set: Average loss: 2.0451, Top-1 Accuracy: 4361/6000 (72.6833%)
Took 2965.084959745407 seconds.
Test set: Average loss: 2.0451, Top-5 Accuracy: 5701.0/6000 (95.0167%)
Took 2965.084959745407 seconds.

----- Layer 4, Node 4, Epoch 25/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.048576
Train set: Average loss: 0.0550
Valid set: Average loss: 2.0920, Accuracy: 15692/24000 (65%)
Took 2990.018054485321 seconds.
Test set: Average loss: 1.7820, Top-1 Accuracy: 4428/6000 (73.8000%)
Took 2992.0514767169952 seconds.
Test set: Average loss: 1.7820, Top-5 Accuracy: 5697.0/6000 (94.9500%)
Took 2992.0514767169952 seconds.

----- Layer 4, Node 4, Epoch 26/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.006675
Train set: Average loss: 0.0226
Valid set: Average loss: 2.2642, Accuracy: 15895/24000 (66%)
Took 3016.877457141876 seconds.
Test set: Average loss: 1.8097, Top-1 Accuracy: 4579/6000 (76.3167%)
Took 3018.8495297431946 seconds.
Test set: Average loss: 1.8097, Top-5 Accuracy: 5699.0/6000 (94.9833%)
Took 3018.8495297431946 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 2.0451, Top-1 Accuracy: 4361/6000 (72.6833%)
Took 3020.8502547740936 seconds.
Test set: Average loss: 2.0451, Top-5 Accuracy: 5701.0/6000 (95.0167%)
Took 3020.8502547740936 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 2.3090, Top-1 Accuracy: 4281/6000 (71.3500%)
Took 3021.7232933044434 seconds.
Test set: Average loss: 2.3090, Top-5 Accuracy: 5683.0/6000 (94.7167%)
Took 3021.7232933044434 seconds.
Test set: Average loss: 1.5660, Top-1 Accuracy: 4704/6000 (78.4000%)
Took 3022.7137203216553 seconds.
Test set: Average loss: 1.5660, Top-5 Accuracy: 5769.0/6000 (96.1500%)
Took 3022.7137203216553 seconds.
Test set: Average loss: 3.3898, Top-1 Accuracy: 2657/6000 (44.2833%)
Took 3024.0958292484283 seconds.
Test set: Average loss: 3.3898, Top-5 Accuracy: 5153.0/6000 (85.8833%)
Took 3024.0958292484283 seconds.
Test set: Average loss: 2.0451, Top-1 Accuracy: 4361/6000 (72.6833%)
Took 3026.0768644809723 seconds.
Test set: Average loss: 2.0451, Top-5 Accuracy: 5701.0/6000 (95.0167%)
Took 3026.0768644809723 seconds.

Average Top-1 accuracy: tensor(66.6792)

----- Top1 acc: [83.66666412353516, 81.9000015258789, 53.40555191040039, 66.67916870117188]
----- Top5 acc: [99.71666717529297, 98.95833587646484, 87.2611083984375, 92.94166564941406]
============== Continual learning on task 4 =================

[before adaption and growth]
Test set: Average loss: 3.4371, Top-1 Accuracy: 3076/6000 (51.2667%)
Took 3028.375373363495 seconds.
Test set: Average loss: 3.4371, Top-5 Accuracy: 5542.0/6000 (92.3667%)
Took 3028.375373363495 seconds.
old_data shape: torch.Size([10000, 3072])
new_data_1 shape: torch.Size([10000, 3072])
MMD loss:tensor(0.1068, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[4, 5]
tensor([0.7147, 0.2853], device='cuda:0')
[4, 5]
---------------------------------------------------------------

At layer 4

Processing node 4
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>

---------- Optimizing a binary split ------------
True
True
False

Selectively optimising the parameters below:
          tree_modules.4.router.conv1.weight
          tree_modules.4.router.conv1.bias
          tree_modules.4.router.linear1.weight
          tree_modules.4.router.linear1.bias
          child_left.classifier.fc1.weight
          child_left.classifier.fc1.bias
          child_left.classifier.fc2.weight
          child_left.classifier.fc2.bias
          child_left.classifier.fc3.weight
          child_left.classifier.fc3.bias
          child_right.classifier.fc1.weight
          child_right.classifier.fc1.bias
          child_right.classifier.fc2.weight
          child_right.classifier.fc2.bias
          child_right.classifier.fc3.weight
          child_right.classifier.fc3.bias

----- Layer 4, Node 4, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.659419
Train set: Average loss: 0.6591
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.8576, Accuracy: 4201/6000 (70%)
Took 3052.0353820323944 seconds.
Test set: Average loss: 0.8576, Top-1 Accuracy: 4201/6000 (70.0167%)
Took 3054.206551551819 seconds.
Test set: Average loss: 0.8576, Top-5 Accuracy: 5974.0/6000 (99.5667%)
Took 3054.206551551819 seconds.

----- Layer 4, Node 4, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.566367
Train set: Average loss: 0.5689
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.8408, Accuracy: 4254/6000 (71%)
Took 3069.7429571151733 seconds.
Test set: Average loss: 0.8408, Top-1 Accuracy: 4254/6000 (70.9000%)
Took 3071.9962186813354 seconds.
Test set: Average loss: 0.8408, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3071.9962186813354 seconds.

----- Layer 4, Node 4, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.559714
Train set: Average loss: 0.5611
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.8441, Accuracy: 4259/6000 (71%)
Took 3087.827960252762 seconds.
Test set: Average loss: 0.8441, Top-1 Accuracy: 4259/6000 (70.9833%)
Took 3090.1154086589813 seconds.
Test set: Average loss: 0.8441, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3090.1154086589813 seconds.

----- Layer 4, Node 4, Epoch 4/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.554522
Train set: Average loss: 0.5556
Valid set: Average loss: 0.8601, Accuracy: 4253/6000 (71%)
Took 3106.06693315506 seconds.
Test set: Average loss: 0.8601, Top-1 Accuracy: 4253/6000 (70.8833%)
Took 3108.3620085716248 seconds.
Test set: Average loss: 0.8601, Top-5 Accuracy: 5982.0/6000 (99.7000%)
Took 3108.3620085716248 seconds.

----- Layer 4, Node 4, Epoch 5/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.551362
Train set: Average loss: 0.5525
Valid set: Average loss: 0.8725, Accuracy: 4243/6000 (71%)
Took 3124.3140466213226 seconds.
Test set: Average loss: 0.8725, Top-1 Accuracy: 4243/6000 (70.7167%)
Took 3126.7404577732086 seconds.
Test set: Average loss: 0.8725, Top-5 Accuracy: 5980.0/6000 (99.6667%)
Took 3126.7404577732086 seconds.

----- Layer 4, Node 4, Epoch 6/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.547771
Train set: Average loss: 0.5492
Valid set: Average loss: 0.9016, Accuracy: 4208/6000 (70%)
Took 3142.6994953155518 seconds.
Test set: Average loss: 0.9016, Top-1 Accuracy: 4208/6000 (70.1333%)
Took 3145.00487947464 seconds.
Test set: Average loss: 0.9016, Top-5 Accuracy: 5977.0/6000 (99.6167%)
Took 3145.00487947464 seconds.

----- Layer 4, Node 4, Epoch 7/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.543641
Train set: Average loss: 0.5453
Valid set: Average loss: 0.9020, Accuracy: 4204/6000 (70%)
Took 3160.915918827057 seconds.
Test set: Average loss: 0.9020, Top-1 Accuracy: 4204/6000 (70.0667%)
Took 3163.238510131836 seconds.
Test set: Average loss: 0.9020, Top-5 Accuracy: 5979.0/6000 (99.6500%)
Took 3163.238510131836 seconds.

----- Layer 4, Node 4, Epoch 8/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.540290
Train set: Average loss: 0.5419
Valid set: Average loss: 0.9300, Accuracy: 4166/6000 (69%)
Took 3179.1647939682007 seconds.
Test set: Average loss: 0.9300, Top-1 Accuracy: 4166/6000 (69.4333%)
Took 3181.476138830185 seconds.
Test set: Average loss: 0.9300, Top-5 Accuracy: 5965.0/6000 (99.4167%)
Took 3181.476138830185 seconds.

----- Layer 4, Node 4, Epoch 9/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.534838
Train set: Average loss: 0.5391
Valid set: Average loss: 0.9434, Accuracy: 4160/6000 (69%)
Took 3197.403379678726 seconds.
Test set: Average loss: 0.9434, Top-1 Accuracy: 4160/6000 (69.3333%)
Took 3199.691324710846 seconds.
Test set: Average loss: 0.9434, Top-5 Accuracy: 5962.0/6000 (99.3667%)
Took 3199.691324710846 seconds.

----- Layer 4, Node 4, Epoch 10/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.534426
Train set: Average loss: 0.5355
Valid set: Average loss: 0.9638, Accuracy: 4157/6000 (69%)
Took 3215.6179151535034 seconds.
Test set: Average loss: 0.9638, Top-1 Accuracy: 4157/6000 (69.2833%)
Took 3217.89289355278 seconds.
Test set: Average loss: 0.9638, Top-5 Accuracy: 5964.0/6000 (99.4000%)
Took 3217.89289355278 seconds.

----- Layer 4, Node 4, Epoch 11/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.535411
Train set: Average loss: 0.5328
Valid set: Average loss: 0.9679, Accuracy: 4150/6000 (69%)
Took 3233.8860669136047 seconds.
Test set: Average loss: 0.9679, Top-1 Accuracy: 4150/6000 (69.1667%)
Took 3236.1603875160217 seconds.
Test set: Average loss: 0.9679, Top-5 Accuracy: 5961.0/6000 (99.3500%)
Took 3236.1603875160217 seconds.

----- Layer 4, Node 4, Epoch 12/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.529234
Train set: Average loss: 0.5304
Valid set: Average loss: 1.0159, Accuracy: 4121/6000 (69%)
Took 3252.1120722293854 seconds.
Test set: Average loss: 1.0159, Top-1 Accuracy: 4121/6000 (68.6833%)
Took 3254.3878698349 seconds.
Test set: Average loss: 1.0159, Top-5 Accuracy: 5956.0/6000 (99.2667%)
Took 3254.3878698349 seconds.

----- Layer 4, Node 4, Epoch 13/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.525769
Train set: Average loss: 0.5269
Valid set: Average loss: 1.0408, Accuracy: 4119/6000 (69%)
Took 3270.4302146434784 seconds.
Test set: Average loss: 1.0408, Top-1 Accuracy: 4119/6000 (68.6500%)
Took 3272.7057037353516 seconds.
Test set: Average loss: 1.0408, Top-5 Accuracy: 5958.0/6000 (99.3000%)
Took 3272.7057037353516 seconds.

----- Layer 4, Node 4, Epoch 14/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.527478
Train set: Average loss: 0.5247
Valid set: Average loss: 1.0382, Accuracy: 4101/6000 (68%)
Took 3288.0801753997803 seconds.
Test set: Average loss: 1.0382, Top-1 Accuracy: 4101/6000 (68.3500%)
Took 3290.250655412674 seconds.
Test set: Average loss: 1.0382, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 3290.250655412674 seconds.

----- Layer 4, Node 4, Epoch 15/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.516557
Train set: Average loss: 0.5214
Valid set: Average loss: 1.0648, Accuracy: 4098/6000 (68%)
Took 3305.880765914917 seconds.
Test set: Average loss: 1.0648, Top-1 Accuracy: 4098/6000 (68.3000%)
Took 3308.1577200889587 seconds.
Test set: Average loss: 1.0648, Top-5 Accuracy: 5962.0/6000 (99.3667%)
Took 3308.1577200889587 seconds.

----- Layer 4, Node 4, Epoch 16/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.515622
Train set: Average loss: 0.5171
Valid set: Average loss: 1.0878, Accuracy: 4092/6000 (68%)
Took 3324.093154668808 seconds.
Test set: Average loss: 1.0878, Top-1 Accuracy: 4092/6000 (68.2000%)
Took 3326.3635194301605 seconds.
Test set: Average loss: 1.0878, Top-5 Accuracy: 5965.0/6000 (99.4167%)
Took 3326.3635194301605 seconds.

----- Layer 4, Node 4, Epoch 17/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.511635
Train set: Average loss: 0.5130
Valid set: Average loss: 1.0965, Accuracy: 4087/6000 (68%)
Took 3342.2481150627136 seconds.
Test set: Average loss: 1.0965, Top-1 Accuracy: 4087/6000 (68.1167%)
Took 3344.5158591270447 seconds.
Test set: Average loss: 1.0965, Top-5 Accuracy: 5949.0/6000 (99.1500%)
Took 3344.5158591270447 seconds.

----- Layer 4, Node 4, Epoch 18/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.510996
Train set: Average loss: 0.5114
Valid set: Average loss: 1.1415, Accuracy: 4073/6000 (68%)
Took 3360.562009572983 seconds.
Test set: Average loss: 1.1415, Top-1 Accuracy: 4073/6000 (67.8833%)
Took 3362.8317968845367 seconds.
Test set: Average loss: 1.1415, Top-5 Accuracy: 5960.0/6000 (99.3333%)
Took 3362.8317968845367 seconds.
Early stopping by patience!
return the node-wise best split model
returning left and right children

----------- Optimizing an extension --------------
No extension as the transformer is an identity function.
Average valid loss is reduced by 70.98332977294922

Splitting node 4
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json
---------------------------------------------------------------

At layer 4

Processing node 5
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>
---------------- data shape before/after transformer -------------
[1, 64, 2, 2] <class 'list'>
(1, 64, 2, 2) <class 'tuple'>

---------- Optimizing a binary split ------------
True
True
False

Selectively optimising the parameters below:
          tree_modules.5.router.conv1.weight
          tree_modules.5.router.conv1.bias
          tree_modules.5.router.linear1.weight
          tree_modules.5.router.linear1.bias
          child_left.classifier.fc1.weight
          child_left.classifier.fc1.bias
          child_left.classifier.fc2.weight
          child_left.classifier.fc2.bias
          child_left.classifier.fc3.weight
          child_left.classifier.fc3.bias
          child_right.classifier.fc1.weight
          child_right.classifier.fc1.bias
          child_right.classifier.fc2.weight
          child_right.classifier.fc2.bias
          child_right.classifier.fc3.weight
          child_right.classifier.fc3.bias

----- Layer 4, Node 5, Epoch 1/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.479255
Train set: Average loss: 0.4425
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7688, Accuracy: 4281/6000 (71%)
Took 3378.805315256119 seconds.
Test set: Average loss: 0.7688, Top-1 Accuracy: 4281/6000 (71.3500%)
Took 3381.0977239608765 seconds.
Test set: Average loss: 0.7688, Top-5 Accuracy: 5984.0/6000 (99.7333%)
Took 3381.0977239608765 seconds.

----- Layer 4, Node 5, Epoch 2/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.430945
Train set: Average loss: 0.4305
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7496, Accuracy: 4267/6000 (71%)
Took 3397.1562724113464 seconds.
Test set: Average loss: 0.7496, Top-1 Accuracy: 4267/6000 (71.1167%)
Took 3399.4600279331207 seconds.
Test set: Average loss: 0.7496, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3399.4600279331207 seconds.

----- Layer 4, Node 5, Epoch 3/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.413587
Train set: Average loss: 0.4203
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7433, Accuracy: 4294/6000 (72%)
Took 3415.465298652649 seconds.
Test set: Average loss: 0.7433, Top-1 Accuracy: 4294/6000 (71.5667%)
Took 3417.733591079712 seconds.
Test set: Average loss: 0.7433, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3417.733591079712 seconds.

----- Layer 4, Node 5, Epoch 4/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.410397
Train set: Average loss: 0.4174
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7417, Accuracy: 4289/6000 (71%)
Took 3433.700784921646 seconds.
Test set: Average loss: 0.7417, Top-1 Accuracy: 4289/6000 (71.4833%)
Took 3435.9956550598145 seconds.
Test set: Average loss: 0.7417, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3435.9956550598145 seconds.

----- Layer 4, Node 5, Epoch 5/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.408796
Train set: Average loss: 0.4159
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7412, Accuracy: 4288/6000 (71%)
Took 3451.919490814209 seconds.
Test set: Average loss: 0.7412, Top-1 Accuracy: 4288/6000 (71.4667%)
Took 3454.182787656784 seconds.
Test set: Average loss: 0.7412, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3454.182787656784 seconds.

----- Layer 4, Node 5, Epoch 6/30, Patience 1/15---------
              [28160/30000 (0%)]      Loss: 0.408598
Train set: Average loss: 0.4149
Valid set: Average loss: 0.7416, Accuracy: 4289/6000 (71%)
Took 3470.1425442695618 seconds.
Test set: Average loss: 0.7416, Top-1 Accuracy: 4289/6000 (71.4833%)
Took 3472.420874595642 seconds.
Test set: Average loss: 0.7416, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3472.420874595642 seconds.

----- Layer 4, Node 5, Epoch 7/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.408420
Train set: Average loss: 0.4142
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7405, Accuracy: 4294/6000 (72%)
Took 3488.3353085517883 seconds.
Test set: Average loss: 0.7405, Top-1 Accuracy: 4294/6000 (71.5667%)
Took 3490.619911670685 seconds.
Test set: Average loss: 0.7405, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3490.619911670685 seconds.

----- Layer 4, Node 5, Epoch 8/30, Patience 2/15---------
              [28160/30000 (0%)]      Loss: 0.405955
Train set: Average loss: 0.4135
Valid set: Average loss: 0.7416, Accuracy: 4290/6000 (72%)
Took 3506.5053968429565 seconds.
Test set: Average loss: 0.7416, Top-1 Accuracy: 4290/6000 (71.5000%)
Took 3508.7795538902283 seconds.
Test set: Average loss: 0.7416, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3508.7795538902283 seconds.

----- Layer 4, Node 5, Epoch 9/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.406134
Train set: Average loss: 0.4126
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7414, Accuracy: 4296/6000 (72%)
Took 3524.7063586711884 seconds.
Test set: Average loss: 0.7414, Top-1 Accuracy: 4296/6000 (71.6000%)
Took 3526.9851529598236 seconds.
Test set: Average loss: 0.7414, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3526.9851529598236 seconds.

----- Layer 4, Node 5, Epoch 10/30, Patience 3/15---------
              [28160/30000 (0%)]      Loss: 0.406108
Train set: Average loss: 0.4119
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7418, Accuracy: 4298/6000 (72%)
Took 3542.875451564789 seconds.
Test set: Average loss: 0.7418, Top-1 Accuracy: 4298/6000 (71.6333%)
Took 3545.1634159088135 seconds.
Test set: Average loss: 0.7418, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3545.1634159088135 seconds.

----- Layer 4, Node 5, Epoch 11/30, Patience 4/15---------
              [28160/30000 (0%)]      Loss: 0.403775
Train set: Average loss: 0.4115
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7427, Accuracy: 4300/6000 (72%)
Took 3561.0621662139893 seconds.
Test set: Average loss: 0.7427, Top-1 Accuracy: 4300/6000 (71.6667%)
Took 3563.406578540802 seconds.
Test set: Average loss: 0.7427, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3563.406578540802 seconds.

----- Layer 4, Node 5, Epoch 12/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.402338
Train set: Average loss: 0.4101
Valid set: Average loss: 0.7416, Accuracy: 4296/6000 (72%)
Took 3579.2966809272766 seconds.
Test set: Average loss: 0.7416, Top-1 Accuracy: 4296/6000 (71.6000%)
Took 3581.663608312607 seconds.
Test set: Average loss: 0.7416, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3581.663608312607 seconds.

----- Layer 4, Node 5, Epoch 13/30, Patience 5/15---------
              [28160/30000 (0%)]      Loss: 0.401216
Train set: Average loss: 0.4091
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 0.7445, Accuracy: 4301/6000 (72%)
Took 3597.513098716736 seconds.
Test set: Average loss: 0.7445, Top-1 Accuracy: 4301/6000 (71.6833%)
Took 3599.824998855591 seconds.
Test set: Average loss: 0.7445, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3599.824998855591 seconds.

----- Layer 4, Node 5, Epoch 14/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.400557
Train set: Average loss: 0.4086
Valid set: Average loss: 0.7440, Accuracy: 4296/6000 (72%)
Took 3615.68785405159 seconds.
Test set: Average loss: 0.7440, Top-1 Accuracy: 4296/6000 (71.6000%)
Took 3617.973753452301 seconds.
Test set: Average loss: 0.7440, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3617.973753452301 seconds.

----- Layer 4, Node 5, Epoch 15/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.399004
Train set: Average loss: 0.4075
Valid set: Average loss: 0.7430, Accuracy: 4300/6000 (72%)
Took 3633.9600121974945 seconds.
Test set: Average loss: 0.7430, Top-1 Accuracy: 4300/6000 (71.6667%)
Took 3636.250505208969 seconds.
Test set: Average loss: 0.7430, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3636.250505208969 seconds.

----- Layer 4, Node 5, Epoch 16/30, Patience 6/15---------
              [28160/30000 (0%)]      Loss: 0.398562
Train set: Average loss: 0.4064
Valid set: Average loss: 0.7460, Accuracy: 4288/6000 (71%)
Took 3652.2263174057007 seconds.
Test set: Average loss: 0.7460, Top-1 Accuracy: 4288/6000 (71.4667%)
Took 3654.493076324463 seconds.
Test set: Average loss: 0.7460, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3654.493076324463 seconds.

----- Layer 4, Node 5, Epoch 17/30, Patience 7/15---------
              [28160/30000 (0%)]      Loss: 0.398788
Train set: Average loss: 0.4058
Valid set: Average loss: 0.7479, Accuracy: 4289/6000 (71%)
Took 3670.369371652603 seconds.
Test set: Average loss: 0.7479, Top-1 Accuracy: 4289/6000 (71.4833%)
Took 3672.657369852066 seconds.
Test set: Average loss: 0.7479, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3672.657369852066 seconds.

----- Layer 4, Node 5, Epoch 18/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.396907
Train set: Average loss: 0.4048
Valid set: Average loss: 0.7470, Accuracy: 4285/6000 (71%)
Took 3688.5779089927673 seconds.
Test set: Average loss: 0.7470, Top-1 Accuracy: 4285/6000 (71.4167%)
Took 3690.8415710926056 seconds.
Test set: Average loss: 0.7470, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3690.8415710926056 seconds.

----- Layer 4, Node 5, Epoch 19/30, Patience 8/15---------
              [28160/30000 (0%)]      Loss: 0.393986
Train set: Average loss: 0.4044
Valid set: Average loss: 0.7479, Accuracy: 4284/6000 (71%)
Took 3706.755700111389 seconds.
Test set: Average loss: 0.7479, Top-1 Accuracy: 4284/6000 (71.4000%)
Took 3709.021664619446 seconds.
Test set: Average loss: 0.7479, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3709.021664619446 seconds.

----- Layer 4, Node 5, Epoch 20/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.392974
Train set: Average loss: 0.4036
Valid set: Average loss: 0.7477, Accuracy: 4297/6000 (72%)
Took 3724.9520950317383 seconds.
Test set: Average loss: 0.7477, Top-1 Accuracy: 4297/6000 (71.6167%)
Took 3727.228402853012 seconds.
Test set: Average loss: 0.7477, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3727.228402853012 seconds.

----- Layer 4, Node 5, Epoch 21/30, Patience 9/15---------
              [28160/30000 (0%)]      Loss: 0.391476
Train set: Average loss: 0.4027
Valid set: Average loss: 0.7480, Accuracy: 4290/6000 (72%)
Took 3743.1606352329254 seconds.
Test set: Average loss: 0.7480, Top-1 Accuracy: 4290/6000 (71.5000%)
Took 3745.4612016677856 seconds.
Test set: Average loss: 0.7480, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3745.4612016677856 seconds.

----- Layer 4, Node 5, Epoch 22/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.390362
Train set: Average loss: 0.4014
Valid set: Average loss: 0.7479, Accuracy: 4293/6000 (72%)
Took 3761.3937764167786 seconds.
Test set: Average loss: 0.7479, Top-1 Accuracy: 4293/6000 (71.5500%)
Took 3763.6683921813965 seconds.
Test set: Average loss: 0.7479, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3763.6683921813965 seconds.

----- Layer 4, Node 5, Epoch 23/30, Patience 10/15---------
              [28160/30000 (0%)]      Loss: 0.388963
Train set: Average loss: 0.4010
Valid set: Average loss: 0.7492, Accuracy: 4296/6000 (72%)
Took 3779.5912885665894 seconds.
Test set: Average loss: 0.7492, Top-1 Accuracy: 4296/6000 (71.6000%)
Took 3781.875911951065 seconds.
Test set: Average loss: 0.7492, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3781.875911951065 seconds.

----- Layer 4, Node 5, Epoch 24/30, Patience 11/15---------
              [28160/30000 (0%)]      Loss: 0.387951
Train set: Average loss: 0.3992
Valid set: Average loss: 0.7516, Accuracy: 4293/6000 (72%)
Took 3797.831072330475 seconds.
Test set: Average loss: 0.7516, Top-1 Accuracy: 4293/6000 (71.5500%)
Took 3800.094795227051 seconds.
Test set: Average loss: 0.7516, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3800.094795227051 seconds.

----- Layer 4, Node 5, Epoch 25/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.389556
Train set: Average loss: 0.3995
Valid set: Average loss: 0.7484, Accuracy: 4286/6000 (71%)
Took 3816.0302107334137 seconds.
Test set: Average loss: 0.7484, Top-1 Accuracy: 4286/6000 (71.4333%)
Took 3818.2955718040466 seconds.
Test set: Average loss: 0.7484, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3818.2955718040466 seconds.

----- Layer 4, Node 5, Epoch 26/30, Patience 12/15---------
              [28160/30000 (0%)]      Loss: 0.386522
Train set: Average loss: 0.3977
Valid set: Average loss: 0.7600, Accuracy: 4272/6000 (71%)
Took 3834.071709871292 seconds.
Test set: Average loss: 0.7600, Top-1 Accuracy: 4272/6000 (71.2000%)
Took 3836.230683326721 seconds.
Test set: Average loss: 0.7600, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3836.230683326721 seconds.

----- Layer 4, Node 5, Epoch 27/30, Patience 13/15---------
              [28160/30000 (0%)]      Loss: 0.386382
Train set: Average loss: 0.3963
Valid set: Average loss: 0.7616, Accuracy: 4271/6000 (71%)
Took 3851.6673440933228 seconds.
Test set: Average loss: 0.7616, Top-1 Accuracy: 4271/6000 (71.1833%)
Took 3853.8334255218506 seconds.
Test set: Average loss: 0.7616, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3853.8334255218506 seconds.

----- Layer 4, Node 5, Epoch 28/30, Patience 14/15---------
              [28160/30000 (0%)]      Loss: 0.386476
Train set: Average loss: 0.3956
Valid set: Average loss: 0.7630, Accuracy: 4271/6000 (71%)
Took 3869.238406419754 seconds.
Test set: Average loss: 0.7630, Top-1 Accuracy: 4271/6000 (71.1833%)
Took 3871.395443916321 seconds.
Test set: Average loss: 0.7630, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3871.395443916321 seconds.

----- Layer 4, Node 5, Epoch 29/30, Patience 15/15---------
              [28160/30000 (0%)]      Loss: 0.385298
Train set: Average loss: 0.3949
Valid set: Average loss: 0.7633, Accuracy: 4269/6000 (71%)
Took 3886.5623366832733 seconds.
Test set: Average loss: 0.7633, Top-1 Accuracy: 4269/6000 (71.1500%)
Took 3888.7504539489746 seconds.
Test set: Average loss: 0.7633, Top-5 Accuracy: 5985.0/6000 (99.7500%)
Took 3888.7504539489746 seconds.
Early stopping by patience!
return the node-wise best split model
returning left and right children

----------- Optimizing an extension --------------
No extension as the transformer is an identity function.
Average valid loss is reduced by 0.7000045776367188

Splitting node 5
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_temp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_temp.json


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 0.7445, Top-1 Accuracy: 4301/6000 (71.6833%)
Took 3890.9923322200775 seconds.
Test set: Average loss: 0.7445, Top-5 Accuracy: 5986.0/6000 (99.7667%)
Took 3890.9923322200775 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.679679
Train set: Average loss: 1.0623
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.5563, Accuracy: 18681/30000 (62%)
Took 3919.2022454738617 seconds.
Test set: Average loss: 1.0340, Top-1 Accuracy: 4164/6000 (69.4000%)
Took 3921.4361913204193 seconds.
Test set: Average loss: 1.0340, Top-5 Accuracy: 5768.0/6000 (96.1333%)
Took 3921.4361913204193 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.474945
Train set: Average loss: 0.4959
Valid set: Average loss: 1.9810, Accuracy: 18256/30000 (61%)
Took 3949.5245044231415 seconds.
Test set: Average loss: 1.0561, Top-1 Accuracy: 4251/6000 (70.8500%)
Took 3951.690802335739 seconds.
Test set: Average loss: 1.0561, Top-5 Accuracy: 5825.0/6000 (97.0833%)
Took 3951.690802335739 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.374334
Train set: Average loss: 0.3870
Valid set: Average loss: 2.1305, Accuracy: 18183/30000 (61%)
Took 3980.302952528 seconds.
Test set: Average loss: 1.7575, Top-1 Accuracy: 3916/6000 (65.2667%)
Took 3982.5047109127045 seconds.
Test set: Average loss: 1.7575, Top-5 Accuracy: 5758.0/6000 (95.9667%)
Took 3982.5047109127045 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.328619
Train set: Average loss: 0.3345
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.0192, Accuracy: 18808/30000 (63%)
Took 4010.384646654129 seconds.
Test set: Average loss: 1.7298, Top-1 Accuracy: 3964/6000 (66.0667%)
Took 4012.5439682006836 seconds.
Test set: Average loss: 1.7298, Top-5 Accuracy: 5773.0/6000 (96.2167%)
Took 4012.5439682006836 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.286532
Train set: Average loss: 0.2891
Valid set: Average loss: 2.1695, Accuracy: 18544/30000 (62%)
Took 4041.8173956871033 seconds.
Test set: Average loss: 1.9961, Top-1 Accuracy: 3942/6000 (65.7000%)
Took 4044.105642557144 seconds.
Test set: Average loss: 1.9961, Top-5 Accuracy: 5708.0/6000 (95.1333%)
Took 4044.105642557144 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.274760
Train set: Average loss: 0.2698
Valid set: Average loss: 2.1435, Accuracy: 18680/30000 (62%)
Took 4073.4159173965454 seconds.
Test set: Average loss: 2.0581, Top-1 Accuracy: 3786/6000 (63.1000%)
Took 4075.772307872772 seconds.
Test set: Average loss: 2.0581, Top-5 Accuracy: 5763.0/6000 (96.0500%)
Took 4075.772307872772 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.228321
Train set: Average loss: 0.2494
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.9787, Accuracy: 19146/30000 (64%)
Took 4105.159842014313 seconds.
Test set: Average loss: 1.5552, Top-1 Accuracy: 4169/6000 (69.4833%)
Took 4107.442566156387 seconds.
Test set: Average loss: 1.5552, Top-5 Accuracy: 5820.0/6000 (97.0000%)
Took 4107.442566156387 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.206757
Train set: Average loss: 0.2285
Valid set: Average loss: 2.9651, Accuracy: 17400/30000 (58%)
Took 4136.599529027939 seconds.
Test set: Average loss: 2.5958, Top-1 Accuracy: 3841/6000 (64.0167%)
Took 4138.880215406418 seconds.
Test set: Average loss: 2.5958, Top-5 Accuracy: 5639.0/6000 (93.9833%)
Took 4138.880215406418 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.192519
Train set: Average loss: 0.2007
Valid set: Average loss: 2.7449, Accuracy: 17717/30000 (59%)
Took 4168.5814526081085 seconds.
Test set: Average loss: 2.0273, Top-1 Accuracy: 4039/6000 (67.3167%)
Took 4171.043098688126 seconds.
Test set: Average loss: 2.0273, Top-5 Accuracy: 5742.0/6000 (95.7000%)
Took 4171.043098688126 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.149459
Train set: Average loss: 0.1728
Valid set: Average loss: 2.8126, Accuracy: 17664/30000 (59%)
Took 4200.90989613533 seconds.
Test set: Average loss: 1.8061, Top-1 Accuracy: 4055/6000 (67.5833%)
Took 4203.192211866379 seconds.
Test set: Average loss: 1.8061, Top-5 Accuracy: 5806.0/6000 (96.7667%)
Took 4203.192211866379 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.187605
Train set: Average loss: 0.1606
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.0178, Accuracy: 19266/30000 (64%)
Took 4232.924617290497 seconds.
Test set: Average loss: 1.4230, Top-1 Accuracy: 4373/6000 (72.8833%)
Took 4235.2540946006775 seconds.
Test set: Average loss: 1.4230, Top-5 Accuracy: 5817.0/6000 (96.9500%)
Took 4235.2540946006775 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.132397
Train set: Average loss: 0.1419
Valid set: Average loss: 2.3288, Accuracy: 18981/30000 (63%)
Took 4265.134487628937 seconds.
Test set: Average loss: 1.7351, Top-1 Accuracy: 4112/6000 (68.5333%)
Took 4267.540162086487 seconds.
Test set: Average loss: 1.7351, Top-5 Accuracy: 5775.0/6000 (96.2500%)
Took 4267.540162086487 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.145639
Train set: Average loss: 0.1392
Valid set: Average loss: 2.6338, Accuracy: 18347/30000 (61%)
Took 4296.844661474228 seconds.
Test set: Average loss: 1.5151, Top-1 Accuracy: 4311/6000 (71.8500%)
Took 4299.128249406815 seconds.
Test set: Average loss: 1.5151, Top-5 Accuracy: 5756.0/6000 (95.9333%)
Took 4299.128249406815 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.109474
Train set: Average loss: 0.1301
Valid set: Average loss: 2.4660, Accuracy: 18892/30000 (63%)
Took 4328.45955824852 seconds.
Test set: Average loss: 2.1911, Top-1 Accuracy: 4129/6000 (68.8167%)
Took 4330.741257429123 seconds.
Test set: Average loss: 2.1911, Top-5 Accuracy: 5674.0/6000 (94.5667%)
Took 4330.741257429123 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.092001
Train set: Average loss: 0.1116
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.3403, Accuracy: 19388/30000 (65%)
Took 4359.174241065979 seconds.
Test set: Average loss: 2.2018, Top-1 Accuracy: 4033/6000 (67.2167%)
Took 4361.470447778702 seconds.
Test set: Average loss: 2.2018, Top-5 Accuracy: 5579.0/6000 (92.9833%)
Took 4361.470447778702 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.105865
Train set: Average loss: 0.1057
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.2309, Accuracy: 19803/30000 (66%)
Took 4389.4554834365845 seconds.
Test set: Average loss: 1.7459, Top-1 Accuracy: 4284/6000 (71.4000%)
Took 4391.632600784302 seconds.
Test set: Average loss: 1.7459, Top-5 Accuracy: 5743.0/6000 (95.7167%)
Took 4391.632600784302 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.087527
Train set: Average loss: 0.1014
Valid set: Average loss: 2.3540, Accuracy: 18736/30000 (62%)
Took 4419.712022304535 seconds.
Test set: Average loss: 1.9423, Top-1 Accuracy: 4123/6000 (68.7167%)
Took 4421.892347574234 seconds.
Test set: Average loss: 1.9423, Top-5 Accuracy: 5647.0/6000 (94.1167%)
Took 4421.892347574234 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.095840
Train set: Average loss: 0.0877
Valid set: Average loss: 2.3983, Accuracy: 19235/30000 (64%)
Took 4450.011706352234 seconds.
Test set: Average loss: 2.3361, Top-1 Accuracy: 4028/6000 (67.1333%)
Took 4452.193404197693 seconds.
Test set: Average loss: 2.3361, Top-5 Accuracy: 5551.0/6000 (92.5167%)
Took 4452.193404197693 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.069599
Train set: Average loss: 0.0848
Valid set: Average loss: 2.5774, Accuracy: 19433/30000 (65%)
Took 4480.692228555679 seconds.
Test set: Average loss: 2.3098, Top-1 Accuracy: 4028/6000 (67.1333%)
Took 4482.902186155319 seconds.
Test set: Average loss: 2.3098, Top-5 Accuracy: 5677.0/6000 (94.6167%)
Took 4482.902186155319 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.061422
Train set: Average loss: 0.0748
Valid set: Average loss: 2.4867, Accuracy: 18983/30000 (63%)
Took 4511.087951898575 seconds.
Test set: Average loss: 2.0113, Top-1 Accuracy: 4256/6000 (70.9333%)
Took 4513.338266134262 seconds.
Test set: Average loss: 2.0113, Top-5 Accuracy: 5571.0/6000 (92.8500%)
Took 4513.338266134262 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.053791
Train set: Average loss: 0.0664
Valid set: Average loss: 2.8351, Accuracy: 18798/30000 (63%)
Took 4542.071223735809 seconds.
Test set: Average loss: 2.2387, Top-1 Accuracy: 4141/6000 (69.0167%)
Took 4544.355913162231 seconds.
Test set: Average loss: 2.2387, Top-5 Accuracy: 5656.0/6000 (94.2667%)
Took 4544.355913162231 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.057480
Train set: Average loss: 0.0649
Valid set: Average loss: 2.4373, Accuracy: 19369/30000 (65%)
Took 4573.687000513077 seconds.
Test set: Average loss: 2.2639, Top-1 Accuracy: 4117/6000 (68.6167%)
Took 4576.016678094864 seconds.
Test set: Average loss: 2.2639, Top-5 Accuracy: 5514.0/6000 (91.9000%)
Took 4576.016678094864 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.062044
Train set: Average loss: 0.0591
Valid set: Average loss: 2.9462, Accuracy: 18092/30000 (60%)
Took 4605.311112642288 seconds.
Test set: Average loss: 2.2136, Top-1 Accuracy: 4180/6000 (69.6667%)
Took 4607.645985364914 seconds.
Test set: Average loss: 2.2136, Top-5 Accuracy: 5621.0/6000 (93.6833%)
Took 4607.645985364914 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.060997
Train set: Average loss: 0.0664
Valid set: Average loss: 2.4675, Accuracy: 19037/30000 (63%)
Took 4637.0423419475555 seconds.
Test set: Average loss: 2.1199, Top-1 Accuracy: 4146/6000 (69.1000%)
Took 4639.329447984695 seconds.
Test set: Average loss: 2.1199, Top-5 Accuracy: 5592.0/6000 (93.2000%)
Took 4639.329447984695 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.060328
Train set: Average loss: 0.0657
Valid set: Average loss: 2.6128, Accuracy: 18644/30000 (62%)
Took 4668.64448928833 seconds.
Test set: Average loss: 2.1286, Top-1 Accuracy: 4065/6000 (67.7500%)
Took 4670.9290335178375 seconds.
Test set: Average loss: 2.1286, Top-5 Accuracy: 5696.0/6000 (94.9333%)
Took 4670.9290335178375 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.006074
Train set: Average loss: 0.0299
Valid set: Average loss: 2.6275, Accuracy: 19519/30000 (65%)
Took 4700.179998636246 seconds.
Test set: Average loss: 2.2934, Top-1 Accuracy: 4198/6000 (69.9667%)
Took 4702.522222042084 seconds.
Test set: Average loss: 2.2934, Top-5 Accuracy: 5596.0/6000 (93.2667%)
Took 4702.522222042084 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.001356
Train set: Average loss: 0.0044
Valid set: Average loss: 2.8512, Accuracy: 19435/30000 (65%)
Took 4732.135326385498 seconds.
Test set: Average loss: 2.5462, Top-1 Accuracy: 4186/6000 (69.7667%)
Took 4734.420129299164 seconds.
Test set: Average loss: 2.5462, Top-5 Accuracy: 5576.0/6000 (92.9333%)
Took 4734.420129299164 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.7459, Top-1 Accuracy: 4284/6000 (71.4000%)
Took 4736.813946008682 seconds.
Test set: Average loss: 1.7459, Top-5 Accuracy: 5743.0/6000 (95.7167%)
Took 4736.813946008682 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 2.7055, Top-1 Accuracy: 3911/6000 (65.1833%)
Took 4737.714175224304 seconds.
Test set: Average loss: 2.7055, Top-5 Accuracy: 5638.0/6000 (93.9667%)
Took 4737.714175224304 seconds.
Test set: Average loss: 1.9034, Top-1 Accuracy: 4348/6000 (72.4667%)
Took 4738.767565488815 seconds.
Test set: Average loss: 1.9034, Top-5 Accuracy: 5732.0/6000 (95.5333%)
Took 4738.767565488815 seconds.
Test set: Average loss: 3.4081, Top-1 Accuracy: 2527/6000 (42.1167%)
Took 4740.2634201049805 seconds.
Test set: Average loss: 3.4081, Top-5 Accuracy: 5135.0/6000 (85.5833%)
Took 4740.2634201049805 seconds.
Test set: Average loss: 1.3914, Top-1 Accuracy: 4733/6000 (78.8833%)
Took 4742.370162010193 seconds.
Test set: Average loss: 1.3914, Top-5 Accuracy: 5801.0/6000 (96.6833%)
Took 4742.370162010193 seconds.
Test set: Average loss: 1.7459, Top-1 Accuracy: 4284/6000 (71.4000%)
Took 4744.6576137542725 seconds.
Test set: Average loss: 1.7459, Top-5 Accuracy: 5743.0/6000 (95.7167%)
Took 4744.6576137542725 seconds.

Average Top-1 accuracy: tensor(66.0100)

----- Top1 acc: [83.66666412353516, 81.9000015258789, 53.40555191040039, 66.67916870117188, 66.00999450683594]
----- Top5 acc: [99.71666717529297, 98.95833587646484, 87.2611083984375, 92.94166564941406, 93.49666595458984]
============== Continual learning on task 5 =================

[before adaption and growth]
Test set: Average loss: 3.0933, Top-1 Accuracy: 3690/6000 (61.5000%)
Took 4746.058731555939 seconds.
Test set: Average loss: 3.0933, Top-5 Accuracy: 5486.0/6000 (91.4333%)
Took 4746.058731555939 seconds.
old_data shape: torch.Size([30000, 3072])
new_data_1 shape: torch.Size([30000, 3072])
MMD loss:tensor(0.0213, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.0052, 0.9720, 0.0197, 0.0032], device='cuda:0')
[7, 8, 6, 9]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 3.0933, Top-1 Accuracy: 3690/6000 (61.5000%)
Took 4763.537415266037 seconds.
Test set: Average loss: 3.0933, Top-5 Accuracy: 5486.0/6000 (91.4333%)
Took 4763.537415266037 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.614878
Train set: Average loss: 0.9272
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.5645, Accuracy: 22995/36000 (64%)
Took 4788.8987357616425 seconds.
Test set: Average loss: 0.8907, Top-1 Accuracy: 4503/6000 (75.0500%)
Took 4790.196704864502 seconds.
Test set: Average loss: 0.8907, Top-5 Accuracy: 5860.0/6000 (97.6667%)
Took 4790.196704864502 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.396242
Train set: Average loss: 0.4545
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7618, Accuracy: 23595/36000 (66%)
Took 4815.736906051636 seconds.
Test set: Average loss: 0.9511, Top-1 Accuracy: 4604/6000 (76.7333%)
Took 4817.176130771637 seconds.
Test set: Average loss: 0.9511, Top-5 Accuracy: 5869.0/6000 (97.8167%)
Took 4817.176130771637 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.254051
Train set: Average loss: 0.3123
Valid set: Average loss: 2.0686, Accuracy: 23389/36000 (65%)
Took 4842.46822977066 seconds.
Test set: Average loss: 1.3015, Top-1 Accuracy: 4484/6000 (74.7333%)
Took 4843.6943526268005 seconds.
Test set: Average loss: 1.3015, Top-5 Accuracy: 5837.0/6000 (97.2833%)
Took 4843.6943526268005 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.214522
Train set: Average loss: 0.2474
Valid set: Average loss: 2.4476, Accuracy: 22596/36000 (63%)
Took 4868.855020523071 seconds.
Test set: Average loss: 1.4404, Top-1 Accuracy: 4471/6000 (74.5167%)
Took 4870.082626819611 seconds.
Test set: Average loss: 1.4404, Top-5 Accuracy: 5849.0/6000 (97.4833%)
Took 4870.082626819611 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.236409
Train set: Average loss: 0.2325
Valid set: Average loss: 2.2972, Accuracy: 22976/36000 (64%)
Took 4895.300821065903 seconds.
Test set: Average loss: 1.2668, Top-1 Accuracy: 4547/6000 (75.7833%)
Took 4896.525248765945 seconds.
Test set: Average loss: 1.2668, Top-5 Accuracy: 5848.0/6000 (97.4667%)
Took 4896.525248765945 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.200793
Train set: Average loss: 0.1967
Valid set: Average loss: 2.2831, Accuracy: 23168/36000 (64%)
Took 4921.496619462967 seconds.
Test set: Average loss: 1.3525, Top-1 Accuracy: 4614/6000 (76.9000%)
Took 4922.693077802658 seconds.
Test set: Average loss: 1.3525, Top-5 Accuracy: 5809.0/6000 (96.8167%)
Took 4922.693077802658 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.142580
Train set: Average loss: 0.1599
Valid set: Average loss: 2.6325, Accuracy: 23006/36000 (64%)
Took 4947.1961262226105 seconds.
Test set: Average loss: 1.5550, Top-1 Accuracy: 4529/6000 (75.4833%)
Took 4948.391907215118 seconds.
Test set: Average loss: 1.5550, Top-5 Accuracy: 5852.0/6000 (97.5333%)
Took 4948.391907215118 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.134420
Train set: Average loss: 0.1603
Valid set: Average loss: 2.6424, Accuracy: 22677/36000 (63%)
Took 4972.711155414581 seconds.
Test set: Average loss: 1.7547, Top-1 Accuracy: 4334/6000 (72.2333%)
Took 4973.895782470703 seconds.
Test set: Average loss: 1.7547, Top-5 Accuracy: 5837.0/6000 (97.2833%)
Took 4973.895782470703 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.116381
Train set: Average loss: 0.1426
Valid set: Average loss: 2.6377, Accuracy: 23065/36000 (64%)
Took 4999.226519107819 seconds.
Test set: Average loss: 1.4840, Top-1 Accuracy: 4620/6000 (77.0000%)
Took 5000.472469091415 seconds.
Test set: Average loss: 1.4840, Top-5 Accuracy: 5813.0/6000 (96.8833%)
Took 5000.472469091415 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.105660
Train set: Average loss: 0.1140
Valid set: Average loss: 2.7390, Accuracy: 22727/36000 (63%)
Took 5025.88422369957 seconds.
Test set: Average loss: 1.5197, Top-1 Accuracy: 4608/6000 (76.8000%)
Took 5027.142975330353 seconds.
Test set: Average loss: 1.5197, Top-5 Accuracy: 5854.0/6000 (97.5667%)
Took 5027.142975330353 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.106260
Train set: Average loss: 0.1167
Valid set: Average loss: 2.6526, Accuracy: 22817/36000 (63%)
Took 5051.778109550476 seconds.
Test set: Average loss: 1.5374, Top-1 Accuracy: 4527/6000 (75.4500%)
Took 5052.989061594009 seconds.
Test set: Average loss: 1.5374, Top-5 Accuracy: 5815.0/6000 (96.9167%)
Took 5052.989061594009 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.084323
Train set: Average loss: 0.1068
Valid set: Average loss: 3.1304, Accuracy: 22338/36000 (62%)
Took 5077.483287811279 seconds.
Test set: Average loss: 1.5644, Top-1 Accuracy: 4616/6000 (76.9333%)
Took 5078.683354854584 seconds.
Test set: Average loss: 1.5644, Top-5 Accuracy: 5840.0/6000 (97.3333%)
Took 5078.683354854584 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.099978
Train set: Average loss: 0.0921
Valid set: Average loss: 3.1111, Accuracy: 22148/36000 (62%)
Took 5103.414209604263 seconds.
Test set: Average loss: 1.7254, Top-1 Accuracy: 4513/6000 (75.2167%)
Took 5104.6247363090515 seconds.
Test set: Average loss: 1.7254, Top-5 Accuracy: 5792.0/6000 (96.5333%)
Took 5104.6247363090515 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.087374
Train set: Average loss: 0.0896
Valid set: Average loss: 3.0249, Accuracy: 22092/36000 (61%)
Took 5129.072412014008 seconds.
Test set: Average loss: 1.5961, Top-1 Accuracy: 4610/6000 (76.8333%)
Took 5130.276282072067 seconds.
Test set: Average loss: 1.5961, Top-5 Accuracy: 5854.0/6000 (97.5667%)
Took 5130.276282072067 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.081475
Train set: Average loss: 0.0830
Valid set: Average loss: 3.1747, Accuracy: 22135/36000 (61%)
Took 5155.09595656395 seconds.
Test set: Average loss: 1.7910, Top-1 Accuracy: 4564/6000 (76.0667%)
Took 5156.3163912296295 seconds.
Test set: Average loss: 1.7910, Top-5 Accuracy: 5876.0/6000 (97.9333%)
Took 5156.3163912296295 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.073295
Train set: Average loss: 0.1002
Valid set: Average loss: 3.1296, Accuracy: 23009/36000 (64%)
Took 5181.123344898224 seconds.
Test set: Average loss: 1.6952, Top-1 Accuracy: 4690/6000 (78.1667%)
Took 5182.332742929459 seconds.
Test set: Average loss: 1.6952, Top-5 Accuracy: 5883.0/6000 (98.0500%)
Took 5182.332742929459 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.076396
Train set: Average loss: 0.0728
Valid set: Average loss: 3.5167, Accuracy: 21976/36000 (61%)
Took 5206.922138929367 seconds.
Test set: Average loss: 1.9619, Top-1 Accuracy: 4518/6000 (75.3000%)
Took 5208.120878696442 seconds.
Test set: Average loss: 1.9619, Top-5 Accuracy: 5826.0/6000 (97.1000%)
Took 5208.120878696442 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.074633
Train set: Average loss: 0.0750
Valid set: Average loss: 3.2059, Accuracy: 22264/36000 (62%)
Took 5232.7962374687195 seconds.
Test set: Average loss: 1.5506, Top-1 Accuracy: 4715/6000 (78.5833%)
Took 5234.012348890305 seconds.
Test set: Average loss: 1.5506, Top-5 Accuracy: 5827.0/6000 (97.1167%)
Took 5234.012348890305 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.076606
Train set: Average loss: 0.0697
Valid set: Average loss: 3.1409, Accuracy: 22619/36000 (63%)
Took 5258.563653707504 seconds.
Test set: Average loss: 1.4644, Top-1 Accuracy: 4703/6000 (78.3833%)
Took 5259.744420289993 seconds.
Test set: Average loss: 1.4644, Top-5 Accuracy: 5884.0/6000 (98.0667%)
Took 5259.744420289993 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.067409
Train set: Average loss: 0.0614
Valid set: Average loss: 3.6260, Accuracy: 21260/36000 (59%)
Took 5284.43790602684 seconds.
Test set: Average loss: 2.1882, Top-1 Accuracy: 4307/6000 (71.7833%)
Took 5285.663270235062 seconds.
Test set: Average loss: 2.1882, Top-5 Accuracy: 5792.0/6000 (96.5333%)
Took 5285.663270235062 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.072994
Train set: Average loss: 0.0645
Valid set: Average loss: 3.3879, Accuracy: 22175/36000 (62%)
Took 5310.639349460602 seconds.
Test set: Average loss: 1.7115, Top-1 Accuracy: 4681/6000 (78.0167%)
Took 5311.8735456466675 seconds.
Test set: Average loss: 1.7115, Top-5 Accuracy: 5842.0/6000 (97.3667%)
Took 5311.8735456466675 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.047624
Train set: Average loss: 0.0534
Valid set: Average loss: 3.8871, Accuracy: 21419/36000 (59%)
Took 5336.813738822937 seconds.
Test set: Average loss: 2.0703, Top-1 Accuracy: 4509/6000 (75.1500%)
Took 5338.025995016098 seconds.
Test set: Average loss: 2.0703, Top-5 Accuracy: 5873.0/6000 (97.8833%)
Took 5338.025995016098 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.083555
Train set: Average loss: 0.0654
Valid set: Average loss: 3.4381, Accuracy: 21657/36000 (60%)
Took 5363.1769490242 seconds.
Test set: Average loss: 1.5272, Top-1 Accuracy: 4694/6000 (78.2333%)
Took 5364.398987054825 seconds.
Test set: Average loss: 1.5272, Top-5 Accuracy: 5900.0/6000 (98.3333%)
Took 5364.398987054825 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.044412
Train set: Average loss: 0.0557
Valid set: Average loss: 3.4547, Accuracy: 22057/36000 (61%)
Took 5389.568587303162 seconds.
Test set: Average loss: 1.6151, Top-1 Accuracy: 4680/6000 (78.0000%)
Took 5390.780706644058 seconds.
Test set: Average loss: 1.6151, Top-5 Accuracy: 5861.0/6000 (97.6833%)
Took 5390.780706644058 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.054444
Train set: Average loss: 0.0516
Valid set: Average loss: 3.5517, Accuracy: 22207/36000 (62%)
Took 5416.064653873444 seconds.
Test set: Average loss: 1.5286, Top-1 Accuracy: 4750/6000 (79.1667%)
Took 5417.2760672569275 seconds.
Test set: Average loss: 1.5286, Top-5 Accuracy: 5894.0/6000 (98.2333%)
Took 5417.2760672569275 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.004112
Train set: Average loss: 0.0230
Valid set: Average loss: 3.0529, Accuracy: 23368/36000 (65%)
Took 5443.105197906494 seconds.
Test set: Average loss: 1.5644, Top-1 Accuracy: 4770/6000 (79.5000%)
Took 5444.334100484848 seconds.
Test set: Average loss: 1.5644, Top-5 Accuracy: 5868.0/6000 (97.8000%)
Took 5444.334100484848 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.001610
Train set: Average loss: 0.0035
Valid set: Average loss: 3.2386, Accuracy: 23376/36000 (65%)
Took 5469.320457935333 seconds.
Test set: Average loss: 1.6482, Top-1 Accuracy: 4788/6000 (79.8000%)
Took 5470.539216995239 seconds.
Test set: Average loss: 1.6482, Top-5 Accuracy: 5878.0/6000 (97.9667%)
Took 5470.539216995239 seconds.

----- Layer 5, Node 8, Epoch 28/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.000716
Train set: Average loss: 0.0013
Valid set: Average loss: 3.3418, Accuracy: 23401/36000 (65%)
Took 5495.871463060379 seconds.
Test set: Average loss: 1.7291, Top-1 Accuracy: 4781/6000 (79.6833%)
Took 5497.1328020095825 seconds.
Test set: Average loss: 1.7291, Top-5 Accuracy: 5868.0/6000 (97.8000%)
Took 5497.1328020095825 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 0.9511, Top-1 Accuracy: 4604/6000 (76.7333%)
Took 5498.385752916336 seconds.
Test set: Average loss: 0.9511, Top-5 Accuracy: 5869.0/6000 (97.8167%)
Took 5498.385752916336 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 0.9383, Top-1 Accuracy: 4644/6000 (77.4000%)
Took 5499.267379045486 seconds.
Test set: Average loss: 0.9383, Top-5 Accuracy: 5891.0/6000 (98.1833%)
Took 5499.267379045486 seconds.
Test set: Average loss: 1.0925, Top-1 Accuracy: 4634/6000 (77.2333%)
Took 5500.342910289764 seconds.
Test set: Average loss: 1.0925, Top-5 Accuracy: 5748.0/6000 (95.8000%)
Took 5500.342910289764 seconds.
Test set: Average loss: 4.0768, Top-1 Accuracy: 1884/6000 (31.4000%)
Took 5501.895232200623 seconds.
Test set: Average loss: 4.0768, Top-5 Accuracy: 4053.0/6000 (67.5500%)
Took 5501.895232200623 seconds.
Test set: Average loss: 1.5097, Top-1 Accuracy: 4311/6000 (71.8500%)
Took 5503.930621623993 seconds.
Test set: Average loss: 1.5097, Top-5 Accuracy: 5504.0/6000 (91.7333%)
Took 5503.930621623993 seconds.
Test set: Average loss: 2.0027, Top-1 Accuracy: 3518/6000 (58.6333%)
Took 5506.163309812546 seconds.
Test set: Average loss: 2.0027, Top-5 Accuracy: 5348.0/6000 (89.1333%)
Took 5506.163309812546 seconds.
Test set: Average loss: 0.9511, Top-1 Accuracy: 4604/6000 (76.7333%)
Took 5507.381005764008 seconds.
Test set: Average loss: 0.9511, Top-5 Accuracy: 5869.0/6000 (97.8167%)
Took 5507.381005764008 seconds.

Average Top-1 accuracy: tensor(65.5417)

----- Top1 acc: [83.66666412353516, 81.9000015258789, 53.40555191040039, 66.67916870117188, 66.00999450683594, 65.54166412353516]
----- Top5 acc: [99.71666717529297, 98.95833587646484, 87.2611083984375, 92.94166564941406, 93.49666595458984, 90.03611755371094]
============== Continual learning on task 6 =================

[before adaption and growth]
Test set: Average loss: 4.3650, Top-1 Accuracy: 1963/6000 (32.7167%)
Took 5508.82279253006 seconds.
Test set: Average loss: 4.3650, Top-5 Accuracy: 4535.0/6000 (75.5833%)
Took 5508.82279253006 seconds.
old_data shape: torch.Size([25000, 3072])
new_data_1 shape: torch.Size([25000, 3072])
MMD loss:tensor(0.6366, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.0108, 0.9075, 0.0432, 0.0385], device='cuda:0')
[7, 8, 9, 6]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 4.3650, Top-1 Accuracy: 1963/6000 (32.7167%)
Took 5522.715626716614 seconds.
Test set: Average loss: 4.3650, Top-5 Accuracy: 4535.0/6000 (75.5833%)
Took 5522.715626716614 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.665032
Train set: Average loss: 0.9532
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.9324, Accuracy: 25741/42000 (61%)
Took 5547.641737937927 seconds.
Test set: Average loss: 1.4877, Top-1 Accuracy: 3785/6000 (63.0833%)
Took 5548.70031785965 seconds.
Test set: Average loss: 1.4877, Top-5 Accuracy: 5711.0/6000 (95.1833%)
Took 5548.70031785965 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.443553
Train set: Average loss: 0.5277
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.2259, Accuracy: 25743/42000 (61%)
Took 5573.854331254959 seconds.
Test set: Average loss: 1.5523, Top-1 Accuracy: 4073/6000 (67.8833%)
Took 5574.8775544166565 seconds.
Test set: Average loss: 1.5523, Top-5 Accuracy: 5709.0/6000 (95.1500%)
Took 5574.8775544166565 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.373241
Train set: Average loss: 0.4049
Valid set: Average loss: 2.4893, Accuracy: 25082/42000 (60%)
Took 5601.297149896622 seconds.
Test set: Average loss: 1.6197, Top-1 Accuracy: 4016/6000 (66.9333%)
Took 5602.362771272659 seconds.
Test set: Average loss: 1.6197, Top-5 Accuracy: 5746.0/6000 (95.7667%)
Took 5602.362771272659 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.300731
Train set: Average loss: 0.3328
Valid set: Average loss: 2.5902, Accuracy: 25146/42000 (60%)
Took 5628.263509988785 seconds.
Test set: Average loss: 1.6353, Top-1 Accuracy: 4112/6000 (68.5333%)
Took 5629.317905902863 seconds.
Test set: Average loss: 1.6353, Top-5 Accuracy: 5751.0/6000 (95.8500%)
Took 5629.317905902863 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.253111
Train set: Average loss: 0.2855
Valid set: Average loss: 3.2483, Accuracy: 24733/42000 (59%)
Took 5655.3415632247925 seconds.
Test set: Average loss: 2.0318, Top-1 Accuracy: 3989/6000 (66.4833%)
Took 5656.410003423691 seconds.
Test set: Average loss: 2.0318, Top-5 Accuracy: 5712.0/6000 (95.2000%)
Took 5656.410003423691 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.212486
Train set: Average loss: 0.2526
Valid set: Average loss: 3.2676, Accuracy: 23943/42000 (57%)
Took 5682.598342180252 seconds.
Test set: Average loss: 1.8523, Top-1 Accuracy: 4101/6000 (68.3500%)
Took 5683.652225732803 seconds.
Test set: Average loss: 1.8523, Top-5 Accuracy: 5762.0/6000 (96.0333%)
Took 5683.652225732803 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.195169
Train set: Average loss: 0.2298
Valid set: Average loss: 3.2622, Accuracy: 24082/42000 (57%)
Took 5709.762684345245 seconds.
Test set: Average loss: 1.9658, Top-1 Accuracy: 4050/6000 (67.5000%)
Took 5710.836895465851 seconds.
Test set: Average loss: 1.9658, Top-5 Accuracy: 5745.0/6000 (95.7500%)
Took 5710.836895465851 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.178816
Train set: Average loss: 0.2085
Valid set: Average loss: 3.1462, Accuracy: 24046/42000 (57%)
Took 5736.889140129089 seconds.
Test set: Average loss: 2.0833, Top-1 Accuracy: 4051/6000 (67.5167%)
Took 5737.949939489365 seconds.
Test set: Average loss: 2.0833, Top-5 Accuracy: 5645.0/6000 (94.0833%)
Took 5737.949939489365 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.162583
Train set: Average loss: 0.1855
Valid set: Average loss: 3.3940, Accuracy: 23260/42000 (55%)
Took 5763.775316238403 seconds.
Test set: Average loss: 2.1423, Top-1 Accuracy: 3997/6000 (66.6167%)
Took 5764.837037563324 seconds.
Test set: Average loss: 2.1423, Top-5 Accuracy: 5735.0/6000 (95.5833%)
Took 5764.837037563324 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.139285
Train set: Average loss: 0.1632
Valid set: Average loss: 3.2972, Accuracy: 23839/42000 (57%)
Took 5790.999987125397 seconds.
Test set: Average loss: 2.1975, Top-1 Accuracy: 3936/6000 (65.6000%)
Took 5792.085957527161 seconds.
Test set: Average loss: 2.1975, Top-5 Accuracy: 5775.0/6000 (96.2500%)
Took 5792.085957527161 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.125495
Train set: Average loss: 0.1500
Valid set: Average loss: 3.2119, Accuracy: 24658/42000 (59%)
Took 5818.244859933853 seconds.
Test set: Average loss: 1.9927, Top-1 Accuracy: 4129/6000 (68.8167%)
Took 5819.3091361522675 seconds.
Test set: Average loss: 1.9927, Top-5 Accuracy: 5780.0/6000 (96.3333%)
Took 5819.3091361522675 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.139838
Train set: Average loss: 0.1323
Valid set: Average loss: 2.9210, Accuracy: 24327/42000 (58%)
Took 5845.227885246277 seconds.
Test set: Average loss: 1.9461, Top-1 Accuracy: 3960/6000 (66.0000%)
Took 5846.371955394745 seconds.
Test set: Average loss: 1.9461, Top-5 Accuracy: 5814.0/6000 (96.9000%)
Took 5846.371955394745 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.114978
Train set: Average loss: 0.1351
Valid set: Average loss: 4.2081, Accuracy: 21227/42000 (51%)
Took 5872.268975734711 seconds.
Test set: Average loss: 3.0511, Top-1 Accuracy: 3555/6000 (59.2500%)
Took 5873.3606152534485 seconds.
Test set: Average loss: 3.0511, Top-5 Accuracy: 5751.0/6000 (95.8500%)
Took 5873.3606152534485 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.114045
Train set: Average loss: 0.1207
Valid set: Average loss: 3.6231, Accuracy: 22770/42000 (54%)
Took 5899.156229496002 seconds.
Test set: Average loss: 1.9855, Top-1 Accuracy: 4099/6000 (68.3167%)
Took 5900.21456360817 seconds.
Test set: Average loss: 1.9855, Top-5 Accuracy: 5828.0/6000 (97.1333%)
Took 5900.21456360817 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.104354
Train set: Average loss: 0.1009
Valid set: Average loss: 3.2807, Accuracy: 24020/42000 (57%)
Took 5926.371229887009 seconds.
Test set: Average loss: 2.0989, Top-1 Accuracy: 4071/6000 (67.8500%)
Took 5927.401911497116 seconds.
Test set: Average loss: 2.0989, Top-5 Accuracy: 5752.0/6000 (95.8667%)
Took 5927.401911497116 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.099009
Train set: Average loss: 0.1020
Valid set: Average loss: 3.0212, Accuracy: 24859/42000 (59%)
Took 5953.393785953522 seconds.
Test set: Average loss: 1.9592, Top-1 Accuracy: 4095/6000 (68.2500%)
Took 5954.500157594681 seconds.
Test set: Average loss: 1.9592, Top-5 Accuracy: 5697.0/6000 (94.9500%)
Took 5954.500157594681 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.095011
Train set: Average loss: 0.0897
Valid set: Average loss: 3.3839, Accuracy: 24081/42000 (57%)
Took 5980.815794706345 seconds.
Test set: Average loss: 2.0295, Top-1 Accuracy: 4128/6000 (68.8000%)
Took 5981.978672742844 seconds.
Test set: Average loss: 2.0295, Top-5 Accuracy: 5787.0/6000 (96.4500%)
Took 5981.978672742844 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.097716
Train set: Average loss: 0.0859
Valid set: Average loss: 3.1347, Accuracy: 25178/42000 (60%)
Took 6007.977060317993 seconds.
Test set: Average loss: 2.1991, Top-1 Accuracy: 4096/6000 (68.2667%)
Took 6009.0126321315765 seconds.
Test set: Average loss: 2.1991, Top-5 Accuracy: 5697.0/6000 (94.9500%)
Took 6009.0126321315765 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.079711
Train set: Average loss: 0.0921
Valid set: Average loss: 3.6946, Accuracy: 24034/42000 (57%)
Took 6034.092367172241 seconds.
Test set: Average loss: 2.2602, Top-1 Accuracy: 4070/6000 (67.8333%)
Took 6035.119326353073 seconds.
Test set: Average loss: 2.2602, Top-5 Accuracy: 5653.0/6000 (94.2167%)
Took 6035.119326353073 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.072106
Train set: Average loss: 0.0812
Valid set: Average loss: 4.1931, Accuracy: 24580/42000 (59%)
Took 6060.755496501923 seconds.
Test set: Average loss: 2.0681, Top-1 Accuracy: 4332/6000 (72.2000%)
Took 6061.782183885574 seconds.
Test set: Average loss: 2.0681, Top-5 Accuracy: 5786.0/6000 (96.4333%)
Took 6061.782183885574 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.066181
Train set: Average loss: 0.0727
Valid set: Average loss: 3.7216, Accuracy: 24489/42000 (58%)
Took 6087.05926156044 seconds.
Test set: Average loss: 2.2833, Top-1 Accuracy: 4176/6000 (69.6000%)
Took 6088.087974309921 seconds.
Test set: Average loss: 2.2833, Top-5 Accuracy: 5723.0/6000 (95.3833%)
Took 6088.087974309921 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.106565
Train set: Average loss: 0.0819
Valid set: Average loss: 3.7894, Accuracy: 24656/42000 (59%)
Took 6113.08291721344 seconds.
Test set: Average loss: 2.0698, Top-1 Accuracy: 4261/6000 (71.0167%)
Took 6114.115110635757 seconds.
Test set: Average loss: 2.0698, Top-5 Accuracy: 5791.0/6000 (96.5167%)
Took 6114.115110635757 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.065687
Train set: Average loss: 0.0716
Valid set: Average loss: 3.5240, Accuracy: 24633/42000 (59%)
Took 6139.1587698459625 seconds.
Test set: Average loss: 2.2433, Top-1 Accuracy: 4205/6000 (70.0833%)
Took 6140.1705865859985 seconds.
Test set: Average loss: 2.2433, Top-5 Accuracy: 5742.0/6000 (95.7000%)
Took 6140.1705865859985 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.071406
Train set: Average loss: 0.0749
Valid set: Average loss: 4.1816, Accuracy: 23233/42000 (55%)
Took 6164.511926412582 seconds.
Test set: Average loss: 2.4543, Top-1 Accuracy: 4108/6000 (68.4667%)
Took 6165.520479917526 seconds.
Test set: Average loss: 2.4543, Top-5 Accuracy: 5645.0/6000 (94.0833%)
Took 6165.520479917526 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.078733
Train set: Average loss: 0.0690
Valid set: Average loss: 3.9117, Accuracy: 24519/42000 (58%)
Took 6190.281856536865 seconds.
Test set: Average loss: 2.1032, Top-1 Accuracy: 4350/6000 (72.5000%)
Took 6191.383696317673 seconds.
Test set: Average loss: 2.1032, Top-5 Accuracy: 5742.0/6000 (95.7000%)
Took 6191.383696317673 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.009296
Train set: Average loss: 0.0343
Valid set: Average loss: 3.4323, Accuracy: 24993/42000 (60%)
Took 6217.008971214294 seconds.
Test set: Average loss: 1.9512, Top-1 Accuracy: 4297/6000 (71.6167%)
Took 6218.061735630035 seconds.
Test set: Average loss: 1.9512, Top-5 Accuracy: 5751.0/6000 (95.8500%)
Took 6218.061735630035 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.002739
Train set: Average loss: 0.0058
Valid set: Average loss: 3.6983, Accuracy: 25053/42000 (60%)
Took 6243.515745639801 seconds.
Test set: Average loss: 2.0933, Top-1 Accuracy: 4328/6000 (72.1333%)
Took 6244.56831908226 seconds.
Test set: Average loss: 2.0933, Top-5 Accuracy: 5771.0/6000 (96.1833%)
Took 6244.56831908226 seconds.

----- Layer 5, Node 8, Epoch 28/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.001174
Train set: Average loss: 0.0024
Valid set: Average loss: 3.8511, Accuracy: 25113/42000 (60%)
Took 6270.052783727646 seconds.
Test set: Average loss: 2.1923, Top-1 Accuracy: 4331/6000 (72.1833%)
Took 6271.103221654892 seconds.
Test set: Average loss: 2.1923, Top-5 Accuracy: 5771.0/6000 (96.1833%)
Took 6271.103221654892 seconds.

----- Layer 5, Node 8, Epoch 29/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.000815
Train set: Average loss: 0.0014
Valid set: Average loss: 3.9850, Accuracy: 25116/42000 (60%)
Took 6296.635583639145 seconds.
Test set: Average loss: 2.2778, Top-1 Accuracy: 4337/6000 (72.2833%)
Took 6297.690457344055 seconds.
Test set: Average loss: 2.2778, Top-5 Accuracy: 5776.0/6000 (96.2667%)
Took 6297.690457344055 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.5523, Top-1 Accuracy: 4073/6000 (67.8833%)
Took 6298.78902220726 seconds.
Test set: Average loss: 1.5523, Top-5 Accuracy: 5709.0/6000 (95.1500%)
Took 6298.78902220726 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 1.6214, Top-1 Accuracy: 4362/6000 (72.7000%)
Took 6299.694258928299 seconds.
Test set: Average loss: 1.6214, Top-5 Accuracy: 5547.0/6000 (92.4500%)
Took 6299.694258928299 seconds.
Test set: Average loss: 0.9485, Top-1 Accuracy: 4718/6000 (78.6333%)
Took 6300.7487144470215 seconds.
Test set: Average loss: 0.9485, Top-5 Accuracy: 5856.0/6000 (97.6000%)
Took 6300.7487144470215 seconds.
Test set: Average loss: 4.8273, Top-1 Accuracy: 1527/6000 (25.4500%)
Took 6302.213980436325 seconds.
Test set: Average loss: 4.8273, Top-5 Accuracy: 4000.0/6000 (66.6667%)
Took 6302.213980436325 seconds.
Test set: Average loss: 2.0816, Top-1 Accuracy: 3906/6000 (65.1000%)
Took 6304.32613658905 seconds.
Test set: Average loss: 2.0816, Top-5 Accuracy: 5281.0/6000 (88.0167%)
Took 6304.32613658905 seconds.
Test set: Average loss: 2.6725, Top-1 Accuracy: 3133/6000 (52.2167%)
Took 6306.625255584717 seconds.
Test set: Average loss: 2.6725, Top-5 Accuracy: 5066.0/6000 (84.4333%)
Took 6306.625255584717 seconds.
Test set: Average loss: 1.8776, Top-1 Accuracy: 4024/6000 (67.0667%)
Took 6307.871919870377 seconds.
Test set: Average loss: 1.8776, Top-5 Accuracy: 5493.0/6000 (91.5500%)
Took 6307.871919870377 seconds.
Test set: Average loss: 1.5523, Top-1 Accuracy: 4073/6000 (67.8833%)
Took 6308.918767213821 seconds.
Test set: Average loss: 1.5523, Top-5 Accuracy: 5709.0/6000 (95.1500%)
Took 6308.918767213821 seconds.

Average Top-1 accuracy: tensor(61.2929)

----- Top1 acc: [83.66666412353516, 81.9000015258789, 53.40555191040039, 66.67916870117188, 66.00999450683594, 65.54166412353516, 61.29285
----- Top5 acc: [99.71666717529297, 98.95833587646484, 87.2611083984375, 92.94166564941406, 93.49666595458984, 90.03611755371094, 87.98094
============== Continual learning on task 7 =================

[before adaption and growth]
Test set: Average loss: 1.8497, Top-1 Accuracy: 4086/6000 (68.1000%)
Took 6310.122081041336 seconds.
Test set: Average loss: 1.8497, Top-5 Accuracy: 5376.0/6000 (89.6000%)
Took 6310.122081041336 seconds.
old_data shape: torch.Size([20000, 3072])
new_data_1 shape: torch.Size([20000, 3072])
MMD loss:tensor(0.2963, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.0091, 0.7681, 0.1068, 0.1160], device='cuda:0')
[7, 9, 8, 6]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 1.8497, Top-1 Accuracy: 4086/6000 (68.1000%)
Took 6321.860635042191 seconds.
Test set: Average loss: 1.8497, Top-5 Accuracy: 5376.0/6000 (89.6000%)
Took 6321.860635042191 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.447409
Train set: Average loss: 0.5705
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8221, Accuracy: 31574/48000 (66%)
Took 6348.426068305969 seconds.
Test set: Average loss: 0.6645, Top-1 Accuracy: 4937/6000 (82.2833%)
Took 6349.486751794815 seconds.
Test set: Average loss: 0.6645, Top-5 Accuracy: 5970.0/6000 (99.5000%)
Took 6349.486751794815 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.340891
Train set: Average loss: 0.3466
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7579, Accuracy: 32236/48000 (67%)
Took 6375.974738121033 seconds.
Test set: Average loss: 0.7151, Top-1 Accuracy: 4927/6000 (82.1167%)
Took 6377.030848026276 seconds.
Test set: Average loss: 0.7151, Top-5 Accuracy: 5974.0/6000 (99.5667%)
Took 6377.030848026276 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.283225
Train set: Average loss: 0.2836
Valid set: Average loss: 2.2136, Accuracy: 31469/48000 (66%)
Took 6402.634630680084 seconds.
Test set: Average loss: 0.8261, Top-1 Accuracy: 4944/6000 (82.4000%)
Took 6403.646695613861 seconds.
Test set: Average loss: 0.8261, Top-5 Accuracy: 5933.0/6000 (98.8833%)
Took 6403.646695613861 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.224087
Train set: Average loss: 0.2378
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.1225, Accuracy: 32546/48000 (68%)
Took 6429.023350954056 seconds.
Test set: Average loss: 0.9519, Top-1 Accuracy: 4910/6000 (81.8333%)
Took 6430.037429094315 seconds.
Test set: Average loss: 0.9519, Top-5 Accuracy: 5926.0/6000 (98.7667%)
Took 6430.037429094315 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.215283
Train set: Average loss: 0.2164
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.8025, Accuracy: 32583/48000 (68%)
Took 6455.435432195663 seconds.
Test set: Average loss: 0.9317, Top-1 Accuracy: 4893/6000 (81.5500%)
Took 6456.473440170288 seconds.
Test set: Average loss: 0.9317, Top-5 Accuracy: 5950.0/6000 (99.1667%)
Took 6456.473440170288 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.190125
Train set: Average loss: 0.1914
Valid set: Average loss: 2.0851, Accuracy: 31586/48000 (66%)
Took 6482.889426231384 seconds.
Test set: Average loss: 1.0741, Top-1 Accuracy: 4779/6000 (79.6500%)
Took 6483.925807952881 seconds.
Test set: Average loss: 1.0741, Top-5 Accuracy: 5941.0/6000 (99.0167%)
Took 6483.925807952881 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.167748
Train set: Average loss: 0.1678
Valid set: Average loss: 1.9950, Accuracy: 32225/48000 (67%)
Took 6509.994095087051 seconds.
Test set: Average loss: 0.8155, Top-1 Accuracy: 5002/6000 (83.3667%)
Took 6511.034774780273 seconds.
Test set: Average loss: 0.8155, Top-5 Accuracy: 5946.0/6000 (99.1000%)
Took 6511.034774780273 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.149494
Train set: Average loss: 0.1413
Valid set: Average loss: 2.0656, Accuracy: 31949/48000 (67%)
Took 6537.809372186661 seconds.
Test set: Average loss: 0.9223, Top-1 Accuracy: 4977/6000 (82.9500%)
Took 6538.849209070206 seconds.
Test set: Average loss: 0.9223, Top-5 Accuracy: 5936.0/6000 (98.9333%)
Took 6538.849209070206 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.126384
Train set: Average loss: 0.1276
Valid set: Average loss: 2.7884, Accuracy: 31435/48000 (65%)
Took 6564.915481328964 seconds.
Test set: Average loss: 1.3876, Top-1 Accuracy: 4810/6000 (80.1667%)
Took 6565.955814599991 seconds.
Test set: Average loss: 1.3876, Top-5 Accuracy: 5919.0/6000 (98.6500%)
Took 6565.955814599991 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.108436
Train set: Average loss: 0.1138
Valid set: Average loss: 2.3480, Accuracy: 32410/48000 (68%)
Took 6591.609464883804 seconds.
Test set: Average loss: 1.0796, Top-1 Accuracy: 4942/6000 (82.3667%)
Took 6592.628064632416 seconds.
Test set: Average loss: 1.0796, Top-5 Accuracy: 5943.0/6000 (99.0500%)
Took 6592.628064632416 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.100208
Train set: Average loss: 0.1033
Valid set: Average loss: 2.5330, Accuracy: 31810/48000 (66%)
Took 6617.9527270793915 seconds.
Test set: Average loss: 1.1330, Top-1 Accuracy: 4962/6000 (82.7000%)
Took 6618.962915658951 seconds.
Test set: Average loss: 1.1330, Top-5 Accuracy: 5918.0/6000 (98.6333%)
Took 6618.962915658951 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.090816
Train set: Average loss: 0.0973
Valid set: Average loss: 2.7487, Accuracy: 31679/48000 (66%)
Took 6644.308861494064 seconds.
Test set: Average loss: 1.1770, Top-1 Accuracy: 4987/6000 (83.1167%)
Took 6645.317058801651 seconds.
Test set: Average loss: 1.1770, Top-5 Accuracy: 5912.0/6000 (98.5333%)
Took 6645.317058801651 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.090100
Train set: Average loss: 0.0833
Valid set: Average loss: 3.1174, Accuracy: 30551/48000 (64%)
Took 6670.844637155533 seconds.
Test set: Average loss: 1.4163, Top-1 Accuracy: 4875/6000 (81.2500%)
Took 6671.858124256134 seconds.
Test set: Average loss: 1.4163, Top-5 Accuracy: 5921.0/6000 (98.6833%)
Took 6671.858124256134 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.096324
Train set: Average loss: 0.0888
Valid set: Average loss: 2.7929, Accuracy: 31106/48000 (65%)
Took 6697.234242916107 seconds.
Test set: Average loss: 1.1371, Top-1 Accuracy: 4973/6000 (82.8833%)
Took 6698.247380495071 seconds.
Test set: Average loss: 1.1371, Top-5 Accuracy: 5914.0/6000 (98.5667%)
Took 6698.247380495071 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.080546
Train set: Average loss: 0.0858
Valid set: Average loss: 2.6851, Accuracy: 31456/48000 (66%)
Took 6724.891026496887 seconds.
Test set: Average loss: 1.4262, Top-1 Accuracy: 4848/6000 (80.8000%)
Took 6725.952532052994 seconds.
Test set: Average loss: 1.4262, Top-5 Accuracy: 5890.0/6000 (98.1667%)
Took 6725.952532052994 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.068729
Train set: Average loss: 0.0857
Valid set: Average loss: 3.1135, Accuracy: 30249/48000 (63%)
Took 6752.433618068695 seconds.
Test set: Average loss: 1.4343, Top-1 Accuracy: 4809/6000 (80.1500%)
Took 6753.487060070038 seconds.
Test set: Average loss: 1.4343, Top-5 Accuracy: 5890.0/6000 (98.1667%)
Took 6753.487060070038 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.082014
Train set: Average loss: 0.0890
Valid set: Average loss: 2.6268, Accuracy: 31727/48000 (66%)
Took 6779.950314044952 seconds.
Test set: Average loss: 1.1726, Top-1 Accuracy: 4992/6000 (83.2000%)
Took 6781.034775972366 seconds.
Test set: Average loss: 1.1726, Top-5 Accuracy: 5912.0/6000 (98.5333%)
Took 6781.034775972366 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.072837
Train set: Average loss: 0.0754
Valid set: Average loss: 3.0527, Accuracy: 31097/48000 (65%)
Took 6807.312714576721 seconds.
Test set: Average loss: 1.3822, Top-1 Accuracy: 4940/6000 (82.3333%)
Took 6808.333129644394 seconds.
Test set: Average loss: 1.3822, Top-5 Accuracy: 5880.0/6000 (98.0000%)
Took 6808.333129644394 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.069387
Train set: Average loss: 0.0688
Valid set: Average loss: 2.9161, Accuracy: 31580/48000 (66%)
Took 6833.801471233368 seconds.
Test set: Average loss: 1.1095, Top-1 Accuracy: 5055/6000 (84.2500%)
Took 6834.81507229805 seconds.
Test set: Average loss: 1.1095, Top-5 Accuracy: 5926.0/6000 (98.7667%)
Took 6834.81507229805 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.062369
Train set: Average loss: 0.0598
Valid set: Average loss: 3.0615, Accuracy: 31729/48000 (66%)
Took 6860.219505310059 seconds.
Test set: Average loss: 1.3246, Top-1 Accuracy: 5013/6000 (83.5500%)
Took 6861.233397960663 seconds.
Test set: Average loss: 1.3246, Top-5 Accuracy: 5926.0/6000 (98.7667%)
Took 6861.233397960663 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.066657
Train set: Average loss: 0.0669
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.6440, Accuracy: 32790/48000 (68%)
Took 6886.720697641373 seconds.
Test set: Average loss: 1.2092, Top-1 Accuracy: 5018/6000 (83.6333%)
Took 6887.736233472824 seconds.
Test set: Average loss: 1.2092, Top-5 Accuracy: 5946.0/6000 (99.1000%)
Took 6887.736233472824 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.060956
Train set: Average loss: 0.0586
Valid set: Average loss: 3.4474, Accuracy: 30720/48000 (64%)
Took 6913.105216503143 seconds.
Test set: Average loss: 1.3234, Top-1 Accuracy: 4991/6000 (83.1833%)
Took 6914.213952302933 seconds.
Test set: Average loss: 1.3234, Top-5 Accuracy: 5935.0/6000 (98.9167%)
Took 6914.213952302933 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.067949
Train set: Average loss: 0.0666
Valid set: Average loss: 2.7942, Accuracy: 31565/48000 (66%)
Took 6939.644878149033 seconds.
Test set: Average loss: 1.2393, Top-1 Accuracy: 4991/6000 (83.1833%)
Took 6940.650573015213 seconds.
Test set: Average loss: 1.2393, Top-5 Accuracy: 5915.0/6000 (98.5833%)
Took 6940.650573015213 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.044965
Train set: Average loss: 0.0598
Valid set: Average loss: 3.1318, Accuracy: 31589/48000 (66%)
Took 6965.837064743042 seconds.
Test set: Average loss: 1.4368, Top-1 Accuracy: 4952/6000 (82.5333%)
Took 6966.838963031769 seconds.
Test set: Average loss: 1.4368, Top-5 Accuracy: 5881.0/6000 (98.0167%)
Took 6966.838963031769 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.059521
Train set: Average loss: 0.0567
Valid set: Average loss: 3.5099, Accuracy: 30799/48000 (64%)
Took 6992.426001548767 seconds.
Test set: Average loss: 1.5669, Top-1 Accuracy: 4939/6000 (82.3167%)
Took 6993.4339435100555 seconds.
Test set: Average loss: 1.5669, Top-5 Accuracy: 5884.0/6000 (98.0667%)
Took 6993.4339435100555 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.008506
Train set: Average loss: 0.0224
Valid set: Average loss: 2.8824, Accuracy: 32265/48000 (67%)
Took 7018.548664093018 seconds.
Test set: Average loss: 1.3171, Top-1 Accuracy: 5038/6000 (83.9667%)
Took 7019.552416086197 seconds.
Test set: Average loss: 1.3171, Top-5 Accuracy: 5910.0/6000 (98.5000%)
Took 7019.552416086197 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.001156
Train set: Average loss: 0.0029
Valid set: Average loss: 3.0353, Accuracy: 32215/48000 (67%)
Took 7044.671420097351 seconds.
Test set: Average loss: 1.3778, Top-1 Accuracy: 5048/6000 (84.1333%)
Took 7045.696827411652 seconds.
Test set: Average loss: 1.3778, Top-5 Accuracy: 5905.0/6000 (98.4167%)
Took 7045.696827411652 seconds.

----- Layer 5, Node 8, Epoch 28/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.000673
Train set: Average loss: 0.0011
Valid set: Average loss: 3.1350, Accuracy: 32265/48000 (67%)
Took 7070.877484798431 seconds.
Test set: Average loss: 1.4204, Top-1 Accuracy: 5047/6000 (84.1167%)
Took 7071.87989282608 seconds.
Test set: Average loss: 1.4204, Top-5 Accuracy: 5902.0/6000 (98.3667%)
Took 7071.87989282608 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.2092, Top-1 Accuracy: 5018/6000 (83.6333%)
Took 7072.916339874268 seconds.
Test set: Average loss: 1.2092, Top-5 Accuracy: 5946.0/6000 (99.1000%)
Took 7072.916339874268 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 2.6761, Top-1 Accuracy: 4367/6000 (72.7833%)
Took 7073.776136875153 seconds.
Test set: Average loss: 2.6761, Top-5 Accuracy: 5635.0/6000 (93.9167%)
Took 7073.776136875153 seconds.
Test set: Average loss: 1.1873, Top-1 Accuracy: 5071/6000 (84.5167%)
Took 7074.770881175995 seconds.
Test set: Average loss: 1.1873, Top-5 Accuracy: 5882.0/6000 (98.0333%)
Took 7074.770881175995 seconds.
Test set: Average loss: 3.6954, Top-1 Accuracy: 3064/6000 (51.0667%)
Took 7076.168784856796 seconds.
Test set: Average loss: 3.6954, Top-5 Accuracy: 5344.0/6000 (89.0667%)
Took 7076.168784856796 seconds.
Test set: Average loss: 1.6987, Top-1 Accuracy: 4735/6000 (78.9167%)
Took 7078.147912740707 seconds.
Test set: Average loss: 1.6987, Top-5 Accuracy: 5776.0/6000 (96.2667%)
Took 7078.147912740707 seconds.
Test set: Average loss: 3.2006, Top-1 Accuracy: 3759/6000 (62.6500%)
Took 7080.316175699234 seconds.
Test set: Average loss: 3.2006, Top-5 Accuracy: 5484.0/6000 (91.4000%)
Took 7080.316175699234 seconds.
Test set: Average loss: 2.8807, Top-1 Accuracy: 4073/6000 (67.8833%)
Took 7081.500288724899 seconds.
Test set: Average loss: 2.8807, Top-5 Accuracy: 5531.0/6000 (92.1833%)
Took 7081.500288724899 seconds.
Test set: Average loss: 4.6039, Top-1 Accuracy: 2703/6000 (45.0500%)
Took 7082.492418766022 seconds.
Test set: Average loss: 4.6039, Top-5 Accuracy: 5210.0/6000 (86.8333%)
Took 7082.492418766022 seconds.
Test set: Average loss: 1.2092, Top-1 Accuracy: 5018/6000 (83.6333%)
Took 7083.503788232803 seconds.
Test set: Average loss: 1.2092, Top-5 Accuracy: 5946.0/6000 (99.1000%)
Took 7083.503788232803 seconds.

Average Top-1 accuracy: tensor(68.3125)

----- Top1 acc: [83.66666412353516, 81.9000015258789, 53.40555191040039, 66.67916870117188, 66.00999450683594, 65.54166412353516, 61.29285
----- Top5 acc: [99.71666717529297, 98.95833587646484, 87.2611083984375, 92.94166564941406, 93.49666595458984, 90.03611755371094, 87.98094
============== Continual learning on task 8 =================

[before adaption and growth]
Test set: Average loss: 4.4023, Top-1 Accuracy: 2632/6000 (43.8667%)
Took 7085.185549259186 seconds.
Test set: Average loss: 4.4023, Top-5 Accuracy: 5129.0/6000 (85.4833%)
Took 7085.185549259186 seconds.
old_data shape: torch.Size([15000, 3072])
new_data_1 shape: torch.Size([15000, 3072])
MMD loss:tensor(1.3514, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.4342, 0.5186, 0.0066, 0.0406], device='cuda:0')
[7, 6, 9, 8]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 4.4023, Top-1 Accuracy: 2632/6000 (43.8667%)
Took 7096.596904039383 seconds.
Test set: Average loss: 4.4023, Top-5 Accuracy: 5129.0/6000 (85.4833%)
Took 7096.596904039383 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.741134
Train set: Average loss: 0.9747
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.5470, Accuracy: 26425/54000 (49%)
Took 7126.846875429153 seconds.
Test set: Average loss: 0.7858, Top-1 Accuracy: 4500/6000 (75.0000%)
Took 7128.300441026688 seconds.
Test set: Average loss: 0.7858, Top-5 Accuracy: 5923.0/6000 (98.7167%)
Took 7128.300441026688 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.513640
Train set: Average loss: 0.5603
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.9662, Accuracy: 27075/54000 (50%)
Took 7157.485604047775 seconds.
Test set: Average loss: 0.8521, Top-1 Accuracy: 4571/6000 (76.1833%)
Took 7158.891533374786 seconds.
Test set: Average loss: 0.8521, Top-5 Accuracy: 5915.0/6000 (98.5833%)
Took 7158.891533374786 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.400029
Train set: Average loss: 0.4104
Valid set: Average loss: 3.6050, Accuracy: 26734/54000 (50%)
Took 7187.579874277115 seconds.
Test set: Average loss: 1.0136, Top-1 Accuracy: 4545/6000 (75.7500%)
Took 7188.974189758301 seconds.
Test set: Average loss: 1.0136, Top-5 Accuracy: 5914.0/6000 (98.5667%)
Took 7188.974189758301 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.322297
Train set: Average loss: 0.3230
Valid set: Average loss: 3.9154, Accuracy: 26687/54000 (49%)
Took 7218.350479602814 seconds.
Test set: Average loss: 1.2088, Top-1 Accuracy: 4476/6000 (74.6000%)
Took 7219.76433134079 seconds.
Test set: Average loss: 1.2088, Top-5 Accuracy: 5892.0/6000 (98.2000%)
Took 7219.76433134079 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.268294
Train set: Average loss: 0.2791
Valid set: Average loss: 4.2714, Accuracy: 26081/54000 (48%)
Took 7248.686089754105 seconds.
Test set: Average loss: 1.3863, Top-1 Accuracy: 4410/6000 (73.5000%)
Took 7250.092163801193 seconds.
Test set: Average loss: 1.3863, Top-5 Accuracy: 5823.0/6000 (97.0500%)
Took 7250.092163801193 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.261250
Train set: Average loss: 0.2518
Valid set: Average loss: 4.5277, Accuracy: 26287/54000 (49%)
Took 7278.964494943619 seconds.
Test set: Average loss: 1.2530, Top-1 Accuracy: 4612/6000 (76.8667%)
Took 7280.367472171783 seconds.
Test set: Average loss: 1.2530, Top-5 Accuracy: 5855.0/6000 (97.5833%)
Took 7280.367472171783 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.227114
Train set: Average loss: 0.2293
Valid set: Average loss: 4.5587, Accuracy: 25076/54000 (46%)
Took 7309.056319952011 seconds.
Test set: Average loss: 1.5264, Top-1 Accuracy: 4393/6000 (73.2167%)
Took 7310.45299243927 seconds.
Test set: Average loss: 1.5264, Top-5 Accuracy: 5832.0/6000 (97.2000%)
Took 7310.45299243927 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.203844
Train set: Average loss: 0.1934
Valid set: Average loss: 5.0399, Accuracy: 25155/54000 (47%)
Took 7339.086014986038 seconds.
Test set: Average loss: 1.5822, Top-1 Accuracy: 4426/6000 (73.7667%)
Took 7340.484600305557 seconds.
Test set: Average loss: 1.5822, Top-5 Accuracy: 5829.0/6000 (97.1500%)
Took 7340.484600305557 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.177789
Train set: Average loss: 0.1853
Valid set: Average loss: 4.3995, Accuracy: 26771/54000 (50%)
Took 7369.244432210922 seconds.
Test set: Average loss: 1.5099, Top-1 Accuracy: 4404/6000 (73.4000%)
Took 7370.670934677124 seconds.
Test set: Average loss: 1.5099, Top-5 Accuracy: 5834.0/6000 (97.2333%)
Took 7370.670934677124 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.155366
Train set: Average loss: 0.1618
Valid set: Average loss: 4.8278, Accuracy: 26763/54000 (50%)
Took 7399.475239753723 seconds.
Test set: Average loss: 1.9237, Top-1 Accuracy: 4274/6000 (71.2333%)
Took 7400.873088598251 seconds.
Test set: Average loss: 1.9237, Top-5 Accuracy: 5797.0/6000 (96.6167%)
Took 7400.873088598251 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.154585
Train set: Average loss: 0.1492
Valid set: Average loss: 5.8362, Accuracy: 24604/54000 (46%)
Took 7429.963679790497 seconds.
Test set: Average loss: 2.0131, Top-1 Accuracy: 4281/6000 (71.3500%)
Took 7431.372745990753 seconds.
Test set: Average loss: 2.0131, Top-5 Accuracy: 5795.0/6000 (96.5833%)
Took 7431.372745990753 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.160257
Train set: Average loss: 0.1509
Valid set: Average loss: 5.2374, Accuracy: 25813/54000 (48%)
Took 7460.080023765564 seconds.
Test set: Average loss: 1.8708, Top-1 Accuracy: 4303/6000 (71.7167%)
Took 7461.479649543762 seconds.
Test set: Average loss: 1.8708, Top-5 Accuracy: 5832.0/6000 (97.2000%)
Took 7461.479649543762 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.116750
Train set: Average loss: 0.1350
Valid set: Average loss: 4.8399, Accuracy: 26632/54000 (49%)
Took 7490.286966562271 seconds.
Test set: Average loss: 2.0060, Top-1 Accuracy: 4329/6000 (72.1500%)
Took 7491.691075086594 seconds.
Test set: Average loss: 2.0060, Top-5 Accuracy: 5826.0/6000 (97.1000%)
Took 7491.691075086594 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.121082
Train set: Average loss: 0.1200
Valid set: Average loss: 4.8585, Accuracy: 25971/54000 (48%)
Took 7521.287909984589 seconds.
Test set: Average loss: 1.7928, Top-1 Accuracy: 4370/6000 (72.8333%)
Took 7522.792341709137 seconds.
Test set: Average loss: 1.7928, Top-5 Accuracy: 5840.0/6000 (97.3333%)
Took 7522.792341709137 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.125864
Train set: Average loss: 0.1114
Valid set: Average loss: 5.1814, Accuracy: 24556/54000 (45%)
Took 7552.361601352692 seconds.
Test set: Average loss: 2.2714, Top-1 Accuracy: 4133/6000 (68.8833%)
Took 7553.806489944458 seconds.
Test set: Average loss: 2.2714, Top-5 Accuracy: 5740.0/6000 (95.6667%)
Took 7553.806489944458 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.099009
Train set: Average loss: 0.1106
Valid set: Average loss: 5.5816, Accuracy: 25537/54000 (47%)
Took 7583.78567481041 seconds.
Test set: Average loss: 1.9444, Top-1 Accuracy: 4308/6000 (71.8000%)
Took 7585.22479057312 seconds.
Test set: Average loss: 1.9444, Top-5 Accuracy: 5806.0/6000 (96.7667%)
Took 7585.22479057312 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.091345
Train set: Average loss: 0.0908
Valid set: Average loss: 5.7076, Accuracy: 26345/54000 (49%)
Took 7614.506490468979 seconds.
Test set: Average loss: 2.4920, Top-1 Accuracy: 4084/6000 (68.0667%)
Took 7615.922568798065 seconds.
Test set: Average loss: 2.4920, Top-5 Accuracy: 5802.0/6000 (96.7000%)
Took 7615.922568798065 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.080799
Train set: Average loss: 0.0932
Valid set: Average loss: 5.8568, Accuracy: 26079/54000 (48%)
Took 7645.3879499435425 seconds.
Test set: Average loss: 1.9406, Top-1 Accuracy: 4434/6000 (73.9000%)
Took 7646.80180644989 seconds.
Test set: Average loss: 1.9406, Top-5 Accuracy: 5785.0/6000 (96.4167%)
Took 7646.80180644989 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.076034
Train set: Average loss: 0.0900
Valid set: Average loss: 6.0390, Accuracy: 26188/54000 (48%)
Took 7675.756769895554 seconds.
Test set: Average loss: 1.6418, Top-1 Accuracy: 4527/6000 (75.4500%)
Took 7677.168322324753 seconds.
Test set: Average loss: 1.6418, Top-5 Accuracy: 5856.0/6000 (97.6000%)
Took 7677.168322324753 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 0.8521, Top-1 Accuracy: 4571/6000 (76.1833%)
Took 7678.6091401577 seconds.
Test set: Average loss: 0.8521, Top-5 Accuracy: 5915.0/6000 (98.5833%)
Took 7678.6091401577 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 4.3942, Top-1 Accuracy: 2373/6000 (39.5500%)
Took 7679.467825889587 seconds.
Test set: Average loss: 4.3942, Top-5 Accuracy: 4056.0/6000 (67.6000%)
Took 7679.467825889587 seconds.
Test set: Average loss: 3.4961, Top-1 Accuracy: 2926/6000 (48.7667%)
Took 7680.461690187454 seconds.
Test set: Average loss: 3.4961, Top-5 Accuracy: 4505.0/6000 (75.0833%)
Took 7680.461690187454 seconds.
Test set: Average loss: 1.7121, Top-1 Accuracy: 3962/6000 (66.0333%)
Took 7681.8558259010315 seconds.
Test set: Average loss: 1.7121, Top-5 Accuracy: 5429.0/6000 (90.4833%)
Took 7681.8558259010315 seconds.
Test set: Average loss: 1.5637, Top-1 Accuracy: 3658/6000 (60.9667%)
Took 7683.842020750046 seconds.
Test set: Average loss: 1.5637, Top-5 Accuracy: 5770.0/6000 (96.1667%)
Took 7683.842020750046 seconds.
Test set: Average loss: 2.3833, Top-1 Accuracy: 2938/6000 (48.9667%)
Took 7686.027846574783 seconds.
Test set: Average loss: 2.3833, Top-5 Accuracy: 5347.0/6000 (89.1167%)
Took 7686.027846574783 seconds.
Test set: Average loss: 4.7322, Top-1 Accuracy: 1898/6000 (31.6333%)
Took 7687.228642702103 seconds.
Test set: Average loss: 4.7322, Top-5 Accuracy: 3710.0/6000 (61.8333%)
Took 7687.228642702103 seconds.
Test set: Average loss: 5.0012, Top-1 Accuracy: 1630/6000 (27.1667%)
Took 7688.223066806793 seconds.
Test set: Average loss: 5.0012, Top-5 Accuracy: 3775.0/6000 (62.9167%)
Took 7688.223066806793 seconds.
Test set: Average loss: 2.5608, Top-1 Accuracy: 3119/6000 (51.9833%)
Took 7689.226358175278 seconds.
Test set: Average loss: 2.5608, Top-5 Accuracy: 5254.0/6000 (87.5667%)
Took 7689.226358175278 seconds.
Test set: Average loss: 0.8521, Top-1 Accuracy: 4571/6000 (76.1833%)
Took 7690.624066352844 seconds.
Test set: Average loss: 0.8521, Top-5 Accuracy: 5915.0/6000 (98.5833%)
Took 7690.624066352844 seconds.

Average Top-1 accuracy: tensor(50.1389)

----- Top1 acc: [83.66666412353516, 81.9000015258789, 53.40555191040039, 66.67916870117188, 66.00999450683594, 65.54166412353516, 61.2928581237793, 68.3125, 50.13888931274414]
----- Top5 acc: [99.71666717529297, 98.95833587646484, 87.2611083984375, 92.94166564941406, 93.49666595458984, 90.03611755371094, 87.98094940185547, 93.34999084472656, 81.03888702392578]
============== Continual learning on task 9 =================

[before adaption and growth]
Test set: Average loss: 2.2618, Top-1 Accuracy: 3089/6000 (51.4833%)
Took 7691.58857011795 seconds.
Test set: Average loss: 2.2618, Top-5 Accuracy: 5412.0/6000 (90.2000%)
Took 7691.58857011795 seconds.
old_data shape: torch.Size([10000, 3072])
new_data_1 shape: torch.Size([10000, 3072])
MMD loss:tensor(0.0129, device='cuda:0')
 ------ leaf nodes and corresponding confidence:
[6, 7, 8, 9]
tensor([0.0734, 0.6785, 0.0773, 0.1708], device='cuda:0')
[7, 9, 8, 6]


------------------- Fine-tuning the tree --------------------
Test set: Average loss: 2.2618, Top-1 Accuracy: 3089/6000 (51.4833%)
Took 7698.523566961288 seconds.
Test set: Average loss: 2.2618, Top-5 Accuracy: 5412.0/6000 (90.2000%)
Took 7698.523566961288 seconds.
False
False
False

Perform global training

----- Layer 5, Node 8, Epoch 1/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.366029
Train set: Average loss: 0.4273
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 1.7654, Accuracy: 37428/60000 (62%)
Took 7725.592503070831 seconds.
Test set: Average loss: 0.7493, Top-1 Accuracy: 4766/6000 (79.4333%)
Took 7726.457446813583 seconds.
Test set: Average loss: 0.7493, Top-5 Accuracy: 5936.0/6000 (98.9333%)
Took 7726.457446813583 seconds.

----- Layer 5, Node 8, Epoch 2/30, Patience 1/15---------
              [56320/60000 (0%)]      Loss: 0.193031
Train set: Average loss: 0.2250
Valid set: Average loss: 2.6255, Accuracy: 35203/60000 (59%)
Took 7753.829067468643 seconds.
Test set: Average loss: 1.0280, Top-1 Accuracy: 4725/6000 (78.7500%)
Took 7754.700177907944 seconds.
Test set: Average loss: 1.0280, Top-5 Accuracy: 5918.0/6000 (98.6333%)
Took 7754.700177907944 seconds.

----- Layer 5, Node 8, Epoch 3/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.136627
Train set: Average loss: 0.1454
Valid set: Average loss: 2.4768, Accuracy: 37347/60000 (62%)
Took 7782.143940448761 seconds.
Test set: Average loss: 1.3810, Top-1 Accuracy: 4518/6000 (75.3000%)
Took 7783.0121920108795 seconds.
Test set: Average loss: 1.3810, Top-5 Accuracy: 5858.0/6000 (97.6333%)
Took 7783.0121920108795 seconds.

----- Layer 5, Node 8, Epoch 4/30, Patience 2/15---------
              [56320/60000 (0%)]      Loss: 0.123693
Train set: Average loss: 0.1243
Valid set: Average loss: 2.4866, Accuracy: 37173/60000 (62%)
Took 7810.357360363007 seconds.
Test set: Average loss: 1.4486, Top-1 Accuracy: 4521/6000 (75.3500%)
Took 7811.229236125946 seconds.
Test set: Average loss: 1.4486, Top-5 Accuracy: 5818.0/6000 (96.9667%)
Took 7811.229236125946 seconds.

----- Layer 5, Node 8, Epoch 5/30, Patience 3/15---------
              [56320/60000 (0%)]      Loss: 0.102621
Train set: Average loss: 0.1045
Valid set: Average loss: 2.8310, Accuracy: 35545/60000 (59%)
Took 7838.405663728714 seconds.
Test set: Average loss: 1.4869, Top-1 Accuracy: 4595/6000 (76.5833%)
Took 7839.283015489578 seconds.
Test set: Average loss: 1.4869, Top-5 Accuracy: 5805.0/6000 (96.7500%)
Took 7839.283015489578 seconds.

----- Layer 5, Node 8, Epoch 6/30, Patience 4/15---------
              [56320/60000 (0%)]      Loss: 0.098080
Train set: Average loss: 0.0919
Valid set: Average loss: 3.0465, Accuracy: 35256/60000 (59%)
Took 7866.338400602341 seconds.
Test set: Average loss: 1.6619, Top-1 Accuracy: 4493/6000 (74.8833%)
Took 7867.212816238403 seconds.
Test set: Average loss: 1.6619, Top-5 Accuracy: 5764.0/6000 (96.0667%)
Took 7867.212816238403 seconds.

----- Layer 5, Node 8, Epoch 7/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.080261
Train set: Average loss: 0.0939
Valid set: Average loss: 2.8997, Accuracy: 36906/60000 (62%)
Took 7894.064117193222 seconds.
Test set: Average loss: 1.6402, Top-1 Accuracy: 4568/6000 (76.1333%)
Took 7894.9478504657745 seconds.
Test set: Average loss: 1.6402, Top-5 Accuracy: 5802.0/6000 (96.7000%)
Took 7894.9478504657745 seconds.

----- Layer 5, Node 8, Epoch 8/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.115347
Train set: Average loss: 0.0837
Valid set: Average loss: 2.6690, Accuracy: 36179/60000 (60%)
Took 7921.793661594391 seconds.
Test set: Average loss: 1.4865, Top-1 Accuracy: 4545/6000 (75.7500%)
Took 7922.672187805176 seconds.
Test set: Average loss: 1.4865, Top-5 Accuracy: 5796.0/6000 (96.6000%)
Took 7922.672187805176 seconds.

----- Layer 5, Node 8, Epoch 9/30, Patience 5/15---------
              [56320/60000 (0%)]      Loss: 0.103150
Train set: Average loss: 0.0763
Valid set: Average loss: 2.7358, Accuracy: 36974/60000 (62%)
Took 7949.458787679672 seconds.
Test set: Average loss: 1.6635, Top-1 Accuracy: 4535/6000 (75.5833%)
Took 7950.316860437393 seconds.
Test set: Average loss: 1.6635, Top-5 Accuracy: 5791.0/6000 (96.5167%)
Took 7950.316860437393 seconds.

----- Layer 5, Node 8, Epoch 10/30, Patience 6/15---------
              [56320/60000 (0%)]      Loss: 0.055033
Train set: Average loss: 0.0595
Valid set: Average loss: 3.2194, Accuracy: 36785/60000 (61%)
Took 7977.19246006012 seconds.
Test set: Average loss: 1.5510, Top-1 Accuracy: 4655/6000 (77.5833%)
Took 7978.078841686249 seconds.
Test set: Average loss: 1.5510, Top-5 Accuracy: 5849.0/6000 (97.4833%)
Took 7978.078841686249 seconds.

----- Layer 5, Node 8, Epoch 11/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.061899
Train set: Average loss: 0.0568
Valid set: Average loss: 2.7803, Accuracy: 37124/60000 (62%)
Took 8005.133291721344 seconds.
Test set: Average loss: 1.6067, Top-1 Accuracy: 4532/6000 (75.5333%)
Took 8005.992732048035 seconds.
Test set: Average loss: 1.6067, Top-5 Accuracy: 5803.0/6000 (96.7167%)
Took 8005.992732048035 seconds.

----- Layer 5, Node 8, Epoch 12/30, Patience 7/15---------
              [56320/60000 (0%)]      Loss: 0.052559
Train set: Average loss: 0.0520
Valid set: Average loss: 2.8593, Accuracy: 36765/60000 (61%)
Took 8033.868531942368 seconds.
Test set: Average loss: 1.8578, Top-1 Accuracy: 4525/6000 (75.4167%)
Took 8034.84863448143 seconds.
Test set: Average loss: 1.8578, Top-5 Accuracy: 5754.0/6000 (95.9000%)
Took 8034.84863448143 seconds.

----- Layer 5, Node 8, Epoch 13/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.063289
Train set: Average loss: 0.0666
Valid set: Average loss: 2.8455, Accuracy: 37007/60000 (62%)
Took 8062.115476369858 seconds.
Test set: Average loss: 1.5650, Top-1 Accuracy: 4628/6000 (77.1333%)
Took 8062.982096910477 seconds.
Test set: Average loss: 1.5650, Top-5 Accuracy: 5799.0/6000 (96.6500%)
Took 8062.982096910477 seconds.

----- Layer 5, Node 8, Epoch 14/30, Patience 8/15---------
              [56320/60000 (0%)]      Loss: 0.059496
Train set: Average loss: 0.0495
Valid set: Average loss: 3.0236, Accuracy: 35551/60000 (59%)
Took 8089.982573032379 seconds.
Test set: Average loss: 1.5955, Top-1 Accuracy: 4537/6000 (75.6167%)
Took 8090.848632097244 seconds.
Test set: Average loss: 1.5955, Top-5 Accuracy: 5789.0/6000 (96.4833%)
Took 8090.848632097244 seconds.

----- Layer 5, Node 8, Epoch 15/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.061257
Train set: Average loss: 0.0443
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.7249, Accuracy: 37867/60000 (63%)
Took 8119.317550420761 seconds.
Test set: Average loss: 1.5752, Top-1 Accuracy: 4620/6000 (77.0000%)
Took 8120.223538637161 seconds.
Test set: Average loss: 1.5752, Top-5 Accuracy: 5776.0/6000 (96.2667%)
Took 8120.223538637161 seconds.

----- Layer 5, Node 8, Epoch 16/30, Patience 9/15---------
              [56320/60000 (0%)]      Loss: 0.041440
Train set: Average loss: 0.0534
Valid set: Average loss: 2.8186, Accuracy: 37022/60000 (62%)
Took 8148.479321241379 seconds.
Test set: Average loss: 1.6340, Top-1 Accuracy: 4641/6000 (77.3500%)
Took 8149.3956027030945 seconds.
Test set: Average loss: 1.6340, Top-5 Accuracy: 5782.0/6000 (96.3667%)
Took 8149.3956027030945 seconds.

----- Layer 5, Node 8, Epoch 17/30, Patience 10/15---------
              [56320/60000 (0%)]      Loss: 0.031190
Train set: Average loss: 0.0379
Valid set: Average loss: 3.1091, Accuracy: 37552/60000 (63%)
Took 8177.6512887477875 seconds.
Test set: Average loss: 1.5152, Top-1 Accuracy: 4758/6000 (79.3000%)
Took 8178.556181430817 seconds.
Test set: Average loss: 1.5152, Top-5 Accuracy: 5816.0/6000 (96.9333%)
Took 8178.556181430817 seconds.

----- Layer 5, Node 8, Epoch 18/30, Patience 11/15---------
              [56320/60000 (0%)]      Loss: 0.029545
Train set: Average loss: 0.0534
Valid set: Average loss: 3.1985, Accuracy: 36502/60000 (61%)
Took 8206.790216684341 seconds.
Test set: Average loss: 1.6337, Top-1 Accuracy: 4589/6000 (76.4833%)
Took 8207.719410181046 seconds.
Test set: Average loss: 1.6337, Top-5 Accuracy: 5774.0/6000 (96.2333%)
Took 8207.719410181046 seconds.

----- Layer 5, Node 8, Epoch 19/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.044332
Train set: Average loss: 0.0469
Valid set: Average loss: 2.9450, Accuracy: 37176/60000 (62%)
Took 8235.9933218956 seconds.
Test set: Average loss: 1.7592, Top-1 Accuracy: 4554/6000 (75.9000%)
Took 8236.895339250565 seconds.
Test set: Average loss: 1.7592, Top-5 Accuracy: 5746.0/6000 (95.7667%)
Took 8236.895339250565 seconds.

----- Layer 5, Node 8, Epoch 20/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.044638
Train set: Average loss: 0.0461
Valid set: Average loss: 2.9242, Accuracy: 36515/60000 (61%)
Took 8265.080666542053 seconds.
Test set: Average loss: 1.6271, Top-1 Accuracy: 4636/6000 (77.2667%)
Took 8265.987014055252 seconds.
Test set: Average loss: 1.6271, Top-5 Accuracy: 5765.0/6000 (96.0833%)
Took 8265.987014055252 seconds.

----- Layer 5, Node 8, Epoch 21/30, Patience 12/15---------
              [56320/60000 (0%)]      Loss: 0.039721
Train set: Average loss: 0.0589
Valid set: Average loss: 2.9401, Accuracy: 36863/60000 (61%)
Took 8294.031381607056 seconds.
Test set: Average loss: 1.5297, Top-1 Accuracy: 4680/6000 (78.0000%)
Took 8294.932596206665 seconds.
Test set: Average loss: 1.5297, Top-5 Accuracy: 5817.0/6000 (96.9500%)
Took 8294.932596206665 seconds.

----- Layer 5, Node 8, Epoch 22/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.047806
Train set: Average loss: 0.0362
Valid set: Average loss: 2.8663, Accuracy: 37237/60000 (62%)
Took 8323.07637000084 seconds.
Test set: Average loss: 1.6964, Top-1 Accuracy: 4563/6000 (76.0500%)
Took 8323.98977303505 seconds.
Test set: Average loss: 1.6964, Top-5 Accuracy: 5754.0/6000 (95.9000%)
Took 8323.98977303505 seconds.

----- Layer 5, Node 8, Epoch 23/30, Patience 13/15---------
              [56320/60000 (0%)]      Loss: 0.035416
Train set: Average loss: 0.0440
Valid set: Average loss: 3.0566, Accuracy: 36378/60000 (61%)
Took 8352.029026508331 seconds.
Test set: Average loss: 1.7828, Top-1 Accuracy: 4531/6000 (75.5167%)
Took 8352.929731845856 seconds.
Test set: Average loss: 1.7828, Top-5 Accuracy: 5747.0/6000 (95.7833%)
Took 8352.929731845856 seconds.

----- Layer 5, Node 8, Epoch 24/30, Patience 14/15---------
              [56320/60000 (0%)]      Loss: 0.055482
Train set: Average loss: 0.0334
Valid set: Average loss: 3.7690, Accuracy: 33989/60000 (57%)
Took 8381.083522081375 seconds.
Test set: Average loss: 2.2265, Top-1 Accuracy: 4420/6000 (73.6667%)
Took 8381.955957651138 seconds.
Test set: Average loss: 2.2265, Top-5 Accuracy: 5630.0/6000 (93.8333%)
Took 8381.955957651138 seconds.

----- Layer 5, Node 8, Epoch 25/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.063835
Train set: Average loss: 0.0490
Valid set: Average loss: 3.1047, Accuracy: 35709/60000 (60%)
Took 8410.019115686417 seconds.
Test set: Average loss: 1.8260, Top-1 Accuracy: 4573/6000 (76.2167%)
Took 8410.920511960983 seconds.
Test set: Average loss: 1.8260, Top-5 Accuracy: 5766.0/6000 (96.1000%)
Took 8410.920511960983 seconds.

----- Layer 5, Node 8, Epoch 26/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.008271
Train set: Average loss: 0.0207
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_tmp.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_tmp.json
Valid set: Average loss: 2.7833, Accuracy: 37930/60000 (63%)
Took 8439.020618200302 seconds.
Test set: Average loss: 1.5887, Top-1 Accuracy: 4715/6000 (78.5833%)
Took 8439.921177864075 seconds.
Test set: Average loss: 1.5887, Top-5 Accuracy: 5816.0/6000 (96.9333%)
Took 8439.921177864075 seconds.

----- Layer 5, Node 8, Epoch 27/30, Patience 15/15---------
              [56320/60000 (0%)]      Loss: 0.002085
Train set: Average loss: 0.0024
Valid set: Average loss: 2.9975, Accuracy: 37703/60000 (63%)
Took 8468.337219953537 seconds.
Test set: Average loss: 1.6835, Top-1 Accuracy: 4737/6000 (78.9500%)
Took 8469.239534854889 seconds.
Test set: Average loss: 1.6835, Top-5 Accuracy: 5808.0/6000 (96.8000%)
Took 8469.239534854889 seconds.
Early stopping by patience!
return the class-wise best tmp model
Model saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/model_cft.pth
Tree structure saved to ./experiments/cifar10/test_ant_cifar10/0313/checkpoints/tree_structures_cft.json
after growth:
Test set: Average loss: 1.5887, Top-1 Accuracy: 4715/6000 (78.5833%)
Took 8470.182531356812 seconds.
Test set: Average loss: 1.5887, Top-5 Accuracy: 5816.0/6000 (96.9333%)
Took 8470.182531356812 seconds.
 ========================== test all task models ==========================
Test set: Average loss: 2.0276, Top-1 Accuracy: 4290/6000 (71.5000%)
Took 8471.082952022552 seconds.
Test set: Average loss: 2.0276, Top-5 Accuracy: 5768.0/6000 (96.1333%)
Took 8471.082952022552 seconds.
Test set: Average loss: 1.7342, Top-1 Accuracy: 4549/6000 (75.8167%)
Took 8472.130831480026 seconds.
Test set: Average loss: 1.7342, Top-5 Accuracy: 5729.0/6000 (95.4833%)
Took 8472.130831480026 seconds.
Test set: Average loss: 4.4236, Top-1 Accuracy: 2195/6000 (36.5833%)
Took 8473.614759922028 seconds.
Test set: Average loss: 4.4236, Top-5 Accuracy: 4519.0/6000 (75.3167%)
Took 8473.614759922028 seconds.
Test set: Average loss: 1.4847, Top-1 Accuracy: 4799/6000 (79.9833%)
Took 8475.718646764755 seconds.
Test set: Average loss: 1.4847, Top-5 Accuracy: 5815.0/6000 (96.9167%)
Took 8475.718646764755 seconds.
Test set: Average loss: 1.8292, Top-1 Accuracy: 4513/6000 (75.2167%)
Took 8478.006335735321 seconds.
Test set: Average loss: 1.8292, Top-5 Accuracy: 5729.0/6000 (95.4833%)
Took 8478.006335735321 seconds.
Test set: Average loss: 2.4799, Top-1 Accuracy: 3940/6000 (65.6667%)
Took 8479.252710819244 seconds.
Test set: Average loss: 2.4799, Top-5 Accuracy: 5640.0/6000 (94.0000%)
Took 8479.252710819244 seconds.
Test set: Average loss: 6.3462, Top-1 Accuracy: 1821/6000 (30.3500%)
Took 8480.301153182983 seconds.
Test set: Average loss: 6.3462, Top-5 Accuracy: 4349.0/6000 (72.4833%)
Took 8480.301153182983 seconds.
Test set: Average loss: 1.9334, Top-1 Accuracy: 4499/6000 (74.9833%)
Took 8481.352330207825 seconds.
Test set: Average loss: 1.9334, Top-5 Accuracy: 5750.0/6000 (95.8333%)
Took 8481.352330207825 seconds.
Test set: Average loss: 3.9853, Top-1 Accuracy: 2609/6000 (43.4833%)
Took 8482.82282447815 seconds.
Test set: Average loss: 3.9853, Top-5 Accuracy: 4638.0/6000 (77.3000%)
Took 8482.82282447815 seconds.
Test set: Average loss: 1.5887, Top-1 Accuracy: 4715/6000 (78.5833%)
Took 8483.72436761856 seconds.
Test set: Average loss: 1.5887, Top-5 Accuracy: 5816.0/6000 (96.9333%)
Took 8483.72436761856 seconds.

Average Top-1 accuracy: tensor(63.2167)

----- Top1 acc: [83.66666412353516, 81.9000015258789, 53.40555191040039, 66.67916870117188, 66.00999450683594, 65.54166412353516, 61.2928581237793, 68.3125, 50.13888931274414, 63.2166633605957]
----- Top5 acc: [99.71666717529297, 98.95833587646484, 87.2611083984375, 92.94166564941406, 93.49666595458984, 90.03611755371094, 87.98094940185547, 93.34999084472656, 81.03888702392578, 89.58834075927734]
